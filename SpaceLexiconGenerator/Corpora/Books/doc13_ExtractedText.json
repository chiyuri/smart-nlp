{"content": "\nSpace Technology Library\n\nF. Landis Markley\nJohn L. Crassidis\n\nFundamentals \nof Spacecraft \nAttitude \nDetermination \nand Control\n\n\n\nFundamentals of Spacecraft Attitude Determination\nand Control\n\n\n\nSPACE TECHNOLOGY LIBRARY\nPublished jointly by Microcosm Press and Springer\n\nThe Space Technology Library Editorial Board\n\nManaging Editor: James R. Wertz (Microcosm, Inc., El Segundo, CA)\n\nEditorial Board: Roland Dor\u00e9 (Professor and Director International Space Univer-\nsity, Strasbourg)\nTom Logsdon (Senior member of Technical Staff, Space Divi-\nsion, Rockwell International)\nF. Landis Markley (NASA, Goddard Space Flight Center)\nRobert G. Melton (Professor of Aerospace Engineering, Penn-\nsylvania State University)\nKeiken Ninomiya (Professor, Institute of Space & Astronautical\nScience)\nJehangir J. Pocha (Letchworth, Herts.)\nRex W. Ridenoure (CEO and Co-founder at Ecliptic Enterprises\nCorporation)\nGael Squibb (Jet Propulsion Laboratory, California Institute of\nTechnology)\nMartin Sweeting (Professor of Satellite Engineering, University\nof Surrey)\nDavid A. Vallado (Senior Research Astrodynamicist, CSSI/AGI)\nRichard Van Allen (Vice President and Director, Space Systems\nDivision, Microcosm, Inc.)\n\nFor further volumes:\nhttp://www.springer.com/series/6575\n\nhttp://www.springer.com/series/6575\n\n\nF. Landis Markley \u2022 John L. Crassidis\n\nFundamentals of Spacecraft\nAttitude Determination\nand Control\n\n123\n\n\n\nF. Landis Markley\nAttitude Control Systems\n\nEngineering Branch\nNASA Goddard Space Flight Center\nGreenbelt, MD, USA\n\nJohn L. Crassidis\nMechanical and Aerospace Engineering\nUniversity at Buffalo\nState University of New York\nAmherst, NY, USA\n\nISBN 978-1-4939-0801-1 ISBN 978-1-4939-0802-8 (eBook)\nDOI 10.1007/978-1-4939-0802-8\nSpringer New York Heidelberg Dordrecht London\n\nLibrary of Congress Control Number: 2014937452\n\n\u00a9 Springer Science+Business Media New York 2014\nThis work is subject to copyright. All rights are reserved by the Publisher, whether the whole or part of\nthe material is concerned, specifically the rights of translation, reprinting, reuse of illustrations, recitation,\nbroadcasting, reproduction on microfilms or in any other physical way, and transmission or information\nstorage and retrieval, electronic adaptation, computer software, or by similar or dissimilar methodology\nnow known or hereafter developed. Exempted from this legal reservation are brief excerpts in connection\nwith reviews or scholarly analysis or material supplied specifically for the purpose of being entered\nand executed on a computer system, for exclusive use by the purchaser of the work. Duplication of\nthis publication or parts thereof is permitted only under the provisions of the Copyright Law of the\nPublisher\u2019s location, in its current version, and permission for use must always be obtained from Springer.\nPermissions for use may be obtained through RightsLink at the Copyright Clearance Center. Violations\nare liable to prosecution under the respective Copyright Law.\nThe use of general descriptive names, registered names, trademarks, service marks, etc. in this publication\ndoes not imply, even in the absence of a specific statement, that such names are exempt from the relevant\nprotective laws and regulations and therefore free for general use.\nWhile the advice and information in this book are believed to be true and accurate at the date of\npublication, neither the authors nor the editors nor the publisher can accept any legal responsibility for\nany errors or omissions that may be made. The publisher makes no warranty, express or implied, with\nrespect to the material contained herein.\n\nSpringer grants the United States government royalty-free permission to reproduce all or part of this\nwork and to authorize others to do so for United States government purposes.\n\nPrinted on acid-free paper\n\nSpringer is part of Springer Science+Business Media (www.springer.com)\n\nwww.springer.com\n\n\nTo Gail, Michelle, and Isaac.\nTo Pam and Lucas,\n\nand in memory of Lucas G.J. Crassidis.\n\n\n\n\n\nPreface\n\nThis text provides the fundamental concepts and mathematical basis for spacecraft\nattitude determination and control. It is intended to serve as both a textbook\nfor undergraduate and graduate students and a reference guide for practicing\nprofessionals. A primary motivation of this text is to develop the theory of attitude\ndetermination from first principles to practical algorithms, because very few of the\nexisting texts on spacecraft control treat spacecraft attitude determination in depth.\nWe emphasize specific applications; so the reader can understand how the derived\ntheory is applied to actual orbiting spacecraft. We also highlight some simplified\nanalytical expressions that can serve as first cut analyses for more detailed studies\nand are especially important in the initial design phase of a spacecraft attitude\ndetermination and control system. For example, Sect. 6.3 shows a simple single-\naxis analysis that is widely used by spacecraft engineers to design actual attitude\nestimation hardware and software configurations and to predict their performance.\nAnalyses of this type can also help to determine whether anomalous behavior\nencountered by an orbiting spacecraft is due to a hardware problem, a control\nsystem design error, or a programming error, and to find a path to resolving the\nanomaly. In writing this book the authors hope to make a significant contribution\ntoward expediting the process most newcomers must go through in assimilating and\napplying attitude determination and control theory.\n\nChapter 1 provides an introduction to the concepts presented in the text. It serves\nto motivate the reader by giving a historical review of the subject matter, including\ndiscussions of several actual missions that cover a broad spectrum of attitude\ndetermination and control designs. It also provides examples of how an inadequate\ntheoretical analysis can cause a failure to meet mission objectives or, even worse,\nloss of a mission. Some examples of creative strategies to recover from potential\nmission failures are also presented. Chapter 2 begins with a review of linear algebra\nand moves on to the basic ideas of spacecraft attitude studies: reference frames,\ntransformations between reference frames, and alternative representations of these\ntransformations. Chapter 3 provides detailed derivations of attitude kinematics and\ndynamics, including a treatment of the torques acting on spacecraft. Chapter 4\nprovides the mathematical models behind the most common types of spacecraft\n\nvii\n\n\n\nviii Preface\n\nsensors and actuators. Actual hardware specifications of these sensors and actuators\nare not given because the rapid development of this technology would quickly\nrender them obsolete. Chapter 5 is a detailed treatment of attitude determination\nmethods that do not depend on a retained memory of past observations. The most\nfamous method in this category, the solution of Wahba\u2019s problem, is introduced,\naccompanied by several algorithms for solving it and a rigorous statistical analysis\nof its estimation errors. Chapter 6 covers attitude determination methods that\nmitigate the effects of sensor errors by incorporating dynamic models into a filtering\nprocess to retain a memory of past observations. Here the focus is on Kalman\nfiltering, including both calibration and mission mode filters. Chapter 7 shows the\nfundamentals of attitude control, including some recent theoretical advancements\non the effects of noise on the control system design.\n\nThis book is the product of many years of experience possessed by the authors\nworking on actual spacecraft attitude determination and control designs for numer-\nous missions. Several actual mission examples are presented throughout the text to\nhelp the reader bridge the gap between theory and practice. For example, Sect. 5.8\npresents an attitude determination algorithm that is employed onboard the Tropical\nRainfall Measuring Mission (TRMM) as of this writing. Most of the mission\nexamples in this text provide representative examples of typical mission mode\ndesigns. However, the authors wish to also show how the theory presented in the text\ncan be applied to nonstandard mission modes derived from unique requirements.\nSection 7.7 presents the specific example of the range of mission modes actually\nused in the attitude determination and control system of the Solar, Anomalous, and\nMagnetospheric Particle Explorer (SAMPEX), each mode responding to its own\nunique challenges. Section 6.4.5 presents experimental magnetometer calibration\nresults from the Transition Region and Coronal Explorer (TRACE) to give the reader\na taste of how algorithm designs perform with real data. All of the examples are\nbased on a \u201cground up\u201d approach, i.e., starting with the fundamentals and leading\ntowards an actual onboard algorithm.\n\nAs stated previously, this text can be used for an undergraduate course in\nspacecraft dynamics and controls. The second author has taught a senior level course\nin this area for many years, which is split into two parts: (1) orbital dynamics\nand (2) attitude kinematics and dynamics. Chapter 10 provides the material that\nis used for the orbital dynamics portion of the course. Chapters 2 and 3 provide the\nnecessary material for the attitude kinematics and dynamics portion of the course.\n\nChapter 8 gives a list of quaternion identities, many of which have not appeared\nin open literature. Chapter 9 presents the explicit equations for the attitude matrices\nand kinematic equations for all 12 Euler angle representations of the attitude.\nChapter 10 gives an overview of orbital dynamics to provide the background\nrequired to understand several topics in the text, such as the local-vertical/local-\nhorizontal frame in Sect. 2.6.4. Chapter 11 provides a summary of environment\nmodels, which is crucial to understanding their effect on spacecraft translational\nand rotational motion. Chapter 12 reviews the theoretical basis of general control\nand estimation in enough detail to refresh the reader\u2019s memory of the concepts that\nunderlie the applications in the text.\n\n\n\nPreface ix\n\nMaterial for a graduate level course can include a brief review of orbital dynamics\nfrom Chapter 10 followed by the environmental models shown in Chapter 11.\nChapters 5 and 6 can provide the bulk of a graduate course covering attitude\ndetermination and estimation. Chapter 7 can also be used in the graduate course to\nprovide an introduction to attitude control. The authors believe that the entire book\ncan serve as a reference or refresher for practitioners, which provides the primary\nmotivation for including Chap. 4 in the text.\n\nTo encourage student learning we have incorporated both analytical and\ncomputer-based problems at the end of each chapter. This promotes working\nproblems from first principles. General computer software and coded scripts have\ndeliberately not been included with this text. Instead, a website with computer\nprograms for all the examples shown in the text can be accessed by the reader\n\nsubject, we feel that they may hinder rigorous theoretical studies that are required\nto properly comprehend the material. Therefore, we strongly encourage students to\nprogram their own computer routines, using the codes provided from the website\nfor verification purposes only.\n\nWe are indebted to numerous colleagues and students for contributions to various\naspects of this work. In particular, we wish to express our gratitude to Mark Psiaki\nand especially to John Junkins for encouraging us to write this book. Many students\nhave provided excellent insights and recommendations to enhance the pedagogical\nvalue, as well as developing new problems that are used as exercises. Although\nthere are far too many students to name individually here, our sincere appreciation\ngoes out to them. We do wish to acknowledge the significant contributions on the\nsubject matter to the following individuals: Christopher Nebelecky for providing the\nsection on the disturbing forces in Sect. 10.3, Agamemnon Crassidis for providing\ninputs on the sliding mode control in Sect. 12.2.3, John Downing for suggesting the\ndodecahedral wheel configuration in Sect. 4.8.3, and Sam Placanica for providing\nFig. 4.16. Our heartfelt thanks to the following individuals for proofreading the text:\nMichael Andrle, J. Russell Carpenter, Yang Cheng, Joanna Hinks, Alice Liu, Adonis\nPimienta-Pe\u00f1alver, Steve Queen, Matthias Schmid, and Matthew Whittaker. We also\nwish to thank the following individuals for their many discussions and insights\nthroughout the development of this book: K. Terry Alfriend, Roberto Alonso, Penina\nAxelrad, Itzhack Bar-Itzhack, Frank Bauer, J. Russell Carpenter, Yang Cheng,\nDaniel Choukroun, Neil Dennehy, Adam Fosbury, Michael Griffin, Christopher\nHall, Joanna Hinks, Henry Hoffman, Kathleen Howell, Johnny Hurtado, Moriba\nJah, Jer-Nan Juang, N. Jeremy Kasdin, Ken Lebsock, E. Glenn Lightsey, Richard\nLinares, Michael Lisano, Alice Liu, Manoranjan Majji, D. Joseph Mook, Daniele\nMortari, Jim O\u2019Donnell, Yaakov Oshman, Mark Pittelkau, Steve Queen, Reid\nReynolds, Hanspeter Schaub, Conrad Schiff, Malcolm Shuster, Tarun Singh, Puneet\nSingla, Eric Stoneking, Sergei Tanygin, Julie Thienel, Panagiotis Tsiotras, James\nTurner, S. Rao Vadali, James Wertz, Bong Wie, and Renato Zanetti. Also, many\nthanks are due to several people at Springer, including our editor Maury Solomon,\nour assistant editor Nora Rawn, and Harry (J.J.) Blom. Finally, our deepest and\nmost sincere appreciation must be expressed to our families for their patience and\n\n(see Appendix). Although computer routines can provide some insights into the\n\n\n\nx Preface\n\nunderstanding throughout the years while we prepared this text. This text was\nproduced using LATEX 2\"(thanks Yaakov and HP!). Any corrections are welcome\nvia email to Landis.Markley@nasa.gov or johnc@buffalo.edu.\n\nGreenbelt, MD, USA F. Landis Markley\nAmherst, NY, USA John L. Crassidis\n\n\n\nContents\n\n1 Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1\nReferences . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 15\n\n2 Matrices, Vectors, Frames, Transforms . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 17\n2.1 Matrices . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 17\n2.2 Vectors . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 21\n2.3 Jacobian, Gradient, and Hessian . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 22\n2.4 Orthonormal Bases, Change of Basis . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 24\n2.5 Vectors in Three Dimensions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 28\n2.6 Some Useful Reference Frames . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 31\n\n2.6.1 Spacecraft Body Frame. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 31\n2.6.2 Inertial Reference Frames . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 31\n2.6.3 Earth-Centered/Earth-Fixed Frame . . . . . . . . . . . . . . . . . . . . . . . . 32\n2.6.4 Local-Vertical/Local-Horizontal Frame . . . . . . . . . . . . . . . . . . . 36\n\n2.7 Quaternions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 37\n2.8 Rotations and Euler\u2019s Theorem . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 40\n2.9 Attitude Representations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 41\n\n2.9.1 Euler Axis/Angle Representation . . . . . . . . . . . . . . . . . . . . . . . . . . 41\n2.9.2 Rotation Vector Representation . . . . . . . . . . . . . . . . . . . . . . . . . . . . 44\n2.9.3 Quaternion Representation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 45\n2.9.4 Rodrigues Parameter Representation . . . . . . . . . . . . . . . . . . . . . . 48\n2.9.5 Modified Rodrigues Parameters . . . . . . . . . . . . . . . . . . . . . . . . . . . 50\n2.9.6 Euler Angles . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 52\n\n2.10 Attitude Error Representations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 59\nReferences . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 64\n\n3 Attitude Kinematics and Dynamics. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 67\n3.1 Attitude Kinematics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 68\n\n3.1.1 Attitude Matrix . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 68\n3.1.2 Vector Addition of Angular Velocity . . . . . . . . . . . . . . . . . . . . . . 69\n3.1.3 Vector Kinematics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 70\n\nxi\n\n\n\nxii Contents\n\n3.2 Kinematics of Attitude Parameterizations . . . . . . . . . . . . . . . . . . . . . . . . . . 71\n3.2.1 Quaternion Kinematics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 71\n3.2.2 Rodrigues Parameter Kinematics . . . . . . . . . . . . . . . . . . . . . . . . . . 72\n3.2.3 Modified Rodrigues Parameter Kinematics . . . . . . . . . . . . . . . 72\n3.2.4 Rotation Vector Kinematics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 72\n3.2.5 Euler Angle Kinematics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 73\n3.2.6 Attitude Error Kinematics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 76\n\n3.3 Attitude Dynamics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 77\n3.3.1 Angular Momentum and Kinetic Energy . . . . . . . . . . . . . . . . . . 77\n3.3.2 Rigid Body Dynamics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 80\n3.3.3 Rigid Body Motion . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 84\n3.3.4 Torque-Free Motion of a Rigid Body . . . . . . . . . . . . . . . . . . . . . . 90\n3.3.5 Internal Torques . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 99\n3.3.6 External Torques . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 103\n3.3.7 Angular Momentum for Health Monitoring . . . . . . . . . . . . . . . 111\n3.3.8 Dynamics of Earth-Pointing Spacecraft . . . . . . . . . . . . . . . . . . . 112\n\nReferences . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 121\n\n4 Sensors and Actuators . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 123\n4.1 Redundancy. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 123\n4.2 Star Trackers . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 125\n\n4.2.1 Overview . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 125\n4.2.2 Modes of Operation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 126\n4.2.3 Field of View, Resolution, Update Rate . . . . . . . . . . . . . . . . . . . 127\n4.2.4 Star Catalogs . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 129\n4.2.5 Proper Motion, Parallax, and Aberration . . . . . . . . . . . . . . . . . . 130\n\n4.3 Sun Sensors . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 133\n4.4 Horizon Sensors . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 135\n4.5 Magnetometers . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 135\n4.6 Global Positioning System. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 136\n\n4.6.1 GPS Satellites . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 138\n4.7 Gyroscopes . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 140\n\n4.7.1 Gyro Measurement Model . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 143\n4.8 Reaction Wheels. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 147\n\n4.8.1 Reaction Wheel Characteristics . . . . . . . . . . . . . . . . . . . . . . . . . . . . 148\n4.8.2 Reaction Wheel Disturbances . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 148\n4.8.3 Redundant Wheel Configurations. . . . . . . . . . . . . . . . . . . . . . . . . . 152\n\n4.9 Control Moment Gyros . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 166\n4.10 Magnetic Torquers . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 168\n4.11 Thrusters . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 169\n4.12 Nutation Dampers . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 170\nReferences . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 178\n\n5 Static Attitude Determination Methods . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 183\n5.1 The TRIAD Algorithm. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 184\n5.2 Wahba\u2019s Problem . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 186\n\n\n\nContents xiii\n\n5.3 Quaternion Solutions of Wahba\u2019s Problem . . . . . . . . . . . . . . . . . . . . . . . . . 187\n5.3.1 Davenport\u2019s q Method . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 187\n5.3.2 Quaternion Estimator (QUEST) . . . . . . . . . . . . . . . . . . . . . . . . . . . 189\n5.3.3 Another View of QUEST. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 191\n5.3.4 Method of Sequential Rotations . . . . . . . . . . . . . . . . . . . . . . . . . . . 192\n5.3.5 Estimator of the Optimal Quaternion (ESOQ) . . . . . . . . . . . . 194\n5.3.6 Second Estimator of the Optimal Quaternion (ESOQ2) . . 195\n\n5.4 Matrix Solutions of Wahba\u2019s Problem . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 196\n5.4.1 Singular Value Decomposition (SVD) Method . . . . . . . . . . . 196\n5.4.2 Fast Optimal Attitude Matrix (FOAM) . . . . . . . . . . . . . . . . . . . . 198\n5.4.3 Wahba\u2019s Problem with Two Observations . . . . . . . . . . . . . . . . . 199\n\n5.5 Error Analysis of Wahba\u2019s Problem . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 201\n5.5.1 Attitude Error Vector . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 201\n5.5.2 Covariance Analysis of Wahba\u2019s Problem. . . . . . . . . . . . . . . . . 204\n5.5.3 Covariance with Two Observations . . . . . . . . . . . . . . . . . . . . . . . . 207\n\n5.6 MLE for Attitude Determination . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 208\n5.6.1 Fisher Information Matrix for Attitude Determination . . . 212\n\n5.7 Induced Attitude Errors from Orbit Errors . . . . . . . . . . . . . . . . . . . . . . . . . . 216\n5.8 TRMM Attitude Determination . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 218\n5.9 GPS Attitude Determination . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 223\nReferences . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 231\n\n6 Filtering for Attitude Estimation and Calibration . . . . . . . . . . . . . . . . . . . . . . 235\n6.1 Attitude Representations for Kalman Filtering . . . . . . . . . . . . . . . . . . . . . 236\n\n6.1.1 Three-Component Representations . . . . . . . . . . . . . . . . . . . . . . . . 236\n6.1.2 Additive Quaternion Representation. . . . . . . . . . . . . . . . . . . . . . . 237\n6.1.3 Multiplicative Quaternion Representation. . . . . . . . . . . . . . . . . 239\n\n6.2 Attitude Estimation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 240\n6.2.1 Kalman Filter Formulation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 240\n6.2.2 Gyro Calibration Kalman Smoother . . . . . . . . . . . . . . . . . . . . . . . 246\n6.2.3 Filtering and the QUEST Measurement Model . . . . . . . . . . . 254\n6.2.4 Mission Mode Kalman Filter . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 257\n6.2.5 Murrell\u2019s Version . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 260\n\n6.3 Farrenkopf\u2019s Steady-State Analysis . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 263\n6.4 Magnetometer Calibration . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 269\n\n6.4.1 Measurement Model . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 270\n6.4.2 Centered Solution. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 272\n6.4.3 The TWOSTEP Algorithm. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 274\n6.4.4 Extended Kalman Filter Approach . . . . . . . . . . . . . . . . . . . . . . . . 276\n6.4.5 TRACE Spacecraft Results . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 277\n\nReferences . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 283\n\n7 Attitude Control . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 287\n7.1 Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 287\n7.2 Attitude Control: Regulation Case . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 289\n\n\n\nxiv Contents\n\n7.3 Attitude Control: Tracking Case . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 294\n7.3.1 Alternative Formulation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 301\n\n7.4 Attitude Thruster Control . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 303\n7.5 Magnetic Torque Attitude Control . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 307\n\n7.5.1 Detumbling . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 308\n7.5.2 Momentum Dumping. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 311\n\n7.6 Effects of Noise . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 312\n7.7 SAMPEX Control Design . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 318\n\n7.7.1 Attitude Determination . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 321\n7.7.2 Magnetic Torque Control Law . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 324\n7.7.3 Science Modes . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 324\n7.7.4 Reaction Wheel Control Law . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 332\n7.7.5 Simulations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 333\n\nReferences . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 341\n\n8 Quaternion Identities. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 345\n8.1 Cross Product Identities . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 345\n8.2 Basic Quaternion Identities . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 346\n8.3 The Matrices ?.q/, ?.q/, ?.!/, and ? .!/ . . . . . . . . . . . . . . . . . . . . . . . . 349\n8.4 Identities Involving the Attitude Matrix . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 350\n8.5 Error Quaternions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 354\n8.6 Quaternion Kinematics. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 355\nReferences . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 359\n\n9 Euler Angles . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 361\n\n10 Orbital Dynamics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 365\n10.1 Geometry of Ellipses . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 365\n10.2 Keplerian Motion . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 370\n\n10.2.1 Classical Orbital Elements . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 374\n10.2.2 Kepler\u2019s Equation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 376\n10.2.3 Orbit Propagation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 379\n\n10.3 Disturbing Forces . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 382\n10.3.1 Non-Spherical Gravity . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 382\n10.3.2 Third-Body Forces. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 388\n10.3.3 Atmospheric Drag . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 389\n10.3.4 Solar Radiation Pressure . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 390\n\n10.4 Perturbation Methods . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 392\n10.4.1 Variation of Parameters. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 392\n10.4.2 Two Line Elements . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 393\n10.4.3 A Useful Approximation, Secular J2 Effects Only . . . . . . . 395\n10.4.4 Sun-Synchronous Orbits . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 397\n\n10.5 Lagrange Points . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 398\nReferences . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 402\n\n\n\nContents xv\n\n11 Environment Models . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 403\n11.1 Magnetic Field Models. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 403\n\n11.1.1 Dipole Model . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 404\n11.2 Atmospheric Density . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 406\n\n11.2.1 Exponentially Decaying Model Atmosphere . . . . . . . . . . . . . . 406\n11.2.2 Harris-Priester Model Atmosphere . . . . . . . . . . . . . . . . . . . . . . . . 407\n11.2.3 Jacchia and GOST Model Atmospheres . . . . . . . . . . . . . . . . . . . 408\n11.2.4 Jacchia-Bowman 2008 (JB2008) Model Atmosphere . . . . 409\n\n11.3 Sun Position, Radiation Pressure, and Eclipse Conditions . . . . . . . . . 420\n11.4 Orbital Ephemerides of the Sun, Moon, and Planets . . . . . . . . . . . . . . . 422\nReferences . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 423\n\n12 Review of Control and Estimation Theory . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 425\n12.1 System Modeling . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 425\n\n12.1.1 Inverted Pendulum Modeling . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 425\n12.1.2 State and Observation Models . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 428\n12.1.3 Discrete-Time Systems . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 434\n\n12.2 Control Theory . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 437\n12.2.1 Basic Linear Control Design . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 437\n12.2.2 Stability of Nonlinear Dynamic Systems . . . . . . . . . . . . . . . . . . 442\n12.2.3 Sliding-Mode Control . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 444\n\n12.3 Estimation Theory . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 448\n12.3.1 Static-Based and Filter-Based Estimation . . . . . . . . . . . . . . . . . 449\n12.3.2 Batch Least Squares Estimation . . . . . . . . . . . . . . . . . . . . . . . . . . . 451\n12.3.3 Sequential Least Squares Estimation . . . . . . . . . . . . . . . . . . . . . . 453\n12.3.4 Maximum Likelihood Estimation. . . . . . . . . . . . . . . . . . . . . . . . . . 454\n12.3.5 Nonlinear Least Squares . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 456\n12.3.6 Advantages and Disadvantages . . . . . . . . . . . . . . . . . . . . . . . . . . . . 462\n12.3.7 State Estimation Techniques . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 462\n12.3.8 Linear Covariance Analysis . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 470\n12.3.9 Separation Theorem . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 470\n\nReferences . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 473\n\nAppendix: Computer Software . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 475\n\nIndex . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 477\n\n\n\nChapter 1\nIntroduction\n\nSpacecraft attitude determination and control covers the entire range of techniques\nfor determining the orientation of a spacecraft and then controlling it so that the\nspacecraft points in some desired direction. The attitude estimation and attitude\ncontrol problems are coupled, but they can be considered separately to some extent.\nThe separation theorem for linear systems shown in Sect. 12.3.9 tells us that the\ncontrol system can be designed without considering the estimator and vice versa.\nSpecifically, the feedback gains in the control system can be chosen assuming that\nthe system\u2019s state is perfectly known. No general separation theorem exists for\nnonlinear systems, including spacecraft attitude control systems, but the pointing\nrequirements for most space missions have been satisfied by designing the attitude\ndetermination and control systems separately.\n\nIt is sometimes useful to distinguish between attitude determination and attitude\nestimation, although this distinction is often blurred. Attitude determination in this\nstrict sense refers to memoryless approaches that determine the attitude point-by-\npoint in time, quite often without taking the statistical properties of the attitude\nmeasurements into account. Attitude estimation, on the other hand, refers to\napproaches with memory, i.e. those that use a dynamic model of the spacecraft\u2019s\nmotion in a filter that retains information from a series of measurements taken over\ntime.\n\nMalcolm Shuster made the incisive observation that attitude estimation is the\nyoungest of the four quadrants of astronautics shown in Table 1.1, which is\nadapted from his work [33]. The table shows the attitude estimation quadrant\nto be actually empty before the launch of Sputnik, the first artificial satellite, in\n1957. As Shuster pointed out,\u201cThere were, apparently no eighteenth- or nineteenth-\ncentury contributors to attitude estimation of even modest calibre,\u201d because \u201cthere\nwas simply no great problem in Attitude Estimation waiting to be solved.\u201d The field\nof attitude estimation actually remained in a very underdeveloped state even into the\n\nF.L. Markley and J.L. Crassidis, Fundamentals of Spacecraft Attitude Determination\nand Control, Space Technology Library 33, DOI 10.1007/978-1-4939-0802-8__1,\n\u00a9 Springer Science+Business Media New York 2014\n\n1\n\n\n\n2 1 Introduction\n\nTable 1.1 Founders of\nastronautics\n\nDynamics Estimation\n\nOrbit Newton (1642\u20131727) Kepler (1571\u20131630\nLagrange (1736\u20131813) Lagrange (1736\u20131813)\nHamilton (1805\u20131865) Gauss (1777\u20131855)\nEinstein (1874\u20131955)\n\nAttitude Euler (1707\u20131783) (gone fishin\u2019)\nCayley (1821\u20131895)\n\nlate 1970s, although hundreds of spacecraft missions existed by that time, starting\nwith Sputnik and including the Apollo missions from the late 1960s to the early\n1970s.\n\nA natural question is: \u201cWith all these missions why didn\u2019t attitude estimation\nbecome important until the late 1970s?\u201d The answer does not necessarily lie in\nthe absence of mathematical developments, as one might expect. Harold Black\nhad developed the algebraic method for the point-by-point determination of a\nspacecraft\u2019s attitude from a set of two vector observations in 1964 [4, 24]. Shuster\nlater renamed this algorithm TRIAD [35], the name stemming from an IBM Federal\nSystems Division internal report called \u201cTri-Axial Attitude Determination System.\u201d\nOne year after Black\u2019s breakthrough, Grace Wahba published her famous attitude\ndetermination problem involving any number of vector observations [40]; but the\nfirst solutions of this problem never found practical application [13]. The first\npractical algorithm was Paul Davenport\u2019s celebrated q method, which solved for the\nquaternion parameterizing the attitude [24]. Unfortunately, this algorithm required\nperforming an eigenvalue/eigenvector decomposition of a 4?4 matrix. It was used\nto support NASA\u2019s High Energy Astronomy Observatories (HEAO 1\u20133) [10], but\nwas not practical for most missions on even the mainframe computers of the\n1970s [34]. Shuster developed his QUaternion ESTimator (QUEST), which did not\nrequire an eigenvalue/eigenvector decomposition, to meet the greater throughput\ndemands of the Magsat mission, launched in late 1979 [35]. Many other practical\nsolutions to Wahba\u2019s problem have been developed since that time, but QUEST was\nthe first algorithm suited to onboard computer processors and is still the most widely\nemployed [27].\n\nJames Farrell published the first known paper using a Kalman filter for attitude\nestimation in 1970 [12], but a constant-gain filter had been proposed earlier [21],\nand Kalman filters for attitude estimation had appeared previously in contractor\nreports [11] and conference reports [30, 39]. Kalman filters were employed during\nthe late 1970s and early 1980s to both filter noisy measurements and estimate for\nthe attitude and gyro biases. The spacecraft dynamics and measurement models\nare nonlinear, though, so the filter is actually a quasi-linear extended Kalman filter\n(EKF, see Sect. 12.3.7.2), which does not possess the guaranteed convergence that\nthe linear Kalman filter has. The EKF provides higher accuracy attitude estimates\nthan point-by-point methods, but it is more expensive computationally, and the\nthreat of divergence made attitude control engineers initially slow to adopt it. Farrell\nused the Euler angle attitude parameterization [12], but implementations using\n\n\n\n1 Introduction 3\n\nthe quaternion parameterization had gained prominence by the mid 1970s [29].\nA survey paper on quaternion-based attitude EKFs appeared in 1982, bringing more\nattention to that approach [23]. However, a conventional Kalman filter using the\nquaternion parameterization results in a covariance matrix that is nearly singular.1\n\nThis could cause problems, especially with single-precision computers, but they\nwere overcome by using a local unconstrained three-dimensional parameterization\nfor the attitude error and the quaternion for the global parameterization of the\nattitude.\n\nReference [42] provides an excellent summary of the state of the art in 1978,\nbut most of the attitude estimation processing described in this reference was\nperformed by large mainframe computers on the ground. Algorithms for performing\nattitude determination and estimation existed well before that time, but space-\nhardened computer processors with the power required to execute them onboard\nspacecraft were not available. This raises the question: \u201cHow did spacecraft control\ntheir attitude without having attitude estimates?\u201d Some early spacecraft, such\nas Sputnik and the Echo 1 and 2 satellites (mylar balloons 30 and 40 m in\ndiameter), were spheres with no pointing requirements at all. Other spacecraft used\npassive stabilization methods: spacecraft spin or a momentum wheel providing a\nconstant angular momentum bias and/or gravity-gradient stabilization (see Chap. 3).\nInfrequent control torques to be applied by active mechanisms were computed on\nthe ground and telemetered to the spacecraft. Other spacecraft with active control\nsystems derived their control commands directly from sensor data, using simple\nanalog circuitry.\n\nMost modern-day spacecraft missions have specific pointing requirements,\notherwise known as pointing modes. Some examples include Earth pointing, inertial\npointing, and Sun pointing. Communications and broadcast satellites are a special\ncase of Earth-pointing spacecraft. They are typically placed in geostationary orbits\nalong the equator, with an orbital period equal to the Earth\u2019s rotational period\n(i.e. one sidereal day), so they appear from the ground to be stationary in the\nsky. Their angular momentum vectors are perpendicular to the equator and their\nattitude rotation rates are also the same as the Earth\u2019s rate, keeping their antennas\nconstantly pointed at the Earth. This explains why a satellite TV dish can be pointed\nto a fixed location for reception purposes. An example of an inertially pointing\nspacecraft is the Hubble Space Telescope (HST), which can point its main mirror\nto a fixed location in the sky for several hours to collect enough faint light to\nprovide a good image. An example of a Sun pointing spacecraft is the Solar &\nHeliospheric Observatory (SOHO) which is used to study the Sun from its deep\ncore to the outer corona and the solar wind. Sometimes the pointing mode changes\nduring the spacecraft mission. This may be due to changing requirements or failure\n\n1Reference [23] states that the covariance matrix is exactly singular, but this would only result\nfrom a linear constraint, while the quaternion norm constraint is quadratic. Itzhack Bar-Itzhack\nand Jeremy Kasdin pointed this out to the authors in personal discussions.\n\n\n\n4 1 Introduction\n\nACS\n\nStabilization\nRequirements\n\nCost\n\nSystem\nBudgets\n\nDesired\nAccuracy\n\nDisturbance\nTorques\n\nDesign\nConstraints\n\nPayload\n\nVehicle\nDesign\n\nFig. 1.1 Factors affecting ACS selection\n\nof some hardware component. The Solar, Anomalous and Magnetospheric Particle\nExplorer (SAMPEX) discussed in Sect. 7.7 provides an example of changing\npointing algorithms to meet changing pointing requirements.\n\nA spacecraft\u2019s overall pointing error is a function of both the attitude determina-\ntion/estimation errors and control errors, because the control system takes its inputs\nfrom the attitude determination/estimation system. As an example consider the non-\nrealistic case where the control errors are exactly zero. If the attitude determination\nerrors are 2?, then the overall pointing errors are also 2? even though the control is\nperfect. Therefore, when considering the overall pointing design requirements both\nthe control errors and attitude determination/estimation errors must be taken into\naccount. Pointing requirements can include requirements for both holding a desired\norientation and for maneuvering the spacecraft from one orientation to another. The\ndesired orientation may be a static resting point or a time varying trajectory. The\ntrajectory itself may be predefined specifically, such as pointing towards a particular\nlocation on the ground from low-Earth orbit (LEO), or not specifically defined, such\nas a general spin that scans the universe. The Wilkinson Microwave Anisotropy\nProbe (WMAP) spacecraft spent 9 years performing a repetitive \u201cspirograph\u201d scan\nof the celestial sphere, as described in Sect. 7.3.\n\nReference [36] provides an excellent overview of the factors that affect an\nattitude control system (ACS) configuration, as shown in Fig. 1.1. Some of these\nfactors are obvious, such as the payload, cost and desired accuracy, but others take\nmuch longer to quantify. More often than not the stabilization requirements may\ninvolve multiple pointing modes of the spacecraft. For example, the mission mode\nis the primary mode to complete the mission objectives. In addition to this mode\na safehold mode is usually required to cope with an anomaly. An example of\nthis mode is a Sun pointing mode that holds the solar arrays to face the Sun\nand removes power from all non-critical subsystems, minimizing power demands\n\n\n\n1 Introduction 5\n\nFig. 1.2 LADEE modular common spacecraft bus architecture\n\nuntil the anomaly is resolved. The spacecraft\u2019s inertia properties and the expected\ndisturbance torques must be accounted for during the ACS design process. The\nconfiguration of the vehicle may impose design constraints on the ACS in the form\nof system budgets for weight, power and volume. This leads to various definitions\nfor the configuration. For example, a CubeSat has a volume of exactly one liter\nand has a mass of no more than 1.33 kg. Current designs focus on commercial\noff-the-shelf (COTS) technology, which is a federal acquisition regulation term\ndefining a non-developmental item of supply that is both commercial and sold in\nsubstantial quantities in the commercial marketplace. The Lunar Atmosphere and\nDust Environment Explorer (LADEE) satellite uses a modular common spacecraft\nbus architecture along with COTS components, as shown in Fig. 1.2, in order to\nsignificantly reduce costs. These types of designs will certainly be prevalent for\nmany future missions.\n\nAlthough reducing costs is important, it is equally important that a proper ACS\nachieves its stated objective throughout the lifetime of the mission. This begins with\na complete understanding of the theory behind an ACS. Most often the particular\nmission objectives drive the requirements. Engineers are usually given the objectives\nand then they must develop a proper ACS that meets these objectives, keeping all\nthe factors shown in Fig. 1.1 in mind. But sometimes engineers are able to drive\nthe objectives. An example of this is an experience that this book\u2019s authors had\nfor the contingency mode for the Tropical Rainfall Measuring Mission (TRMM)\nspacecraft. The scientists asked the authors \u201cRoughly what attitude accuracy do\nyou think can be achieved with three-axis magnetometer and Sun sensors?\u201d After\na simple analysis we responded that 0.7? should be doable. The very next day the\nofficial requirement from the scientists for the contingency mode was stated to be\n0.7?! The authors and other engineers then performed a detailed analysis to prove\nthat this requirement could be met [6]. Other times one system is more important\nthan another system. This is the case for the Wilkinson Microwave Anisotropy\nProbe (WMAP) spacecraft [25], which is used to make fundamental cosmological\nmeasurements. The ACS objectives are to provide a complete scan of the universe\n\n\n\n6 1 Introduction\n\ntwice a year. The scientists were more interested in the attitude knowledge than\nWMAP\u2019s actual orientation. Therefore, the control system did not need to be as\naccurate as the attitude estimation system, which involved a star tracker and gyros.\nThis allowed for a less sophisticated control design than would be required for a fine\npointing spacecraft.\n\nIt is important to note that other requirements may be imposed on the overall\npointing mode. For example, nearly every spacecraft uses solar arrays for power\ngeneration, and the arrays must be pointed towards the Sun well enough to\nprovide sufficient power. This may require that the desired pointing mode be\nslightly modified during mission operations. Other spacecraft require calibration\nmaneuvers to determine sensor biases and other calibration parameters. These\nattitude maneuvers typically require that the spacecraft be capable of controlling\nall three of its axes, which is often broadly termed three-axis stabilization.\n\nThe history of attitude determination/estimation has been well documented, but\nthe history of attitude control is less known. This is in part due to the fact that this\nfield of study was classified Secret in the early days of spacecraft mission designs.\nRobert Roberson [32] claims that its birth year is 1952, with the first publicly\npublished works by him and Vladimir Beletskii, who was in the USSR, appearing\nin the mid 1950s. Early designs were based on linearized equations of motion to\nstudy the behavior of the control system. Active control relies on only a handful\nof available actuators: (1) momentum exchange devices such as reaction wheels,\n(2) thrusters and (3) magnetic torquers. As early as 1961 magnetic torquers had\nbeen proposed both for momentum dumping and active pointing control. According\nto Roberson, the first Orbiting Solar Observatory (OSO 1) was the first known\ncontrolled spacecraft. This used a dual-spin design, with a rotating wheel to provide\ngyroscopic stability, and a sail driven electrically against the wheel\u2019s rotation to\npoint at the Sun. Although modern-day actuators have not changed from their initial\npurpose, technology has advanced greatly since the early days to provide much\ngreater efficiency and tighter pointing performance. For example, in order to take\nimages of distant, faint objects, HST must point extremely stably and accurately.\nThe telescope is able to lock onto a target without deviating more than 7/1000th of\nan arcsecond, or the width of a human hair seen at a distance of about 1.5 km. Fine\nguidance sensors looking through HST\u2019s main optics are used to provide the attitude\nknowledge while reaction wheels provide the necessary control. These reaction\nwheels must be very accurately balanced and isolated so that vibration is as small\nas possible; otherwise a jitter effect would ensue causing image blurring.\n\nSpacecraft attitude control methods fall into two broad classes: passive control\nand active control. Passive control methods use the natural spacecraft dynamics\nto satisfy their pointing requirements. The simplest of these is spin stabilization,\nwhich depends on the fact that the direction of a rigid spinning body\u2019s angular\nmomentum is relatively immune to disturbances (see Sect. 3.3.3). The Pioneer series\nof spacecraft provides a good example of early spinners. Pioneer 10 and 11 each\ncarried a sensor called the Imaging Photopolarimeter (IPP), as shown in Fig. 1.3,\nwhich measured the strength of sunlight scattered from the clouds of Jupiter [31].\nIt then converted this information into digital format of different shades of red\n\n\n\n1 Introduction 7\n\nSpin axis of\nspacecraft\n\n10 deg\n\nLook angle (can\nbe varied 151 deg)\n\nDirection of\nscan data beam\n\nScan limit\n14 deg\n\nJupiter\n\nWidth of scan\ndata beam 0.5 by\n0.5 milliradian\n\nClosest telescope\nposition to spin axis\n\nFig. 1.3 Pioneer imaging photopolarimeter\n\nand blue that made up each image of Jupiter. The telescope axis was swept about\nthe spacecraft spin axis through 360? in the look angle as the spacecraft rotated\nat its nominal spin rate. It could also be positioned in discrete 0.5 mrad steps of\ncone angle over a range from 29? from the earthward direction (limited by the\nspacecraft antenna structure) to 170? from earthward. This allowed two-dimensional\nmapping of the celestial sphere in any one of three distinct operational modes. The\ntotal angle coverage per spin rotation depended on the spacecraft data transmission\nrate; during encounter it was limited to 70? and 14? (28? at low sample rate) for\nphotopolarimetry and imaging, respectively. Any swath of the 360? rotation could\nbe covered by selecting the starting angle. In the faint light mode the entire roll was\ncovered.\n\nAs shown by the example of Pioneer, one advantage of spinning spacecraft is that\nthe spin can be used by ACS and payload sensors to scan targets. A disadvantage, of\ncourse, is that a spinning platform is very inconvenient for sensors or antennas that\nneed to point at fixed targets. Dual-spin spacecraft have both a spinning component\nand a despun platform that is not rotating. The dual-spin configuration has mainly\nbeen used for communications or broadcast satellites, where the despun platform\ncontains an antenna pointed at a receiving station on the Earth, but it was also used\n\n\n\n8 1 Introduction\n\nfor OSO 1 and for the Galileo interplanetary spacecraft, which was launched toward\nJupiter in October 1989. Dual-spin spacecraft are intermediate between passive and\nactive control, because the pointing of the spin axis is largely passive, but the angle\nof rotation of the despun platform about the spin axis is controlled actively by the\nmotor driving the relative rotation of the two components.\n\nA momentum-bias attitude control system is conceptually similar to a dual-spin\nsystem, but the angular momentum bias is provided by a spinning wheel or\nwheels internal to the main spacecraft body, which is not spinning. Many Earth-\npointing spacecraft have used this configuration, with the momentum bias along the\nspacecraft pitch axis, which is perpendicular to the orbital plane. Spacecraft pitch\nmotion is controlled by the wheel torque and the motion about the other two axes can\nbe controlled by magnetic torques or propulsive torques. Another common variation\nis to have two wheels slightly misaligned from the pitch axis so that torquing them\nin the same direction provides pitch control and commanding them in opposite\ndirections provides a torque perpendicular to the pitch axis.\n\nGravity-gradient torques provide another passive method to keep one axis of\nan Earth-orbiting spacecraft pointed toward the Earth, as was first demonstrated\non the Transit Research and Attitude Control (TRAAC) spacecraft, launched in\n1962 [45]. Since this provides no control about the Earth-pointing axis, it is usually\ncombined with some other form of control, a pitch momentum bias in the case of\nthe Geostationary Experimental Ocean Satellite (GEOS) [42] or magnetic torquing\nin the case of the \u00d8rsted satellite [44].\n\nAs pointing requirements have become more demanding and spacecraft\ncomputers have become more capable, spacecraft ACS designs have largely\nmoved to three-axis stabilization. Most actively-controlled spacecraft use thrusters,\nreaction wheels or, less frequently, control moment gyros (CMGs) as their primary\ncontrollers. Thrusters by their nature use expendable propellants, limiting the life\nof a mission. Reaction wheels or CMGs, on the other hand, require only electrical\npower that can be supplied by solar arrays. They also are well suited for repointing\nand absorbing periodic disturbance torques, which cause no long-term change in\ntheir stored angular momentum. Secular disturbances, on the other hand, lead to\nmomentum buildup in the wheels, which must be unloaded (or \u201cdumped\u201d) using\nexternal torques provided by attitude thrusters or magnetic torquers. Magnetic\ntorquers are preferable because they do not use expendables and are less disruptive\nto the spacecraft\u2019s primary function, but they are generally only employed in LEO.\n\nThe Geostationary Operational Environmental Satellites (GOES), which supply\nthe weather pictures seen on televised weather programs, provide an excellent\nexample of the evolution of attitude control system designs. The first three of\nthese satellites, GOES 1\u20133,2 were spin-stabilized. Weather images were obtained\nby a Visible Infrared Spin Scan Radiometer (VISSR) which used the satellite spin\nto scan in the East-West direction, and a mirror stepped once per spin period to\n\n2NASA satellites are given letter designations before launch and numerical designations after they\nattain orbit, so the first three GOES satellites were also known as GOES A-C.\n\n\n\n1 Introduction 9\n\nTrim Tab\n\nImager\nand\n\nSounder\n\nSolar Sail\n\nSolar Array\n\nFig. 1.4 Geostationary\noperational environmental\nsatellite I\u2013M\n\nscan North to South. GOES 4\u20137 were dual-spin satellites, with high-gain antennas\non the despun platform to increase the speed of data transmission to the Earth.\nOne drawback of these designs was that the VISSR spent only a very small\nfraction of its spin period actually scanning the Earth. In order to increase the\ntime spent actually gathering weather imagery, the GOES 8\u201312 satellites, depicted\nin Fig. 1.4, were designed as momentum-biased three-axis controlled spacecraft,\nwith the scan provided by the science instruments [37]. These were the imager,\nwhich senses infrared and visible energy from the Earth\u2019s surface and atmosphere,\nand the sounder, which provides data for vertical atmospheric temperature and\nmoisture profiles, surface and cloud top temperature, and ozone distribution. The\nmain disturbance at geosynchronous altitudes is the torque caused by solar radiation\npressure on solar arrays, so geosynchronous spacecraft usually have two solar arrays\non opposite sides to balance the torque. The imager and sounder need a cold\nfield of view for their radiators, so GOES could not have balanced solar arrays.\nA small solar sail on an extended boom was provided to balance the solar torque,\nbut the combination of imperfect symmetry, center of mass shifts, and changing\nsurface optical properties resulted in a seasonally-varying net torque. The resulting\naccumulated momentum was unloaded by thrusters or by magnetic torquing, the\nlatter with mixed success at geosynchronous altitude. A trim tab at the end of the\n\n\n\n10 1 Introduction\n\nsolar array was adjusted daily by ground command to minimize the need for active\nmomentum dumping [17]. Each spacecraft had a set of gyros, the Digital Integration\nRate Assembly (DIRA), but it was not used for the mission mode ACS because the\ngyros had an operational lifetime of only 2,000 h.\n\nThe pointing requirement for this series of GOES satellites was 12 ?rad relative\nto an Earth referenced system, which translates to roughly 4 km knowledge on\nthe ground. It is important to note that this was the tightest pointing requirement\never for a spacecraft that did not use data from its main instruments to aid the\nACS, as HST and other fine-pointing spacecraft do. The original ACS designers\nbelieved that this requirement could be met using a horizon sensor only and by\nmaking corrections through ground processing of the data [20]. Unfortunately, the\nrequirements were not met on orbit with this approach, so a NASA team investigated\nACS modifications needed to improve the performance of the next generation of\nGOES spacecraft [8, 26]. The present authors concluded that the desired level\nof performance required star trackers and gyros capable of providing continuous\ndata in a stellar-inertial ACS, which had been used for Earth-pointing spacecraft\nin near-Earth orbit at least since Landsat 4 in 1982, but never to our knowledge\nfor a geostationary satellite. However, star trackers provide an attitude relative to\nan inertial frame, and converting the attitude to an Earth reference frame requires\nknowledge of the spacecraft orbit,3 so orbit errors will contribute to pointing errors.\nThis is the reason why Earth-pointing spacecraft have historically used horizon\nsensors as pointing references. Fortunately, it is not difficult to reduce orbit errors\nto the point where they do not significantly degrade pointing performance, so the\nstellar-inertial design could meet the pointing requirements.\n\nReference [26] had been presented at the 1991 AIAA Guidance, Navigation,\nand Control Conference, and it was well known to the spacecraft manufacturers\ninterested in building the next generation of GOES spacecraft. Thus it is no\nsurprise that later GOES satellites starting with GOES 13 have used many of the\nimprovements suggested in that paper, including a stellar-inertial ACS mode [38].\nIncreased cooling demands of the imager and sounder precluded the use of a solar\nsail on these spacecraft, so they must perform daily momentum dumps, but the\nimproved performance of the ACS allows them to continue imaging during the\ndumps and to meet all their performance requirements [15].\n\nThe design of the TRMM ACS involved a similar decision between an Earth-\nreferenced concept and a stellar-inertial concept. TRMM was developed at Goddard\nSpace Flight Center concurrently with the Rossi X-Ray Timing Explorer (RXTE),\nand an effort was made to use common hardware and software wherever feasible.\nRXTE was an astronomical mission, and its stringent pointing stability requirement\nof 30 arcsec led it to incorporate a stellar-inertial ACS [3]. The TRMM engineers\ndecided not to use a stellar-inertial system, because their much less stringent\nattitude knowledge requirement of 0.18? per axis could be met by using pitch\nand roll measurements from an Earth Sensor Assembly (ESA), and obtaining yaw\n\n3This is discussed in Sects. 2.6.4 and 5.7.\n\n\n\n1 Introduction 11\n\nknowledge from gyros updated twice each orbit by Sun sensor measurements.\nAlthough this decision was controversial, it was supported by the first author of this\nbook on the principle that an Earth-pointing mission should use an Earth-referenced\nACS. It appeared to be an unfortunate decision in early 1994, after development\nof the TRMM ACS was well underway, when ACS engineers became aware of a\nprogressive degradation of similar ESAs on the Defense Meteorological Satellite\nProgram (DMSP) spacecraft. They considered adding a star tracker to TRMM\nto protect against this possibility, but avoided the severe monetary and schedule\npenalties that this would entail by developing a contingency mode using gyros and\nmagnetometers, based on results that had been obtained in ground-based attitude\ndetermination of the Upper Atmosphere Research Satellite (UARS) using flight gyro\nand magnetometer data [18].\n\nImplementation of TRMM\u2019s contingency mode required an onboard filter to\nreduce the effects of sensor noise and magnetic field modeling errors. The common\nhardware procurement with RXTE spacecraft provided gyros that were much more\naccurate than required by the ESA-based TRMM ACS but provided the dynamic\nmemory needed by the filter. It was not clear that the onboard processor could\nhandle the computational load of a full Kalman filter in addition to the existing\nACS software, so the authors of this book conducted a study to develop algorithms\nthat could provide near-optimal attitude estimates with a lower computational load\n[6]. Our investigation showed that one eigenvalue of the covariance matrix of\nattitude errors was much larger than the other two, and its eigenvector was within\n2.5? of the Sun vector. This reflects the fact that the more accurate Sun sensor\ncannot reduce the attitude error along the Sun line, which must be estimated using\nthe less-accurate magnetometer. A simplified expression for the covariance using\nthis analysis provided several alternate algorithms that obtained nearly the same\naccuracy as the Kalman filter at a fraction of the computational load [6].\n\nIt was determined, however, that the already-validated RXTE Kalman filter,\nmodified to use magnetometer and Sun sensor data in place of star tracker data,\nwould fit in the TRMM computer, so this alternative was chosen. In August of\n2001 TRMM\u2019s orbit altitude was raised from 350 to 402 km to save propellant\nused to compensate for atmospheric drag. The ESA had performed well at the lower\naltitudes for which it was designed, but it ceased providing valid data above 380 km,\nand the contingency mode Kalman filter was enabled. It has since provided attitude\naccuracies of approximately 0:2?, about the same as the ESA had provided and\nmuch better than the allotted attitude knowledge accuracy for the contingency mode\nof 0.7? per axis [1].\n\nIn addition to difficulties in meeting requirements, as on GOES 8\u201312, it is not\nuncommon to experience an outright failure. Some of these are not recoverable,\nbut ingenious workarounds can often be found. The Lewis spacecraft provides an\nexample of an unrecoverable failure. The Lewis design engineers adopted a Sun-\npointing ACS safehold mode that had been designed for the Total Ozone Mapping\nSpectrometer-Earth Probe (TOMS-EP) spacecraft. Unfortunately, the spacecraft\naxis that the Lewis safehold mode pointed at the Sun was an unstable axis\nof intermediate inertia (see Sect. 3.3.3), unlike the stable Sun-pointing axis on\n\n\n\n12 1 Introduction\n\nTOMS-EP. This instability should have revealed itself in simulations performed\nduring the design phase, but the simulations assumed perfectly aligned and balanced\nthrusters. When Lewis entered safehold mode on orbit, a small thruster imbalance\ncaused the spacecraft to spin up around the unstable intermediate axis. This rotation\ncould not be sensed by the Sun sensors, and the spin momentum started to transfer\ninto the controlled principal axis causing the thrusters to fire excessively in an\nattempt to maintain control. But the ACS processor was programmed to shut down\nthe control system if excessive firings occurred. The spin momentum then was\ntransferred to the principal axis, which rotated the spacecraft 90?, causing the solar\narrays to be pointed nearly edge-on to the Sun, resulting in a fatal loss of power\nfrom which Lewis could not recover.\n\nThe Solar Maximum Mission (SMM) provides an example of a recovery from a\npotentially fatal malfunction. Launched in February 1970, SMM was the first of the\nMultimission Modular Spacecraft (MMS) with independent modules designed to\nbe replaceable on orbit [9, 16]. SMM\u2019s Modular Attitude Control System (MACS)\nfunctioned flawlessly for the first nine months after launch, but then fuse failures\npermanently disabled three of its four reaction wheels, which were the primary ACS\nactuators. With only one wheel operational, the experiment axis would drift away\nfrom the Sun and severe thermal and power problems would develop. Engineers at\nGoddard Space Flight Center developed an algorithm to spin-stabilize SMM, which\nwas uplinked to the onboard computer less than six weeks after the loss of the first\nwheel [19]. A successful spinup was achieved, leaving the spacecraft rotating at\nabout 1 deg/s and pointing near the Sun in a thermal- and power-safe state. Three\nof the seven observatory experiments continued to operate while spinning to return\nsolar constant measurements as well as data on gamma ray and x-ray emissions\nfrom the Sun. SMM remained in the spin-stabilized mode until it was captured in\n1984 by Space Shuttle Challenger and its MACS module was replaced in the first\nrepair of an orbiting spacecraft.\n\nAnother rescue from a potentially fatal malfunction was performed on the\nInternational Ultraviolet Explorer (IUE), which was launched in January 1978 into\na geosynchronous, but not geostationary, orbit. Because of its high altitude, IUE\ncould not be serviced on orbit. It was equipped with six gyros, of which three were\nneeded for the ACS. Three of the gyros had failed by July 1982, so a replacement\ntwo-gyro control algorithm was developed in 1982\u20131983 to permit continued use\nof the observatory in the anticipated loss of a fourth gyro [14]. This algorithm\nwas ready for operation by Spring 1983, well before the fourth gyro failed on\nAugust 17, 1985. IUE continued science operations until it was decommissioned\nfor non-ACS reasons in September 1996, 18 years and 9 months after launch,\nalthough it was built to last for 3 years with a goal of 5 years. A single-gyro control\nalgorithm for IUE was developed and fully tested on orbit, but it was never needed.\nTheir rescues of SMM, IUE, and several other spacecraft earned the engineers in\nHenry Hoffman\u2019s Guidance and Control Branch at Goddard Space Flight Center the\nappellation \u201cSatellite Saviors\u201d [22].\n\n\n\n1 Introduction 13\n\nHST, deployed by Space Shuttle Discovery in April 1990, is the only telescope\ndesigned to be serviced on orbit by astronauts. Like IUE, HST was launched with\nsix primary high-accuracy single-degree-of-freedom gyros for redundancy. In fact,\nthe gyros are of the same basic design as IUE\u2019s, but they were improved to avoid\nthe IUE\u2019s failure mode. Unfortunately, they experienced a different failure mode.\nIf four of the six primary gyros were lost, vehicle health and safety could still be\nmaintained by using a set of backup lower-accuracy gyros until the primary gyros\ncould be brought on line, after replacement if necessary. The backup gyros have\na limited operational life, however, so they should not be relied on for long-term\ncontrol. Therefore, when two of HST\u2019s primary gyros failed during the first year\nof HST operation, it was felt prudent to develop a zero-gyro sunpoint (ZGSP)\nsafehold mode [28]. Development of this safehold mode algorithm, which uses\nmagnetometer and coarse Sun sensor data, went from concept to flight code in three\nmonths, with uplink to HST on January 20, 1992, and it maintained HST in a power\nand thermally safe state for 38 consecutive days between the failure of a fourth gyro\nin November 1999 and a December servicing mission to replace all six gyros.\n\nOur final example of an ACS design using minimal hardware is provided by\nthe Solar Radiation and Climate Experiment (SORCE) spacecraft [2]. The SORCE\nengineers developed a gyroless ACS design out of necessity after much of the\nACS flight software had already been coded, when problems arose with their gyro\nprocurement and no alternate gyros could be procured quickly that met spacecraft\ninterface and resource requirements. Facing a very tight schedule, the ACS team\ndesigned and implemented a simple science mode that took advantage of the\navailability of two star trackers and a fine Sun sensor to derive accurate rates,\nand a safehold mode deriving rates from magnetometer and coarse Sun sensor\nmeasurements. The key system feature enabling the simplicity of these modes was\nthat the science instrument was designed to point at the Sun and therefore could\nnot be damaged by Sun exposure. Reference [5] provides an overview of gyroless\npointing modes on several scientific spacecraft, including SORCE.\n\nA sound theoretical foundation is the first and foremost step to achieve a good\nACS design. The Lewis issue could have been easily avoided by a simple analysis\nthat would have showed that the safehold mode had a spin about its intermediate\naxis. Understanding how orbit errors couple with attitude errors in the GOES star\ntracker design is another example of using theory to aid in the ACS analysis.\nThe TRMM contingency filter, described above, also provides an illustrative case.\nA classic example is the roll/yaw coupling effect used to control communications\nsatellites (see Sect. 3.3.8), which typically employ a horizon sensor for the ACS.\nA horizon sensor can provide only roll and pitch information, leaving the yaw\nrotation angle about the nadir vector unknown and the attitude not fully observable.\nHowever, roll/yaw coupling causes an error in yaw to become an error in roll a\nquarter orbit later, so yaw is controllable even though it is not observable. The yaw\npointing accuracy is typically about an order of magnitude worse than roll and pitch,\nbut this is of no concern for most communications satellites because their antennas\nare still pointed toward the Earth to meet their requirements.\n\n\n\n14 1 Introduction\n\nSince the first publications on attitude control this area has been extremely\nactive, producing a vast stream of theoretically-based publications that continues\nto this day. It is impossible to even begin to scratch the surface of the extensive\ndevelopments in this area. Rather, we shall highlight some key aspects of the\nresults shown in classic publications. The attitude control problem can be essentially\nbroken down into two parts: (1) attitude regulation and (2) attitude tracking.\nRegulation drives the attitude toward a fixed orientation and keeps it there. Note that\nthis is exactly the same as an inertial pointing mode. Tracking involves continuously\nre-orientating the attitude to follow some predefined attitude motion profile. This\nfalls under the category of three-axis stabilization. Control techniques fall under\nboth open-loop and closed-loop approaches, as is further discussed in Sect. 7.1.\n\nAs with estimation the parameterization of choice for control purposes is the\nquaternion. Bong Wie and Peter Barba produced one of the earliest works using this\nparameterization for the regularization problem in 1985 [43]. This work derives\nsimple feedback laws that are essentially equivalent to classical proportional-\nderivative controllers and shows them to be stable through a Lyapunov analysis.\nNote that Wie and Barba did not prove asymptotic stability, but fortunately their\ncontrol laws do lead to an asymptotically stable closed-loop system as shown in\nSect. 7.2. The extension of this work to the tracking case is derived by John Wen and\nKenneth Kreutz-Delgado [41]. Control theory has continued to evolve since the time\nof these classic papers, including robust control approaches, control methods that\ntake into account actuation constraints, controllers that can work when an actuator\nfails (such as the two-wheel control problem), as well as many others that can be\nfound in the open literature.\n\nMany of the techniques described in this text have been extensively employed for\nmany years, but the field continues to grow. Advances in attitude estimation include\na number of nonlinear filtering algorithms developed since the survey paper of 1982\n[23], many of which are critically reviewed in a more recent survey paper [7]. The\nmost important theoretical tool that has significantly advanced the mathematics\nunderlying attitude control is the use of Lyapunov-based methods to design\ncontrollers that guarantee stability for general nonlinear systems.4 Although the\npotential advantages of the new control and estimation algorithms are undeniable,\nit is wise to apply the old adage \u201cIf it ain\u2019t broke don\u2019t fix it\u201d to the simple but\neffective control laws and the standard extended Kalman filter, which have proved\ntheir worth on a multitude of spacecraft missions. Ultimately, enhanced confidence\nin the new approaches, coupled with the more stringent pointing requirements of\nfuture missions, will bring about more widespread use of these approaches, or of\nothers as yet undiscovered, for spacecraft attitude determination and control.\n\n4A review of Lyapunov stability is presented in Sect. 12.2.2.\n\n\n\nReferences 15\n\nReferences\n\n1. Andrews, S.F., Bilanow, S.: Recent flight results of the TRMM Kalman filter. In: AIAA\nGuidance, Navigation and Control Conference. Monterey (2002). AIAA 2002-5047\n\n2. Baird, G.C., Groszkiewicz, J.E.: Gyroless attitude control for the SORCE spacecraft. In:\nChapel, J.D., Culp, R.D. (eds.) Guidance and Control 2004, Advances in the Astronautical\nSciences, vol. 118, pp. 593\u2013605. Univelt, San Diego (2004). AAS 04-076\n\n3. Bauer, F.H., Femiano, M.D., Mosier, G.E.: Attitude control system conceptual design for the\nX-Ray Timing Explorer. In: AIAA Guidance, Navigation and Control Conference. Hilton\nHead (1992). AIAA 92-4334-CP\n\n4. Black, H.D.: A passive system for determining the attitude of a satellite. AIAA J. 2(7),\n1350\u20131351 (1964)\n\n5. Bruno, D., Class, B.F., Rovner, D., Baird, G., Groszkiewicz, J., Lebsock, K., Kruk, J.:\nA comparison of gyroless implementations on scientific spacecraft. In: AIAA Guidance,\nNavigation and Control Conference. Chicago (2009). AIAA 2009-5942\n\n6. Crassidis, J.L., Andrews, S.F., Markley, F.L., Ha, K.: Contingency designs for attitude deter-\nmination of TRMM. In: Proceedings of the Flight Mechanics/Estimation Theory Symposium,\npp. 419\u2013433. NASA-Goddard Space Flight Center, Greenbelt (1995)\n\n7. Crassidis, J.L., Markley, F.L., Cheng, Y.: Survey of nonlinear attitude estimation methods.\nJ. Guid. Contr. Dynam. 30(1), 12\u201328 (2007)\n\n8. Crassidis, J.L., Markley, F.L., Kyle, A.M., Kull, K.: Attitude determination improvements for\nGOES. In: Proceedings of the Flight Mechanics/Estimation Theory Symposium, pp. 151\u2013165.\nNASA-Goddard Space Flight Center, Greenbelt (1996)\n\n9. Falkenhayn Jr., E.: Multimission Modular Spacecraft (MMS). In: Proceedings of the AIAA\nPrograms and Technologies Conference. Houston (1988). AIAA 88-3513\n\n10. Fallon III, L., Harrop, I.H., Sturch, C.R.: Ground attitude determination and gyro calibration\nprocedures for the HEAO missions. In: 17th Aerospace Sciences Meeting, AIAA 79-0397.\nNew Orleans (1979)\n\n11. Farrell, J.L.: Attitude determination by Kalman filtering. Contractor Report NASA-CR-598,\nNASA Goddard Space Flight Center, Washington, DC (1964)\n\n12. Farrell, J.L.: Attitude determination by Kalman filtering. Automatica 6, 419\u2013430 (1970)\n13. Farrell, J.L., Stuelpnagel, J.C.: A least-squares estimate of satellite attitude. SIAM Rev. 7(3),\n\n384\u2013386 (1966)\n14. Femiano, M.D.: Inflight redesign of the IUE attitude control system. In: 2nd Aerospace Main-\n\ntenance Conference. San Antonio (1986). AIAA 86-1193\n15. Gibbs, B.P., Uetrecht, D.S., Carr, J.L., Sayal, C.: Analysis of GOES-13 orbit and attitude\n\ndetermination. In: SpaceOps Conference. Heidelberg (2008). AIAA 2008-3222\n16. Guha, A.K.: Solar Maximum Mission\u2013a system overview. In: Proceedings of the AIAA 19th\n\nAerospace Sciences Meeting. St. Louis (1981). AIAA 81-0200\n17. Harvie III, E., Rowe, J., Tsui, Y.K.J.: Performance analysis of the GOES trim tab solar pressure\n\ntorque angular momentum control. In: Proceedings of SPIE, GOES-8 and Beyond, vol. 2812.\nDenver (1996)\n\n18. Hashmall, J.A., Liu, A.K., Rokni, M.: Accurate spacecraft attitudes from magnetometer data.\nIn: CNES Spacecraft Dynamics (Colloque 95), pp. 169\u2013179. C\u00e9padu\u00e8s-\u00c9ditions, Toulouse\n(1995)\n\n19. Hoffman, H.C., Donohue, J.H., Flatley, T.W.: SMM attitude control recovery. In: Proceedings\nof the AIAA Guidance and Control Conference. Albuquerque (1981). AIAA 81-1760\n\n20. Kamel, A.A., Bhat, M.K.P., Gamble, D., Scholtz, J.H.: GOES I\u2013M image motion compensation\nsystem. In: 1992 AIAA Aerospace Design Conference. Irvine (1992). AIAA 92-1107\n\n21. Kau, S., Kumar, K.S.P., Granley, G.B.: Attitude determination via nonlinear filtering. IEEE\nTrans. Aero. Electron. Syst. AES-5(6), 906\u2013911 (1969)\n\n22. Kuznik, F.: Satellite saviors. Air Space Smithsonian 6(3), 66\u201370 (1991)\n\n\n\n16 1 Introduction\n\n23. Lefferts, E.J., Markley, F.L., Shuster, M.D.: Kalman filtering for spacecraft attitude estimation.\nJ. Guid. Contr. Dynam. 5(5), 417\u2013429 (1982)\n\n24. Lerner, G.M.: Three-axis attitude determination. In: Wertz, J.R. (ed.) Spacecraft Attitude\nDetermination and Control, chap. 12. Kluwer Academic, Dordrecht (1978)\n\n25. Markley, F.L., Andrews, S.F., O\u2019Donnell Jr., J.R., Ward, D.K.: Attitude control system of the\nWilkinson Microwave Anisotropy Probe. J. Guid. Contr. Dynam. 28(3), 385\u2013397 (2005)\n\n26. Markley, F.L., Bauer, F.H., Deily, J.J., Femiano, M.D.: Attitude control system conceptual\ndesign for Geostationary Operational Environmental Satellite spacecraft series. J. Guid. Contr.\nDynam. 18(2), 247\u2013255 (1995)\n\n27. Markley, F.L., Mortari, D.: Quaternion attitude estimation using vector observations. J.\nAstronaut. Sci. 48(2/3), 359\u2013380 (2000)\n\n28. Markley, F.L., Nelson, J.D.: Zero-gyro safemode controller for the Hubble Space Telescope.\nJ. Guid. Contr. Dynam. 17(4), 815\u2013822 (1994)\n\n29. Murrell, J.W.: Precision attitude determination for multimission spacecraft. In: Proceedings of\nthe AIAA Guidance, Navigation, and Control Conference, pp. 70\u201387. Palo Alto (1978)\n\n30. Pauling, D.C., Jackson, D.B., Brown, C.D.: SPARS algorithms and simulation results. In:\nProceedings of the Symposium on Spacecraft Attitude Estimation, vol. 1, pp. 293\u2013317.\nAerospace Corporation, El Segundo (1969)\n\n31. Pellicori, S.F., Russell, E.E., Watts, L.A.: Pioneer imaging photopolarimeter optical system.\nAppl. Optic 12(6), 1246\u20131258 (1973)\n\n32. Roberson, R.E.: Two decades of spacecraft attitude control. J. Guid. Contr. 2(1), 3\u20138 (1979)\n33. Shuster, M.D.: In my estimation. J. Astronaut. Sci. 54(3 & 4), 273\u2013297 (2006)\n34. Shuster, M.D.: The quest for better attitudes. J. Astronaut. Sci. 54(3/4), 657\u2013683 (2006)\n35. Shuster, M.D., Oh, S.D.: Attitude determination from vector observations. J. Guid. Contr. 4(1),\n\n70\u201377 (1981)\n36. Siahpush, A., Gleave, J.: A brief survey of attitude control systems for small satellites using\n\nmomentum concepts. In: Proceedings of the 2nd AIAA/USU Conference on Small Satellites.\nLogan (1988). SSC88-IV-24\n\n37. Space Systems Loral: GOES I\u2013M data book (1996). http://goes.gsfc.nasa.gov/text/goes.\ndatabook.html (accessed Jan. 27, 2014)\n\n38. The Boeing Company: GOES N data book (2005). http://goes.gsfc.nasa.gov/text/goes.\ndatabooknop.html (accessed Jan. 27, 2014)\n\n39. Toda, N.F., Heiss, J.L., Schlee, F.H.: SPARS: The system, algorithms, and test results. In:\nProceedings of the Symposium on Spacecraft Attitude Estimation, vol. 1, pp. 361\u2013370.\nAerospace Corporation, El Segundo (1969)\n\n40. Wahba, G.: A least-squares estimate of satellite attitude. SIAM Rev. 7(3), 409 (1965)\n41. Wen, J.T.Y., Kreutz-Delgado, K.: The attitude control problem. IEEE Trans. Automat. Contr.\n\n36(10), 1148\u20131162 (2002)\n42. Wertz, J.R. (ed.): Spacecraft Attitude Determination and Control. Kluwer Academic, Dor-\n\ndrecht (1978)\n43. Wie, B., Barba, P.M.: Quaternion feedback for spacecraft large angle maneuvers. J. Guid.\n\nContr. Dynam. 8(3), 360\u2013365 (1985)\n44. Wis?niewski, R., Blanke, M.: Fully magnetic attitude control for spacecraft subject to gravity\n\ngradient. Automatica 35(7), 1201\u20131214 (1999)\n45. Worth, H.E., Warren, M.: Transit to Tomorrow: Fifty Years of Space Research at the Johns\n\nHopkins University Applied Physics Laboratory. The Johns Hopkins University Applied\nPhysics Laboratory, Laurel (2009)\n\nhttp://goes.gsfc.nasa.gov/text/goes.databook.html\nhttp://goes.gsfc.nasa.gov/text/goes.databook.html\nhttp://goes.gsfc.nasa.gov/text/goes.databooknop.html\nhttp://goes.gsfc.nasa.gov/text/goes.databooknop.html\n\n\nChapter 2\nMatrices, Vectors, Frames, Transforms\n\nThis chapter begins with an overview of matrices and vectors, which are used\nextensively in attitude analysis. We assume that the reader has some familiarity\nwith this material, so the account is not completely self-contained. The principal\nobjective of this section is to define our notation and conventions.\n\nWe next discuss a special category of four-component vectors, which we refer to\nas quaternions although they differ conceptionally from the quaternions introduced\nby W. R. Hamilton in 1844. They perform the same function as Hamilton\u2019s\nquaternions in applications, however, and have proved to be extremely useful in\nattitude analysis.\n\nWe then move on to a discussion of rotations in three-dimensional space and\nthe most common parameter sets that have been used to specify these rotations: the\nEuler axis and angle, the rotation vector, the quaternion, the Rodrigues parameters,\nthe modified Rodrigues parameters, and the Euler angles. The last section in this\nchapter addresses the representation of attitude errors. A more extensive treatment of\nthe material in this section, including historical references, can be found in Shuster\u2019s\ncomprehensive review article [17].\n\n2.1 Matrices\n\nAn m ? n matrix A is an array with m rows and n columns of scalars:\n\nA D\n\n2\n6664\n\na11 a12 ? ? ? a1n\na21 a22 ? ? ? a2n\n:::\n\n:::\n: : :\n\n:::\n\nam1 am2 ? ? ? amn\n\n3\n7775 (2.1)\n\nF.L. Markley and J.L. Crassidis, Fundamentals of Spacecraft Attitude Determination\nand Control, Space Technology Library 33, DOI 10.1007/978-1-4939-0802-8__2,\n\u00a9 Springer Science+Business Media New York 2014\n\n17\n\n\n\n18 2 Matrices, Vectors, Frames, Transforms\n\nWe will assume that the scalar matrix elements are real numbers. The results in\nthis chapter can be generalized to matrices with complex elements, but we will\nrarely need to deal with complex matrices. If m D n, then the matrix A is square.\nWe denote anm?nmatrix with all components equal to zero by 0m?n, or sometimes\nsimply by 0 if confusion is unlikely to result.\n\nA column vector, or sometimes simply a vector, is an n ? 1 matrix\n\nx D\n\n2\n6664\n\nx1\nx2\n:::\n\nxn\n\n3\n7775 (2.2)\n\nWe denote an n-component vector with all components equal to zero by 0n, or\nsometimes simply by 0 if confusion is unlikely.\n\nMatrices can be added, subtracted, or multiplied. For addition and subtraction,\nall matrices must have the same number of rows and columns. The elements of\n\nC D A? B (2.3)\n\nare given by cij D aij ? bij . Matrix addition and subtraction are both commutative,\nA?B D B?A, and associative, .A?B/?C D A? .B?C/. The multiplication\nof two matrices A and B:\n\nC D AB (2.4)\n\nis valid only when the number of columns of A is equal to the number of rows of B\n(i.e. A and B must be conformable). The resulting matrix C will have rows equal to\nthe number of rows of A and columns equal to the number of columns of B . Thus,\nif A has dimension m ? n and B has dimension n ? p, then C will have dimension\nm ? p. The elements of C are given by\n\ncij D\nnX\n\nkD1\naikbkj (2.5)\n\nfor all i D 1; 2; : : : ; m and j D 1; 2; : : : ; p. Matrix multiplication is associative,\nA .B C/ D .AB/C , and distributive, A .B C C/ D AB C AC , but not\ncommutative in general, AB \u00a4 B A. In those cases for which AB D B A, the\nmatrices A and B are said to commute.\n\nThe transpose of a matrix, denoted AT , has rows that are the columns of A and\ncolumns that are the rows of A. The transpose of the matrix defined by Eq. (2.1), for\nexample, is\n\n\n\n2.1 Matrices 19\n\nAT D\n\n2\n6664\n\na11 a21 ? ? ? am1\na12 a22 ? ? ? am2\n:::\n\n:::\n: : :\n\n:::\n\na1n a2n ? ? ? amn\n\n3\n7775 (2.6)\n\nThe transpose of a column vector is a row vector. The transpose operator has the\nfollowing properties:\n\n.?A/T D ?AT ; where ? is a scalar (2.7a)\n.AC B/T D AT C BT (2.7b)\n.AB/T D BTAT (2.7c)\n\nIf A D AT , then A is a symmetric matrix, if A D ?AT , then A is a skew symmetric\nmatrix.\n\nA diagonal matrix is a square matrix with nonzero elements only on the main\ndiagonal and all other elements equal to zero. An n ? n diagonal matrix can be\nformed from an n-component row or column vector by\n\ndiag.x/ D diag.xT / D diag.\u0152x1 x2 ? ? ? xn?/ ?\n\n2\n6664\n\nx1 0 ? ? ? 0\n0 x2 ? ? ? 0\n:::\n:::\n: : :\n\n:::\n\n0 0 ? ? ? xn\n\n3\n7775 (2.8)\n\nAn important special case of a diagonal matrix is the identity matrix:\n\nI ? diag.\u01521 1 ? ? ? 1?/ (2.9)\n\nIt has the property that I A D A and B I D B if the matrices are conformable.\nWe sometimes denote the n ? n identity matrix by In if supplying the subscript\nhelps to remove ambiguity.\n\nAn upper triangular matrix is a matrix in which all the entries below the main\ndiagonal are zero, i.e. aij D 0 for i < j . A lower triangular matrix has all zeros\nabove the main diagonal, i.e. aij D 0 for i > j .\n\nTwo useful scalar quantities can be defined for square matrices, the trace and\nthe determinant. The trace of an n ? n matrix is simply the sum of the diagonal\nelements:\n\ntrA D\nnX\niD1\n\nai i (2.10)\n\n\n\n20 2 Matrices, Vectors, Frames, Transforms\n\nSome useful identities involving the matrix trace are given by\n\ntr.?A/ D ? trA (2.11a)\ntr.AC B/ D trAC trB (2.11b)\n\ntr.AB C/ D tr.B C A/ D tr.C AB/ (2.11c)\ntr.AB/ D tr.B A/ (2.11d)\n\ntr.x yT / D xT y (2.11e)\ntr.A y xT / D xT A y (2.11f)\n\nEquation (2.11d)\u2013(2.11f) are special cases of Eq. (2.11c), which shows the cyclic\ninvariance of the trace. The operation y xT is known as the outer product (note that\ny xT \u00a4 x yT in general).\n\nThe determinant of an n ? n matrix can be computed using an expansion about\nany row i or any column j :\n\ndetA D\nnX\n\nkD1\n.?1/iCkaikmik D\n\nnX\nkD1\n.?1/kCj akjmkj (2.12)\n\nwhere mij is the minor, which is the determinant of the .n ? 1/ ? .n ? 1/\nmatrix resulting from deleting row i and column j of A. Some useful determinant\nidentities are\n\ndet I D 1 (2.13a)\ndetAT D detA (2.13b)\n\ndet.AB/ D detA detB (2.13c)\ndet.? A/ D ?n detA (2.13d)\n\nThe elements of the adjoint matrix adjA are defined in terms of the minors:\n\n\u0152adjA?ij D .?1/iCjmji (2.14)\nNote the reversed order of the subscripts on the left and right side of this equation.\nIt can be shown that [21]\n\nA.adjA/ D .adjA/A D .detA/I (2.15)\nThus we see that a nonsingular matrix, which is a square matrix with a nonzero\ndeterminant, has an inverse\n\nA?1 D adjA\ndetA\n\n(2.16)\n\n\n\n2.2 Vectors 21\n\nthat satisfies the identities\n\nA?1A D AA?1 D I (2.17a)\n.AT /?1 D .A?1/T ? A?T (2.17b)\n\nIf A and B are n ? n matrices, then the matrix product AB is nonsingular if and\nonly if A and B are nonsingular. If these conditions are met, then\n\n.AB/?1 D B?1A?1 (2.18)\n\n2.2 Vectors\n\nThe dot product, inner product, or scalar product of two vectors of equal dimension,\nn ? 1, is given by\n\nx ? y ? xT y D yT x D\nnX\niD1\n\nxiyi (2.19)\n\nIf the dot product is zero, then the vectors are said to be orthogonal. A measure of\nthe length of a vector is given by its Euclidean norm, which is the square root of the\ninner product of the vector with itself:\n\nkxk ? px ? x D\n\"\n\nnX\niD1\n\nx2i\n\n#1=2\n(2.20)\n\nIt is easily seen that k? xk D j?j kxk. The norm obeys the inequality\n\nkxk ? 0 (2.21)\n\nwith equality only for x D 0.\nA vector with norm equal to unity is said to be a unit vector. Any nonzero vector\n\ncan be made into a unit vector by dividing it by its norm:\n\nxunit ? xkxk (2.22)\n\nThis is referred to as normalizing the vector x.\nFigure 2.1a shows two vectors, x and y, and the orthogonal projection of a vector\n\ny onto a vector x. The orthogonal projection of y onto x \u00a4 0 is given by\n\n\n\n22 2 Matrices, Vectors, Frames, Transforms\n\ny\n\np\n\nx\n\ny?p\n\nOrthogonal Projection\n\ny\n\nx\n\ny?x\n\n?\n\nAngle between Two Vectors\n\na b\n\nFig. 2.1 Depiction of an orthogonal projection (a) and of the angle between two vectors (b)\n\np D x ? ykxk2 x (2.23)\n\nThis projection yields .y ? p/ ? x D 0. From Eqs. (2.21) and (2.23) we see that\n\n0 ? k.y ? p/k2 D kyk2 ? .x ? y/\n2\n\nkxk2 (2.24)\n\nThis yields the Cauchy-Schwarz inequality:\n\njx ? yj ? kxk kyk (2.25)\n\nThe Cauchy-Schwarz inequality implies the triangle inequality\n\nkxC yk ? kxk C kyk (2.26)\n\nand it allows us to define the angle ? between the vectors x and y by\n\ncos ? D x ? ykxk kyk (2.27)\n\nThis angle is illustrated in Fig. 2.1b, as is the vector difference y ? x.\n\n2.3 Jacobian, Gradient, and Hessian\n\nIn this section we will introduce notation for partial derivatives with respect to\ncomponents of a vector x. If y.x/ is an m-component vector function of an\nn-component vector x, we define the Jacobian matrix as the m ? n matrix\n\n\n\n2.3 Jacobian, Gradient, and Hessian 23\n\n@y.x/\n@x\n?\n\n2\n6666666666666664\n\n@y1\n\n@x1\n\n@y1\n\n@x2\n? ? ? @y1\n\n@xn\n\n@y2\n\n@x1\n\n@y2\n\n@x2\n? ? ? @y2\n\n@xn\n\n:::\n:::\n\n: : :\n:::\n\n@ym\n\n@x1\n\n@ym\n\n@x2\n? ? ? @ym\n\n@xn\n\n3\n7777777777777775\n\n(2.28)\n\nIn particular, if we have a scalar f .x/ in place of the vector function y.x/, this\nreduces to the m ? 1 row vector\n\n@f .x/\n@x\n?\n?\n@f\n\n@x1\n\n@f\n\n@x2\n: : :\n\n@f\n\n@xn\n\n?\n(2.29)\n\nThe transpose of this, a 1 ?m column vector, is known as the gradient of f .x/:\n\nr xf .x/ ?\n?\n@f .x/\n@x\n\n?T\n? @f .x/\n\n@xT\n(2.30)\n\nThe Hessian is the n ? n symmetric matrix of second-order partial derivatives\nof f .x/:\n\n@2f .x/\n@x @xT\n\n?\n\n2\n6666666666666664\n\n@2f\n\n@x1@x1\n\n@2f\n\n@x1@x2\n? ? ? @\n\n2f\n\n@x1@xn\n\n@2f\n\n@x2@x1\n\n@2f\n\n@x2@x2\n? ? ? @\n\n2f\n\n@x2@xn\n\n:::\n:::\n\n: : :\n:::\n\n@2f\n\n@xn@x1\n\n@2f\n\n@xn@x2\n? ? ? @\n\n2f\n\n@xn@xn\n\n3\n7777777777777775\n\n(2.31)\n\nSome use the term Hessian to refer to the determinant of the Hessian matrix. The\nLaplacian is the trace of the Hessian matrix:\n\nr2xf .x/ ?\nnX\niD1\n\n@2f\n\n@x2i\nD tr\n\n?\n@2f .x/\n@x @xT\n\n?\n(2.32)\n\n\n\n24 2 Matrices, Vectors, Frames, Transforms\n\n2.4 Orthonormal Bases, Change of Basis\n\nAn orthonormal set of vectors is a set with inner products obeying\n\nxi ? xj D ?ij (2.33)\nwhere the Kronecker delta ?ij is defined as\n\n?ij D\n(\n0 if i \u00a4 j\n1 if i D j (2.34)\n\nIf the number of vectors in the set is equal to the dimension of the vectors, then the\nset is said to constitute an orthonormal basis. We will generally denote basis vectors\n(and some other unit vectors) by the letter e. The orthonormal basis\n\ne1 D\n\n2\n6664\n\n1\n\n0\n:::\n\n0\n\n3\n7775 ; e2 D\n\n2\n6664\n\n0\n\n1\n:::\n\n0\n\n3\n7775 ; : : : ; en D\n\n2\n6664\n\n0\n\n0\n:::\n\n1\n\n3\n7775 (2.35)\n\nis called the natural basis. Any vector x can be written as a linear superposition of\nbasis vectors; using the natural basis gives\n\nx D\n\n2\n6664\n\nx1\nx2\n:::\n\nxn\n\n3\n7775 D\n\nnX\njD1\n\nxj ej (2.36)\n\nAn orthonormal set of basis vectors defines a reference frame. Let us refer to the\nframe defined by e1; e2; : : : ; en as frame F ; and consider another frame F 0 defined\nby the orthonormal basis: e01; e02; : : : ; e0n. We can express the vector x in either basis\n\nx D\nnX\n\njD1\nxj ej D\n\nnX\nkD1\n\nx0ke0k (2.37)\n\nTaking the dot product of this equation with ej or e0k gives\n\nxj D ej ? x D\nnX\n\nkD1\n.ej ? e0k/x0k (2.38a)\n\nx0k D e0k ? x D\nnX\n\njD1\n.e0k ? ej /xj (2.38b)\n\n\n\n2.4 Orthonormal Bases, Change of Basis 25\n\nSubstituting the first equality of Eq. (2.38a) into the first equality of Eq. (2.37) gives\n\nx D\nnX\n\njD1\nej .eTj x/ D\n\n0\n@\n\nnX\njD1\n\nej eTj\n\n1\nA x (2.39)\n\nIt follows that the identity matrix can be expressed in terms of any orthonormal\nbasis by\n\nIn D\nnX\niD1\n\neieTi (2.40)\n\nWhen considering transformations among different reference frames, it is very\nuseful (almost indispensable, in fact) to regard x as an abstract vector having an\nexistence in n-dimensional space independent of any particular reference frame, and\nhaving representations xF in reference frame F and xF 0 in frame F 0. Subscripts\nwill be provided when it is important to indicate the reference frame explicitly\nor to carefully distinguish between abstract vectors and their representations, but\nsubscripts will often be omitted when confusion is unlikely to arise. Arraying the\ncomponents of x in the reference frames F and F 0 as column vectors gives the\nrepresentations\n\nxF D\n\n2\n6664\n\nx1\nx2\n:::\n\nxn\n\n3\n7775 D\n\n2\n6664\n\ne1 ? x\ne2 ? x\n:::\n\nen ? x\n\n3\n7775 and xF 0 D\n\n2\n6664\n\nx01\nx02\n:::\n\nx0n\n\n3\n7775 D\n\n2\n6664\n\ne01 ? x\ne02 ? x\n:::\n\ne0n ? x\n\n3\n7775 (2.41)\n\nEquation (2.38) can be used to express the relations between xF and xF 0 as matrix\nproducts:\n\nxF D DFF 0xF 0 (2.42a)\nxF 0 D DF 0F xF (2.42b)\n\nwhere\n\nDFF 0 D\n\n2\n6664\n\ne1 ? e01 e1 ? e02 ? ? ? e1 ? e0n\ne2 ? e01 e2 ? e02 ? ? ? e2 ? e0n\n:::\n\n:::\n: : :\n\n:::\n\nen ? e01 en ? e02 ? ? ? en ? e0n\n\n3\n7775 (2.43a)\n\nDF 0F D\n\n2\n6664\n\ne01 ? e1 e01 ? e2 ? ? ? e01 ? en\ne02 ? e1 e02 ? e2 ? ? ? e02 ? en\n:::\n\n:::\n: : :\n\n:::\n\ne0n ? e1 e0n ? e2 ? ? ? e0n ? en\n\n3\n7775 (2.43b)\n\n\n\n26 2 Matrices, Vectors, Frames, Transforms\n\nThe matrices DFF 0 and DF 0F are known as direction cosine matrices (DCMs)\nbecause their elements are the cosines of the angles between the basis vectors in the\ntwo reference frames. These transformation equations hold for any two orthonormal\nbases. We see immediately that\n\nDF 0F D DTFF 0 (2.44)\n\nwhich means that the matrix transforming vector representations from frame F to\nframe F 0 is the transpose of the matrix transforming from F 0 to F . Another way of\nstating the content of Eq. (2.43) is that the columns of DFF 0 are the representations\nin frame F of the basis vectors of frame F 0 and vice versa:\n\nDFF 0 D\n?\ne01F e02F ? ? ? e0nF\n\n?\n(2.45a)\n\nDF 0F D\n?\ne1F 0 e2F 0 ? ? ? enF 0\n\n?\n(2.45b)\n\nWe emphasize that the transformations considered here are transformations of\nthe representations of a fixed abstract vector resulting from a change in the reference\nframe. This is the passive interpretation of a transformation, also known as the\nalias sense (from the Latin word for \u201cotherwise,\u201d in the sense of \u201cotherwise known\nas\u201d) [17]. The alternative active interpretation (also known as the alibi sense from\nthe Latin word for \u201celsewhere\u201d) considers the representation in a fixed reference\nframe of an abstract vector that is rotated from x to x0. The difference between these\ntwo interpretations is illustrated in Fig. 2.2a\u2013c. Figure 2.2a shows the components\nx1 and x2 of the vector x in frame F . Figure 2.2b shows the components x01 and\nx02 of x in the rotated frame F 0, illustrating the alias sense. Figure 2.2c shows the\ncomponents x01 and x02 of a rotated vector x0 in the unrotated frame F , illustrating the\nalibi sense. In this example, the values of x01 and x02 are the same in the alias and alibi\ninterpretations, but the significance of these quantities is completely different in the\ntwo cases. They are the components of an unrotated vector in a rotated reference\nframe in the alias interpretation, while they are the components of a rotated vector\nin an unrotated reference frame in the alibi interpretation. When necessary, we can\nuse a more precise notation to distinguish these two different interpretations, as\nin Eq. (2.45); but we can usually avoid this complication because this book will\nrarely, if ever, employ the active interpretation of transformations. In the example\nillustrated in Fig. 2.2b,c, it can be seen that the magnitude of the rotation is the\nsame in the two interpretations but the sense of the rotation is opposite. It is\nimportant to remember this important difference in the sense of rotation in the two\ninterpretations; it results in some unexpected minus signs, and overlooking them has\nled to actual errors in flight software.1\n\n1One example is an incorrect sign for the velocity aberration correction for star tracker measure-\nments on the WMAP spacecraft, which fortunately was easily corrected.\n\n\n\n2.4 Orthonormal Bases, Change of Basis 27\n\na b c\n\nFig. 2.2 Alias and Alibi interpretations of a transformation. (a) Components. (b) Alias. (c) Alibi\n\nNow consider that we have three reference frames, denoted F , G, and H , and\nthat we transform a vector representation from frame F to frame G and then from\nframe G to frame H . This is effected by the successive transformations\n\nxH D DHGxG D DHG .DGF xF / D .DHGDGF / xF (2.46)\n\nWe could have transformed directly from F to H by xH D DHF xF . These\ntransformations must be equivalent for any vector xF , so it must be true that\n\nDHF D DHGDGF (2.47)\n\nThis says that successive transformations are accomplished by simple matrix\nmultiplication of DCMs, which may appear to be an obvious result. It is not\ninconceivable, though, that the method for implementing successive transformations\ncould have been more complex.\n\nTransforming from frame F to frame G and back to frame F is effected by the\nmatrixDFF , which must be the identity matrix. But from Eqs. (2.44) and (2.47) this\nmeans that\n\nI D DFGDGF D DFGDTFG D DTGFDGF (2.48)\n\nMatrices like DCMs for which I D DDT D DTD are called orthogonal matrices,\nor sometimes orthonormal matrices. The transpose of an orthogonal matrix is equal\nto its inverse; its columns constitute a set of orthonormal vectors, as do its rows.\nIn fact, the columns and rows of a DCM are just the representations in one reference\nframe of the basis vectors in the other reference frame. Equation (2.7c) can be used\nto show that the product of two orthogonal matrices is orthogonal; i.e. if A and B\nare orthogonal, then\n\n.AB/.AB/T D AB BTAT D AAT D I (2.49)\n\nThis means that the set of n ? n orthogonal matrices form a group, which requires,\namong other things, that the product of two elements of the group is also an element.\n\n\n\n28 2 Matrices, Vectors, Frames, Transforms\n\nThe group of n?n orthogonal matrices is called the orthogonal group O.n/. Because\n1 D det I D det.DTD/ D .detD/2, the determinant of an orthogonal matrix must\nbe equal to ?1. It follows that the set of n ? n proper orthogonal matrices, which\nare those whose determinant isC1, also form a group, called the special orthogonal\ngroup SO.n/. The orthogonal matrices with determinant ?1 do not form a group,\nbecause the product of two matrices with determinant ?1 has determinant C1.\n\nAn important result follows from Eq. (2.48), namely that\n\nxG ? yG D .DGF xF /TDGF yF D xTFDTGFDGF yF D xF ? yF (2.50)\n\nThis says that the value of the inner product of two vectors is independent of the\nreference frame in which they are represented, or equivalently that reference frame\ntransformations preserve both lengths of vectors and angles between them. Inserting\na matrix between two vectors leads to the relation\n\nxTFMF yF D xTFDTGFDGFMFDTGFDGF yF D xTGMGyG (2.51)\n\nwhere\n\nMG ? DGFMFDTGF (2.52)\n\nThis defines how matrices must transform under reference frame transformations\nfor Eq. (2.51) to hold.\n\n2.5 Vectors in Three Dimensions\n\nThe case of three dimensions is especially interesting because we and our vehicles\nlive in three-dimensional space.2 In three dimensions, the abstract vectors generally\nrepresent physical quantities that have both a magnitude and a direction, like\ndisplacements or velocities.\n\nWe can define a vector product or cross product for three-component vectors in\nterms of their components by\n\nx ? y D\n2\n4\nx2y3 ? x3y2\nx3y1 ? x1y3\nx1y2 ? x2y1\n\n3\n5 D ?y ? x (2.53)\n\nIt is easily seen that the cross product x ? y is perpendicular to both x and y. The\ncross product can also be obtained using matrix multiplication:\n\n2This is true in classical physics. Various contemporary physical theories indicate that we live in a\nspace having anywhere from two to eleven dimensions.\n\n\n\n2.5 Vectors in Three Dimensions 29\n\nx ? y D \u0152x?? y (2.54)\nwhere \u0152x?? is the cross product matrix, defined by\n\n\u0152x?? ?\n2\n4\n0 ?x3 x2\nx3 0 ?x1\n?x2 x1 0\n\n3\n5 (2.55)\n\nNote that \u0152x?? is a skew symmetric matrix.3\nThe cross product and the cross product matrix obey the following relations:\n\nx ? .y ? z/ D .x ? y/ ? z (2.56a)\n\u0152x?? \u0152y?? D ? .x ? y/ I C y xT (2.56b)\n\n\u0152x?? \u0152y?? ? \u0152y?? \u0152x?? D y xT ? x yT D \u0152.x ? y/?? (2.56c)\nadj \u0152x?? D x xT (2.56d)\n\nIt follows from Eq. (2.56b) that\n\nkx ? yk2 D .\u0152x?? y/T .\u0152x?? y/ D ?yT \u0152x??2y D kxk2kyk2 ? .x ? y/2 (2.57)\nWith Eq. (2.27), this means that\n\nkx ? yk D kxk kyk sin ? (2.58)\n\nIt is often convenient to express a 3 ? 3 matrix in terms of its columns:\n\nM ? ?a b c? (2.59)\n\nWith this notation, the determinant is\n\ndetM D a ? .b ? c/ D b ? .c ? a/ D c ? .a ? b/ (2.60)\n\nand the adjoint is\n\nadjM ? adj ??a b c?\t D\n2\n4\n.b ? c/T\n.c ? a/T\n.a ? b/T\n\n3\n5 (2.61)\n\nWe can also derive the useful identity\n\n3A vector product of two vectors can be defined only in three dimensions because an n ? n skew-\nsymmetric matrix has exactly n independent parameters only for n D 3.\n\n\n\n30 2 Matrices, Vectors, Frames, Transforms\n\nMT \u0152x??M D\n2\n4\n\na ? .x ? a/ a ? .x ? b/ a ? .x ? c/\nb ? .x ? a/ b ? .x ? b/ b ? .x ? c/\nc ? .x ? a/ c ? .x ? b/ c ? .x ? c/\n\n3\n5\n\nD\n2\n4\n\n0 ? .a ? b/ ? x .c ? a/ ? x\n.a ? b/ ? x 0 ? .b ? c/ ? x\n? .c ? a/ ? x .b ? c/ ? x 0\n\n3\n5 D \u0152f.adjM/xg??\n\n(2.62)\n\nSetting M D AT , where A is a proper orthogonal 3 ? 3 matrix, gives adjM D A\nand\n\nA \u0152x?? AT D \u0152.Ax/??; for A 2 SO(3) (2.63)\nThis special case is much more useful than the general case. In the specific case of\na reference frame transformation, we have\n\nAGF \u0152xF?? ATGF D \u0152.AGF xF /?? D \u0152xG?? (2.64)\nwhich can be viewed as a special case of Eq. (2.52). This equation can be used to\nshow that\n\nxG ? yG D \u0152.AGF xF /??AGF yF D AGF .xF ? yF / (2.65)\nThe significance of this is that the cross product of two vectors transforms exactly\nlike any other vector under a reference frame rotation, which is what we want.\n\nThe discussion so far has been purely algebraic; it has said nothing about the\nright hand rule. Discussing this rule requires an intuitive picture of vectors in three-\ndimensional space. First note that the definition of the cross product means that the\nnatural basis vectors defined by Eq. (2.35) satisfy the relation e3 D e1 ? e2. Now\nconsider the possible orientation of these three basis vectors in physical space. The\norientation of e1 and e2 is arbitrary, except that they must be orthogonal; but this\nleaves us only two choices for e3, which must be perpendicular to both e1 and e2.\nWe choose the orientation of e3 to satisfy the right hand rule, i.e: we place e1 and e2\ntail-to-tail, flatten the right hand, extending it in the direction of e1, curl the fingers\ntoward e2 through the shortest angle, and choose e3 to point along the direction\nindicated by the thumb. This defines a right-handed reference frame, and all cross\nproducts will obey the right hand rule if we restrict ourselves to right handed\nreference frames. To see this explicitly, consider two arbitrary vectors x and y. There\nis a reference frame in which\n\nxF D kxk\n2\n4\n1\n\n0\n\n0\n\n3\n5 ; yF D kyk\n\n2\n4\n\ncos ?\nsin ?\n0\n\n3\n5 H) xF ? yF D kxkkyk\n\n2\n4\n\n0\n\n0\n\nsin ?\n\n3\n5 (2.66)\n\n\n\n2.6 Some Useful Reference Frames 31\n\nwhere ? is the angle between x and y. This cross product obeys the right-hand rule,\nand Eq. (2.65) guarantees that the right hand rule will then hold in any reference\nframe. Note that if A had been an improper orthogonal matrix with determinant ?1,\nan undesirable minus sign would have appeared between the two sides of Eq. (2.63).\nSeen from this point of view, the problem with improper orthogonal matrices is\nthat they would change a right-handed reference frame into a left-handed one; they\nwould turn the reference frame inside out.\n\n2.6 Some Useful Reference Frames\n\nSeveral reference frames in three dimensions are of special interest for attitude\nanalysis. We will discuss the most important of these in this section. In general,\na reference frame is specified by the location of its origin and the orientation of\nits coordinate axes, with the orientation being much more important for attitude\nanalysis.\n\n2.6.1 Spacecraft Body Frame\n\nA spacecraft body frame is defined by an origin at a specified point in the spacecraft\nbody and three Cartesian axes. A body frame is used to align the various components\nduring spacecraft assembly. Components will generally shift due to the large forces\nexperienced during launch, though, and can also move while on orbit due to thermal\ndeformations. Every effort is made to limit these motions, but they cannot always\nbe neglected. Whether they are negligible or not depends on the pointing accuracy\nrequired of the spacecraft. As an additional complication, some components of\nthe spacecraft, such as solar arrays or gimbaled instruments, are moved quite\ndeliberately. Therefore, it is quite common to define the body coordinate system\noperationally as the orientation of some sufficiently rigid navigation base, which is a\nsubsystem of the spacecraft including the most critical attitude sensors and payload\ninstruments. The navigation base often takes the form of a specially constructed\noptical bench, with its attached sensors and payload components. The purpose of\nattitude estimation and attitude control is to ascertain and to control the orientation\nof the navigation base relative to some external reference frame.\n\n2.6.2 Inertial Reference Frames\n\nAn inertial reference frame is a frame in which Newton\u2019s laws of motion are valid.\nIt is a well known fact of classical mechanics that any frame moving at constant\nvelocity and without rotation with respect to an inertial frame is also inertial [5].\n\n\n\n32 2 Matrices, Vectors, Frames, Transforms\n\nThe existence of these dynamically preferred frames raises the interesting question\nof whether there is something with respect to which all inertial frames are non-\nrotating and unaccelerated. Weinberg concludes in [25, p. 474] that \u201c . . . inertial\nframes are any reference frames that move at constant velocity, and without rotation,\nrelative to frames in which the universe appears spherically symmetric.\u201d This\ncharacterization is consistent with Mach\u2019s Principle, the hypothesis that inertial\nframes are somehow determined by the mass of everything in the universe.\n\nCelestial reference frames with their axes fixed relative to distant \u201cfixed\u201d stars\nare the best realizations of inertial frames. The standard as of this writing is the\nInternational Celestial Reference System (ICRF) with its axes fixed with respect\nto the positions of several hundred distant extragalactic sources of radio waves,\ndetermined by very long baseline interferometry [8, 11]. The z axis of this frame\nis aligned with the Earth\u2019s North pole, and the x axis with the vernal equinox, the\nintersection of the Earth\u2019s equatorial plane with the plane of the Earth\u2019s orbit around\nthe Sun, in the direction of the Sun\u2019s position relative to the Earth on the first day of\nspring. Unfortunately, neither the polar axis nor the ecliptic plane is inertially fixed,\nso the ICRF axes are defined to be the mean orientations of the pole and the vernal\nequinox (the positions with short-period motions removed by dynamic models) at\nsome fixed epoch time. The origin of the ICRF is at the center-of-mass of the solar\nsystem.\n\nAn approximate inertial frame, known as the Geocentric Inertial Frame (GCI)\nhas its origin at the center of mass of the Earth. This frame has a linear acceleration\nbecause of the Earth\u2019s circular orbit about the Sun, but this is unimportant for\nattitude analysis. The axes of a \u201cmean of epoch\u201d GCI frame are aligned with the\nmean North pole and mean vernal equinox at some epoch. The GCI frame is denoted\nby the triad fi1; i2; i3g, as shown in Fig. 2.3.\n\n2.6.3 Earth-Centered/Earth-Fixed Frame\n\nThe Earth-Centered/Earth-Fixed (ECEF) Frame is denoted by f?1; ?2; ?3g as shown\nin Fig. 2.3. This frame is similar to the GCI frame with ?3 D i3; however, the ?1 axis\npoints in the direction of the Earth\u2019s prime meridian, and the ?2 axis completes the\nright-handed system. Unlike the GCI frame, the ECEF frame rotates with the Earth.\nThe rotation angle is known as the Greenwich Mean Sidereal Time (GMST) angle\nand is denoted by ?GMST in Fig. 2.3.\n\nThe transformation of a position vector r from its GCI representation rI to its\nECEF representation rE follows\n\nrE D\n2\n4\nx\n\ny\n\nz\n\n3\n5 D AEI rI D\n\n2\n4\n\ncos ?GMST sin ?GMST 0\n? sin ?GMST cos ?GMST 0\n\n0 0 1\n\n3\n5 rI (2.67)\n\n\n\n2.6 Some Useful Reference Frames 33\n\nPrime\nMeridian\n\nPlane\n\nEquatorial\nPlane 2\n\n3 ,i\n\n1\n\nSpacecraft\n\nr\n\n1i 2i\n\nInertial\nReference\nDirection GMST\n\n3\n\nFig. 2.3 Definitions of various reference frames\n\nDetermining the GMST angle requires the Julian date, JD. For a given year Y\n(between 1901 and 2099), month M , day D, hour h, minute m, and second s, the\nJulian date is calculated by [24]\n\nJD.Y;M;D; h;m; s/ D 1; 721; 013:5C 367 Y ? INT\n\n\n7\n\n4\n\n?\nY C INT\n\n?\nM C 9\n12\n\n???\n\nC INT\n?\n275M\n\n9\n\n?\nCD C 60 hCmC s=60\n\n?\n\n1440\n(2.68)\n\nwhere INT denotes the integer part and 60* denotes using 61 s for days with a leap\nsecond. We need to compute T0, the number of Julian centuries elapsed from the\nepoch J2000.0 to zero hours of the date in question:\n\nT0 D JD.Y;M;D; 0; 0; 0/ ? 2; 451; 545\n36; 525\n\n(2.69)\n\nThe GCI coordinate system is fixed relative to the stars, not the Sun, so the GMST\nangle is the mean sidereal time at zero longitude. A sidereal day is the length of\ntime that passes between successive crossings of a given projected meridian by a\ngiven fixed star in the sky. It is approximately 3 min and 56 s shorter than a solar\n\n\n\n34 2 Matrices, Vectors, Frames, Transforms\n\nRpole\n\nR N\n\nh\n\nZenith\n\nHorizonr\n\nFig. 2.4 Geocentric and\ngeodetic latitude\n\nday of 86,400 s, which is the length of time that elapses between the Sun reaching\nits highest point in the sky two consecutive times [1]. Therefore ?GMST in units of\nseconds is calculated by\n\n?GMST D 24; 110:54841C 8; 640; 184:812866 T0 C 0:093104 T 20\n? 6:2 ? 10?6 T 30 C 1:002737909350795.3600 hC 60mC s/ (2.70)\n\nThis quantity is next reduced to a range from 0 to 86,400 s by adding/subtracting\nmultiples of 86,400. Then ?GMST in degrees is obtained by dividing by 240, because\n1 sD 1/240?.\n\nThe ECEF position vector can be specified by its magnitude r ? krEk D krIk,\nlongitude ?, and geocentric latitude \t0. An alternative description in terms of\ngeodetic latitude, \t, is often employed. The Earth\u2019s geoid can be approximated by\nan ellipsoid of revolution about its minor axis, the Earth\u2019s rotation axis, as shown\nin Fig. 2.4 [11]. The geocentric latitude \t0 D sin?1.z=r/ is the angle between the\nequatorial plane and the radius vector from the center of the Earth. The geodetic\nlatitude \t is the angle between the equatorial plane and the normal to the reference\nellipsoid. The flattening of the ellipsoid is given by\n\nf D R? ?Rpole\nR?\n\n(2.71)\n\nwhere R? is the equatorial radius of the Earth and Rpole is the distance from the\ncenter of the Earth to a pole. The eccentricity of the reference ellipsoid is given by\n\ne D\np\n1 ? .1 ? f /2 D\n\np\nf .2 ? f / (2.72)\n\nMany reference ellipsoid models exist, but for all of them the difference between\nthe equatorial and polar radii is less than 22 km, so that f ? 1=298:257 is a valid\napproximation. A common ellipsoid model is given by the World Geodetic System\n1984 model (WGS-84), with semimajor axis R? ? a D 6; 378; 137:0 m and\nsemiminor axis Rpole ? b D 6; 356; 752:3142 m. The eccentricity of this ellipsoid\nis given by e D 0:0818.\n\n\n\n2.6 Some Useful Reference Frames 35\n\nTo determine the ECEF position vector from the geodetic coordinates, latitude \t,\nlongitude ?, and height h, we first compute the distance between the z axis and the\nnormal to the ellipsoid, finding [3]\n\nN D R?p\n1 ? e2 sin2 \t\n\n(2.73)\n\nThen the ECEF position coordinates are given by\n\nx D .N C h/ cos\t cos? (2.74a)\ny D .N C h/ cos\t sin? (2.74b)\nz D \u0152N.1 ? e2/C h? sin\t (2.74c)\n\nThis gives the following relationship between geocentric and geodetic latitudes\n\ntan\t D N C h\nN.1 ? e2/C h tan\t\n\n0 (2.75)\n\nwhich has the first order approximation in the flattening f\n\n\t D \t0 C fR?\nR? C h sin.2\t\n\n0/ (2.76)\n\nThe difference between geodetic and geocentric latitudes amounts to 12 arcmin at\nmost [11].\n\nThe conversion from ECEF to geodetic coordinates is not straightforward, but a\nclosed-form solution is given in [20]. Given, x, y and z in ECEF coordinates, the\nsolution is given by\n\ne2 D 1 ? b2=a2; \n2 D a2=b2 ? 1; ? D\np\nx2 C y2 (2.77a)\n\np D jzj=\n2; s D ?2=.e2\n2/; q D p2 ? b2 C s (2.77b)\nu D p=pq; v D b2u2=q; P D 27vs=q; Q D .pP C 1CpP /2=3\n\n(2.77c)\n\nt D .1CQC 1=Q/=6; c D\np\n\nu2 ? 1C 2t; w D .c ? u/=2 (2.77d)\nd D sign.z/pq\n\nh\nwC .\n\np\nt 2 C v ? uw ? t=2 ? 1=4/1=2\n\ni\n(2.77e)\n\nN D a\np\n1C \n2d2=b2; \t D sin?1\u0152.\n2 C 1/.d=N /? (2.77f)\n\nh D ? cos\tC z sin\t ? a2=N; ? D atan2.y; x/ (2.77g)\n\n\n\n36 2 Matrices, Vectors, Frames, Transforms\n\nDirection of\nMotionGeocentric Radius\n\nVector of Spacecraft\nOrbital\nPlane\n\nba\n\nFig. 2.5 Local-vertical/local-horizontal frame. (a) Frame definition. (b) Flight path angle\n\nwhere atan2.y; x/ is the standard function giving the argument of the complex\nnumber x C iy. It should be noted that longitude here is assumed to range between\n?180? (West) toC180? (East).\n\n2.6.4 Local-Vertical/Local-Horizontal Frame\n\nIt is often convenient, especially for Earth-pointing spacecraft, to define a reference\nframe referenced to the spacecraft\u2019s orbit, which we will identify by the subscriptO .\nThe most common case is the Local-Vertical/Local-Horizontal (LVLH) orbit frame\nshown in Fig. 2.5a. It has its z axis o3 pointing along the nadir vector, directly toward\nthe center of the Earth from the spacecraft,4 and its y axis o2 pointing along the\nnegative orbit normal, in the direction opposite to the spacecraft\u2019s orbital angular\nvelocity. The x axis o1 completes the right-handed triad. The representations of\nthese vectors in an inertial frame I are\n\no3I D ?rI =krIk ? ?g3rI (2.78a)\no2I D ?.rI ? vI /=krI ? vIk ? ?g2.rI ? vI / (2.78b)\no1I D o2I ? o3I D g2g3.rI ? vI / ? rI D g2g3\u0152 krIk2vI ? .rI ? vI /rI ? (2.78c)\n\nwhere rI and vI D PrI are the spacecraft position and velocity in the I frame. Note\nthat the x axis is in the direction of the velocity for a circular orbit. The rotation\nmatrix from the O frame to the I frame can be expressed by Eq. (2.45) as\n\nAIO D\n?\no1I o2I o3I\n\n?\n(2.79)\n\n4This is the geocentric nadir vector. Some spacecraft use the geodetic nadir vector, which is normal\nto the surface of the reference ellipsoid, but we will not consider this complication.\n\n\n\n2.7 Quaternions 37\n\nThe angle between the velocity vector and the local horizontal .o1I ? o2I / plane\nis called the flight-path angle, denoted by ? in Fig. 2.5b. The specific angular\nmomentum is given by hI D rI ? vI , as discussed in Chap. 10. From Eq. (2.58)\nwe have h ? khjk D rv sin', where r ? krIk and v ? kvIk. Since ? C ' D 90?,\nthen the flight path angle can be computed using\n\ncos ? D h\nrv\n\n(2.80)\n\nThe sign of ? is the same as the sign of rI ? vI . Notice that o1I is in the direction of\nthe spacecraft velocity and the flight path angle is always zero for a circular orbit,\nbecause rI ? vI D 0 in this case.\n\n2.7 Quaternions\n\nWe consider a quaternion to be a four-component vector with some additional\noperations defined on it. A quaternion q has a three-vector part q1W3 and a scalar\npart q4\n\nq D\n?\n\nq1W3\nq4\n\n?\nwhere q1W3 D\n\n2\n4\nq1\nq2\nq3\n\n3\n5 (2.81)\n\nThe most important added quaternion operations are two different products of a pair\nof quaternions Nq and q\n\nNq? q D\n?\nq4 Nq1W3 C Nq4 q1W3 ? Nq1W3 ? q1W3\n\nNq4 q4 ? Nq1W3 ? q1W3\n?\n\n(2.82a)\n\nNq? q D\n?\nq4 Nq1W3 C Nq4 q1W3 C Nq1W3 ? q1W3\n\nNq4 q4 ? Nq1W3 ? q1W3\n?\n\n(2.82b)\n\nNotice that these definitions differ only in the sign of the cross product in the vector\npart, from which it follows that5\n\nNq? q D q? Nq (2.83)\nOur quaternions are conceptually different from those introduced by Hamilton in\n\n1844, before the introduction of vector notation. Hamilton defined a quaternion as\nq D q0 C iq1 C jq2 C kq3, a hypercomplex extension of a complex number z D\nxC iy, with i , j , and k obeying the relations i 2 D j 2 D k2 D ?1, ij D ?j i D k,\n\n5The notation Nq ? q was introduced in [7], and the notation Nq ? q is a modification of notation\nintroduced in [13].\n\n\n\n38 2 Matrices, Vectors, Frames, Transforms\n\njk D ?kj D i , and ki D ?ik D j . Hamilton\u2019s product Nqq corresponds to our\nproduct Nq?q, but the product Nq?q has proven to be more useful in attitude analysis.\nSome authors\u2019 notations differ from ours in labeling the scalar part of a quaternion\nq0 and putting it at the top of the column vector. Care must be taken to thoroughly\nunderstand the conventions embodied in any quaternion equation that one chooses\nto reference.\n\nQuaternion multiplication is associative, q ? . Nq ? NNq/ D .q ? Nq/ ? NNq and\ndistributive, q ? . Nq C NNq/ D q ? Nq C q ? NNq, but not commutative in general,\nq? Nq \u00a4 Nq? q. This parallels the situation for matrix multiplication. In those cases\nfor which q? Nq D Nq? q, the quaternions q and Nq are said to commute. Analogous\nequations hold for the product Nq? q.\n\nQuaternion products can be represented by matrix multiplication, very much like\nthe cross product:\n\nq? Nq D \u0152q?? Nq D Nq? q (2.84a)\nq? Nq D \u0152q?? Nq D Nq? q (2.84b)\n\nwhere\n\n\u0152q?? ?\n?\nq4 I3 ? \u0152q1W3?? q1W3\n?qT1W3 q4\n\n?\nD ??.q/ q? (2.85)\n\nand\n\n\u0152q?? ?\n?\nq4 I3 C \u0152q1W3?? q1W3\n?qT1W3 q4\n\n?\nD ??.q/ q? (2.86)\n\nwith ?.q/ and ?.q/ being the 4 ? 3 matrices\n\n?.q/ ?\n?\nq4 I3 ? \u0152q1W3??\n?qT1W3\n\n?\nD\n\n2\n664\n\nq4 q3 ?q2\n?q3 q4 q1\nq2 ?q1 q4\n?q1 ?q2 ?q3\n\n3\n775 (2.87)\n\n?.q/ ?\n?\nq4 I3 C \u0152q1W3??\n?qT1W3\n\n?\nD\n\n2\n664\n\nq4 ?q3 q2\nq3 q4 ?q1\n?q2 q1 q4\n?q1 ?q2 ?q3\n\n3\n775 (2.88)\n\nIt is easy to show that\n\n?T .q/?.q/ D ?T .q/?.q/ D kqk2I3 (2.89a)\n?.q/?T .q/ D ?.q/?T .q/ D kqk2I4 ? qqT (2.89b)\n\n?T .q/q D ?T .q/q D 03 (2.89c)\n\nfrom which it follows that kqk?1\u0152q?? and kqk?1\u0152q?? are orthogonal matrices.\n\n\n\n2.7 Quaternions 39\n\nWe define the identity quaternion\n\nIq ?\n?\n\n03\n1\n\n?\n(2.90)\n\nwhich obeys Iq ? q D q? Iq D Iq ? q D q? Iq D q, as required of the identity.\nWe also define the conjugate q? of a quaternion, obtained by changing the sign\n\nof the three-vector part:\n\nq? D\n?\n\nq1W3\nq4\n\n??\n?\n??q1W3\nq4\n\n?\n(2.91)\n\nThe product of a quaternion with its conjugate is equal to the square of its norm\ntimes the identity quaternion\n\nq? q? D q? ? q D q? q? D q? ? q D kqk2 Iq (2.92)\nThe conjugate of the product of two quaternions Nq and q is the product of the\nconjugates in the opposite order .p ? q/? D q? ? p?. This relation, Eq. (2.92),\nand the associativity of quaternion multiplication can be used to show that\n\nkp? qk D kp? qk D kpkkqk (2.93)\nIt is not difficult to see that\n\n\u0152q??? D \u0152q??T and \u0152q??? D \u0152q??T (2.94)\nThe inverse of any quaternion having nonzero norm is defined by\n\nq?1 ? q?=kqk2 (2.95)\nso that q ? q?1 D q?1 ? q D q ? q?1 D q?1 ? q D Iq , as required by the\ndefinition of an inverse. The inverse of the product of two quaternions is the product\nof the inverses in the opposite order .p? q/?1 D q?1 ? p?1.\n\nWe will overload the quaternion product notation to allow us to multiply a three-\ncomponent vector x and a quaternion, using the definitions\n\nx? q ?\n?\n\nx\n0\n\n?\n? q D \u0152x??q and q? x ? q?\n\n?\nx\n0\n\n?\n(2.96)\n\nwith analogous definitions for x? q, \u0152x??, and q? x. Note that the matrices\n\n\u0152x?? D\n??\u0152x?? x\n?xT 0\n\n?\n? ?.x/ and (2.97a)\n\n\u0152x?? D\n?\n\u0152x?? x\n?xT 0\n\n?\n? ? .x/ (2.97b)\n\n\n\n40 2 Matrices, Vectors, Frames, Transforms\n\nare skew-symmetric. The relation\n\nx? q D q? x D ??.q/ q?\n?\n\nx\n0\n\n?\nD ?.q/ x (2.98)\n\nis often very useful.\n\n2.8 Rotations and Euler\u2019s Theorem\n\nThe discipline of spacecraft attitude determination is basically the study of methods\nfor estimating the proper orthogonal matrix that transforms vectors from a reference\nframe fixed in space to a frame fixed in the spacecraft body. Thus it is the study of\nproper orthogonal 3 ? 3 matrices, or matrices in the group SO(3). We will refer to\nthese as rotation matrices or attitude matrices and denote them by the letter A.\n\nEuler\u2019s Theorem6 states one of the most important properties of attitude matrices,\nnamely that any rotation is a rotation about a fixed axis. Recall that the transforma-\ntion of a vector representation xF from reference frame F to reference frame G by\nthe attitude matrix AGF is given by\n\nAGF xF D xG (2.99)\nEuler\u2019s Theorem asserts the existence of a vector e along the direction of the rotation\naxis that has the same representation in frame G as in frame F . This means that we\ncan substitute xF D xG D e in Eq. (2.99) and state Euler\u2019s theorem algebraically as\n\nA e D e (2.100)\nThis is a special case of an eigenvalue/eigenvector relationship. An eigenvector of a\ngeneral square matrix M is a nonzero vector x for which multiplication by M has\nthe same effect as multiplication by a scalar, i.e.\n\nM x D \tx (2.101)\nwhere the scalar \t is the eigenvalue corresponding to the eigenvector x. The solution\nfor x is only determined up to a scale factor in general, so eigenvectors are almost\ninvariably given as unit vectors. In order for Eq. (2.101) to have a nonzero solution\nfor x, the matrix .\tI ?M/ must be singular.7 Therefore, from Eq. (2.16) we have\n\ndet.\tI ?M/ D \tn C ?1\tn?1 C ? ? ? C ?n?1\tC ?n D 0 (2.102)\n\n6Leonhard Euler (1707\u20131783) laid the foundations for the analysis of rotations, and his fingerprints\nare all over the subject. Thus, attaching his name to anything serves poorly for distinguishing it\nfrom other results also bearing his name.\n7Otherwise, we would have x D .\tI ?M/?10 D 0.\n\n\n\n2.9 Attitude Representations 41\n\nx\n\n,A e\n\ne\n\nx e e x\n\nFig. 2.6 Euler axis/angle\nrotation\n\nThis polynomial equation of degree n is known as the characteristic equation ofM .\nThe eigenvalues are the n roots of the characteristic equation, counting multiple\nroots by their multiplicity.\n\nIn the language of eigenvalues and eigenvectors, Euler\u2019s theorem says that one\nof the eigenvalues of an attitude matrix has the value \t D 1. The characteristic\nequation of a 3 ? 3 matrix M is easily found by explicit computation of the\ndeterminant to take the form\n\n\t3 ? \t2trM C \t tr.adjM/ ? det M D 0 (2.103)\n\nFor the special case of a proper orthogonal 3 ? 3 matrix, we find the characteristic\nequation to be\n\n0 D \t3 ? \t2trAC \t trA ? 1 D .\t ? 1/\u0152\t2 C \t.1 ? trA/C 1? (2.104)\n\nThis clearly has a root \t D 1, which proves Euler\u2019s theorem with the rotation axis e\nbeing the eigenvector corresponding to this eigenvalue.\n\n2.9 Attitude Representations\n\n2.9.1 Euler Axis/Angle Representation\n\nWe have seen that every proper orthogonal 3? 3 matrix has a rotation axis specified\nby a unit vector e. The only other parameter needed to completely specify the matrix\nis the angle of rotation # about this axis. This axis and angle are known as the Euler\naxis and Euler angle of the rotation. We will now show how to parameterize the\nattitude matrix in terms of these parameters.\n\nFigure 2.6 depicts the rotation of an arbitrary vector x through an angle # about\nan axis e. This figure is actually more illustrative of an active (alibi) rotation of the\n\n\n\n42 2 Matrices, Vectors, Frames, Transforms\n\nvector, but we want to represent the transformation as a passive (alias) rotation of\nthe reference frame [5]. We make the connection between these two interpretations\nby referring to Fig. 2.2b,c, which show that we can move from one interpretation\nto the other by simply changing the direction of the rotation. The mapping of the\nvector x into the rotated reference frame is denoted as A.e; #/x, as indicated in the\nfigure.\n\nWe express x as the sum of vectors parallel and perpendicular to the rotation axis\n\nx D xk C x? (2.105)\nwhere\n\nxk ? .x ? e/ e D\n?\ne eT\n\n\t\nx and x? ? x ? .x ? e/e D .I3 ? e eT /x (2.106)\n\nThe rotation leaves xk alone, but rotates x? out of the plane defined by e and x. The\ncross product e?x is perpendicular to that plane and has magnitude ke?xk D kx?k\nby Eq. (2.57), so the result of the norm-preserving rotation by angle # is\n\nA.e; #/ x D xk C .cos#/ x? ? .sin#/ e ? x (2.107)\n\nThe sign of the last term is chosen to agree with the sense of the rotation shown in\nFig. 2.2b, which is regarded as a rotation in the positive sense about e3 D e1 ? e2,\nthe outward normal from the plane of the figure.\n\nBecause x is an arbitrary vector, Eq. (2.107) means, inserting the definitions of\nxk and x?, that\n\nA.e; #/ D .cos#/ I3 ? sin# \u0152e??C .1 ? cos#/e eT (2.108)\n\nThis is the Euler axis/angle parameterization of an attitude matrix. We can also\nexpress this, using Eq. (2.56b) as\n\nA.e; #/ D I3 ? sin# \u0152e??C .1 ? cos#/\u0152e??2 (2.109)\nThe attitude matrix is expressed in explicit component form as\n\nA.e; #/ D\n2\n4\n\nc C .1 ? c/e21 .1 ? c/e1e2 C s e3 .1 ? c/e1e3 ? s e2\n.1 ? c/e2e1 ? s e3 c C .1 ? c/e22 .1 ? c/e2e3 C s e1\n.1 ? c/e3e1 C s e2 .1 ? c/e3e2 ? s e1 c C .1 ? c/e23\n\n3\n5\n\n(2.110)\n\nwhere we have written c ? cos# and s ? sin# for conciseness. The attitude\nmatrix appears to depend on four parameters, but there are only three independent\nparameters owing to the constraint kek D 1. The nine-component attitude matrix\nhas only three independent parameters because of the orthogonality constraint\nAAT D I . This matrix constraint is equivalent to six scalar constraints rather than\nnine because the product AAT is symmetric.\n\n\n\n2.9 Attitude Representations 43\n\nEquations (2.108)\u2013(2.110) show that the attitude matrix is a periodic function of\nthe rotation angle over an unlimited range with period 2\n . Some useful identities\nsatisfied by the Euler axis/angle representation are\n\nA.e; #/ D A.?e;?#/ (2.111a)\nA?1.e; #/ D AT .e; #/ D A.?e; #/ D A.e;?#/ (2.111b)\n\nA.e; \n/ D A.?e; \n/ D 2 e eT ? I3 (2.111c)\n\nWe now turn to the question of finding the rotation axis and angle corresponding\nto a given attitude matrix. Noting from Eq. (2.108) that\n\ntrA.e; #/ D 1C 2 cos# (2.112)\n\nwe see that the rotation angle is given by\n\n# D cos?1\n?\n\ntrA.e; #/ ? 1\n2\n\n?\n(2.113)\n\nIf cos# D 1 the attitude matrix is A.e; #/ D I3, and the rotation axis is clearly\nundefined. If ?1 < cos# < 1, the axis of rotation is given by\n\ne D 1\n2 sin#\n\n2\n4\nA23.e; #/ ? A32.e; #/\nA31.e; #/ ? A13.e; #/\nA12.e; #/ ? A21.e; #/\n\n3\n5 (2.114)\n\nIf cos# D ?1 the axis of rotation can be found by normalizing any nonzero\ncolumn of\n\nA.e; #/C I3 D 2 e eT (2.115)\n\nbecause all the columns of this matrix are parallel to e. The overall sign of the\nrotation axis vector is undetermined in this case, but Eq. (2.111c) shows that this\nsign makes no difference.\n\nThe other two eigenvalues of the attitude matrix are the other two roots of\nEq. (2.104). Inserting the value of trA.e; #/ into this equation gives\n\n0 D \t2?2\t cos#C1 D \t2?\t ?ei# C e?i#\tC1 D ?\t ? ei#\t ?\t ? e?i#\t (2.116)\n\nThese two eigenvalues form a complex conjugate pair on the unit circle in the\ncomplex plane, and the corresponding eigenvectors are complex as well. This result\ncan be generalized to proper orthogonal matrices of higher dimensionality. A matrix\nin SO(2n C 1) has one eigenvalue equal to C1 and n conjugate pairs on the unit\ncircle in the complex plane. A matrix in SO(2n) has only the n conjugate pairs\n\n\n\n44 2 Matrices, Vectors, Frames, Transforms\n\non the unit circle. Thus Euler\u2019s theorem holds in any space of odd dimensionality,\nbut not in a space with an even number of dimensions. If we regard Fig. 2.2b as\na rotation in two-dimensional space rather than a projection onto the plane of a\nrotation in a higher-dimensional space, for example, it is easy to see that there is\nno invariant vector in the plane. This does not preclude the possibility of a pair of\ncomplex conjugate eigenvectors accidentally having the common valueC1.\n\nCross-product and trigonometric identities can be used to find the unsurprising\nresult of successive rotations about the same axis,\n\nA.e; #/A.e; '/ D A.e; '/A.e; #/ D A.e; # C '/ (2.117)\nbut this is more easily derived using the quaternion representation of rotations. The\ncomposition of rotations about non-parallel axes does not have a simple form in the\nangle/axis representation. Another useful result holds for two attitude matrices A0\nand A.e; #/. From Eq. (2.108) we have\n\nA0A.e; #/AT0 D .cos#/ I3 ? .sin#/A0\u0152e??AT0 C .1 ? cos#/A0 e eT AT0 (2.118)\nThis can be written, using Eqs. (2.7c) and (2.63), as\n\nA0A.e; #/AT0 D A.A0 e; #/ (2.119)\nwhich shows that A0AAT0 is a rotation by the same angle as A, but about a rotated\naxis.\n\n2.9.2 Rotation Vector Representation\n\nIt is convenient for analysis, but not for computations, to combine the Euler axis and\nangle into the three-component rotation vector\n\n# ? # e (2.120)\nTo express the attitude matrix in terms of the rotation vector, we insert the Taylor\nseries expansions of the sine and cosine into Eq. (2.109), giving8\n\nA.e; #/ D I3 ? \u0152e??\n1X\niD0\n\n.?1/i#2iC1\n.2i C 1/\u0160 ? \u0152e??\n\n2\n\n1X\niD1\n\n.?1/i#2i\n.2n/\u0160\n\n(2.121)\n\nEquation (2.56b) can be used to show that \u0152e??3 D ?\u0152e??, so we have\n\nA.e; #/ D I3C\n1X\niD0\n\n\u0152.?# e/??2iC1\n.2iC1/\u0160 C\n\n1X\niD1\n\n\u0152.?# e/??2i\n.2n/\u0160\n\nD\n1X\nnD0\n\n\u0152.?# e/??n\nn\u0160\n\n(2.122)\n\n8Note that these power series expansions assume that we measure angles in radians.\n\n\n\n2.9 Attitude Representations 45\n\nA function of a square matrix is defined by its Taylor series, so this expression for\nthe attitude matrix in terms of the rotation vector can finally be written as\n\nA.e; #/ D exp .?\u0152#??/ (2.123)\nwhere exp is the matrix exponential.\n\nThis is the first three-parameter representation of rotations that we have encoun-\ntered. It is a very useful representation for the analysis of small rotations; but it\nis not useful for large rotations, mainly because it obscures the periodicity of the\nattitude matrix as a function of # . In particular, it is not at all obvious in this\nrepresentation that a rotation by an angle # D 2\n is equivalent to the identity\ntransformation. Equation (2.113) shows that we can restrict the rotation angle to the\nrange 0 ? # ? \n , which avoids this problem and gives a 1:1 mapping of rotations\nwith # < \n to rotation vectors. The rotation vectors fill a ball of radius \n ,\nwith the two vectors at the ends of a diameter of the ball representing the same\nattitude according to Eq. (2.111c). This causes the difficulty that the rotation vector\nparameterization of a smoothly-varying attitude can jump discontinuously from\none side of the ball to the other. This discontinuity can be avoided by giving\nup the 1:1 mapping by allowing rotation angles greater than \n , but this causes\nother difficulties. It is an unavoidable fact that the rotation group has no global\nthree-component parameterization without singular points [22]. The expense of\ncomputing the matrix exponential also renders the rotation vector parameterization\nimpractical for numerical computations.\n\n2.9.3 Quaternion Representation\n\nSubstituting sin# D 2 sin.#=2/ cos.#=2/ and cos# D cos2.#=2/ ? sin2.#=2/ into\nEq. (2.108) and defining the quaternion\n\nq.e; #/ D\n?\n\ne sin.#=2/\ncos.#=2/\n\n?\n(2.124)\n\ngives the quaternion representation of the attitude matrix\n\nA.q/ D ?q24 ? kq1W3k2\n\t\nI3 ? 2q4\u0152q1W3??C 2q1W3 qT1W3\n\nD\n2\n4\nq21 ? q22 ? q23 C q24 2.q1q2 C q3q4/ 2.q1q3 ? q2q4/\n2.q2q1 ? q3q4/ ?q21 C q22 ? q23 C q24 2.q2q3 C q1q4/\n2.q3q1 C q2q4/ 2.q3q2 ? q1q4/ ?q21 ? q22 C q23 C q24\n\n3\n5\n\n(2.125)\n\nWe are abusing the notation by using both A.q/ and A.e; #/ to denote the attitude\nmatrix, and we will abuse it further when we define other representations. The\nmeaning of the argument of A.?/ will always be clear in context, however.\n\n\n\n46 2 Matrices, Vectors, Frames, Transforms\n\nThe four parameters of the quaternion representation were first considered by\nEuler, but their full significance was revealed by Rodrigues.9 For this reason, they\nare often referred to as the Euler symmetric parameters or the Euler-Rodrigues\nparameters. The beauty of the quaternion representation is that it expresses the\nattitude matrix as a homogenous quadratic function of the elements of the quater-\nnion, requiring no trigonometric or other transcendental function evaluations.\nQuaternions are more efficient for specifying rotations than the attitude matrix itself,\nhaving only four components instead of nine, and obeying only one constraint, the\nnorm constraint, instead of the six constraints imposed on the attitude matrix by\northogonality.\n\nQuaternions used to parameterize rotations are unit quaternions, i.e. quaternions\nwith unit norm, as defined by Eq. (2.124). A unit quaternion always has an inverse,\nwhich is identical with its conjugate. Also, the discussion in Sect. 2.7 says that the\nmatrices \u0152q?? and \u0152q?? for a unit quaternion are orthogonal. We will now derive\na useful expression for \u0152q?? in terms of the rotation vector. Because it is a linear\nfunction of q, we have\n\n\u0152q.e; #/?? D cos.#=2/\u0152Iq??C sin.#=2/\u0152e?? D cos.#=2/I4 C sin.#=2/\u0152e??\n(2.126)\n\nNow expand the sine and cosine in Taylor series and use \u0152e??2 D ?I4, to get\n\n\u0152q.e; #/?? D\n1X\niD0\n\n\u0152.# e=2/??2i\n.2n/\u0160\n\nC\n1X\niD0\n\n\u0152.# e=2/??2iC1\n.2i C 1/\u0160 D exp\u0152.#=2/?? (2.127)\n\nThis result and its derivation are very similar to Eq. (2.123).\nWe now want to show how a rotation of a three-component vector x can be\n\nimplemented by quaternion multiplication. This is accomplished by the quaternion\nproduct\n\nq? x? q? D \u0152q???.q? x/ D \u0152q??T \u0152q??\n?\n\nx\n0\n\n?\nD\n?\n?T .q/?.q/ x\n\n0\n\n?\n(2.128)\n\nwhere we have used several relations from Sect. 2.7. Explicit multiplication and\ncomparison with Eq. (2.125) gives\n\n?T .q/?.q/ D A.q/ (2.129)\n\n9Olinde Rodrigues (1795\u20131851) obtained a doctorate in mathematics in 1815, with a thesis con-\ntaining his well-known formula for the Legendre polynomials. He published nothing mathematical\nfor the next 21 years, devoting himself to banking, the development of the French railways, utopian\nsocialism, writing several pamphlets on banking, and editing an anthology of workers\u2019 poetry. Then\nhe published eight papers between 1838 and 1845, including his 1840 paper [14] greatly advancing\nthe state of the art in attitude analysis.\n\n\n\n2.9 Attitude Representations 47\n\nso that\n\nq? x? q? D\n?\nA.q/ x\n0\n\n?\n(2.130)\n\nThis can be used to derive the rule for performing successive transformations using\nquaternions. Applying a transformation by a second quaternion Nq gives\n\nNq? ?q? x? q?\t? Nq? D Nq? \u0152A.q/ x?? Nq? D\n?\nA. Nq/A.q/ x\n\n0\n\n?\n(2.131)\n\nThis transformation can also be written as\n\n. Nq? q/? x? . Nq? q/? D\n?\nA. Nq? q/ x\n\n0\n\n?\n(2.132)\n\nBecause this relation must hold for any x, we have proved that\n\nA. Nq? q/ D A. Nq/A.q/ (2.133)\n\nThus the quaternion representation of successive transformations is just the product\nof the quaternions of the constituent transformations, in the same way that the\nattitude matrix of the combined transformation is the product of the individual\nattitude matrices. A simple bilinear composition rule of this type holds only for\nthe attitude matrix and quaternion representations, which is one of the reasons for\nthe popularity of quaternions. With our? quaternion product definition, the order of\nquaternion multiplication is identical to the order of matrix multiplication. The order\nwould have been reversed if we had used the classical ? definition of quaternion\nmultiplication. The quaternion equivalent of Eq. (2.117) for successive rotations\nabout the same axis follows from straightforward quaternion multiplication:\n\nq.e; #/? q.e; '/ D q.e; '/? q.e; #/ D q.e; # C '/ (2.134)\n\nUnit quaternions reside on the three-dimensional unit sphere S3 embedded in\nfour-dimensional quaternion space. Equation (2.124) shows that a rotation by 720?,\nbut not a rotation by 360?, is equivalent to the identity transformation in quaternion\nspace, because q.e; # C 4\n/ D q.e; #/ but q.e; # C 2\n/ D ?q.e; #/. The attitude\nmatrix A.q/ is a homogenous quadratic function of the elements of the quaternion,\nthough, so q and ?q give the same attitude matrix. This 2:1 mapping of quaternions\nto rotations is a minor annoyance that cannot be removed without introducing\ndiscontinuities like those that plague all three-parameter attitude representations.\nBecause the quaternions q and ?q are on opposite hemispheres of S3, we could\nget a 1:1 mapping of quaternions to rotations by restricting the quaternions to one\nhemisphere, which is usually taken to be the hemisphere with q4 ? 0. This gives\nrise to the same problem as restricting the rotation vector to # ? \n , namely that a\n\n\n\n48 2 Matrices, Vectors, Frames, Transforms\n\nsmoothly varying quaternion can jump discontinuously from one side to the other\nof the equator bounding the hemisphere. Restricting the representation to positive\nq4 effectively gives a three-parameter representation with q4 ?\n\np\n1 ? kq1W3k2, so\n\nit is not surprising that it leads to the same problems as other three-parameter\nrepresentations.\n\nWe finally turn to the problem of extracting a quaternion from an attitude matrix\n[10]. We construct four four-component vectors from the components of A:\n\n2\n664\n\n1C 2A11 ? trA\nA12 C A21\nA13 C A31\nA23 ? A32\n\n3\n775 D 4q1q ;\n\n2\n664\n\nA21 C A12\n1C 2A22 ? trA\nA23 C A32\nA31 ? A13\n\n3\n775 D 4q2q\n\n2\n664\n\nA31 C A13\nA32 C A23\n\n1C 2A33 ? trA\nA12 ? A21\n\n3\n775 D 4q3q ;\n\n2\n664\n\nA23 ? A32\nA31 ? A13\nA12 ? A21\n1C trA\n\n3\n775 D 4q4q (2.135)\n\nThe quaternion can be found by normalizing any one of these four vectors.\nNumerical errors are minimized by choosing the vector with the greatest norm,\nwhich is the vector with the largest value of jqi j on the right side. This can be\nfound by the following procedure. Find the largest of trA and Aii for i D 1; 2; 3.\nIf trA is the largest of these, then jq4j is the largest of the jqi j, otherwise the largest\nvalue of jqi j is the one with the same index as the largest Aii . The overall sign\nof the normalized vector is not determined, reflecting the twofold ambiguity of the\nquaternion representation.\n\n2.9.4 Rodrigues Parameter Representation\n\nThe three Rodrigues parameters made their appearance in Rodrigues\u2019 classic 1840\npaper [14]. They were later represented as the \u201cvector semitangent of version\u201d by\nJ. Willard Gibbs, who invented modern vector notation. For this reason, the vector\nof Rodrigues parameters is often called the Gibbs vector and denoted by g. They are\nrelated to the quaternion by\n\ng D q1W3\nq4\n\n(2.136)\n\nwhich has the inverse\n\nq D ?1p\n1C kgk2\n\n?\ng\n1\n\n?\n(2.137)\n\n\n\n2.9 Attitude Representations 49\n\n0 \n\nq4 g\n\nq\n\nq\n\nq1:3\n\nIq\n\nba\nq4\n\nq\n\nq\n\nq1:3\n\np s p\n\nIq\n\nFig. 2.7 Relationship of the Rodrigues parameters (a) and the modified Rodrigues parameters\n(b) to the quaternion\n\nUsing Eq. (2.124) to express the quaternion in terms of the Euler axis and angle\ngives\n\ng.e; #/ D e tan.#=2/ (2.138)\n\nwhich explains Gibbs\u2019 peculiar terminology.\nThe mapping from quaternions to Rodrigues parameters is illustrated in Fig. 2.7a.\n\nThe plane of the figure is the plane containing the origin, q, and the identity\nquaternion Iq . The circle is the cross-section of the quaternion sphere S3, so it has\nunit radius. The vertical axis is the q4 axis, and the horizontal axis represents the\nthree-dimensional q1W3 hyperplane. The horizontal line passing through Iq represents\nthe three-dimensional Gibbs vector hyperplane, which is tangent to S3 at the point\nq D Iq . The Gibbs vector g is the projection of the quaternion from the origin onto\nthe Gibbs vector hyperplane. It is clear from the figure or from Eq. (2.136) that q\nand ?q map to the same Gibbs vector, so the Rodrigues parameters provide a 1:1\nmapping of rotations. The price paid for this is that the Gibbs vector is infinite for\na 180? rotation. Thus this parameterization is not recommended as a global attitude\nrepresentation, but it provides an excellent representation of small rotations.\n\nSubstituting Eq. (2.137) into Eq. (2.125) gives the Rodrigues parameter represen-\ntation of the attitude matrix\n\nA.g/ D .1 ? kgk\n2/I3 ? 2\u0152g??C 2 g gT\n1C kgk2 D I3 C 2\n\n\u0152g??2 ? \u0152g??\n1C kgk2\n\nD 1\n1C kgk2\n\n2\n4\n1C g21 ? g22 ? g23 2.g1g2 C g3/ 2.g1g3 ? g2/\n2.g2g1 ? g3/ 1 ? g21 C g22 ? g23 2.g2g3 C g1/\n2.g3g1 C g2/ 2.g3g2 ? g1/ 1 ? g21 ? g22 C g23\n\n3\n5\n\n(2.139)\n\n\n\n50 2 Matrices, Vectors, Frames, Transforms\n\nThis is similar to the quaternion representation in requiring no transcendental\nfunction evaluations. However, it is a rational function of the Rodrigues parameters\nrather than a simple polynomial function.\n\nThe relationship between the Rodrigues parameters and the attitude matrix can\nalso be expressed as a Cayley transform. The equations\n\nA.g/ D .I3 ? \u0152g??/ .I3 C \u0152g??/?1 D .I3 C \u0152g??/?1 .I3 ? \u0152g??/ (2.140)\ncan be verified by multiplying Eq. (2.139) by I3 C \u0152g??. Because the matrices\n.I3 ? \u0152g??/ and .I3 C \u0152g??/?1 commute, the order of multiplication is irrelevant\nand the Cayley transform can be written as\n\nA.g/ D I3 ? \u0152g??\nI3 C \u0152g?? (2.141)\n\nThis is not a useful form for computation, owing to the required matrix inversion;\nbut it can be generalized to higher dimensions. Any n? n proper orthogonal matrix\nM can be expressed in terms of an n ? n skew-symmetric matrix S by\n\nD D In ? S\nIn C S (2.142)\n\nA skew-symmetric n?nmatrix has n.n?1/=2 free parameters, the correct number\nto parameterize an orthogonal n ? n matrix that must obey n.nC 1/=2 constraints\non its n2 elements.\n\nThe rule for computing the Gibbs vector representing a composite of two\nrotations is easily derived from Eqs. (2.82), (2.136), and (2.137). The Gibbs vector\ncorresponding to the quaternion product NNq D Nq? q is\n\nNNg D NgC g ? Ng ? g\n1 ? Ng ? g (2.143)\n\nThis is not a bilinear function of the constituent Gibbs vectors, so it cannot be\nrepresented as a matrix product like quaternion composition.\n\nExtracting the Rodrigues parameters from the attitude matrix is similar to\nextracting the quaternion using one of the four-component vectors of Eq. (2.135).\nInstead of normalizing one of those vectors, though, the Rodrigues parameters are\nfound by dividing the first three components of the vector by the fourth component.\n\n2.9.5 Modified Rodrigues Parameters\n\nThe modified Rodrigues parameters (MRPs) are the newest of the commonly-\nemployed attitude representations. They were invented by T. F. Wiener in 1962\n[26], rediscovered by Marandi and Modi in 1987 [9], and have been championed\nby Junkins and Schaub [16]. They are related to the quaternion by\n\np D q1W3\n1C q4 (2.144)\n\n\n\n2.9 Attitude Representations 51\n\nwhich has the inverse\n\nq D 1\n1C kpk2\n\n?\n2p\n\n1 ? kpk2\n?\n\n(2.145)\n\nUsing Eq. (2.124) to express the quaternion in terms of the Euler axis and angle\ngives\n\np.e; #/ D e tan.#=4/ (2.146)\n\nIt it easy to see that\n\np.e; # C 2\n/ D ?e cot.#=4/ D ? p.e; #/kp.e; #/k2 (2.147)\n\nbut that p.e; # C 4\n/ D p.e; #/. Thus the MRP representation is 2:1 just like the\nquaternion representation.\n\nThe shadow set of MRPs\n\npS ? ? pkpk2 (2.148)\n\nrepresents the same attitude as p, in the same way that q and ?q represent the same\nattitude. These two MRP vectors are illustrated in Fig. 2.7b, which shows them as\nstereographic projections from the point q D ?Iq onto the MRP hyperplane, which\nis coincident with the q1W3 hyperplane. It is clear from the figure or from Eq. (2.148)\nthat kpSk ? 1 if kpk ? 1. Thus, in following the variation of an attitude represented\nby MRPs, one can always keep the magnitude of the MRP vector from exceeding\nunity by switching to the shadow MRP when needed. The logic required for this\nis regarded by many practitioners to be less burdensome than carrying the fourth\ncomponent of a quaternion and enforcing the quaternion norm constraint, leading\nthem to prefer MRPs for numerical simulation of attitude motion. It is good practice\nto allow the MRP norm to exceed unity by some amount to avoid \u201cchattering\u201d\nbetween the MRP and its shadow in case the norm remains close to unity for an\nextended period.\n\nThe MRP representation of the attitude matrix can be found by substituting\nEq. (2.145) into Eq. (2.125). It is easier to note that A.e; #/ D A2.e; #=2/ from\nEq. (2.117), so the MRP representation can be obtained by squaring the Gibbs vector\nrepresentation for a half-angle rotation:\n\nA.p/ D\n?\nI3 ? \u0152p??\nI3 C \u0152p??\n\n?2\nD\n?\nI3 C 2 \u0152p??\n\n2 ? \u0152p??\n1C kpk2\n\n?2\n\nD I3 C\n8 \u0152p??2 ? 4 ?1 ? kpk2\t \u0152p??\n\n.1C kpk2/2 (2.149)\n\n\n\n52 2 Matrices, Vectors, Frames, Transforms\n\nThe rule for computing the MRPs representing a composite of two rotations can\nbe derived using Eqs. (2.82), (2.144). and (2.145). The MRP vector corresponding\nto the quaternion product NNq D Nq? q is\n\nNNp D\n?\n1 ? kpk2\t NpC ?1 ? kNpk2\tp ? 2 Np ? p\n\n1C kpk2kNpk2 ? 2 Np ? p (2.150)\n\nThis involves more computation than the composition of Gibbs vectors, but not an\nunreasonable burden.\n\nThe most convenient way to extract the MRPs from the attitude matrix is to first\nextract the quaternion and then compute the MRPs by Eq. (2.144).\n\nJunkins and Schaub have developed a family of attitude representations inter-\nmediate between the Rodrigues parameters and the MRPs by choosing a projection\npoint in quaternion space intermediate between the point q D 0 in Fig. 2.7a and the\npoint q D ?Iq in Fig. 2.7b [15]. Tsiotras, Junkins, and Schaub have investigated\nhigher-order Cayley transforms\n\nA.v/ D\n?\nI3 ? \u0152v??\nI3 C \u0152v??\n\n?n\n(2.151)\n\nfor n > 2 [23]. Neither of these generalizations has found wide application,\nhowever.\n\n2.9.6 Euler Angles\n\nAn Euler angle representation expresses a rotation from an initial frame I to a final\nframe F as the product of three rotations: a rotation first from I to an intermediate\nframeH , then to a second intermediate frame G, and finally to frame F . The frame\nindices are generally omitted to simplify the notation, but including them clarifies\nthe form of the overall transformation\n\nAFI .e?; e? ; e I?; ?;  / ? AFG.e ;  /AGH.e? ; ?/AHI .e?; ?/ (2.152)\n\nThe rotation axis vectors of the constituent rotations are constant column vectors,\nand their subscripts do not label frames explicitly. The column vector e is a\nrepresentation of a rotation axis in frames F and G, e? is a representation in\nframes G and H , and e? is a representation in frames H and I . The rotation\nangles ?, ? , and  are the variables used to specify the rotation. The possibility of\nemploying Euler axis sequences with a wide choice of rotation axes was discovered\nby Davenport [2,18], generalizing the classical applications of Euler angles that use\na more restricted set of rotation axes. We will establish general results for Euler\naxis sequences using Davenport\u2019s general formulation, and then the classical axis\nsequences will follow as special cases.\n\n\n\n2.9 Attitude Representations 53\n\nWe want to be able to represent any attitude matrix by this Euler angle sequence.\nIn particular, we must be able to represent the attitude matrix that transforms e? into\ne , which is to say\n\ne D A.e?; e? ; e I?; ?;  /e? D A.e ;  /A.e? ; ?/A.e?; ?/e? (2.153)\nMultiplying on the left by AT .e ;  / and noting that AT .e ;  /e D e and\nA.e?; ?/e? D e? , we see that there must be an angle ?0 for which\n\ne D A.e? ; ?0/e? (2.154)\nA little thought (or algebra) shows that this requires e ? e? D e? ? e? . We must also\nbe able to represent the attitude matrix that transforms e? into ?e , which means\nthat there must be an angle ?1 for which ?e D A.e? ; ?1/e? . It follows from this\nthat ?e ? e? D e? ? e? . These conditions can be satisfied simultaneously only if the\nrotation axis e? is perpendicular to both e? and e , so that\n\ne ? e? D e? ? e? D 0 (2.155)\n\nThis relation leads to a more complete description of the orientation of the physical\nrotation axis vectors. Axis e? is fixed in the initial reference frame, e is fixed in the\nfinal reference frame, and e? is perpendicular to both e? and e .\n\nWe have shown that Eq. (2.155) is a necessary condition for Eq. (2.152) to\nrepresent a general attitude. We will now show that it is a sufficient condition. Note\nthat the angle ?0 is not a variable, but is defined by the choice of rotation axes. Then\nusing Eqs. (2.111b), (2.117) and (2.119) gives\n\nA.e?; e? ; e I?; ?;  / DA\n?\nA.e? ; ?0/e?;  \n\n\t\nA.e? ; ?/A.e?; ?/\n\nDA.e? ; ?0/A.e?;  /A.e? ; ? 0/A.e?; ?/\nDA.e? ; ?0/A.e?; e? ; e? I?; ? 0;  / (2.156)\n\nwhere ? 0 ? ? ? ?0. As A.e?; e? ; e I?; ?;  / covers all of SO(3), the product\nAT .e? ; ?0/A.e?; e? ; e I?; ?;  / also covers SO(3), so we only need to show that\nA.e?; e? ; e? I?; ? 0;  / can represent any attitude, or equivalently to show that this\nrotation can transform the orthonormal basis e? , e? , e? ? e? into any other\northonormal basis. It is sufficient to show that e0? ? A.e?; e? ; e? I?; ? 0;  /e?\ncan be any unit vector and e0? ? A.e?; e? ; e? I?; ? 0;  /e? can be any unit vector\nperpendicular to e0? , because Eq. (2.65) then implies that e? ? e? will transform into\ne0? ? e0? , completing the orthonormal triad. Now\n\ne0? DA.e?;  /A.e? ; ? 0/A.e?; ?/e? D A.e?;  /A.e? ; ? 0/e?\nD cos ? 0 e? C sin ? 0 sin e? C sin ? 0 cos .e? ? e? / (2.157)\n\n\n\n54 2 Matrices, Vectors, Frames, Transforms\n\nand we can find values of ? 0 and  to make this equal any desired unit vector.\nFurthermore, because A.e?; ?/e? D cos? e? ? sin? .e? ? e? /, we have\n\ne0? D cos? A.e?;  /A.e? ; ? 0/e? ? sin? A.e?;  /A.e? ; ? 0/.e? ? e? / (2.158)\n\nRotations preserve orthogonality, so this superposition can represent any unit vector\nin the plane perpendicular to e0? , completing the proof that any Euler angle sequence\nobeying Eq. (2.155) is sufficient to represent any attitude matrix.\n\nAn Euler angle parameterization has a twofold ambiguity in addition to the usual\n2\n ambiguity in specifying any angle. To see this ambiguity, insert the product\nA.e?;?\n/A.e?; \n/ before and after A.e? ; ? 0/ in the second line of Eq. (2.156) and\nuse some axis/angle representation identities to get\n\nA.e?; e? ; e I?; ?;  / D A.e? ; ?0/A.e?;  ?\n/A\n?\nA.e?; \n/e? ; ? ? ?0\n\n\t\nA.e?; ?C\n/\n\nD A.e? ; ?0/A.e?;  ? \n/A.?e? ; ? ? ?0/A.e?; ? C \n/\nD A.e? ; ?0/A.e?;  ? \n/A.e? ;??0/A.e? ; 2 ?0 ? ?/A.e?; ? C \n/\nD A.e?; e? ; e I? C \n; 2 ?0 ? ?;  ? \n/ (2.159)\n\nThe rotation axes of the classical Euler angle representation are selected from\nthe set\n\ne1 D\n2\n4\n1\n\n0\n\n0\n\n3\n5 ; e2 D\n\n2\n4\n0\n\n1\n\n0\n\n3\n5 ; e3 D\n\n2\n4\n0\n\n0\n\n1\n\n3\n5 (2.160)\n\nand a more compact notation is used for these representations\n\nAijk.?; ?;  / D A.ek;  /A.ej ; ?/A.ei ; ?/ (2.161)\n\nThe possible choice of axes is constrained by the requirements i \u00a4 j and j \u00a4 k, as\nrequired by Eq. (2.155). This leaves us with six symmetric sets of Euler parameters,\nwith i?j?k equal to:\n1?2?1, 1?3?1, 2?3?2, 2?1?2, 3?1?3, and 3?2?3\n\nand six asymmetric sets:\n\n1?2?3, 1?3?2, 2?3?1, 2?1?3, 3?1?2, and 3?2?1\nThe explicit forms of the attitude matrices for all 12 sets are collected in Chap. 9.\n\nAs a specific example of the symmetric sequences, we consider the 3? 1? 3\nsequence, which is often used for analytical treatments of rigid body motion and for\nrepresenting the attitude of spinning spacecraft:\n\nA313.?; ?;  / DA.e3;  /A.e1; ?/A.e3; ?/\n\n\n\n2.9 Attitude Representations 55\n\nD\n2\n4\n\nc s 0\n?s c 0\n0 0 1\n\n3\n5\n2\n4\n1 0 0\n\n0 c? s?\n0 ?s? c?\n\n3\n5\n2\n4\n\nc? s? 0\n?s? c? 0\n0 0 1\n\n3\n5\n\nD\n2\n4\n\nc c? ? s c? s? c s? C s c? c? s s?\n?s c? ? c c? s? ?s s? C c c? c? c s?\n\ns? s? ?s? c? c?\n\n3\n5 (2.162)\n\nWe have written c ? cos , s ? sin , and analogous equations for ? and ?.\nThe symmetric Euler angle sets all have ?0 D 0, so the angle ambiguity relation is\n\nA313.?; ?;  / D A313.? C \n;??;  ? \n/ (2.163)\nThe asymmetric sets are often called the Tait-Bryan angles, although this\n\nterminology has been called into question [4]. The three angles in an asymmetric\nEuler angle sequence are often referred to as roll, pitch, and yaw. This terminology\noriginally described the motions of ships and then was carried over into aircraft\nand spacecraft. Roll is a rotation about the vehicle body axis that is closest to the\nvehicle\u2019s usual direction of motion, and hence would be perceived as a screwing\nmotion. The roll axis is conventionally assigned index 1. Yaw is a rotation about the\nvehicle body axis that is usually closest to the direction of local gravity, and hence\nwould be often be perceived as a motion that points the vehicle left or right. The yaw\naxis is conventionally assigned index 3. Pitch is a rotation about the remaining\nvehicle body axis, and hence would often be perceived as a motion that points the\nvehicle up or down. The pitch axis is conventionally assigned index 2. Note that\nthis associates the terms roll, pitch, and yaw with the vehicle axes, while Eq. (2.161)\nassigns the variables ?, ? , and  based on the order of rotations in the sequence\nrather than on the axis indices. Thus there is no definite association between the\nvariables ?, ? , and  and the axis labels 1, 2, and 3 or the names roll, pitch and\nyaw. A different convention is followed by many authors who denote roll by ?,\npitch by ? , and yaw by  . As always, the reader consulting any source should be\ncareful to understand the conventions that it follows.\n\nThe 3?2?1 sequence, which is often used to describe the attitude of an Earth-\npointing spacecraft, is a specific example of an asymmetric sequence.\n\nA321.?; ?;  / DA.e1;  /A.e2; ?/A.e3; ?/\n\nD\n2\n4\n1 0 0\n\n0 c s \n0 ?s c \n\n3\n5\n2\n4\n\nc? 0 ?s?\n0 1 0\n\ns? 0 c?\n\n3\n5\n2\n4\n\nc? s? 0\n?s? c? 0\n0 0 1\n\n3\n5\n\nD\n2\n4\n\nc? c? c? s? ?s?\n?c s? C s s? c? c c? C s s? s? s c?\ns s? C c s? c? ?s c? C c s? s? c c?\n\n3\n5 (2.164)\n\n\n\n56 2 Matrices, Vectors, Frames, Transforms\n\nEquation (2.154) shows that the angle ?0 for this sequence is equal to ?\n=2, so the\nangle ambiguity relation is\n\nA321.?; ?;  / D A321.? C \n; \n ? ?;  ? \n/ (2.165)\n\nIn fact, all the Tait-Bryan angle axis sets have ?0 D ?\n=2 so they all obey\nEq. (2.165), taking into account the 2\n ambiguity in the definition of ? . The\nTait-Bryan representations have useful small-angle approximations, as will be\nshown in Sect. 2.10, but the small angle limits of the symmetric Euler angles are\nnot as useful.\n\nSeparate procedures for the different axis sequences are generally used to find\nthe Euler angles representing a given attitude matrix. We will consider the 3?1?3\nand 3?2?1 sequences as specific examples, and will follow these examples with a\ngeneral algorithm.\n\nFor the symmetric 3?1?3 sequence, the angle ? is computed from the 33 element\nof A313:\n\n? D cos?1 .\u0152A313?33/ (2.166)\nUnless \u0152A313?33 has magnitude unity, two distinct values of ? have the same cosine,\ncorresponding to the two possible signs for sin ? and to the twofold ambiguity shown\nin Eq. (2.163). We are free to select either of these values, but we can avoid the\ntwofold ambiguity by computing ? as the principal value of the inverse cosine,\nwhich restricts its range to 0 ? ? ? \n and gives sin ? ? 0. If sin ? \u00a4 0, the\nother two Euler angles can be determined, modulo 2\n , by\n\n? D atan2 .?\u0152A313?31;??\u0152A313?32/ (2.167a)\n D atan2 .?\u0152A313?13; ?\u0152A313?23/ (2.167b)\n\nwhere ? D ?1 is the sign of sin ? and atan2.y; x/ is the standard function giving\nthe argument of the complex number x C iy.\n\nIt is obvious that ? and  cannot be determined from Eqs. (2.167) if ? is equal\nto 0 or \n , since these values give sin ? D 0. The usual twofold ambiguity is absent\nin these cases, but the attitude matrix takes the form\n\nA313.?; .\n \t \n/=2;  / D\n2\n4\n\ncos.? ?  / sin.? ?  / 0\n\t sin.? ?  / ? cos.? ?  / 0\n\n0 0 ?1\n\n3\n5 (2.168)\n\nIt can be seen that only the sum or difference ? ?  is determined, and not the\nangles individually. This is known as gimbal lock, for reasons that will become\napparent when we discuss the kinematics of rotations. Gimbal lock is caused by\ncollinearity of the physical rotation axis vectors of the first and third rotations in\nthe sequence. Note that the column vector representations of the rotation axes are\nalways parallel for the symmetric Euler angle sequences, but that does not cause\n\n\n\n2.9 Attitude Representations 57\n\ngimbal lock. Gimbal lock occurs for all the symmetric Euler angle sequences when\nsin ? D 0.\n\nWe could employ a special algorithm for the sin ? D 0 case, but it is preferable\nto develop a general algorithm for all values of ? , because we could encounter a loss\nof precision for small but nonzero values of sin ? . To this end, we note that\n\n\u0152A313?11 ? \u0152A313?22 D .1? c?/ cos.? ?  / (2.169a)\n\u0152A313?12 \t \u0152A313?21 D .1? c?/ sin.? ?  / (2.169b)\n\nand that .1?c?/ is positive if cos ? \u00a4 \t1. Therefore, we find either ? or  , but not\nboth, from Eq. (2.167). If sin ? D 0 we can set one of these angles to any convenient\nvalue. Then we find the other angle from their sum or difference by\n\n? C  D atan2 .\u0152A313?12 ? \u0152A313?21; \u0152A313?11 C \u0152A313?22/ if \u0152A313?33 ? 0\n(2.170a)\n\n? ?  D atan2 .\u0152A313?12 C \u0152A313?21; \u0152A313?11 ? \u0152A313?22/ if \u0152A313?33 < 0\n(2.170b)\n\nExtraction of the asymmetric Euler angles proceeds in a similar manner. For the\n3?2?1 sequence, the angle ? is computed from the 13 element of A321:\n\n? D sin?1 .?\u0152A321?13/ (2.171)\n\nUnless \u0152A321?13 has magnitude unity, two distinct values of ? have the same sine,\ncorresponding to the two possible signs for cos ? and to the twofold ambiguity\nshown in Eq. (2.165). We are free to select either value, but can avoid the ambiguity\nby computing ? as the principal value of the inverse sine, restricting its range to\nj? j ? \n=2 and giving cos ? ? 0. If cos ? \u00a4 0, the other two angles can be\ndetermined by\n\n? D atan2 ?? 0\u0152A321?12; ? 0\u0152A321?11\n\t\n\n(2.172a)\n\n D atan2 ?? 0\u0152A321?23; ? 0\u0152A321?33\n\t\n\n(2.172b)\n\nwhere ? 0 D ?1 is the sign of cos ? .\nGimbal lock for the asymmetric Euler, or Tait-Bryan, sequences occurs when\n\ncos ? D 0, i.e. when ? D \t\n=2. Then the usual twofold ambiguity is absent, and\nthe attitude matrix for the 3?2?1 example has the form\n\nA321.?;\t\n=2; / D\n2\n4\n\n0 0 ?1\n? sin.? ?  / cos.? ?  / 0\n\t cos.? ?  / \t sin.? ?  / 0\n\n3\n5 (2.173)\n\n\n\n58 2 Matrices, Vectors, Frames, Transforms\n\nOnly the sum or difference ? ?  is determined, just as for the symmetric Euler\naxis sequence, again due to collinearity of the physical rotation axis vectors of\nthe first and third rotations. The column vector representations of the rotation axes\nare always perpendicular for the asymmetric sequences, but that does not prevent\ngimbal lock from occurring.\n\nIn parallel with the 3?1?3 case, we deal with gimbal lock by finding either ? or\n from Eq. (2.172) and then the other from their sum or difference by\n\n? C  D atan2 .?\u0152A321?32 ? \u0152A321?21; \u0152A321?22 ? \u0152A321?31/ if \u0152A321?13 ? 0\n(2.174a)\n\n? ?  D atan2 . \u0152A321?32 ? \u0152A321?21; \u0152A321?22 C \u0152A321?31/ if \u0152A321?13 < 0\n(2.174b)\n\nWe finally discuss the extraction of the angles for Davenport\u2019s general axis\nsequences. We will accomplish this in a way that uses the results obtained above for\nextracting the 3?1?3 Euler angles. This technique can be applied to any sequence of\nconventional Euler or Tait-Bryan angles, as well as to the general Davenport angles,\nby selecting the rotation axes from the set of coordinate axes fe1; e2; e3g [19].\n\nWe note that the proper orthogonal matrix\n\nC D\n2\n4\n\neT?\n.e? ? e? /T\n\neT?\n\n3\n5 (2.175)\n\nhas the property that C e? D e1 and C e? D e3. Then we have from Eq. (2.156)\n\nCA.e?; e? ; e I?; ?;  /CTD CA.e? ; ?0/C TCA.e?; e? ; e? I?; ? 0;  /C T\n\nD A.e1; ?0/CA.e?;  /C TC.e? ; ? 0/C TCA.e?; ?/C T\nD A.e1; ?0/A313.?; ? 0;  / (2.176)\n\nThus we can extract ?, ? 0, and  from AT .e1; ?0/CA.e?; e? ; e I?; ?;  /CT by the\nstandard technique for the 3? 1? 3 sequence, and then compute ? D ? 0 C ?0.\nAn easily-verified special case of Eq. (2.176) is\n\n2\n4\n0 1 0\n\n0 0 1\n\n1 0 0\n\n3\n5A321.?; ?;  /\n\n2\n4\n0 ?1 0\n1 0 0\n\n0 0 1\n\n3\n5 D A313.?; ? C \n=2; / (2.177)\n\nExplicit expressions for the Euler angles resulting from successive transforma-\ntions have been found in some special cases [17], but they have not been widely\napplied in practice.\n\n\n\n2.10 Attitude Error Representations 59\n\n2.10 Attitude Error Representations\n\nThe attitude matrix represents the rotation ABR from some reference frame R to the\nspacecraft body frame B . Attitude estimation errors can be represented either as a\nsmall rotation A ORR between R and an estimated reference frame OR\n\nABR D AB ORA ORR (2.178)\n\nor more commonly as a small rotation AB OB between B and an estimated body\nframe OB\n\nABR D AB OBA OBR (2.179)\nThe estimated attitude is represented by AB OR in the former case and by A OBR in the\nlatter. In either case the matrix representing the errors, A ORR or AB OB , is expected to\nbe close to the identity matrix.\n\nThe most natural representation of attitude errors is in terms of the rotation\nvector, Eq. (2.123), and its small-angle approximation\n\nA.?#/ D exp .?\u0152?#??/ ? I3 ? \u0152?#??C 1\n2\n\u0152?#??2 (2.180)\n\nOther attitude parameterizations can be used to represent attitude errors, such as the\nquaternion, Eq. (2.125),\n\nA.?q/ ? I3 ? 2\u0152?q1W3??C 2\u0152?q1W3??2 (2.181)\nthe Gibbs vector, Eq. (2.139),\n\nA.?g/ ? I3 ? 2\u0152?g??C 2\u0152?g??2 (2.182)\nor the MRPs, Eq. (2.149),\n\nA.?p/ ? I3 ? 4\u0152?p??C 8\u0152?p??2 (2.183)\nIt is notable that these representations are all equivalent through second order in the\nerrors with the identification\n\n?# D 2?q1W3 D 2?g D 4?p (2.184)\nIn fact, only the first-order approximation is required for most applications.\nIt must be emphasized that Eqs. (2.180)\u2013(2.184) are only true in the (very useful)\napproximation of small error angles. Attitude error representations are often used\nfor errors that are not especially small. In that case, the quaternion, Gibbs vector,\nor MRP representation is often preferred to the rotation vector for computational\nconvenience.\n\nThe small-angle approximation of the Tait-Bryan or asymmetric Euler angle\nrepresentation, Eq. (2.161), is to second order\n\n\n\n60 2 Matrices, Vectors, Frames, Transforms\n\nAijk.??; ??; ? / ?\n?\nI3 ? ? \u0152ek??C 1\n\n2\n? 2\u0152ek??2\n\n?\n\n?\n?\nI3 ? ??\u0152ej??C 1\n\n2\n??2\u0152ej??2\n\n??\nI3 ? ??\u0152ei??C 1\n\n2\n??2\u0152ei??2\n\n?\n\n? I3 ? \u0152?#1??C 1\n2\n\u0152?#1??2 \t 1\n\n2\n\u0152.?? ? ei ? ? ?? ej C ?? ? ? ek/??\n\n(2.185)\n\nwhere\n\n?#1 ? ?? ei C ?? ej C ? ek (2.186)\n\nThe upper sign in the last term in Eq. (2.185), which was derived with the use of\nEq. (2.56c), holds if fi; j; kg is an even permutation of f1; 2; 3g, and the lower sign\napplies if it is an odd permutation. With the identification ?# D ?#1 Eq. (2.185)\nagrees with Eq. (2.180) to first order, but not to second order. Agreement to second\norder would require\n\n?# D\n?\n?? ? ?? ? \n\n2\n\n?\nei C\n\n?\n?? \t ? ??\n\n2\n\n?\nej C\n\n?\n? ? ??? ?\n\n2\n\n?\nek (2.187)\n\nThis identification has never been used to our knowledge, however, because first-\norder approximations in the errors are generally adequate.\n\nProblems\n\n2.1. Prove that any real n ? n matrix A can be decomposed into the sum of a\nsymmetric and skew symmetric matrix. Hint: the matrix A ? AT is clearly skew\nsymmetric.\n\n2.2. It is known that a general n ? n symmetric matrix A must possess n mutually\northogonal eigenvectors, even if some of the eigenvalues are repeated. Here, you will\nprove that this is true when the eigenvalues are not repeated. Let A xi D \tixi for\ni D 1; 2, where \ti is the i th eigenvalue and xi is the i th eigenvector. Assume that\n\t1 \u00a4 \t2. Start by taking the transpose of A x1 D \t1x1 and right multiplying both\nsides by x2, and prove that when A D AT the vectors x1 and x2 must be orthogonal.\n2.3. Suppose that the characteristic equation of an n ? n matrix A is given by\n\n?.\t/ D det.\tIn ? A/ D \tn C a1\tn?1 C ? ? ? C an?1\tC an\nThe Cayley-Hamilton theorem states that the matrix A obeys its characteristic\nequation so that\n\n\n\nProblems 61\n\nAn C a1An?1 C ? ? ? C AC anIn D 0\n\nMultiplying by A gives\n\nAnC1 C a1An C ? ? ? C A2 C anA D 0\n\nThis implies that AnC1 can be written as a linear combination of A; A2; : : : ; An,\nwhich in turn can be written as a linear combination of In; A; : : : ; An?1. In fact,\nany Am with m > n ? 1 can be written using the same linear combination. Use this\nfact to compute a closed-form expression for the following:\n\n2\n4\n1 0 4\n\n0 0 1\n\n0 ?1 0\n\n3\n5\n100\n\nNote that f .A/ is the same linear combination of powers of A as f .J / is of powers\nof J , where J is a diagonal matrix of the eigenvalues of A.\n\n2.4. Consider the following 2 ? 2 matrix for real a, b and d :\n\nA D\n?\na b\n\nb d\n\n?\n\nDetermine the eigenvalues \t1 and \t2 of A in terms of a, b and d . Since A is\nsymmetric then the eigenvalue/eigenvector decomposition gives\n\nV TAV D\n?\n\t1 0\n\n0 \t2\n\n?\n\nwhere V is an orthogonal matrix. Suppose that V is given by the form\n\nV D\n?\nc s\n\n?s c\n?\n\nwhere s ? sin ? and c ? cos ? for some angle ? . Find c and s in terms of a, b\nand d .\n\n2.5. A matrix that is used to reflect an object over a line or plane is called a\nreflection matrix. Consider the following natural basis, given by Eq. (2.35), for\nn D 2:\n\ne1 D\n?\n1\n\n0\n\n?\n; e2 D\n\n?\n0\n\n1\n\n?\n\n\n\n62 2 Matrices, Vectors, Frames, Transforms\n\nChief\nInertial Orbit\n\nDeputy\nInertial Orbit\n\nChief\n\nDeputy\n\nRelative\nOrbit\n\nro\n\nho\n\no\n\nFig. 2.8 Hill frame\n\nLet ? be the counterclockwise angle between some line ` through the origin and the\nx-axis. Consider the following matrix that rotates the x-axis onto `:\n\nA D\n?\n\ncos? ? sin?\nsin? cos?\n\n?\n\nNoting that A e1 lies on ` and A e1 is perpendicular to `, determine the reflection\nmatrix that sends any vector not on ` to its mirror image about `. Provide simulation\nplots for various angles ? and any chosen 2 ? 1 vector to reflect.\n2.6. Write a computer program that takes some latitude, longitude and height, and\nconverts these quantities to ECEF position using Eq. (2.74). Also, write a computer\nprogram that takes ECEF position and converts it to latitude, longitude and height\nusing Eq. (2.77). Pick some latitude, longitude and height. Then compute the ECEF\nposition and convert this position to latitude, longitude and height to ensure that the\noriginal quantities are obtained.\n\n2.7. A useful frame for formation flying applications is the \u201cHill frame\u201d shown\nin Fig. 2.8 [6]. The frame is given by for ; o? ; ohg, where or points in the chief\nspacecraft\u2019s radial direction, oh is along the chief orbit momentum vector and o?\ncompletes the right-handed coordinate system, so that\n\nor D rIkrIk ; o? D oh ? or ; oh D\nhI\nkhIk\n\n\n\nProblems 63\n\nwhere hI D rI ? vI . Using the dot product approach similar to Eq. (2.43), fully\nderive the attitude matrix that rotates vectors from the Hill frame to an inertial frame.\nAlso, determine the relationship between the Hill frame and the LVLH frame.\n\n2.8. This is an alternative proof of Euler\u2019s Theorem that avoids eigenvalues [12].\n\na) First assume that the attitude matrix is not symmetric, i.e. that A \u00a4 AT . Define\nthe skew symmetric matrix S ? 1\n\n2\n.A ? AT / D \u0152s??. Prove that AS AT D S .\n\nNext show that d ? s=ksk is equivalent to the Euler axis e, to within a sign\nambiguity,\n\nb) Now assume that A D AT . Why does the above argument fail in this case? If A\nis symmetric the orthogonality relation is A2 D I3. Show that this gives A.AC\nI3/ D AC I3, so all the columns of AC I3 are unchanged by A. Complete the\nproof by showing that at least one of these columns is not a column of zeros, and\nis therefore equivalent to the Euler axis e, to within a sign ambiguity. What Euler\nangles of rotation, # , correspond to the case of A D AT ?\n\n2.9. The generalized Rodrigues parameters [15] (GRPs) can be written as\n\n? D f q1W3\naC q4\n\nwhere a is a parameter from 0 to 1 and f is a scale factor.\n\na) Draw a plot of the rotation angle # verses a that causes the GPRs to become\nsingular.\n\nb) Determine the inverse transformation for q1W3 and q4 in terms of ?, a and f . Note\nthat your answer for q4 may seem to provide two solutions, but only one of them\nis correct.\n\nc) Determine f in terms of a so that the small angle approximation gives k?k ? # .\n2.10. Show that the square of the quaternion elements can be extracted from the\nattitude matrix by using the following equations:\n\nq21 D\n1\n\n4\n.1C a11 ? a22 ? a33/\n\nq22 D\n1\n\n4\n.1C a22 ? a11 ? a33/\n\nq23 D\n1\n\n4\n.1C a33 ? a11 ? a22/\n\nq24 D\n1\n\n4\n.1C a11 C a22 C a33/\n\n2.11. Derive the attitude matrix for a 1?2?3 sequence. Also, explicitly compute\nthe determinant of this matrix to show that it isC1.\n\n\n\n64 2 Matrices, Vectors, Frames, Transforms\n\n2.12. Derive the direct relationship from Euler angles to quaternion for a 1?2?3\nsequence and for a 1?2?1 sequence. Compare your results to the ones shown in\nTable 9.5 to make sure they are equivalent.\n\nReferences\n\n1. Bate, R.R., Mueller, D.D., White, J.E.: Fundamentals of Astrodynamics. Dover Publications,\nNew York (1971)\n\n2. Davenport, P.B.: Rotations about nonorthogonal axes. AIAA J. 11(6), 853\u2013857 (1973)\n3. Farrell, J., Barth, M.: The Global Positioning System & Inertial Navigation. McGraw-Hill,\n\nNew York (1998)\n4. Fraiture, L.: A history of the description of the three-dimensional finite rotation. J. Astronaut.\n\nSci. 57(1/2), 207\u2013232 (2009)\n5. Goldstein, H.: Classical Mechanics, 2nd edn. Addison-Wesley, Reading (1980)\n6. Hill, G.W.: Researches in lunar theory. Am. J. Math. 1(1), 5\u201326 (1878)\n7. Lefferts, E.J., Markley, F.L., Shuster, M.D.: Kalman filtering for spacecraft attitude estimation.\n\nJ. Guid. Contr. Dynam. 5(5), 417\u2013429 (1982)\n8. Ma, C., Arias, E.F., Eubanks, T.M., Frey, A.L., Gontier, A.M., Jacobs, C.S., Sovers, O.J.,\n\nArchinal, B.A., Charlot, P.: The International Celestial Reference Frame as realized by very\nlong baseline interferometry. Astron. J. 116, 516\u2013546 (1998)\n\n9. Marandi, S.R., Modi, V.J.: A preferred coordinate system and the associated orientation\nrepresentation in attitude dynamics. Acta Astronautica 15(11), 833\u2013843 (1987)\n\n10. Markley, F.L.: Unit quaternion from rotation matrix. J. Guid. Contr. Dynam. 31(2), 440\u2013442\n(2008)\n\n11. Montenbruck, O., Gill, E.: Satellite Orbits: Models, Methods, and Applications. Springer,\nBerlin Heidelberg New York (2000)\n\n12. Palais, B., Palais, R.: Euler\u2019s fixed point theorem: The axis of a rotation. J. Fixed point Theory\nAppl. 2(2), 215\u2013220 (2007)\n\n13. Pittelkau, M.E.: An analysis of the quaternion attitude determination filter. J. Astronaut. Sci.\n51(1) (2003)\n\n14. Rodrigues, O.: Des lois g\u00e9om\u00e9triques qui r\u00e9gissent les d\u00e9placements d\u2019un syst\u00e8me solide\ndans l\u2019espace, et de la variation des coordonn\u00e9es provenant de ces d\u00e9placements consid\u00e9r\u00e9s\nind\u00e9pendamment des causes qui peuvent les produire. J. de Math\u00e9matiques Pures et Appliqu\u00e9es\n5, 380\u2013440 (1840)\n\n15. Schaub, H., Junkins, J.L.: Stereographic orientation parameters for attitude dynamics: A gen-\neralization of the Rodrigues parameters. J. Astronaut. Sci. 44(1), 1\u201319 (1996)\n\n16. Schaub, H., Junkins, J.L.: Analytical Mechanics of Aerospace Systems, 2nd edn. American\nInstitute of Aeronautics and Astronautics, New York (2009)\n\n17. Shuster, M.D.: A survey of attitude representations. J. Astronaut. Sci. 41(4), 439\u2013517 (1993)\n18. Shuster, M.D., Markley, F.L.: Generalization of the Euler angles. J. Astronaut. Sci. 51(2),\n\n123\u2013132 (2003)\n19. Shuster, M.D., Markley, F.L.: General formula for extracting the Euler angles. J. Guid. Contr.\n\nDynam. 29(1), 215\u2013217 (2006)\n20. Sofair, I.: Improved method for calculating exact geodetic latitude and altitude revisited.\n\nJ. Guid. Contr. Dynam. 23(2), 369 (2000)\n21. Stewart, G.W.: Introduction to Matrix Computations. Academic Press, New York (1973)\n22. Stuelpnagel, J.: On the parametrization of the three-dimensional rotation group. SIAM Rev.\n\n6(4), 422\u2013430 (1964)\n23. Tsiotras, P., Junkins, J.L., Schaub, H.: Higher-order Cayley transforms with applications to\n\nattitude representations. J. Guid. Contr. Dynam. 20(3), 528\u2013534 (1997)\n\n\n\nReferences 65\n\n24. Vallado, D.A.: Fundamentals of Astrodynamics and Applications, 3rd edn. Microcosm Press,\nHawthorne and Springer, New York (2007)\n\n25. Weinberg, S.: Gravitation and Cosmology: Principles and Applications of the General Theory\nof Relativity. Wiley, Chichester (1972)\n\n26. Wiener, T.F.: Theoretical analysis of gimballess inertial reference equipment using delta-\nmodulated instruments. Ph.D. dissertation, Massachusetts Institute of Technology, Cambridge\n(1962)\n\n\n\nChapter 3\nAttitude Kinematics and Dynamics\n\nThis chapter begins with a discussion of the kinematics of rotations, or attitude\nkinematics, and then moves on to attitude dynamics. The distinction between\nkinematics and dynamics is that kinematics covers those aspects of motion that can\nbe analyzed without consideration of forces or torques. When forces and torques\nare introduced, we are in the realm of dynamics. To make this distinction clear,\nconsider the motion of a point particle in Newtonian physics. If r denotes position,\nv denotes velocity, and time derivatives are indicated by a dot, then the kinematic\nequation of motion is simply Pr D v. The dynamic equation of motion is mPv D F\nor Pp D F, where F is the applied force and p ? mPv is the translational momentum.\nKinematics and dynamics are often subsumed under the single term dynamics by\ncombining the kinematic and dynamic equations in the single relation mRr D F.\nIn fact, it is common in filtering theory to apply the term dynamics to any relation\nexpressing time dependence.\n\nThe role of the position vector r is taken in attitude kinematics by the attitude\nmatrixA or one of its parameterizations, and the role of the velocity v is taken by the\nangular velocity !. The role of translational momentum p is played by the angular\nmomentum H. The kinematic and dynamic equations of rotational motion are not\nas simple as those for translational motion. In particular, the angular momentum is\nnot a scalar multiple of the angular velocity in general.\n\nWe discuss attitude kinematics first, deriving equations for the time derivatives of\nthe attitude matrix and of its various parameterizations introduced in the previous\nchapter. We also discuss the time derivatives of representations of a vector in frames\nthat undergo relative rotational motion.\n\nOur treatment of dynamics begins by considering the separation of center-of-\nmass motion from rotational motion, emphasizing the fundamental role played by\nangular momentum. We next introduce the concept of a rigid body, an extremely\nuseful approximation for many spacecraft. We summarize the kinematic and\ndynamic equations of motion and collect them in one place for easy reference, and\nthen analyze the torque-free motion of a rigid body. We follow this with discussions\n\nF.L. Markley and J.L. Crassidis, Fundamentals of Spacecraft Attitude Determination\nand Control, Space Technology Library 33, DOI 10.1007/978-1-4939-0802-8__3,\n\u00a9 Springer Science+Business Media New York 2014\n\n67\n\n\n\n68 3 Attitude Kinematics and Dynamics\n\nof the modeling of internal and external torques, which include both undesired\ndisturbance torques and deliberately applied control torques. Finally, we examine\nthe special case of Earth-pointing spacecraft.\n\n3.1 Attitude Kinematics\n\nWe will discuss the kinematics of the attitude matrix first, since this is the\nfundamental representation of a rotation. This discussion introduces the concept\nof the angular velocity or angular rate vector. We then discuss the kinematics of\ncolumn vectors in rotating reference frames.\n\n3.1.1 Attitude Matrix\n\nThe time dependence of the attitude matrix expressing the rotation from a frame F\nto a frame G is given by the fundamental definition of a derivative as\n\nPAGF .t/ ? lim\n?t!0\n\nAGF .t C?t/ ? AGF .t/\n?t\n\nD lim\n?t!0\n\nAGF .t C?t/AFG.t/ ? I3\n?t\n\nAGF .t/ (3.1)\n\nbecause AFG.t/AGF .t/ is equal to the identity matrix. As ?t goes to zero, the\nproduct AGF .t C ?t/AFG.t/ differs from the identity matrix by a small rotation\nthat we can represent by a rotation vector,\n\nAGF .t C?t/AFG.t/ D exp\n??\u0152?#GFG ??\n\n\t ? I3 ? \u0152?#GFG ?? (3.2)\n\nThe higher-order terms omitted in the approximation go to zero faster than?t as?t\ngoes to zero. The ? in front of # expresses the fact that this is a small rotation, the\nsuperscriptGF means that it relates to the rotation from frameF to frameG, and the\nsubscript G means that the rotation vector is represented in the frame G. We know\nthat the rotation vector is represented in frame G because AGF .t C ?t/AFG.t/ is\na rotation from frame G at one time to frame G at a different time, and these two\nframes coincide in the limit that ?t goes to zero. The kinematic relations do not\ndistinguish between the situations where frame F or frame G or both frames are\nrotating in an absolute sense; they only care about the relative rotation between the\ntwo frames. Substituting Eq. (3.2) into Eq. (3.1) gives\n\nPAGF .t/ D lim\n?t!0\n\n?\u0152?#GFG ??\n?t\n\nAGF .t/ D ?\u0152!GFG .t/??AGF .t/ (3.3)\n\n\n\n3.1 Attitude Kinematics 69\n\nwhere the angular rate vector or angular velocity vector is defined by\n\n!GFG .t/ ? lim\n?t!0\n\n?#GFG\n?t\n\n(3.4)\n\nThe rotation vector is always specified in radians, so the units of the angular velocity\nare rad/s, assuming that time is measured in seconds.\n\nEquation (3.3) is the fundamental equation of attitude kinematics. We can also\nwrite this, omitting the time arguments, as\n\nPAGF D ?AGFAFG\u0152!GFG ??ATFG D ?AGF \u0152AFG!GFG ?? D ?AGF \u0152!GFF ?? (3.5)\n\nwhich expresses the kinematics in terms of the components of !GF in frame\nF instead of its components in frame G. Taking the transpose of Eq. (3.3) and\nremembering that the cross-product matrix is skew-symmetric gives\n\nPAFG D ATGF \u0152!GFG ?? D AFG\u0152!GFG ?? (3.6)\n\nThe frame labels are arbitrary, so we can exchange the labels F and G in this\nexpression to get\n\nPAGF D AGF \u0152!FGF ?? (3.7)\nComparing with Eq. (3.5) establishes the identity\n\n!FGF D ?!GFF (3.8)\nexpressing the perfectly reasonable result that the rotational rate of frame F with\nrespect to frame G is the negative of the rate of frame G with respect to frame F .\nAlthough we have derived this as a relationship of the components in frame F ,\nthe properties of orthogonal transformations show that it must be true for the\ncomponents in any frame.\n\nThe kinematic equations preserve the orthogonality of the attitude matrix because\nthe derivatives of AGFATGF D I3 and ATGFAGF D I3 are\n\nPAGFATGF C AGF PATGF D ?\u0152!GFG ??I3 C I3\u0152!GFG ?? D 0 (3.9a)\nPATGFAGF C ATGF PAGF D ?\u0152!FGF ??I3 C I3\u0152!FGF ?? D 0 (3.9b)\n\n3.1.2 Vector Addition of Angular Velocity\n\nThe specialization of Eq. (2.47) for rotation matrices is\n\nAHF D AHGAGF (3.10)\n\n\n\n70 3 Attitude Kinematics and Dynamics\n\nTaking the time derivative of this equation gives\n\nPAHF D ?\u0152!HFH ??AHF D PAHGAGF C AHG PAGF\nD ?\u0152!HGH ??AHGAGF ? AHG\u0152!GFG ??AGF\nD ?f\u0152!HGH ??C AHG\u0152!GFG ??ATHGgAHF (3.11)\n\nwhich means, by Eq. (2.63), that\n\n!HFH D !HGH C AHG!GFG D !HGH C!GFH (3.12)\nThe first form of this equation is more useful in applications, but the second shows\nthat the angular velocity of the motion of frame H relative to frame F is just the\nvector sum of angular velocity of the motion of H relative to G and the angular\nvelocity of the motion of G relative to F , provided that they are expressed in the\nsame reference frame. Equation (3.8) is a special case of this general result.\n\n3.1.3 Vector Kinematics\n\nConsider the representations of a vector x in two different frames:\n\nxG D AGF xF (3.13)\nThe time derivative of this equation is\n\nPxG D AGF PxF C PAGF xF D AGF PxF ? \u0152!GFG ??AGF xF\nD AGF PxF ?!GFG ? xG (3.14)\n\nThis is a fundamental equation. It expresses the derivative PxG of a vector in one\nframe, as seen in that frame, as the sum of two terms: the mapping by orthogonal\ntransformation of the derivative PxF in another frame, as seen in that frame, and\nan \u201c!?\u201d term reflecting the rotational motion between the two frames. Note that\nno judgement is made as to which frame is moving in an absolute sense; only the\nrelative rotation matters.\n\nDifferentiating Eq. (3.14) again gives\n\nRxG D AGF RxF ? \u0152!GFG ??AGF PxF ?!GFG ? PxG ? P!GFG ? xG\nD AGF RxF ? \u0152!GFG ??.PxG C!GFG ? xG/ ?!GFG ? PxG ? P!GFG ? xG\nD AGF RxF ?!GFG ? .!GFG ? xG/ ? 2!GFG ? PxG ? P!GFG ? xG (3.15)\n\nThis equation is more useful for translational motion than for rotational motion.\nThe terms on the right side have special names when x is a position vector; the\nsecond term is the centripetal acceleration, the third term is the Coriolis acceleration,\nand the last term is sometimes called the Euler acceleration.\n\n\n\n3.2 Kinematics of Attitude Parameterizations 71\n\n3.2 Kinematics of Attitude Parameterizations\n\nAs discussed in Chap. 2, attitude simulation and attitude estimation usually employ\na representation of the attitude having fewer parameters and fewer constraints than\nthe attitude matrix. We will now derive the kinematic equations for several of\nthese parameterizations. Frame-specifying subscripts are omitted in this section\nand in most of the book, unless they are necessary to avoid ambiguity. We always\nunderstand the attitude rate vector relating to an attitude matrix AGF to be !GFG ,\nunless explicitly indicated otherwise.\n\n3.2.1 Quaternion Kinematics\n\nThe derivation of the kinematic equation for the quaternion is similar to that for the\nattitude matrix. The derivative is\n\nPq.t/ ? lim\n?t!0\n\nq.t C?t/ ? q.t/\n?t\n\n(3.16)\n\nWe can use Eq. (2.127) to represent the rotation from q.t/ to q.t C ?t/ as the\nexponential of a rotation vector,\n\nq.t C?t/ D exp\u0152.?#=2/??q.t/ ? q.t/C \u0152.?#=2/??q.t/ (3.17)\nInserting this into Eq. (3.16) and taking the limit as ?t goes to zero gives\n\nPq.t/ D 1\n2\n\u0152!.t/??q.t/ D 1\n\n2\n!.t/? q.t/ D 1\n\n2\n?.!.t//q.t/ (3.18)\n\nwhere the angular velocity vector is defined by Eq. (3.4). This result is very similar\nto Eq. (3.3).\n\nThe fact that \u0152!.t/?? is a skew-symmetric matrix ensures that Eq. (3.18)\npreserves the quaternion norm, because the derivative of kqk2 D 1 is\n\nPqT qC qT Pq D\n?\n1\n\n2\n\u0152!??q\n\n?T\nqC qT\n\n?\n1\n\n2\n\u0152!??q\n\n?\n\nD 1\n2\n\n??qT \u0152!??qC qT \u0152!??q\t D 0 (3.19)\nIt is often more convenient to use Eqs. (2.84a) and (2.86) to write the kinematic\n\nequation for the quaternion in the form\n\nPq D 1\n2\n\nq?! D 1\n2\n?.q/! (3.20)\n\nwhere ?.q/ is defined by Eq. (2.88). Then Eq. (2.89a) gives ! as a function of the\nquaternion rate as\n\n! D 2?T .q/ Pq (3.21)\n\n\n\n72 3 Attitude Kinematics and Dynamics\n\n3.2.2 Rodrigues Parameter Kinematics\n\nThe kinematic equation satisfied by the Gibbs vector is most easily obtained from\nthe kinematic equation for the quaternion. Taking the time derivative of Eq. (2.136),\ninserting Eq. (3.18) for the quaternion derivative, and then substituting Eq. (2.137)\ngives\n\nPg D .1=2/ \u0152!C g ?!C .g ?!/g ? D .1=2/ ?I3 C \u0152g??C ggT\n\t\n! (3.22)\n\nThe inverse of this equation is\n\n! D 2 ?I3 C \u0152g??C ggT\n\t?1 Pg D 2 ?1C kgk2\t?1 .Pg ? g ? Pg/ (3.23)\n\n3.2.3 Modified Rodrigues Parameter Kinematics\n\nThe kinematic equation for the modified Rodrigues parameters can also be obtained\nfrom the kinematic equation for the quaternion. Taking the time derivative of\nEq. (2.144), inserting Eq. (3.18) for the quaternion derivative, and then substituting\nEq. (2.145) gives\n\nPp D .1=4/ ?.1 ? kpk2/!C 2p ?!C 2.p ?!/p ?\n\nD .1=4/ ?.1 ? kpk2/I3 C 2\u0152p??C 2ppT\n?\n!\n\nD 1C kpk\n2\n\n4\n\n?\nI3 C 2 \u0152p??\n\n2 C \u0152p??\n1C kpk2\n\n?\n! (3.24)\n\nThe matrix in parentheses in the last line of this equation is the transpose of the\nmatrix appearing in Eq. (2.149), which is orthogonal, so the inverse of the kinematic\nequation for the MRPs is\n\n! D 4\n1C kpk2\n\n?\nI3 C 2 \u0152p??\n\n2 ? \u0152p??\n1C kpk2\n\n?\nPp\n\nD 4 ?1C kpk2\t?2 ?.1 ? kpk2/ Pp ? 2p ? PpC 2.p ? Pp/p ? (3.25)\n\n3.2.4 Rotation Vector Kinematics\n\nThe kinematic equation for the rotation vector # D e# is also most easily obtained\nfrom the kinematic equation for the quaternion. Taking the time derivative of\n\n# D 2.cos?1 q4/ q1W3kq1W3k (3.26)\n\n\n\n3.2 Kinematics of Attitude Parameterizations 73\n\nand substituting Eq. (3.18) gives\n\nP# D\n\n\n\nq1W3qT1W3\nkq1W3k2 C\n\ncos?1 q4\nkq1W3k3\n\n?kq1W3k2I3 ? q1W3qT1W3\n\t\n.q4I3 C \u0152q1W3??/\n\n?\n! (3.27)\n\nafter replacing\nq\n1 ? q24 by kq1W3k. We now substitute Eq. (2.124) for the quaternion,\n\nuse the identities eeT D \u0152e??2 C I3 and \u0152e??3 D ?\u0152e??, and collect terms to yield\nthe desired kinematic equation\n\nP# D !C 1\n2\n# ?!C 1\n\n#2\n\n?\n1 ? #\n\n2\ncot\n\n#\n\n2\n\n?\n# ? .# ?!/ (3.28)\n\nThe coefficient of the last term is singular for # equal to any nonzero multiple of 2\n ,\nmaking the rotation vector parameterization unsuitable for numerical simulations.\nThis coefficient is difficult to evaluate numerically for # ? 0, but it is nonsingular\nin this limit, and expanding the cotangent in a power series leads to the small angle\napproximation\n\nP# ? !C .1=2/# ?!C .1=12/# ? .# ?!/ (3.29)\nThe inverse of Eq. (3.28) is\n\n! D P# ? 1 ? cos#\n#2\n\n# ? P# C # ? sin#\n#3\n\n# ? .# ? P#/ (3.30)\n\nThis is easily verified with the use of the relation \u0152e??3 D ?\u0152e?? and some\ntrigonometric identities.\n\n3.2.5 Euler Angle Kinematics\n\nThe product rule for differentiation gives the time derivative of a generalized Euler\nangle representation of a rotation, defined by Eq. (2.152), as\n\nPA.e?; e? ; e I?; ?;  / D PA.e ;  /A.e? ; ?/A.e?; ?/\nCA.e ;  / PA.e? ; ?/A.e?; ?/C A.e ;  /A.e? ; ?/ PA.e?; ?/\n\n(3.31)\n\nwhich can be seen to be a specific application of the methods of Sect. 3.1.2.\nDifferentiating Eq. (2.109) and remembering that e? is constant gives\n\nPA.e? ; ?/ D P?.? cos ? \u0152e???C sin ?\u0152e???2/ D ? P?\u0152e???A.e? ; ?/ (3.32)\n\n\n\n74 3 Attitude Kinematics and Dynamics\n\nAnalogous relations hold for PA.e ;  / and PA.e?; ?/, so\n\nPA.e?; e? ; e I?; ?;  / D ? P \u0152e ??A.e ;  /A.e? ; ?/A.e?; ?/\n? P?A.e ;  /\u0152e???A.e? ; ?/A.e?; ?/\n? P?A.e ;  /A.e? ; ?/\u0152e???A.e?; ?/\n\nD ?f P \u0152e ??C P?A.e ;  /\u0152e???AT .e ;  /\nC P?A.e ;  /A.e? ; ?/\u0152e???AT .e? ; ?/\n?AT .e ;  /gA.e?; e? ; e I?; ?;  / (3.33)\n\nBut we know that PA D ?\u0152!??A, so using Eq. (2.63) gives\n\n! D P e C P?A.e ;  /e? C P?A.e ;  /A.e? ; ?/e? (3.34)\n\nwhere !, P , P? , and P? are expressed all in rad/s. This expression is intuitively\nplausible. It expresses the total angular velocity as the sum of the components\nP e , P? e? , and P? e? , all mapped into the frame into which A.e?; e? ; e I?; ?;  /\n\ntransforms. The axis e is already in this frame, but e? and e? must be rotated by\nthe matrices A.e ;  / and A.e ;  /A.e? ; ?/, respectively.\n\nWe have obtained an expression for the angular velocity as a function of the\nEuler angle rates, but the inverse expression for the Euler angle rates in terms of the\nangular velocity is more useful. Because e is not affected by the rotationA.e ;  /,\nwe can write Eq. (3.34) as\n\n! D A.e ;  /\u0152 P e C P? e? C P?A.e? ; ?/e?? D A.e ;  /M\n2\n4\nP?\nP?\nP \n\n3\n5 (3.35)\n\nwhere M is the 3 ? 3 matrix\n\nM ? ?A.e? ; ?/e? e? e \n? D ?A.e? ; ?/AT .e? ; ?0/e e? e \n\n?\n\nD ?cos.? ? ?0/e Csin.? ? ?0/.e ? e? / e? e \n?\n\n(3.36)\n\nWe have used Eqs. (2.154), (2.155), and (2.117) in the above. The determinant of\nM is\n\ndetM D \u0152cos.? ??0/e C sin.? ??0/.e ?e? /? ? .e? ?e / D ? sin.? ??0/ (3.37)\nbecause e and e? are orthogonal. Equations (2.16) and (2.61) give the inverse of\nEq. (3.35) as\n\n2\n4\nP?\nP?\nP \n\n3\n5 DM?1AT .e ;  /! D B.?;  /! (3.38)\n\n\n\n3.2 Kinematics of Attitude Parameterizations 75\n\nwhere\n\nB.?;  / ? 1\nsin.? ? ?0/\n\n2\n4\n\n.e ? e? /T\nsin.? ? ?0/eT?\n\nsin.? ? ?0/eT ? cos.? ? ?0/.e ? e? /T\n\n3\n5AT .e ;  /\n\n(3.39)\n\nAlthough hidden by the notation, B.?;  / also depends on e , e? , and e? , the last\nimplicitly through ?0; but it is independent of ?.\n\nEquations (3.38) and (3.39) exhibit the gimbal-lock phenomenon; both P and P?\nbecome infinitely large as sin.? ? ?0/ ! 0 unless the angular velocity vector ! is\northogonal to A.e ;  /.e ? e? /. Gimbal lock is a real physical phenomenon for\ngimbaled platforms, where the Euler or Bryan-Tait angles are the actual physical\nangles of the gimbal mechanisms, which clearly cannot attain infinite rates.\n\nUsing A.e ;  /e D e and A.e ;  /e? D cos e? ? sin .e ? e? / allows us\nto express Eq. (3.39) as\n\nB.?;  / D\n2\n4\n\ncsc.? ? ?0/\u0152cos .e ? e? /C sin e? ?T\ncos eT? ? sin .e ? e? /T\n\neT ? cot.? ? ?0/\u0152cos .e ? e? /C sin e? ?T\n\n3\n5 (3.40)\n\nNow let us look at some specific examples of conventional Euler angle\nsequences. The axes for the 3?1?3 sequence are e D e3, e? D e1, and e ?e? D e2,\nand ?0 D 0, so Eq. (3.35) gives\n\n! ?\n2\n4\n!1\n!2\n!3\n\n3\n5 D A.e3;  /\n\n2\n4\n0 1 0\n\n0 0 sin ?\n1 0 cos ?\n\n3\n5\n2\n4\nP \nP?\nP?\n\n3\n5 D\n\n2\n4\nP? sin ? sin C P? cos \nP? sin ? cos ? P? sin \n\nP C P? cos ?\n\n3\n5\n\n(3.41)\nand Eq. (3.40) gives\n\nB.?;  / D\n2\n4\n\ncsc ? sin csc ? cos 0\ncos ? sin 0\n\n? cot ? sin ? cot ? cos 1\n\n3\n5 (3.42)\n\nThe axes for the 3?2?1 sequence are e D e1, e? D e2, and e ? e? D e3, and\n?0 D ?\n=2, so Eq. (3.35) gives\n\n! D A.e1;  /\n2\n4\n1 0 ? sin ?\n0 1 0\n\n0 0 cos ?\n\n3\n5\n2\n4\nP \nP?\nP?\n\n3\n5 D\n\n2\n4\n\nP ? P? sin ?\nP? cos ? sin C P? cos \nP? cos ? cos ? P? sin \n\n3\n5 (3.43)\n\nand Eq. (3.40) gives\n\nB.?;  / D\n2\n4\n0 sec ? sin sec ? cos \n0 cos ? sin \n1 tan ? sin tan ? cos \n\n3\n5 (3.44)\n\n\n\n76 3 Attitude Kinematics and Dynamics\n\nExpressions for B.?;  / and its inverse for all the conventional Euler and\nTait-Bryan representations can be derived in a parallel fashion, and explicit formulas\nfor them can be found in Chap. 9.\n\n3.2.6 Attitude Error Kinematics\n\nThe analysis of attitude error kinematics uses the results of Sects. 2.10 and 3.1.2.\nTo first order in the attitude error, the angular velocity of the attitude error is given\nby Eqs. (3.5) and (2.180) as\n\n\u0152!.?#/?? D ? PA.?#/AT .?#/ D \u0152? P#?? .I3 C \u0152?#??/ D \u0152? P#?? (3.45)\nThus we have simply !.?#/ D ? P# .\n\nConsider first the case where the attitude errors are defined in the spacecraft body\nframe. Equation (2.179) gives ABR D AB OBA OBR, so Eq. (3.12) gives\n\n!BRB D !B OBB C AB OB ! OBROB (3.46)\n\nIn this case the attitude error rate is !.?#B/ D !B OBB D ? P#B , so we have\n\n? P#B D !BRB ? AB OB ! OBROB D ! ? AB OB O! (3.47)\n\nwhere the second form uses the compact notation of ! for the true body rate, !BRB ,\n\nand O! for the estimated body rate, ! OBROB . Inserting Eq. (2.180) for AB OB gives\n\n? P#B D ! ? .I3 ? \u0152?#B??/ O! D .! ? O!/ ? O! ? ?#B (3.48)\nThe final form of this equation is the one most commonly applied. It appears to be\ninconsistent because it involves the difference of ! and O!, which are referenced to\ntwo different coordinate frames. Equation (3.47) shows that the attitude error rate\nis really defined consistently; the apparent contradiction arises from inserting the\napproximate form for AB OB . In fact, it is just this approximation that gives rise to\nthe O! ? ?# term in the kinematic equation.\n\nNow consider the case where the attitude errors are defined in the reference\nframe. Equation (2.178) gives ABR D AB ORA ORR, so Eq. (3.12) gives\n\n!BRB D !B ORB C AB OR ! ORROR (3.49)\n\nIn this case the attitude error rate is !.?#R/ D ! ORROR D ? P#R, so\n\n? P#R D ATB OR.!BRB ?!B\nOR\n\nB / D OAT .! ? O!/ (3.50)\n\nwhere in this case OA D AB OR is the estimated attitude and O! D !B ORB is the estimated\nbody rate.\n\n\n\n3.3 Attitude Dynamics 77\n\nThe error kinematics in these two cases look quite different. Equations (3.47)\nor (3.48) involves the attitude error, while Eq. (3.50) involves the attitude estimate.\nThe difference arises because either attitude dynamics or strapdown gyro measure-\nments give the components of the body rate in the spacecraft body frame. If the\nattitude errors are specified in the body frame, there are two slightly different body\nframes, the true frame and the estimated frame. If the attitude errors are specified in\nthe reference frame, on the other hand, there is only one body frame. The difference\nbetween the two formulations is purely kinematic, it has nothing to do with either\nframe being inertial or non-inertial.1\n\n3.3 Attitude Dynamics\n\nWe now turn to attitude dynamics, emphasizing the fundamental role of angular\nmomentum. We begin by defining the center of mass of a collection of mass points\nand showing how the rotational motion of this system can be treated separately from\nthe motion of the center of mass. We then specialize to the case of a rigid body,\ndefining the moment of inertia tensor and expressing the angular momentum and\nrotational kinetic energy in terms of the moment of inertia and the angular velocity.\nWe collect the rotational equations of motion, kinematic and dynamic, in one place\nfor easy reference, and then discuss the torque-free motion of a rigid body. Then we\nshow how to include internal and external torques in the dynamics.\n\n3.3.1 Angular Momentum and Kinetic Energy\n\nWe will consider a spacecraft (or anything else) to be made up of a collection of\nn point masses. The angular momentum with respect to the origin 0 of an inertial\ncoordinate frame is defined in terms of the masses mi , positions ri0, and velocities\nvi0 D Pri0 of the points relative to 0 by\n\nH0 ?\nnX\niD1\n\nri0 ?mivi0 (3.51)\n\nNewton\u2019s second law of motion tells us that mi Pvi0I D FiI in an inertial reference\nframe, and vi0 ? vi0 D 0, so the angular momentum obeys the equation\n\nPH0I D\nnX\niD1\n\nri0I ? FiI D\nnX\niD1\n\nri0I ?\n0\n@\n\nnX\njD1\n\nFijI C FiextI\n\n1\nA (3.52)\n\n1The situation would be different if the gyros were used to stabilize a platform to serve as an\ninertially fixed reference, but such platforms are now used only infrequently in space.\n\n\n\n78 3 Attitude Kinematics and Dynamics\n\n0\n\nr\nc0\n\nr\nj0\n\nr\njc\n\nr\nic\n\nj\n\ni\n\nc\n\nr\nij\n\nr\ni0\n\nFig. 3.1 Center of mass, c, and two representative mass points\n\nwhere Fij is the force exerted on mass point i by mass point j and Fiext is the\nforce exerted on i by everything external to the system of mass points.2 Any pair of\nmass points with indices k and ` appears twice in the double sum over i and j , as\nrk0I ? Fk`I and as r`0I ? F`kI . Newton\u2019s third law of motion says that F`k D ?Fk`, so\nthese two terms sum to .rk0I ? r`0I / ? Fk`I D rk`I ? Fk`I . This geometry is illustrated\nin Fig. 3.1. We assume that the force between two mass points acts along the line\nbetween them, an assumption known as the strong law of action and reaction [10],\nso the cross product vanishes and\n\nPH0I D\nnX\niD1\n\nri0I ? FiextI ? L0I (3.53)\n\nwhere L0I is the net torque about 0 exerted on the collection of mass points by all\nthe external forces.3 Note that internal forces give no contribution to the net torque.\n\nWe will now define the center of mass of the collection of mass points and prove\nthe important result that the motion of the center of mass and the motion of the mass\npoints about their center of mass are uncoupled. The location of the center of mass\nc with respect to the origin 0 is defined as\n\nrc0 ?\n \n\nnX\niD1\n\nmiri0\n!,\n\nM (3.54)\n\nwhere M ? PniD1 mi is the total mass of the collection of mass points. It follows\nfrom this definition that\n\nnX\niD1\n\nmiric D\nnX\niD1\n\nmi .ri0 ? rc0/ DM rc0 ?M rc0 D 0 (3.55)\n\n2We assume that Fi i , the force exerted by a mass point on itself, is zero.\n3Warning! Many authors use the letter L to denote angular momentum.\n\n\n\n3.3 Attitude Dynamics 79\n\nwhere these vectors are illustrated in Fig. 3.1. Using this result and its derivative,\nthe angular momentum about the arbitrary point 0 can be written as the sum of\nthe angular momentum about the center of mass and the angular momentum of the\ncenter-of-mass motion, namely\n\nH0 D\nnX\niD1\n\nmi .ric C rc0/ ? .vic C vc0/ D\nnX\niD1\n\nmiric ? vic C rc0 ?Mvc0\n\nD Hc C rc0 ?Mvc0 (3.56)\nThe net torque can similarly be expressed as\n\nL0 D\nnX\niD1\n.ric C rc0/ ? Fiext D\n\nnX\niD1\n\nric ? Fiext C rc0 ?\nnX\niD1\n\nFiext\n\nD Lc C rc0 ? F (3.57)\n\nwhere F is the net external force on the collection of point masses. Now in an inertial\nframe, we have FI D M Pvc0I , so substituting Eqs. (3.56) and (3.57) into Eq. (3.53)\nand canceling the term due to motion of the center of mass gives Euler\u2019s equation\n\nPHcI D LcI (3.58)\nThis is the fundamental equation of attitude dynamics. It is important to note that\nthis result holds even if the center of mass undergoes acceleration, as it usually does.\nEquation (3.58) only holds in a non-rotating frame, however.4\n\nThe separation into contributions from center-of-mass motion and motion about\nthe center of mass also holds for the kinetic energy. We have\n\nE0k ?\n1\n\n2\n\nnX\niD1\n\nmikvi0k2 D 1\n2\n\nnX\niD1\n\nmi .vic C vc0/ ? .vic C vc0/\n\nD 1\n2\n\nnX\niD1\n\nmikvick2 C 1\n2\nMkvc0k2 D Eck C\n\n1\n\n2\nMkvc0k2 (3.59)\n\nThe derivative of the kinetic energy is\n\nPE0k D\nnX\niD1\n\nmivi0I ? Pvi0I D\nnX\niD1\n.vicI C vc0I / ? FiI D\n\nnX\niD1\n\nvicI ? FiI C vc0I ? FI (3.60)\n\nThe internal forces cancel in the vc0I ? FiI sum due to the weak form of Newton\u2019s\nthird law of motion, i.e. this cancelation does not require the force between two\nmass points to be along the line joining them. The internal forces do not cancel in\n\n4This is discussed in Sect. 2.6.2.\n\n\n\n80 3 Attitude Kinematics and Dynamics\n\nthe other term, though. This means that internal forces cannot affect the energy of\ncenter-of-mass motion, but they can modify the energy of rotation about the center\nof mass. It is apparent that the last term of Eq. (3.60) is equal to the derivative of the\nlast term of Eq. (3.59), from which it follows that\n\nPEck D\nnX\niD1\n\nvicI ? FiI (3.61)\n\n3.3.2 Rigid Body Dynamics\n\nA rigid body is defined by the existence of a reference frame, called the body frame\nB in which all the vectors ricB are constant. The body frame is not unique; any\nframe related to it by a constant orthogonal transformation is also a body frame.\nThe constancy of the vectors in the body frame and Eq. (3.14) allow us to obtain the\nvelocity of a mass point in the inertial frame as\n\nvicI D PricI D AIB PricB ?!IBI ? ricI D !BII ? ricI (3.62)\nwhere we have used Eq. (3.8) to obtain the last form. Substituting this into Eq. (3.56)\ngives\n\nHcI D\nnX\n\niD1\n\nmiricI ? vicI D\nnX\n\niD1\n\nmiricI ? .!BII ? ricI / D ?\nnX\n\niD1\n\nmi \u0152ricI ??2!BII D J cI !BII\n(3.63)\n\nThe last equality defines the representation in the frame I of the symmetric 3 ? 3\nmatrix J cI known as the moment of inertia tensor, or MOI.\n\n5 The MOI in Eq. (3.63)\nis specific to frame I , but we can define it in a general frame by\n\nJ c ? ?\nnX\niD1\n\nmi \u0152ric??2 D\nnX\niD1\n\nmi\n?krick2I3 ? ric.ric/T\n\n?\n(3.64)\n\nwhich defines the MOI in the frame in which the vectors ric are represented,\nwhatever that frame is. In fact the MOI is almost always expressed in the body\nframe\n\nJ cB D ?\nnX\niD1\n\nmi \u0152ricB??2 D\nnX\niD1\n\nmi\n?kricB k2I3 ? ricB .ricB /T\n\n?\n(3.65)\n\n5The MOI is more specifically a second-rank tensor, which means that it transforms by Eq. (2.52)\nunder reference frame transformations. This follows directly from the fact that ricB D ABI ricI .\n\n\n\n3.3 Attitude Dynamics 81\n\nbecause it is constant in that frame. The angular momentum in the body frame is\ngiven, using Eqs. (2.52) and (2.42), by\n\nHcB D ABIHcI D ABIJ cI !BII D ABIJ cI ATBIABI!BII D J cB !BIB : (3.66)\n\nThe parallel axis theorem can be used to find the MOI of a rigid body about an\narbitrary point p in terms of its MOI about its center of mass:\n\nJ p D\nnX\niD1\n\nmi\n?kripk2I3 ? rip.rip/T\n\n?\n\nD\nnX\niD1\n\nmi\n?k.ric C rcp/k2I3 ? .ric C rcp/.ric C rcp/T\n\n?\n\nDM ?krcpk2I3 ? rcp.rcp/T\n?C J c (3.67)\n\nwith Eq. (3.55) causing the other terms in the sum to vanish. This allows us to\nexpress the MOI of a large body in terms of the MOIs of m subassemblies as\n\nJ c D\nmX\nkD1\n\n?\nMk\n\n?krckck2I3 ? rckc.rckc/T\n?C J ck? (3.68)\n\nwhere c is the center of mass of the whole system and Mk , ck , and J ck denote the\nmass, location of the center of mass, and MOI about ck of the kth subassembly. This\nis the method used to compute MOIs in practice, where the subassemblies can be\nstructural elements, electronics boxes, reaction wheel assemblies, star trackers, etc.\nThe MOIs of the subassemblies can be directly measured or they can be computed\nby breaking the subassemblies down into sub-subassemblies.\n\nThe matrix elements of the MOI tensor are given explicitly by\n\n\u0152J c?11 D\nnX\niD1\n\nmi\n?\n.ric2 /\n\n2 C .ric3 /2\n?\n\n(3.69a)\n\n\u0152J c?22 D\nnX\niD1\n\nmi\n?\n.ric3 /\n\n2 C .ric1 /2\n?\n\n(3.69b)\n\n\u0152J c?33 D\nnX\niD1\n\nmi\n?\n.ric1 /\n\n2 C .ric2 /2\n?\n\n(3.69c)\n\n\u0152J c?k` D ?\nnX\niD1\n\nmi r\nic\nk r\n\nic\n` ; for k \u00a4 ` (3.69d)\n\n\n\n82 3 Attitude Kinematics and Dynamics\n\nThe off-diagonal elements, \u0152J c?k`, or their negatives, ?\u0152J c?k`, are often referred to\nas the products of inertia.6\n\nBeing a real symmetric 3 ? 3 matrix, the MOI tensor has three orthogonal\neigenvectors ekB and three real eigenvalues Jk satisfying the relation\n\nJ cBe\nk\nB D JkekB; for k D 1; 2; 3 (3.70)\n\nThe unit vectors ekB are called the principal axes and the scalars Jk are known as\nthe principal moments of inertia. The transformation of the MOI tensor from an\narbitrary body frame to the principal axis frame is given by\n\nATBP J\nc\nBABP D J cP D diag .\u0152J1 J2 J3 ?/ (3.71)\n\nwhere ABP D \u0152e1B e2B e3B ?. In the principal axis frame Eq. (3.69) has the form\n\nJ1 D\nnX\niD1\n\nmi\n?\n.ricP 2/\n\n2 C .ricP 3/2\n?\n\n(3.72a)\n\nJ2 D\nnX\niD1\n\nmi\n?\n.ricP 3/\n\n2 C .ricP1/2\n?\n\n(3.72b)\n\nJ3 D\nnX\niD1\n\nmi\n?\n.ricP1/\n\n2 C .ricP 2/2\n?\n\n(3.72c)\n\n0 D\nnX\niD1\n\nmi r\nic\nPk r\n\nic\nP `; for k \u00a4 ` (3.72d)\n\nThe sum in the last of these equations must have balancing positive and negative\ncontributions, expressing the intuitive idea that the mass is distributed symmetrically\nabout the principal axes. In particular, any axis of rotational symmetry of a mass\ndistribution is a principal axis. The first three equations show that the principal\nmoments are all positive, unless the mass is all concentrated on a mathematical\nstraight line, which is impossible for a real physical body. It can also be seen from\nthese equations that the principal moments of inertia satisfy the triangle inequalities\n\nJk ? J` C Jm (3.73)\n\nwhere equality holds only if all the mass is concentrated in the ` ? m plane, and\nwhere k, `, and m are any permutation of the indices 1; 2; 3.\n\n6Be warned that notation varies. The majority of authors use I for the MOI, but we reserve this\nnotation for the identity matrix. Some denote our Jkk by Ikk and our Jk` for k \u00a4 ` by ?Ik`, but\nthis unfortunate notation should be shunned.\n\n\n\n3.3 Attitude Dynamics 83\n\nIt also follows from this analysis that the MOI tensor of any real physical body\nhas an inverse in any body frame, and we can write Eq. (3.66) as\n\n!BIB D .J cB/?1HcB (3.74)\n\nImplicit in Eqs. (3.66) and (3.74) is the key fact that the angular momentum and\nangular velocity of a rigid body are parallel if and only if the body rotates about a\nprincipal axis.\n\nThe rotational kinetic energy of a rigid body can also be expressed in terms of\nthe MOI tensor. Substituting Eq. (3.62) into Eq. (3.59) gives\n\nEck D\n1\n\n2\n\nnX\niD1\n\nmikvick2 D 1\n2\n\nnX\niD1\n\nmi .!\nBI\nI ? ricI /T .!BII ? ricI /\n\nD 1\n2\n\nnX\niD1\n\nmi\n?\n\u0152ricI ??!BII\n\n\tT ?\n\u0152ricI ??!BII\n\n\t D 1\n2\n.!BII /\n\nT J cI !\nBI\nI (3.75)\n\nThe rotational kinetic energy can be computed in any frame F by\n\nEck D\n1\n\n2\n.!BIF /\n\nT J cF !\nBI\nF D\n\n1\n\n2\n!BIF ?HcF D\n\n1\n\n2\n.HcF /\n\nT .J cF /\n?1 HcF (3.76)\n\nThe time derivative of Eq. (3.75) is, with Eqs. (3.63) and (3.58),\n\nPEck D .!BII /T J cI P!BII D !BII ? LcI D !BIB ? LcB (3.77)\n\nshowing that only external torques can modify the energy of rotation of a rigid body\nabout its center of mass. This can be seen more explicitly by substituting Eq. (3.62)\ninto Eq. (3.61), giving\n\nPEck D\nnX\niD1\n.!BII ? ricI / ?\n\n0\n@\n\nnX\njD1\n\nFijI C FiextI\n\n1\nA D !BII ? LcI (3.78)\n\nThe sum over the internal forces FijI vanishes for the same reason that the\ncorresponding sum in Eq. (3.52) gave zero contribution, and the final equality\nfollows from applying Eqs. (2.56a) and (3.57).\n\nWe can now collect in one place the basic equations needed to model the attitude\nmotion of a rigid body. We will assume that the attitude is parameterized by a\nquaternion, but any other representation could be used instead:\n\nPHcI D LcI (3.79a)\nHcB D A.qBI /HcI (3.79b)\n\n\n\n84 3 Attitude Kinematics and Dynamics\n\n!BIB D .J cB/?1HcB (3.79c)\n\nPqBI D 1\n2\n!BIB ? qBI (3.79d)\n\nThe external torques are often more easily computed in the body frame, so Eq. (3.14)\nis often employed to replace the first two of these equations by\n\nPHcB D LcB ?!BIB ?HcB (3.80)\n\nA further reduction in the number of equations can be achieved by combining the\nabove equation with Eq. (3.66) to obtain Euler\u2019s rotational equation\n\nP!BIB D .J cB/?1\n?\nLcB ?!BIB ? .J cB !BIB /\n\n?\n(3.81)\n\nThis equation and a kinematics equation, such as the quaternion kinematics\nequation, provide a complete description of the motion of a rigid body.\n\nUse of the principal axis reference frame is generally not especially advantageous\nfor numerical integration of the equations of motion, since a computer can easily\ndeal with a full 3 ? 3 inertia tensor. The principal axis frame is almost invariably\nemployed for analytical studies of attitude motion, however, and we will use it in\nthe next subsection.\n\n3.3.3 Rigid Body Motion\n\nWe now begin a discussion of the motion produced by the rigid body dynamic and\nkinematic equations. This section will consider the qualitative aspects of the motion,\nwithout solving the kinematic and dynamic differential equations explicitly. Then\nSect. 3.3.4 will discuss in detail the solutions in the absence of torques. We will\nsimplify the notation by omitting the superscript c, with the understanding that we\nalways treat motion with respect to the center of mass unless explicitly indicated\notherwise. We will denote the components of HB in a principal axis frame by\nH1;H2;H3 and the components of !BIB by !1; !2; !3. There are many discussions\nof rigid body motion in the literature, including notable ones by Goldstein [10],\nKaplan [17], Markley [20], and Hughes [14].\n\n3.3.3.1 Spin Stabilization\n\nEquation (3.58) tells us that HI is constant if there are no external torques. This\nhas led to the technique of spin stabilization of spacecraft. The basic idea is to\nstabilize the pointing direction of one axis by spinning the spacecraft about that axis.\n\n\n\n3.3 Attitude Dynamics 85\n\nIf a torque of magnitudeL transverse to the direction of the spin angular momentum\nacts on a spinning spacecraft, the change in angular momentum over a time interval\n?t will be\n\nk?HIk D L?t ? H?# (3.82)\n\nwhereH is the magnitude of the angular momentum and?# is the angle (measured\nin radians) over which it rotates. It is clear that a larger amount of angular\nmomentum will result in a smaller angular motion for a given level of disturbance\ntorque. Spin stabilization was widely employed early in the space program, then\nwas largely displaced by active control methods, but has made a comeback in the\nera of microsatellites and nanosatellites.\n\nIt is important for spin stabilization that the angular momentum also have a\nconstant direction in the body frame. Equation (3.80) says that this will be the\ncase if !BIB ? HB D 0, which requires the rotation axis to be a principal axis of\nthe inertia tensor. Thus we want the spacecraft to rotate about a principal axis. If the\nspacecraft spins about a principal axis, but this does not align precisely with the\ndesired pointing axis, coning results, with the pointing axis rotating at the spin\nrate around a cone centered on the inertially fixed angular momentum. The only\nway to eliminate coning is to carefully balance the spacecraft. This is generally\naccomplished by adding balance weights before launch similar to balancing an\nautomobile tire, but some spacecraft have carried movable weights into orbit to\nallow compensation for inertia shifts caused by launch forces or to provide better\nbalance than can be measured on the ground.\n\nIf the angular momentum is not perfectly aligned with a principal axis of inertia,\nthe angular momentum will not be constant in the body frame. The resulting motion\nof the angular momentum, and of the angular velocity, is called nutation.7 For\ntorque-free motion, kHBk D kHIk ? H is constant during nutation, so the angular\nmomentum vector moves on the surface of a sphere of radius H in the body frame.\n\nInvestigating the stability of the motion for angular velocity close to, but not\nexactly on, a principal axis shows that all principal axes are not created equal for\nthe purpose of spin stabilization. We will see that spin stabilization should always\nbe about the principal axis with the largest or smallest principal moment of inertia,\nknown as the major or minor principal axis, respectively, with a strong preference\nfor the major principal axis. If there are no torques, the component form of Eq. (3.80)\nin the principal axis frame is\n\nPH1 D .J?13 ? J?12 /H2 H3 D \u0152.J2 ? J3/=.J2J3/?H2 H3 (3.83a)\nPH2 D .J?11 ? J?13 /H3 H1 D \u0152.J3 ? J1/=.J3J1/?H3 H1 (3.83b)\nPH3 D .J?12 ? J?11 /H1 H2 D \u0152.J1 ? J2/=.J1J2/?H1 H2 (3.83c)\n\n7This is the usual aerospace meaning of the term nutation; it is used quite differently in other\napplications of classical mechanics to refer to a wobbling or nodding motion.\n\n\n\n86 3 Attitude Kinematics and Dynamics\n\ne e\n\nee\n\n21\n\n3\n\na b\n\n3\n\nFig. 3.2 Constant energy paths on the angular momentum sphere. (a) Axisymmetric inertia ratios\nJ1 W J2 W J3 D 4 W 4 W 6. (b) Triaxial inertia ratios J1 W J2 W J3 D 3 W 4 W 6\n\nWe will choose the spin axis to be close to the e3 axis for the purpose of the following\nargument, which means that H1 and H2 are both much less than H3. Thus their\nproduct on the right side of Eq. (3.83c) is negligibly small, and we can approximate\nH3 as being constant. Then differentiating Eq. (3.83a) and substituting Eq. (3.83b)\ngives\n\nRH1.t/ D \u0152.J2 ? J3/.J3 ? J1/=.J1J2/?.H3=J3/2H1.t/ (3.84)\n\nIf J3 is the largest or smallest principal moment, the product .J2 ? J3/.J3 ? J1/\nis negative, resulting in a periodic motion of H1. Then Eq. (3.83a) shows that H2\nalso undergoes periodic motion with the same period. This is nutation about the e3\naxis. The product .J2 ? J3/.J3 ? J1/ is positive if J3 is intermediate between J1\nand J2, however, and H1 and H2 both grow exponentially.8 Thus rotation about an\nintermediate principal axis is inherently unstable. It is also possible that J3 is equal\nto one of the other principal moments. If J3 D J1, for instance, then Eq. (3.83b)\ntells us thatH2 is exactly constant, and Eq. (3.83a) says thatH1 grows linearly with\ntime. This motion is also unstable, although not exponentially unstable.\n\nThis behavior is illustrated in Fig. 3.2a,b, which show the torque-free motion of\nHB on the sphere of radiusH for two different inertia tensors. The rotational kinetic\nenergy in a principal axis frame is given by\n\n2Ek D H21 =J1 CH22 =J2 CH23 =J3 (3.85)\n\n8Exponential growth continues until the right side of Eq. (3.83c) is no longer negligible.\n\n\n\n3.3 Attitude Dynamics 87\n\nFor a given angular momentum magnitude, the kinetic energy is restricted to the\nrange\n\nH2=Jmax ? 2Ek ? H2=Jmin (3.86)\nwhere Jmin and Jmax are the minimum and maximum principal moments of inertia.\nConservation of energy confines the motion of HB to a path on the sphere and\nFig. 3.2a,b show these paths for energy levels with even spacing 0:025H2=Jmax\nin the range allowed by Eq. (3.86).\n\nWe will first discuss the simpler axially symmetric, or axisymmetric case, with\ntwo principal moments equal. We will take e3 to be the axis of symmetry of the\ninertia tensor in this case, which is shown in Fig. 3.2a. The axes e1 and e2 are not\nshown on the figure because they can be any two axes in the equatorial plane that\nform a right-handed orthogonal triad with e3. With J1 D J2 ? Jt , where the\nsubscript t denotes \u201ctransverse,\u201d Eq. (3.85) becomes\n\n2Ek D .H21 CH22 /=Jt CH23 =J3 (3.87)\nIt follows that\n\nH3 D ?\n?\nJ3.H\n\n2 ? 2JtEk/\nJ3 ? Jt\n\n?1=2\n(3.88a)\n\nHt ?\n?\nH21 CH22\n\n?1=2 D\n?\nJt .2J3Ek ?H2/\n\nJ3 ? Jt\n?1=2\n\n(3.88b)\n\nThis shows that nutation of an axisymmetric body is motion of the angular\nmomentum vector in the body frame along circles of constant radius Ht a constant\ndistance of H3 above or below the equatorial plane, as shown in Fig. 3.2a. This\nextends the analysis of Eq. (3.84) to nutation with any allowable magnitude about\nthe major or minor principal axis?e3. The figure also shows that there are no small\nnutation paths close to the e1 ? e2 plane.\n\nFigure 3.2b illustrates the triaxial case, where no two principal moments are\nequal. We have labeled the principal axes for this discussion so that J1 < J2 < J3.\nThe paths followed by nutational motion about the major and minor axes are not\nsimple circles in this case; their exact form will be found in Sect. 3.3.4. We see that\nthere is no stable motion about the intermediate axis ?e2 in this case. Instead, we\nfind motion along two great circles passing through e2. They are called separatrices,\nbecause they separate nutational motion about ?e1 from nutational motion about\n?e3. The separatrices are the curves for 2Ek D H2=J2, so they satisfy the equation\n\n.H23 CH22 CH21 /=J2 D H21 =J1 CH22 =J2 CH23 =J3 (3.89)\nwhich gives\n\nH3\n\nH1\nD\n?\nJ3.J2 ? J1/\nJ1.J3 ? J2/\n\n?1=2\n(3.90)\n\n\n\n88 3 Attitude Kinematics and Dynamics\n\nFig. 3.3 William Pickering, James Van Allen, and Wernher von Braun holding a Full-Scale Model\nof Explorer 1. Source: NASA\n\n3.3.3.2 Energy Dissipation\n\nWe have seen that stable rotation is possible around either a major or minor principal\naxis of inertia. However, internal forces in a body that is not completely rigid can\nlead to energy dissipation. If external torques are absent, HI will be constant, but\nthe rotational energy will decrease to its minimum value of H2=Jmax, resulting in\nstable rotation about a major principal axis. If the intended spin axis is a minor\naxis, energy dissipation will result in flat spin, an undesirable rotation about an axis\nperpendicular to the preferred axis. A famous example of this is the pencil-shaped\nExplorer 1, the first Earth satellite successfully launched by the United States, which\nwas intended to spin about its longitudinal axis. Its entry into flat spin was attributed\nto energy dissipation in the flexible turnstile antenna array, comprising the four wires\nattached to the fuselage just aft of Wernher von Braun\u2019s right hand in Fig. 3.3 [5].\n\nSteady spin about the major principal axis is commonly the desired outcome,\nwith spin-stabilized spacecraft designed to be more nearly disc-shaped than pencil-\nshaped; and passive nutation dampers are often placed on these spacecraft to\nproduce this result. For triaxial inertia, energy dissipation can result in motion\nstarting with increasing nutation about ?e1, then crossing one of the separatrices,\nfollowed by decreasing nutation about either e3 or ?e3, depending on where a\nseparatrix is crossed. Because HI is fixed in the inertial frame, these two outcomes\nresult in the pointing axis being oriented in opposite directions in inertial space.\nIt is usually the case that only one of these pointing directions is satisfactory, which\nrequires careful control of the energy damping to ensure the correct crossing of the\nseparatrix.\n\n\n\n3.3 Attitude Dynamics 89\n\n3.3.3.3 Poinsot\u2019s Construction\n\nThe discussion up to this point has not provided a picture of the motion in the inertial\nframe. Poinsot\u2019s construction supplies this picture by focusing on angular velocity\nrather than angular momentum [10, 14, 17]. Conservation of energy in torque-free\nmotion restricts angular velocity to the surface of the inertia ellipsoid defined by\n\n2Ek D .!BIB /T JB !BIB D J1!21 C J2!22 C J3!23 (3.91)\n\nwith semimajor axes of length\np\n2Ek=J1;\n\np\n2Ek=J2;\n\np\n2Ek=J3. A small change\n\n?! in the angular velocity would result in an energy change\n\n?Ek D .!BIB /T J cB ?! D HB ??! (3.92)\n\nwhich is zero if ?! is perpendicular to the angular momentum. Changes ?! that\ndo not change Ek are in the plane tangent to the inertia ellipsoid, leading to the\nconclusion that the normal to the inertia ellipsoid at any !BIB is in the direction of\nthe angular momentum HB D JB!BIB .\n\nEach closed path on the momentum sphere illustrated in Fig. 3.2a or b maps onto\na closed path called a polhode on the inertia ellipsoid. As the angular velocity moves\nalong the polhode, the inertia ellipsoid (which is fixed in the rigid body) moves in\nsuch away that the normal to its surface at the position of the instantaneous angular\nvelocity maintains a fixed direction (that of HI ) in inertial space. But Poinsot tells\nus more. Writing the energy equation in the form 2Ek D !BII ? HI reveals that the\ncomponent of !BII parallel to HI has the constant value 2Ek=H . Thus the tip of\nthe vector !BII always lies in a fixed plane normal to HI at a distance of 2Ek=H\nfrom the center of the inertia ellipsoid. The path followed by the angular velocity in\nthis invariant plane is called the herpolhode. Thus the inertia ellipsoid rolls on the\ninvariant plane with its center at a fixed point a distance 2Ek=H above the plane and\nwith the tip of the angular velocity vector as the point of contact. Since the angular\nvelocity is the instantaneous axis of rotation, there is no slippage at the contact\npoint, and Poinsot\u2019s construction can be succinctly summarized by the statement that\nthe polhode rolls without slipping on the herpolhode lying in the invariant plane.9\n\nGoldstein [10], Kaplan [17], and Hughes [14] have pictures illustrating Poinsot\u2019s\nconstruction.\n\nPoinsot\u2019s construction is not especially easy to visualize, and there is a simpler\npicture for the familiar axial symmetry case. In any case, we now turn to analytic\nsolutions of the equations of motion, which are often more useful than pictures for\nestimation and control applications.\n\n9A statement aptly characterized by Goldstein [10] as \u201cjabberwockian.\u201d\n\n\n\n90 3 Attitude Kinematics and Dynamics\n\n3.3.4 Torque-Free Motion of a Rigid Body\n\nAnalytic solutions of the rigid body equations of motion are customarily expressed\nin terms of angular velocity rather than angular momentum. Thus we will consider\nthe component form of Eq. (3.81) in the principal axis frame in the absence of\ntorques:\n\nP!1.t/ D \u0152.J2 ? J3/=J1? !2.t/ !3.t/ (3.93a)\nP!2.t/ D \u0152.J3 ? J1/=J2? !3.t/ !1.t/ (3.93b)\nP!3.t/ D \u0152.J1 ? J2/=J3? !1.t/ !2.t/ (3.93c)\n\nAs we saw in Sect. 3.3.3, the rate of rotation about one of the principal axes is\nconstant if the moments of inertia about the other two principal axes are equal. We\nwill treat this simpler case of axial symmetry first, and then turn to the case of a\ntriaxial inertia tensor.\n\n3.3.4.1 Axial Symmetry\n\nTaking e3 to be the axis of symmetry of the inertia tensor, we have\n\nP!1.t/ D .1 ? J3=Jt / !2.t/ !3.t/ (3.94a)\nP!2.t/ D ?.1 ? J3=Jt / !3.t/ !1.t/ (3.94b)\nP!3.t/ D 0 (3.94c)\n\nThis means that !3 is constant, so we can omit the time argument. Note that !3 is\nexactly constant for axial symmetry, as opposed to its approximate constancy in the\nstability analysis of Sect. 3.3.3. It follows from Eq. (3.88a) that\n\n!3 D H3\nJ3\nD ?\n\n?\nH2 ? 2JtEk\nJ3.J3 ? Jt /\n\n?1=2\n(3.95)\n\nDifferentiating Eq. (3.94a) and substituting Eq. (3.94b) gives\n\nR!1.t/ D ?.1 ? J3=Jt /2!23 !1.t/ (3.96)\nwhich has the solution\n\n!1.t/ D !t sin. 0 C !pt/ (3.97)\nwhere  0 is a constant initial phase,\n\n!p ? .1 ? J3=Jt /!3 (3.98)\n\n\n\n3.3 Attitude Dynamics 91\n\nand, from Eq. (3.88b),\n\n!t D Ht\nJt\nD\n?\n2J3Ek ?H2\nJt .J3 ? Jt /\n\n?1=2\n(3.99)\n\nThen !2.t/ is given by Eq. (3.94a) as\n\n!2.t/ D !t cos. 0 C !pt/ (3.100)\n\nThe angular rate !p is called the body nutation rate because it is the rate at which\nthe angular velocity vector rotates about the symmetry axis in the body frame. Note\nthat !p has the same sign as !3 if Jt > J3 and the opposite sign if Jt < J3.\nIf Jt D J3, there is no nutation, only steady rotation, since all axes are principal\naxes in that case. The angular momentum rotates about the symmetry axis in the\nbody frame at the same rate, because the three vectors H;!, and e3 are coplanar in\nthe case of triaxial symmetry, as is easily seen from the relation\n\nH D Jt\n2\n4\n!1\n!2\n0\n\n3\n5C J3\n\n2\n4\n0\n\n0\n\n!3\n\n3\n5 D Jt!C .J3 ? Jt /!3e3 (3.101)\n\nThe speed at which the angular momentum vector moves over the sphere of\nradius H in the body frame can also be computed by\n\nk PHBk2 D k!BIB ?HBk2 D H2k!BIB k2 ? .!BIB ?HB/2 D H2k!BIB k2 ? .2Ek/2\n(3.102)\n\nSubstituting Eqs. (3.95), (3.99), (3.97) and (3.100) and performing some straight-\nforward algebra gives\n\nk PHBk D j.J3 ? Jt /!t!3j D Ht j!pj (3.103)\n\nIt is easy to see that these equations give k PHBk D 0 for rotation about a principal\naxis, for which either !t or !3 is zero.\n\nBy using the addition formulas for the sine and cosine, we can express the\ntransverse components of the angular velocity in terms of their initial values:\n\n!1.t/ D !01 cos!pt C !02 sin!pt (3.104a)\n!2.t/ D !02 cos!pt ? !01 sin!pt (3.104b)\n\nwhere !01 D !t sin 0 and !02 D !t cos 0.\nWe must now solve the kinematic equations of motion in order to have a complete\n\nmathematical description of the torque-free motion. We will follow the almost\nuniversal practice for torque-free motion of specifying the attitude by 3?1?3 Euler\nangles. This gives us three first-order equations to integrate, which would lead to\n\n\n\n92 3 Attitude Kinematics and Dynamics\n\nthree constants of integration in addition to the three we have already found:H;Ek ,\nand  0. Two of these constants can be thought of as specifying the fixed direction\nof HI , and we eliminate these by choosing the inertial reference frame with its\nthird axis in the direction of HI . Then the angular momentum in the body frame is\ngiven by\n\nHB D\n2\n4\nJt!1\nJt!2\nJ3!3\n\n3\n5 D ABIHI D A313.?; ?;  /\n\n2\n4\n0\n\n0\n\nH\n\n3\n5 D H\n\n2\n4\n\nsin sin ?\ncos sin ?\n\ncos ?\n\n3\n5 (3.105)\n\nwhere Eq. (2.162) provides the last equality. We immediately see that the nutation\nangle ? has constant value between 0 and \n given by\n\n? D cos?1.J3 !3=H/ (3.106)\n\nand comparison of the first two components of Eq. (3.105) with Eqs. (3.97)\nand (3.100) shows that\n\nsin ? D Jt !t=H ? 0 (3.107)\n\nand\n\n D  0 C !pt (3.108)\n\nup to an irrelevant multiple of 2\n . This explains our choice of the notation  0 in\nEq. (3.97). The third Euler angle is found by integrating Eq. (3.38) using Eq. (3.42):\n\nP? D csc ?.!1 sin C !2 cos / D !t csc ? D H=Jt ? !` (3.109)\n\nso that\n\n? D ?0 C !`t (3.110)\n\nThe angular rate !` is called the inertial nutation rate because it is the rate at which\nthe angular velocity vector and the symmetry axis of the rigid body rotate about the\nfixed angular momentum vector in the inertial frame. Equation (3.98) can be used\nto write Eq. (3.101) as\n\n! D H=Jt C .1 ? J3=Jt /!3e3 D H=Jt C !pe3 (3.111)\n\nThis shows that the angular velocity in the axisymmetric case can be expressed as\nthe sum of two (nonorthogonal) vectors of magnitude !` and !p .\n\nWe complete the analysis of axisymmetric motion by finding the components of\nthe angular velocity in the inertial frame. These are given by\n\n\n\n3.3 Attitude Dynamics 93\n\n!BII D AIB!BIB D AT313.?; ?;  /\n2\n4\n!1\n!2\n!3\n\n3\n5\n\nD A.e3;??/A.e1;??/A.e3;? /\n2\n4\n!t sin \n!t cos \n!3\n\n3\n5 (3.112)\n\nPerforming the matrix multiplications and applying Eqs. (2.108), (3.106),\nand (3.107) gives\n\nA.e1;??/A.e3;? /\n2\n4\n!t sin \n!t cos \n!3\n\n3\n5 D A.e1;??/\n\n2\n4\n0\n\n!t\n!3\n\n3\n5\n\nD\n2\n4\n\n0\n\n!t cos ? ? !3 sin ?\n!3 cos ? C !t sin ?\n\n3\n5 D 1\n\nH\n\n2\n4\n\n0\n\n.J3 ? Jt /!t!3\n2Ek\n\n3\n5 (3.113)\n\nThus the component of!BII parallel to HI has the constant value 2Ek=H , as we saw\nin our discussion of Poinsot\u2019s construction; and the component transverse to HI has\na magnitude agreeing with Eq. (3.103) and rotates around a circular herpolhode at\nthe inertial nutation rate.\n\nWe now present a pictorial view of this motion, which is the specialization\nof Poinsot\u2019s construction to the axisymmetric case. The angular velocity vector\nprecesses at rate !` and at an angle ? from the angular momentum vector around\na space cone fixed in the inertial frame. At the same time, the angular velocity\nvector precesses at rate !p and at an angle ? from the e3 axis around a body cone\nfixed in the body frame. These cones are illustrated in Fig. 3.4a for the prolate case\nand in Fig. 3.4b for the oblate case.10 The cones are tangent at the angular velocity\nbecause H;!, and e3 are coplanar, and there is no slippage along the line of tangency\nbecause that is the axis around which the rotation takes place. Thus, as viewed from\nthe inertial frame, the body cone (and the spacecraft which is fixed to it) rolls without\nslipping around the fixed space cone; while, as viewed from the body frame, the\nspace cone (and the universe which is fixed to it) rolls without slipping around the\nfixed body cone.\n\nThe body cone angle ? obeys\n\ncos? D !3=k!k and sin? D !t=k!k (3.114)\n\n10The figure illustrates the case of !3 > 0, but a corresponding figure for !3 < 0 shows that all the\ndiscussion of this section holds in that case also.\n\n\n\n94 3 Attitude Kinematics and Dynamics\n\nH\n\ne3\n\nH\n\ne3\n\na b\n\nFig. 3.4 Torque-free motion of an axisymmetric rigid body. (a) Prolate rigid body J3 < Jt .\n(b) Oblate rigid body J3 > Jt\n\nand comparison with Eqs. (3.106) and (3.107) shows that the space cone rolls on the\noutside of the body cone for a prolate rigid body and on the inside for an oblate body,\nas shown in the figure. This explains why !p has the same sign as !3 in the prolate\ncase and the opposite sign in the oblate case, in agreement with Eq. (3.98). Finally,\nwe note from the figure that ?, the angle between H and !, is equal to j? ? ?j. This\nrelation can be verified algebraically by applying Eqs. (3.106), (3.107) and (3.114)\nto get\n\nHk!k.cos? cos ? C sin? sin ?/ D 2Ek D H ?! D Hk!k cos? (3.115)\n\n3.3.4.2 Triaxial Symmetry\n\nWe will designate the intermediate principal moment of inertia by J2 in the triaxial\ncase. We saw in the discussion of Fig. 3.2b that the separatrices divide the motion\ninto two regimes. For 2Ek < H2=J2 the motion has the form of nutation about\nthe principal axis having the largest moment of inertia, and 2Ek > H2=J2 results\nin nutation about the principal axis with the smallest moment of inertia. Motion\nalong a separatrix is a limiting case of either of these regimes. In order that one\nanalytic formulation will cover both of these cases, we label the principal axes so\nthat nutation is always about ?e3. Thus\n\nJ1 < J2 < J3 if 2Ek ? H2=J2; (3.116a)\nJ1 > J2 > J3 if 2Ek ? H2=J2 (3.116b)\n\n\n\n3.3 Attitude Dynamics 95\n\nNo component of the angular velocity is constant in the triaxial symmetry\ncase, so the solutions cannot be expressed in terms of sines and cosines. The\nclosed-form solutions are expressed in terms of the Jacobian elliptic functions [1]\nsn.ujm/; cn.ujm/, and dn.ujm/ with argument u and parameter m.11 We define two\nsigns, s1 and s3 equal to?1, a dimensionless constant\n\n? ?\n?\nJ1.J3 ? J1/\nJ2.J3 ? J2/\n\n?1=2\n(3.117)\n\nand the angular rates\n\n!1m ?\n?\n2J3Ek ?H2\nJ1.J3 ? J1/\n\n?1=2\n(3.118a)\n\n!3m ?\n?\nH2 ? 2J1Ek\nJ3.J3 ? J1/\n\n?1=2\n(3.118b)\n\nThen\n\n!1.t/ D s1 !1m cn\n?\nu0 C !pt jm\n\n\t\n(3.119a)\n\n!2.t/ D ?s1? !1m sn\n?\nu0 C !pt jm\n\n\t\n(3.119b)\n\n!3.t/ D s3 !3m dn\n?\nu0 C !pt jm\n\n\t\n(3.119c)\n\nwhere\n\n!p D \u0152.J2 ? J3/=J1??s3 !3m (3.120)\nand\n\nm D .J2 ? J1/.2J3Ek ?H\n2/\n\n.J3 ? J2/.H2 ? 2J1Ek/ (3.121)\n\nNote that m D 0 for 2Ek D H2=J3, m D 1 for 2Ek D H2=J2, and Eq. (3.116)\nrestrictsm to always lie between these limits. Figure 3.5a shows the Jacobian elliptic\nfunctions for m D 0:7, which is the value for 2J2Ek D .16=17/H2 with the inertia\nratios used in Fig. 3.2b.\n\nThe Jacobian elliptic functions obey the differential equations\n\nsn0.ujm/ D cn.ujm/dn.ujm/ (3.122a)\ncn0.ujm/ D ?sn.ujm/dn.ujm/ (3.122b)\ndn0.ujm/ D ?m sn.ujm/cn.ujm/ (3.122c)\n\n11Some authors, including Hughes [14], use the modulus k ? m1=2 in place of the parameter.\n\n\n\n96 3 Attitude Kinematics and Dynamics\n\n0 2K 3K 4K\n?1\n\n?0.5\n\n0\n\n0.5\n\n1\n\n u\n\nsn(u|m)\n\ncn(u|m)\n\ndn(u|m)\n\nK 0 0.2 0.4 0.6 0.8 1\n1.5\n\n2\n\n2.5\n\n3\n\n3.5\n\nm\n\nK\n\na b\n\nFig. 3.5 Jacobian elliptic functions. (a) Elliptic functions for m D 0:7. (b) Dependence of the\nquarter-period K on m\n\nwhere the prime denotes differentiation with respect to the argument. These\nequations can be used to show that Eq. (3.119) obeys Eq. (3.93). The Jacobian\nelliptic functions also satisfy the quadratic relations\n\ncn2.ujm/C sn2.ujm/ D dn2.ujm/Cm sn2.ujm/ D 1; (3.123)\n\nwhich verify thatEk andH are the rotational kinetic energy and angular momentum\nmagnitude, respectively, of the solutions. The Jacobian elliptic functions are related\nto the usual trigonometric functions by\n\nsn.ujm/ D sin' (3.124a)\ncn.ujm/ D cos' (3.124b)\ndn.ujm/ D .1 ?m sin2 '/1=2 (3.124c)\n\nwhere ' is an implicit function of u and m defined by the integral relation\n\nu D\nZ '\n0\n\nd?\n\n.1 ?m sin2 ?/1=2 (3.125)\n\nThese equations lead directly to Eqs. (3.122) and (3.123). The quarter-period of\nthe sine or cosine function is \n=2, so the quarter-period of the Jacobian elliptic\nfunctions is\n\nK.m/ D\nZ \n=2\n0\n\nd?\n\n.1 ?m sin2 ?/1=2 (3.126)\n\nThis integral is known as a complete elliptic integral of the first kind [1]. Figure 3.5b\nshows that the quarter-period is an increasing function ofm, equal to \n=2 form D 0\nand becoming infinite as m goes to 1.\n\n\n\n3.3 Attitude Dynamics 97\n\nWe can use the addition formulas for the Jacobian elliptic functions to write\nthe triaxial solutions in terms of initial values. The addition formulas are, with the\nparameter m omitted for notational convenience,\n\nsn.uC v/ D snu cnv dnv C snv cnu dnu\n1 ?m sn2u sn2v (3.127a)\n\ncn.uC v/ D cnu cnv ? snu dnu snv dnv\n1 ?m sn2u sn2v (3.127b)\n\ndn.uC v/ D dnu dnv ?m snu cnu snv cnv\n1 ?m sn2u sn2v (3.127c)\n\nThe angular rates can then be written in terms of the initial values as\n\n!1.t/ D !01 cn.!pt/C \u0152.J2 ? J3/=J1?.!02!03=!p/sn.!pt/dn.!pt/\n1 ? \u0152.J2 ? J3/=J1?\u0152.J1 ? J2/=J3?.!02=!p/2sn2.!pt/ (3.128a)\n\n!2.t/ D !02 cn.!pt/dn.!pt/C \u0152.J3 ? J1/=J2?.!03!01=!p/sn.!pt/\n1 ? \u0152.J2 ? J3/=J1?\u0152.J1 ? J2/=J3?.!02=!p/2sn2.!pt/ (3.128b)\n\n!3.t/ D !03 dn.!pt/C \u0152.J1 ? J2/=J3?.!01!02=!p/sn.!pt/cn.!pt/\n1 ? \u0152.J2 ? J3/=J1?\u0152.J1 ? J2/=J3?.!02=!p/2sn2.!pt/ (3.128c)\n\nComparison with Eq. (3.93) suggests the alternative form\n\n!1.t/ D !01 cn.!pt/C . P!01=!p/sn.!pt/dn.!pt/\n1 ? !?2p . P!01=!03/. P!03=!01/sn2.!pt/\n\n(3.129a)\n\n!2.t/ D !02 cn.!pt/dn.!pt/C . P!02=!p/sn.!pt/\n1 ? !?2p . P!01=!03/. P!03=!01/sn2.!pt/\n\n(3.129b)\n\n!3.t/ D !03 dn.!pt/C . P!03=!p/sn.!pt/cn.!pt/\n1 ? !?2p . P!01=!03/. P!03=!01/sn2.!pt/\n\n(3.129c)\n\nbut neither form is especially convenient for computation.\nEquations (3.124) and (3.125) show that the Jacobian elliptic functions are equal\n\nto the usual trigonometric functions for m D 0:\nsn.uj0/ D sin u (3.130a)\ncn.uj0/ D cos u (3.130b)\ndn.uj0/ D 1 (3.130c)\n\nThey are equal to hyperbolic functions for m D 1:\nsn.uj1/ D tanh u (3.131a)\ncn.uj1/ D sech u (3.131b)\ndn.uj1/ D sech u (3.131c)\n\n\n\n98 3 Attitude Kinematics and Dynamics\n\nwhich give the solution for motion on the separatrices with 2Ek D H2=J2. These\nsolutions are not periodic, because the quarter-period is infinite for m D 1; they\napproach pure rotation about the principal axis e2 in the infinite past and future.\n\nThe speed at which the angular momentum vector moves over the sphere of\nradius H in the body frame is also given by Eq. (3.102) in the triaxial case,\nbut substituting Eq. (3.119) shows that the speed is not constant in this case.\nHowever, nice expressions can be found for the maximum and minimum speeds.\nThe maximum, reached when !2 D 0 or equivalently where the path of the angular\nmomentum crosses the plane perpendicular to e2, is\n\nk PHBkmax D .J3 ? J1/!1m!3m (3.132)\n\nThe minimum, reached when j!2j obtains its maximum value on the path, is\n\nk PHBk2min D .H2 ? 2J2Ek/.2J3Ek ?H2/=.J2J3/ (3.133)\n\nThe maximum speed has the same form as for an axisymmetric body, but the\nminimum speed is specific to the triaxial case. It is not difficult to see that\nthese equations give k PHBk D 0 for rotation about a principal axis, for which\n2Ek D H2=Jk .\n\nSolution of the kinematic equations proceeds in parallel with the axisymmetric\ncase. We again specify the attitude by 3?1?3 Euler angles and choose the inertial\nreference frame with its third axis in the direction of HI . Then Eq. (3.105) holds,\nand substituting Eq. (3.119) gives\n\n2\n4\nJ1 !1\nJ2 !2\nJ3 !3\n\n3\n5 D\n\n2\n4\ns1J1 !1m cn\n\n?\nu0 C !pt jm\n\n\t\n?s1J2? !1m sn\n\n?\nu0 C !pt jm\n\n\t\ns3J3 !3m dn\n\n?\nu0 C !pt jm\n\n\t\n\n3\n5 D H\n\n2\n4\n\nsin sin ?\ncos sin ?\n\ncos ?\n\n3\n5 (3.134)\n\nThus\n\ncos ? D .s3J3 !3m=H/dn\n?\nu0 C !pt jm\n\n\t\n(3.135a)\n\n D atan2 ?s1J1cn\n?\nu0 C !pt jm\n\n\t\n;?s1J2? sn\n\n?\nu0 C !pt jm\n\n\t\t\n(3.135b)\n\nThe third Euler angle is found by integrating Eq. (3.38) using Eq. (3.42):\n\nP? D csc ?.!1 sin C !2 cos / D H J1!\n2\n1 C J2!22\n\nJ 21 !\n2\n1 C J 22 !22\n\nD H J3 ? J2 C .J2 ? J1/sn\n2.u0 C !pt jm/\n\nJ1.J3 ? J2/C J3.J2 ? J1/sn2.u0 C !pt jm/ (3.136)\n\nThe quantities ?; P , and P? are all time-varying for triaxial inertia.\n\n\n\n3.3 Attitude Dynamics 99\n\nWe complete the analysis of motion for triaxial inertia by finding the components\nof the angular velocity in the inertial frame. These are given by Eq. (3.112).\nPerforming the matrix multiplications gives\n\nA.e1;??/A.e3;? /\n2\n4\n!1\n!2\n!3\n\n3\n5 D A.e1;??/\n\n2\n4\n.J2 ? J1/ !1!2=.H sin ?/\n.J1!\n\n2\n1 C J2!22/=.H sin ?/\n\n!3\n\n3\n5\n\nD 1\nH\n\n2\n4\n\n.J2 ? J1/ !1!2 csc ?\n.J 21 !\n\n2\n1 C J 22 !22/?1=2J1.J3 ? J1/!21m!3\n\n2Ek\n\n3\n5 (3.137)\n\nThe component of !BII parallel to HI has the constant value 2Ek=H , as required\nby Poinsot\u2019s construction and as we saw for axial symmetry. The component of\n!BII transverse to HI has a varying magnitude, so the herpolhode is not a circle.\nIn fact, the herpolhode is not a closed curve in general, because the motion of ? is\nnot commensurate with that of ? and  .\n\nIt is not difficult to see that all the equations for the triaxial case reduce to the\naxisymmetric results, with  0 D .u0 C s1\n=2/, if J1 D J2.\n\n3.3.5 Internal Torques\n\nAlthough some spacecraft can be modeled as a single rigid body, many are more\ncomplex. These complexities can be of several types. The first is that the spacecraft\nconsists of a number of rigid bodies connected by joints having one, two, or\nthree degrees of rotational freedom, and sometimes admitting sliding motion as\nwell. Powerful and general commercial software packages, many employing Kane\u2019s\nmethod [15, 16] are available to analyze the dynamics of these systems. We will\nonly treat the simple cases of reaction wheels and control moment gyros, the more\ncomplex systems being beyond the scope of this text.\n\nThe rigid model of a spacecraft will also be inadequate if we cannot ignore\nflexibility, which is always present at some level. Analysis of flexible body dynamics\ngenerally uses finite element methods [30], which are almost always applied to the\nanalysis of large spacecraft but are also beyond the scope of this text.\n\nA third complication often encountered is fluid motion, or slosh of liquid fuels\nor cryogens. We will only give a basic introduction to the treatment of slosh, with\nreferences to the literature.\n\nThese internal torques are also known as momentum exchange torques because\nthey result in, or are a result of, the exchange of angular momentum between\ncomponents of complex spacecraft without a change in the net system momentum of\nthe entire spacecraft. As the listing above indicates, some internal torques constitute\nundesirable disturbances, while others are provided by control mechanisms.\n\n\n\n100 3 Attitude Kinematics and Dynamics\n\n3.3.5.1 Reaction Wheels and Control Moment Gyros\n\nLet us consider a spacecraft with n reaction wheels or control moment gyros, labeled\nby an index `. Each wheel rotates about its spin axis with an angular velocity !w`\nwith respect to the body. The wheel is axially symmetric about its spin axis, so\nthe spin axis is a principal axis with principal moment of inertia J k` , and every axis\nperpendicular to the spin axis is a principal axis with moment J ??.12 Thus the inertia\ntensor of the `th wheel in the body reference frame is\n\nJ w` D J ??.I3 ? w`wT` /C J k` w`wT` (3.138)\n\nwhere the unit vector w` defines the spin axis in the body frame. Letting QJB\nrepresent the moment of inertia of the spacecraft without the wheels, the body\nframe representation of total angular momentum with respect to inertial space of\nthe spacecraft with its wheels is\n\nHB D QJB!BIB C\nnX\n`D1\n\nJ w` .!\nBI\nB C !w` w`/\n\nD JB!BIB CHwB (3.139)\n\nwhere\n\nJB ? QJB C\nnX\n`D1\n\nJ ??.I3 ? w`wT` / (3.140)\n\nand\n\nHwB D\nnX\n`D1\n\nJ\nk\n` .w` ?!BIB C !w` /w` ?\n\nnX\n`D1\n\nHw` w` (3.141)\n\nThe body moment of inertia JB is defined to include the inertia of the wheels\ntransverse to their spin axes, but not their inertia along their spin axes. Note that\nHwB denotes only the angular momentum of the wheels along their spin axes;\nthe momentum of their transverse rotation is included in JB!BIB . The difference\nbetween reaction wheels and control moment gyros is that w` is fixed and !w` is\nchanging for reaction wheels, while !w` is constant and w` is moved by a gimbal\n(or gimbals) for control moment gyros. Some control wheels have been designed to\nvary both w` and !w` , but these have not been widely employed.\n\n12This describes an ideal wheel. The effects of deviations from this ideal case will be discussed in\nSect. 4.8.\n\n\n\n3.3 Attitude Dynamics 101\n\nThe rotational dynamics of the spacecraft with wheels are still described by\nEq. (3.80) but with Eq. (3.79c) replaced by\n\n!BIB D J?1B .HB ?HwB/ (3.142)\nwhere the superscript c is understood but has been omitted for economy of\nnotation. For many attitude determination problems, !BIB and H\n\nw\nB can be computed\n\nfrom Eqs. (3.141) and (3.142) using tachometer data for reaction wheels or axis\norientation data for control moment gyros.13 To complete the dynamics analysis,\nhowever, a dynamic equation for HwB is required.\n\nThe rotational kinetic energy of a spacecraft with reaction wheels or control\nmoment gyros is given by\n\nEk D 1\n2\n.!BIB /\n\nT QJB !BIB C\n1\n\n2\n\nnX\n`D1\n.!BIB C !w` w`/T J w` .!BIB C !w` w`/\n\nD 1\n2\n.!BIB /\n\nT JB !\nBI\nB C\n\n1\n\n2\n\nnX\n`D1\n\nJ\nk\n` .w` ?!BIB C !w` /2\n\nD 1\n2\n.!BIB /\n\nT JB !\nBI\nB C\n\n1\n\n2\n\nnX\n`D1\n.J\n\nk\n` /\n\n?1.Hw` /2 (3.143)\n\nNow let us specialize to reaction wheels, which have been more commonly\nemployed in small to medium size spacecraft than control moment gyros. The\nrepresentations in the body frame of the angular momenta of the wheels are the\nterms in the sum in Eq. (3.139). It follows that the equation of motion of the `th\nwheel in the body frame, using Eq. (3.138), is\n\nJ w` . P!BIB C P!w` w`/D QLw` ?!BIB ?\u0152J w` .!BIB C !w` w`/?\nD QLw` C \u0152 J ??.w` ?!BIB / ?Hw` ?.!BIB ? w`/ (3.144)\n\nwhere QLw` is the applied torque. The other term on the right side of this equation is\nperpendicular to the spin axis; it is provided by the wheel bearings and is not under\nour direct control. Thus we are only interested in the spin axis component of the\ntorque, which is denoted by Lw` and is given by\n\nLw` D wT` J w` . P!BIB C P!w` w`/ D J k` .w` ? P!BIB C P!w` / D PHw` (3.145)\nThen Eq. (3.141) gives14\n\n13Giving !BIB D .JB C\nPn\n\n`D1 J\nk\n\n` w`w\nT\n` /\n\n?1.HB ?Pn`D1 J k` !w` w`/ and HwB D HB ? JB!BIB .\n14Including an !BIB ? HwB term in this equation would be double-counting, because this term was\nalready accounted for in Eq. (3.144). It can be seen explicitly in Eq. (3.147).\n\n\n\n102 3 Attitude Kinematics and Dynamics\n\nPHwB D\nnX\n`D1\nPHw` w` D\n\nnX\n`D1\n\nLw` w` ? LwB (3.146)\n\nWe find the generalization of Eq. (3.81) to include reaction wheels by substituting\nthis and Eq. (3.139) into Eq. (3.80), yielding\n\nP!BIB D J?1B \u0152LB ? LwB ?!BIB ? .JB!BIB CHwB/? (3.147)\nThe negative sign before LwB on the right side reflects Newton\u2019s third law of motion.\n\nThe rate of change of the kinetic energy is given by the derivative of Eq. (3.143),\n\nPEk D !BIB ? \u0152LB ? LwB ?!BIB ?HB?C\nnX\n`D1\n.w` ?!BIB C !w` /Lw`\n\nD !BIB ? LB C\nnX\n`D1\n\n!w` L\nw\n` (3.148)\n\nThis shows that the change in rotational kinetic energy is the sum of work done\nby the external torques and by the internal torques, a concrete illustration of the\nobservation made near the end of Sect. 3.3.1 that internal forces can modify the\nenergy of rotational motion.\n\n3.3.5.2 Slosh\n\nSpacecraft often contain fluids, the most common being propellants or cryogens\nfor cooling scientific instruments. The motion of these fluids, commonly called\nslosh, is often a source of undesirable attitude disturbances. Slosh is very difficult\nto analyze, and we will only provide a very brief introduction to some of the issues;\nthe monograph by Dodge provides a much more thorough discussion [8].\n\nFuel slosh can be a major problem for spin-stabilized spacecraft. In particular,\nthe energy dissipated by sloshing liquid can destabilize the motion of a spacecraft\nspinning about an axis of minimum MOI, as discussed in Sect. 3.3.3.2. Slosh is also\na problem for repointing maneuvers of fine-pointing spacecraft. A strong coupling\nof the fluid motion to the rigid spacecraft can cause large pointing errors. Weak\ncoupling of the fluid motion, on the other hand, leads to smaller pointing errors,\nbut the perturbations take a correspondingly longer time to damp out. The resulting\nlong resettling times after attitude maneuvers decrease the time available for fine-\npointing observations.\n\nThe main dynamic effects of slosh result from the motion of the center of\nmass of the moving fluid. This is usually represented by the mechanical model\nof a pendulum or a mass on a spring to represent the motion of the fluid, along\nwith some mechanism to provide damping. Dodge presents methods for computing\nthe frequencies and damping coefficients for fluid containers of various shapes,\nincluding a variety of baffles, diaphragms, and fluid management devices. The fill\nfactor of the container, the ratio of the amount of fluid contained to the capacity of\n\n\n\n3.3 Attitude Dynamics 103\n\nthe full tank, is a critical factor. Slosh is much less of a factor for a nearly full tank,\nbecause the center of mass cannot move much, or for a nearly empty tank, because\nthere is less moving mass.\n\nFluid motion in microgravity is different from motion under acceleration forces.\nThe relative importance of inertia forces, gravity forces, and capillary forces on fluid\nmotion are characterized by the Bond number, the Weber number, and the Froude\nnumber, while the Reynolds number determines the importance of viscosity. All\nthese considerations are important for providing a slosh model from first principles,\nbut it is quite common for the parameters in a slosh model to be determined\nempirically.\n\n3.3.6 External Torques\n\nExternal torques involve an interaction with entities external to the spacecraft.\nAs opposed to internal torques, external torques change the overall momentum\nof the spacecraft. In common with internal torques, external torques include both\nundesirable disturbance torques and torques deliberately applied for control.\n\n3.3.6.1 Gravity-Gradient Torque\n\nAny nonsymmetrical rigid body in a gravity field is subject to a gravity-gradient\ntorque. We compute this torque by summing the contributions of the gravitational\nforces on the various point masses constituting the rigid body as in Eq. (3.57). The\ngravitational force on the i th particle is\n\nFiext D mig.ri0/ D mi r rU.r/jrDri0 (3.149)\n\nwhere U.r/ is the gravity potential.15 Assuming that only first-order variations in\nthe gravitational field over the rigid body are significant allows us to expand in a\npower series, retaining only the first two terms:\n\nFiext D mig.ric C rc0/ D mi \u0152g.rc0/CG.rc0/ric ? (3.150)\n\nwhere\n\nG.rc0/ ? @g.r/\n@r\n\n??\n??\nrDrc0\n\nD @\n2U.r/\n@r @rT\n\n??\n??\nrDrc0\n\n(3.151)\n\n15As is customary in astrodynamics, this is the negative of the potential energy.\n\n\n\n104 3 Attitude Kinematics and Dynamics\n\nis the gravity-gradient tensor, evaluated at the center of mass. It follows from\nEq. (3.151) that the gravity-gradient tensor is a symmetric 3 ? 3 matrix.\n\nSubstituting into Eq. (3.57) gives the gravity-gradient torque about the center of\nmass as\n\nLcgg D\nnX\niD1\n\nmiric ?\n?\ng.rc0/CG.rc0/ric?\n\nD\n \n\nnX\niD1\n\nmiric\n!\n? g.rc0/C\n\nnX\niD1\n\nmiric ?\n?\nG.rc0/ric\n\n?\n\nD\nnX\niD1\n\nmiric ?\n?\nG.rc0/ric\n\n?\n(3.152)\n\nusing the property of the center of mass expressed in Eq. (3.55).\nIt is usually adequate to approximate the gravity field as spherically symmetric\n\nfor computing gravity-gradient torques. In this case, we have\n\ng.r/ D ??r\nr3\n\n(3.153)\n\nand therefore\n\nG.r/ D ? ?\nr3\n\n?\nI3 ? 3rr\n\nT\n\nr2\n\n?\n(3.154)\n\nwhere ? is the gravitational parameter of the central body, the product of its mass\nand Newton\u2019s universal gravitational constant, r is the radius vector from the center\nof the central body, and r ? krk. Inserting this into Eq. (3.152), letting rc0 D ?rn,\nwhere n is the body frame representation of a nadir-pointing unit vector, and using\nvarious identities for dot and cross products gives\n\nLcgg D ?\n?\n\nr3\n\nnX\niD1\n\nmiric ?\n?\nric ? 3nnT ric\t D ?3?\n\nr3\nn ?\n\nnX\niD1\n\nmi .ric/.ric/T n\n\nD 3?\nr3\n\nn ?\nnX\niD1\n\nmi\n?krick2I3 ? .ric/.ric/T\n\n?\nn D 3?\n\nr3\nn ? .J cn/ (3.155)\n\nwhere J c is the moment of inertia tensor about the center of mass. Several properties\nof the gravity-gradient torque are apparent from this equation: its magnitude is\ninversely proportional to the cube of the distance from the center of the central\nbody, its direction is perpendicular to the radius vector from the central body, and it\nvanishes if the radius vector is along any principal axis of inertia.\n\nTo investigate the gravity-gradient torque in more detail, consider a spacecraft\norbiting the Earth (or any celestial body) and oriented to the nadir. We represent the\n\n\n\n3.3 Attitude Dynamics 105\n\nattitude relative to the LVLH frame16 by a 3?2?1 Euler angle sequence of yaw D ?,\npitch D ? , and roll D  angles. The nadir vector is the e3 axis in the LVLH frame,\nso the nadir vector in the body frame is given by Eq. (2.164) as\n\nn D A321.?; ?;  /\n2\n4\n0\n\n0\n\n1\n\n3\n5 D\n\n2\n4\n? sin ?\n\ncos ? sin \ncos ? cos \n\n3\n5 (3.156)\n\nSubstituting this into Eq. (3.155) and assuming that the body frame is a principal\naxis frame gives\n\nLcgg D\n3?\n\nr3\n\n2\n4\n.J3 ? J2/ cos2 ? cos sin \n.J3 ? J1/ cos ? sin ? cos \n.J1 ? J2/ cos ? sin ? sin \n\n3\n5 (3.157)\n\nWe notice that the torque does not depend on the yaw angle, which is one of the\nreasons for choosing a 3?2?1 sequence to specify the attitude.17 The yaw angle\ncan be quite large for some missions, with 180? yaw maneuvers used to keep one\nside of the spacecraft cool by facing it away from the Sun. The roll and pitch angles\nare usually small, though, and almost certainly less than 90? in magnitude. It is\nclear that the gravity-gradient torque vanishes if the roll and pitch are both zero, so\nthis is an equilibrium configuration. For small pitch and roll angles, the third (yaw)\ncomponent of the gravity-gradient torque is small, so we will not be concerned\nwith it. Comparing Eqs. (3.156) and (3.157) shows that the first (roll) component\nof the gravity-gradient torque will drive the roll angle toward zero if J3 < J2 and\naway from zero if J3 > J2. Similarly, the second (pitch) component of the gravity-\ngradient torque will drive the pitch angle toward zero if J3 < J1 and away from zero\nif J3 > J1. Thus the equilibrium at zero roll and pitch is a stable equilibrium if J3\nis the smallest principal moment, otherwise the equilibrium is unstable for rotations\nabout one or both axes. Another way of stating this is that gravity-gradient torque\nwill tend to align a spacecraft with its principal axis of minimum inertia aligned\nwith the nadir vector.\n\nGravity-gradient torques are often used for passive stabilization of a spacecraft.\nA gravity-gradient boom with a mass at the end can be deployed along the positive\nor negative yaw axis to increase the J1 and J2 moments of inertia relative to\nthe J3 inertia about the desired nadir-pointing axis. The boom deployment must\nbe carefully timed to avoid an inverted orientation, with the desired nadir-pointing\naxis pointing in the zenith direction. Pendular motions, known as libration, can\nbe damped out by energy-dissipating libration dampers, which are very similar in\ndesign and function to nutation dampers. Finally, we note that the gravity-gradient\ntorque cannot provide stability against rotations around the nadir vector. These are\ncontrolled either by active means or by employing a momentum wheel to provide a\n\n16The LVLH frame is defined in Sect. 2.6.4.\n17A 3?1?2 sequence would serve as well.\n\n\n\n106 3 Attitude Kinematics and Dynamics\n\nmomentum bias along the pitch axis. Issues arising from the deployment of gravity-\ngradient booms are described on pp. 669\u2013677 of [19].\n\nTo handle cases more general than a spherically symmetric gravity field, we can\nuse Eq. (2.56c) to find an expression for the gravity-gradient torque for a general\ngravity-gradient tensor. This identity gives, suppressing the argument of G for\nnotational convenience,\n\n\u0152Lcgg?? D\nnX\niD1\n\nmi \u0152.ric ?Gric/?? D\nnX\niD1\n\nmi \u0152Gric.ric/T ? ric.Gric/T ?\n\nD\nnX\niD1\n\nmi\n?krick2I3 ? .ric/.ric/T\n\n?\nGT ?G\n\nnX\niD1\n\nmi\n?krick2I3 ? .ric/.ric/T\n\n?\n\nD .GJ c/T ?GJ c (3.158)\n\nmaking use of Eq. (2.7c) and the fact that both G and J c are symmetric.\n\n3.3.6.2 Magnetic Torque\n\nThe torque generated by a magnetic dipole m in a magnetic field B is\n\nLmag D m ? B (3.159)\n\nThe most basic source of a magnetic dipole is a current loop. A current of I amperes\nflowing in a planar loop of area A produces a dipole moment of magnitudem D IA\nin the direction normal to the plane of the loop and satisfying a right-hand rule.\nIt follows from this definition that the natural unit for the dipole moment is Am2.\nWhen m is in Am2 and the magnetic field is specified in Tesla, Eq. (3.159) gives\nthe torque in Nm. If there are N turns of wire in the loop, the dipole moment\nhas magnitude m D NIA. The dipole moment can be significantly increased\nby wrapping the wire loops around a ferromagnetic core, as will be discussed in\nSect. 4.10.\n\nMagnetic control torques are used almost exclusively in near-Earth orbits, where\nthe magnitude of the Earth\u2019s magnetic field is roughly in the range of 20\u201350 ?T.\nCommercially available torquers can provide dipole moments from 1 to 1,000 Am2,\nso the resulting magnetic control torques range from 2 ? 10?5 to 0.05 Nm.\nAs described in Sect. 11.1, the field strength falls off as the inverse cube of the\ndistance from the center of the Earth, so magnetic control has rarely been employed\nin higher orbits, but it has sometimes been used even in geosynchronous orbits.\nUndesirable magnetic dipoles can lead to magnetic disturbance torques, which are\ngenerally several orders of magnitude smaller than the above estimates of control\ntorques.\n\nIt is customary to express Lmag, m, and B in body-frame coordinates. There\nare two ways to determine the body-frame magnetic field. The first employs\n\n\n\n3.3 Attitude Dynamics 107\n\nmeasurements by an onboard three-axis magnetometer (TAM), as described in\nSect. 4.5. The other method is to compute the magnetic field vector, R, in reference-\nframe coordinates from a model, either a simple dipole model, the International\nGeomagnetic Reference Field (IGRF), or some truncated version of the IGRF, as\ndescribed in Sect. 11.1. The attitude matrix then rotates the field to the body frame\nby B D AR. In addition to an attitude estimate, this method requires an onboard\nephemeris, which in modern spacecraft would be provided by GPS, as well as an\nonboard magnetic field model.\n\nOne advantage of magnetic torques is that they produce no force, so they do\nnot perturb the spacecraft\u2019s orbit. A significant disadvantage is that the torques are\nconstrained to lie in the plane orthogonal to the magnetic field, as is clear from\nEq. (3.159), so only two out of three axes can be controlled at a given time instant.\nHowever, full three-axis control is available over a complete orbit provided that\nthe spacecraft\u2019s orbital plane does not coincide with the geomagnetic equatorial\nplane and does not contain the magnetic poles [3]. The Earth\u2019s rotation causes this\ngeometry to change, so any simulation involving magnetic control should be at least\n24 h in length to ensure that unfavorable magnetic field geometry does not cause a\nproblem at some point.18\n\nBecause magnetic torques cannot provide three-axis control at any instant of\ntime, they are generally employed in conjunction with some other form of attitude\ncontrol. This can be passive control, such as spin stabilization [9, 11, 13, 23] or\ngravity-gradient stabilization [7,28,29], but it is more common to employ magnetic\ncontrol in conjunction with reaction wheels. In this application, the wheels provide\nthe actual pointing and maneuvering torques, and magnetic torques are used to\nunload the secular angular momentum buildup in the wheels. Reference [6] provides\nan analysis of the orbit-averaged behavior of magnetic control for unloading angular\nmomentum. Some specific examples of magnetic control laws can be found in\nChap. 7.\n\n3.3.6.3 Aerodynamic Torque\n\nFor objects in low-Earth orbit, atmospheric drag is a significant source of perturbing\ntorque. Aerodynamic torque is generally computed by modeling the spacecraft as a\ncollection of N flat plates of area Si and outward normal unit vector niB expressed\nin the spacecraft body-fixed coordinate system. The torque depends on the velocity\nof the spacecraft relative to the atmosphere. This is not simply the velocity of the\nspacecraft in the GCI frame, because the atmosphere is not stationary in that frame.\nThe most common assumption is that the atmosphere co-rotates with the Earth. The\nrelative velocity in the GCI frame is then given by\n\nvrelI D vI C \u0152!?I?? rI (3.160)\n\n18This point was often emphasized by Henry Hoffman of Goddard Space Flight Center.\n\n\n\n108 3 Attitude Kinematics and Dynamics\n\nwhere rI and vI are the position and velocity of the spacecraft expressed in the GCI\ncoordinate frame. The Earth\u2019s angular velocity vector is !?I D !?\u01520 0 1?T with\n!? D 0:000 072 921 158 553 rad/s. Inserting this !?I gives the relative velocity\nin the body frame as\n\nvrelB D A\n2\n4\nPx C !? y\nPy ? !? x\nPz\n\n3\n5 (3.161)\n\nwhereA is the attitude matrix. The inclination of the i th plate to the relative velocity\nis given by\n\ncos ?iaero D\nniB ? vrelB\nkvrelk (3.162)\n\nThe aerodynamic force on the i th plate in the flat plate model is\n\nFiaero D ?\n1\n\n2\n? CDkvrelkvrelB Si max\n\n?\ncos ?iaero; 0\n\n\t\n(3.163)\n\nwhere ? is the atmospheric density and CD , is a dimensionless drag coefficient. The\ndrag coefficient is determined empirically, and is usually in the range between 1.5\nand 2.5. Methods for computing the atmospheric density are presented in Sect. 11.2.\n\nThe aerodynamic torque on the spacecraft is then\n\nLiaero D\nNX\niD1\n\nri ? Fiaero (3.164)\n\nwhere ri is the vector from the spacecraft center of mass to the center of pressure of\nthe i th plate. Note this algorithm does not account for potential self-shielding that\nwould exist on concave spacecraft.\n\nIn principle, aerodynamic torques could be used for attitude control, either for\npassive control like the feathers on an arrow, or even for active control by providing\nmovable surfaces. Applications of this concept have been exceedingly rare, however.\n\n3.3.6.4 Solar Radiation Pressure Torque\n\nSolar radiation pressure (SRP) is another source of disturbance torque. In low-\nEarth orbit, the effect of SRP is dominated by aerodynamics, but SRP torques will\ngenerally dominate aerodynamic torques in higher altitude orbits (?800 km). The\nSRP torque is zero when the spacecraft is in the shadow of the Earth or any other\nbody, of course. In contrast to the case of aerodynamic torques, movable surfaces\nhave been used on some spacecraft in geosynchronous orbits to balance the SRP\ntorques. In most applications, the surfaces have been moved by daily commands,\nand not controlled autonomously or in real time by an onboard computer [12].\n\n\n\n3.3 Attitude Dynamics 109\n\nAs for aerodynamic torque, we model the surface of the spacecraft as a\ncollection of N flat plates of area Si , outward normal niB in the body coordinate\nframe, specular reflection coefficient Rispec, diffuse reflection coefficient R\n\ni\ndiff, and\n\nabsorption coefficient Riabs. Diffuse reflection is assumed to be Lambertian, which\nmeans that the intensity of the reflected light in any direction is proportional to the\ncosine of the angle between the reflection direction and the normal. The coefficients\nsum to unity; Rispec CRidiff CRiabs D 1.\n\nThe spacecraft-to-Sun unit vector in the body frame is\n\ns D A esat? (3.165)\nwhere A is the attitude matrix and esat? is the spacecraft-to-Sun vector in the GCI\nframe. The angle between the Sun vector and the normal to the i th plate is given by\n\ncos ?iSRP D niB ? s (3.166)\nThe SRP force on the i th plate can then be expressed as [26]\n\nFSRPD?P?Si\n?\n2\n\n?\nRidiff\n3\nCRispec cos ?iSRP\n\n?\nniBC.1 ?Rispec/s\n\n?\nmax\n\n?\ncos ?iSRP; 0\n\n\t\n\n(3.167)\n\nwhere P? is the solar radiation pressure. Section 11.3 present methods for comput-\ning the Sun position, solar radiation pressure, and conditions for shadowing.\n\nThe SRP torque on the spacecraft is then\n\nLiSRP D\nNX\niD1\n\nri ? FiSRP (3.168)\n\nwhere ri is the vector from the spacecraft center of mass to the center of pressure of\nthe SRP on the i th plate.\n\nThis formulation has several limitations. First, the Sun is not the only source of\nradiation, although it is by far the largest for Earth-orbiting spacecraft. Reflected\nlight from the Earth or the Moon, called albedo, can be significant if very precise\ndynamical modeling is required; and models incorporating this effect have been\ndeveloped [4].\n\nSecondly, the torque due to thermal radiation emitted from the spacecraft has\nbeen ignored. A spacecraft is usually in a long-term energy balance, so all the\nabsorbed radiation is emitted as thermal radiation, although not necessarily at\nthe same time or from the same surface as its absorption. Accurate modeling of\nthermal radiation requires knowledge of the absolute temperature Ti and emissivity\n\ni (a dimensionless constant between 0 and 1) of each surface. Then the thermal\nradiation flux from the surface is given by the Stefan-Boltzmann law\n\nF ithermal D \ni?T 4i (3.169)\n\n\n\n110 3 Attitude Kinematics and Dynamics\n\nwhere ? D 5:67?10?8 Wm?2K?4 is the Stefan-Boltzmann constant. If the thermal\nradiation from every surface is Lambertian, it gives rise to a net torque\n\nLthermal D ?2\n3\n\nNX\niD1\n\nF ithermalSi .r\ni ? niB/ (3.170)\n\nThermal radiation torque can usually be neglected because the thermal flux is\nemitted roughly equally in all directions, so that the net torque is small.\n\nFinally, Eqs. (3.168) and (3.170) ignore potential self-shadowing of concave\nspacecraft. If the configuration of the spacecraft is known a priori, self-shadowing\ncan be taken into account by replacing Si with the area of the flat plate that is\nvisible to the Sun after accounting for shadowing. Modeling the effects of reflected\nradiation or thermal radiation from one surface striking another surface is an\nadditional complication. Another drawback to Eq. (3.167) is that it is only valid\nfor a collection of flat surfaces with uniquely defined outward normals. Most real\nspacecraft have some curved surfaces, and accurately approximating these surfaces\nby a collection of flat plates causes the size of the model to grow, increasing the\ncomputational burden.\n\n3.3.6.5 Mass-Expulsion Torques\n\nTranslational momentum is the productmv of mass and velocity. We generally think\nof a force producing a rate of change of momentum mPv. Mass-expulsion forces, on\nthe other hand, are the result of a change of momentum Fmexp D ? Pmvrel, where Pm\nis the rate at which mass is expelled, and vrel is the velocity of the expelled mass\nrelative to the spacecraft. Newton\u2019s third law of motion gives the negative sign,\nbecause this is a reaction force on the spacecraft. Another way to state this is to say\nthat the mass-expulsion force reflects the conservation of momentum of the system\nconsisting of the spacecraft and the expelled mass. Mass-expulsion forces provided\nby thrusters can be used to adjust the trajectories of spacecraft that require such\ncorrections.\n\nA mass-expulsion force will generally be accompanied by a torque\n\nLmexp D r ? Fmexp D ? Pm r ? vrel (3.171)\n\nwhere r is the vector from the spacecraft center of mass to the point where the\nmass is expelled. Undesirable mass-expulsion torques during orbit maneuvers can\nbe minimized either by requiring the line of action of the thrust to pass through the\nspacecraft\u2019s center of mass or by using multiple thrusters whose torques cancel. It\nis impossible in practice to ensure exact cancelation, however.\n\nThrusters can also be used specifically as sources of torque. Attitude control\nthrusters are generally much smaller than orbit adjustment thrusters, because atti-\ntude control requires less force. An advantage of using thrusters for attitude control\n\n\n\n3.3 Attitude Dynamics 111\n\nis that they can be used anywhere, unlike magnetic torquers or gravity-gradient\nbooms that require an ambient magnetic or gravitational field. They have the\ndisadvantage of requiring expendable propellant, which can often be the element\nlimiting the lifetime of a mission. Another disadvantage is that attitude control\nthrusters are accompanied by orbit-perturbing forces unless their forces are arranged\nin exact couples, equal and opposite pairs, which are impossible to attain in practice.\n\nUse of thrusters for attitude control will be considered in more detail in Sect. 4.11\nand Chap. 7, so this section will concentrate on mass-expulsion torques as a\ndisturbance source. One source already mentioned is residual torques from orbit\nmaneuvers, which can result from thruster misalignments or from impingement of\nthruster plumes on the spacecraft structure. Other common sources are outgassing\nof water vapor from the spacecraft structure during early stages of a mission or\nventing of cryogens. These can be minimized by arranging the vents to provide\ncancelation of the torques. Disturbances can also result from leaks of fuel, fuel\npressurizing agents, or air from pressurized compartments, as on the International\nSpace Station [18].\n\nThe Wilkinson Microwave Anisotropy Probe (WMAP) provided an interesting\nexample of a mass-expulsion torque [25]. WMAP had a warm Sun-facing side and\na cold side separated by a Sun shield of radius 2.5 m (see Fig. 7.4). Shortly after\nlaunch, WMAP executed three highly elliptical orbits with periods of approximately\n7 days and with perigees on the sunlit side of the Earth. WMAP\u2019s attitude was\ninertially fixed prior to planned orbit adjustments at the perigees. About 40 min\nbefore the first perigee passage, the spacecraft angular momentum began to increase,\npeaking at about 2 Nms approximately 20 min before perigee and then decreasing.\nVarious mechanisms for this anomalous torque were considered and rejected. The\nfinal explanation was that water vapor outgassing from the spacecraft had condensed\non the cold side of the Sun shield as ice while WMAP was on the dark side of the\nEarth and had sublimated, first from one half of the Sun shield and then from the\nother, when the cold side was subjected to reflected sunlight from the Earth near\nperigee. The average velocity of the sublimated water molecules was estimated,\nassuming a temperature of 150 K, to be\n\nvrel D\np\n2kBT=mH2O D 370 m/s (3.172)\n\nwhere kB D 1:38? 10?23 J/K is the Boltzmann constant andmH2O D 3? 10?26 kg\nis the mass of a water molecule. Assuming an average lever arm of R D 1:1 m, the\nquantity of sublimated ice required to explain the anomalous torque is only ?m D\n?H=R vrel D 5 g.\n\n3.3.7 Angular Momentum for Health Monitoring\n\nWe have emphasized that internal momentum-exchange torques can lead to\nrapid variation of a spacecraft\u2019s angular velocity, but not of the system angular\nmomentum. This insight led to an application of angular momentum conservation\n\n\n\n112 3 Attitude Kinematics and Dynamics\n\nfor spacecraft failure detection [21]. A computer onboard the Hubble Space\nTelescope (HST) calculates the total system angular momentum HB by means\nof Eqs. (3.139)\u2013(3.141), with the angular velocity being sensed by the gyros and the\nwheel angular momentum computed using wheel tachometer data. The high torque\nof the reaction wheels can cause both the wheel angular momentum and the body\nangular momentum to change rapidly, but their vector sum only changes slowly.\nSubtracting easily computable gyroscopic, magnetic, and gravity-gradient torques\nfrom the rate of change of the computed system momentum gives an apparent\ndisturbance torque:\n\nLdisturbance D PHB C! ?HB ?m ? B ? Lgg (3.173)\n\nwith all the vectors computed in the spacecraft body frame. A large value of this\ndisturbance torque indicates a failure of either a reaction wheel tachometer or\na gyro. A tachometer failure could be identified by an independent test, so this\nangular momentum test was implemented onboard HST to identify gyro failures.\nThe test initiated entry to a gyroless safehold mode three times in late 2002 and\nearly 2003 [22].\n\n3.3.8 Dynamics of Earth-Pointing Spacecraft\n\nA great many spacecraft are pointed at the Earth to study its weather, climate, and\nresources. Thus it is useful to consider the special case of Earth-pointing spacecraft,\nwhose body axes are closely aligned with the LVLH frame defined in Sect. 2.6.4.\nThe attitude ABO specifying the orientation of the spacecraft body axes to the axes\nof the LVLH frame, denoted by index O , is conveniently described by a 3?2?1\nEuler sequence of yaw D ?, pitch D ? , and roll D  angles.\n\nThe dynamic equations give the motion relative to an inertial frame, so we write\nABI D ABOAOI and use the Eq. (3.12) with the appropriate assignment of frame\nindices to find !BIB . The matrix ABO is given by Eq. (2.164), so Eq. (3.43) gives the\ncomponents of!BOB . The matrixAIO is given by Eq. (2.79), so Eq. (3.3) can be used\nto find the angular velocity of the O frame with respect to the I frame:\n\n?\u0152!OIO ?? D PAOIATOI D PATIOAIO D\n2\n4\nPoT1I\nPoT2I\nPoT3I\n\n3\n5?o1I o2I o3I\n\n?\n\nD\n2\n4\nPo1I ? o1I Po1I ? o2I Po1I ? o3I\nPo2I ? o1I Po2I ? o2I Po2I ? o3I\nPo3I ? o1I Po3I ? o2I Po3I ? o3I\n\n3\n5 (3.174)\n\nConsidering the derivatives of oiI ?ojI D ?ij confirms that this 3?3matrix is skew-\nsymmetric. The inner products are frame-independent, but the subscript I is needed\n\n\n\n3.3 Attitude Dynamics 113\n\nto specify the frame used for differentiation. We substitute Eq. (2.78) and carry out\nsome tedious but straightforward vector algebra to find the angular velocity of the\nLVLH frame relative to the inertial frame as\n\n!OIO D\n2\n4\n?Po3I ? o2I\nPo3I ? o1I\n?Po2I ? o1I\n\n3\n5 D\n\n2\n4\n\n. Pg3rI C g3vI / ? o2I\n?. Pg3rI C g3vI / ? o1I\n\n. Pg2 rI ? vI C g2 rI ? PvI / ? o1I\n\n3\n5\n\nD\n2\n4\n\n0\n\n?krI ? vIk=krIk2\nkrIk.o2I ? PvI /=krI ? vIk\n\n3\n5 (3.175)\n\nThe roll component of this angular velocity is zero, and the yaw component is also\nzero if the spacecraft\u2019s acceleration PvI is perpendicular to o2I , as it is for a purely\ncentral force. As shown in Sect. 10.4.3, a non-central force causes the orbit plane to\nprecess, producing a small but finite yaw rotation rate. The pitch component of !OIO\nis by far the largest.\n\nWe can obtain the attitude motion in the general case by solving the dynamic\nequations from Sect. 3.3.2 with !BIB given by the procedure described above.\nHowever, it is useful to study the special case of uncontrolled attitude motion in\na nearly circular Keplerian orbit with only small excursions from perfect alignment\nwith the LVLH coordinate frame. Applying Eqs. (10.32), (10.39), (10.40), (10.15),\nand (10.43) of Chap. 10 to the pitch component of !OIO shows that\n\nkrI ? vIk=krIk2 D n.1 ? e2/?3=2.1C e cos ?/2 (3.176)\nwhere n is the mean motion, e is the eccentricity, ? is the true anomaly. Now\nwe ignore all terms of higher than first order in the Euler angles, their rates,\nand the eccentricity, and we approximate the cosines of the Euler angles by\nunity and their sines by the angles themselves. With these approximations,\nEqs. (3.12), (3.43), (2.164), and (3.176) give\n\n!BIB D !BOB ? krI ? vIk=krIk2\n2\n4\n\ncos ? sin?\ncos cos? C sin sin ? sin?\n? sin cos? C cos sin ? sin?\n\n3\n5\n\n?\n2\n4\nP \nP?\nP?\n\n3\n5 ? n.1C 2e cos ?/\n\n2\n4\n?\n\n1\n\n? \n\n3\n5 ?\n\n2\n4\n\nP ? n?\nP? ? n.1C 2e cos ?/\n\nP? C n \n\n3\n5 (3.177)\n\nThe first and third components of this equation exhibit the phenomenon of roll/yaw\ncoupling. If we assume that the roll and yaw components of !BIB are exactly zero,\nwe have P D n? and P? D ?n , with the solution\n\n .t/ D  .t0/ cos n.t ? t0/C ?.t0/ sinn.t ? t0/ (3.178a)\n?.t/ D ?.t0/ cos n.t ? t0/ ?  .t0/ sinn.t ? t0/ (3.178b)\n\n\n\n114 3 Attitude Kinematics and Dynamics\n\nDirection of\nMotion\n\nOrbital\nPlane\n\nH\n\nH\n\nFig. 3.6 Roll/yaw coupling\n\nThus a positive yaw becomes a positive roll one quarter orbit later and a negative\nyaw a quarter orbit after that, etc., which is why roll/yaw coupling is also known\nas quarter-orbit coupling. Figure 3.6 illustrates this effect, where H indicates the\norientation of the spacecraft\u2019s total rotational angular momentum, which is assumed\nto be directed along the spacecraft\u2019s negative pitch axis but not exactly perpen-\ndicular to the orbit plane. Angular momentum conservation keeps the direction\nof this momentum fixed in inertial space, thereby ensuring that the roll and yaw\ncomponents of !BIB remain small.\n\nLet us now investigate the dynamic equations of motion, assuming that a reaction\nwheel, or possibly a combination of several wheels, provides a constant angular\nmomentum bias h along the pitch axis. This is a common method for enhancing\nthe roll/yaw coupling effect. Differentiating Eq. (3.177) and substituting Eq. (3.147)\nwith LwB D 0 as required by Eq. (3.146) gives\n\n2\n4\n\nR ? n P?\nR? C 2en2 sin ?\nR? C n P \n\n3\n5 D J?1B \u0152LB ?!BIB ? .JB!BIB C he2/? (3.179)\n\nThis makes the further approximation P? D n, ignoring terms that would be of order\ne2 in Eq. (3.179). Next assume that the body axes are principal axes and that the\nonly significant external torque is the gravity-gradient torque, given by Eq. (3.157).\nApplying Eqs. (10.20) and (10.43) of Chap. 10 shows that\n\n?\n\nr3\nD n2\n\n?\n1C e cos ?\n1 ? e2\n\n?3\n(3.180)\n\nWe make the small-angle approximation for the trigonometric functions and ignore\nproducts of the eccentricity and the small angles, giving\n\nLB D Lgg D 3n2\n2\n4\n.J3 ? J2/ \n.J3 ? J1/?\n\n0\n\n3\n5 (3.181)\n\n\n\n3.3 Attitude Dynamics 115\n\nSubstituting Eq. (3.177) for the components of !BIB on the right side of Eq. (3.179),\nignoring second-order terms in small quantities, and collecting terms gives\n\nJ1 R D n\u01524n.J3 ? J2/C h? C \u0152n.J1 ? J2 C J3/C h? P? (3.182a)\nJ2 R? D 3n2.J3 ? J1/? ? 2en2J2 sin ? (3.182b)\nJ3 R? D n\u0152n.J1 ? J2/C h?? ? \u0152n.J1 ? J2 C J3/C h? P (3.182c)\n\nThe first property of these equations to notice is that pitch motion is decoupled\nfrom the roll and yaw motion. The pitch equation gives unstable motion with linear\ngrowth if J1 D J3 and unstable motion with exponential growth if J1 < J3, so pitch\nstability demands that J1 > J3. With the approximation P? D n, the solution for\nJ1 > J3 is found to be\n\n? D ?lib cos.!libt C ?/C 2en\n2\n\nn2 ? !2lib\nsin ? (3.183)\n\nwhere ?lib and ? are constants of integration, and\n\n!lib D n\np\n3.J1 ? J3/=J2 (3.184)\n\nis the libration frequency. The first term on the right side of Eq. (3.183) is the\nlibration term, describing a pendular motion at the libration frequency. The second\nterm gives a sinusoidal error at the orbit rate in a non-circular orbit, a result of\nthe conflicting tendencies of rotational inertia to keep the pitch rate constant and\nof gravity-gradient torque to keep the yaw axis pointing along the nadir. This term\ngrows very large near the pitch resonance case of!lib D n, which must be avoided.19\nIts amplitude for the GEOS-3 spacecraft, with e D 0:0054, was 0.03? [27].\n\nNow consider the roll/yaw dynamics expressed in Eqs. (3.182a) and (3.182c).\nThe general solution of these two coupled second-order linear differential equation\nis a superposition of four components of the form\n\n?\n .t/\n\n?.t/\n\n?\nD\n?\n .0/\n\n?.0/\n\n?\nest (3.185)\n\nwith coefficients satisfying initial conditions. Substituting Eq. (3.185) into the\nroll/yaw dynamics gives a result expressible in matrix form as\n\n?\nJ1s\n\n2 C n\u01524n.J2 ? J3/ ? h? \u0152n.J2 ? J1 ? J3/ ? h?s\n?\u0152n.J2 ? J1 ? J3/ ? h?s J3s2 C n\u0152n.J2 ? J1/ ? h?\n\n? ?\n .0/\n\n?.0/\n\n?\nest D 0\n\n(3.186)\n\n19In the exact resonance case, Eq. (3.182b) has the growing solution ? D ent cos ?.\n\n\n\n116 3 Attitude Kinematics and Dynamics\n\nThis has a nontrivial solution only if the determinant of the 2 ? 2 matrix is zero,\nwhich means that\n\nJ1J3s\n4 C bs2 C c D 0 (3.187)\n\nwhere\n\nb D \u0152n.J2 ? J1 ? J3/ ? h?2 C nJ3\u01524n.J2 ? J3/ ? h?C nJ1\u0152n.J2 ? J1/ ? h?\n(3.188a)\n\nc D n2\u01524n.J2 ? J3/ ? h?\u0152n.J2 ? J1/ ? h? (3.188b)\n\nStable motion in roll and yaw requires that none of the roots of Eq. (3.187) has a\npositive real part. It is clear that if s is a root, then ?s is also a root, so stability\nrequires all the roots to be purely imaginary numbers. The well-known solution of\nEq. (3.187) is\n\n2J1J3s\n2 D ?b ?\n\np\nb2 ? 4J1J3c (3.189)\n\nBoth of the solutions, s2, of Eq. (3.189) must be real and negative, with purely\nimaginary square roots, for roll/yaw stability. This will hold if and only if\n\nc > 0 and b ? 2\np\nJ1J3c (3.190)\n\nThe first of these conditions is easier to satisfy; we see from Eq. (3.188b) that it\nrequires\n\nh > nmax .4.J2 ? J3/; .J2 ? J1// or (3.191a)\nh < nmin .4.J2 ? J3/; .J2 ? J1// (3.191b)\n\nThe second condition is harder to analyze, but a large enough positive or negative\nmomentum bias h can provide roll/yaw stabilization for any moments of inertia,\nbecause b tends asymptotically to h2, while c is asymptotic to n2h2. In this\nasymptotic limit Eq. (3.189) becomes\n\n2J1J3s\n2 D ?h2\n\n\n1?\n\np\n1 ? 4J1J3n2=h2\n\n?\n? ?h2\u01521? .1 ? 2J1J3n2=h2/?\n\n?\n(\n?2h2\n?2J1J3n2\n\n(3.192)\n\nComparison of the first root, ! D p?s2 D h=pJ1J3, with Eq. (3.109) identifies\nthis as a nutation frequency. The second root gives ! D n, the frequency of the\nquarter-orbit roll/yaw coupling. These two frequencies do not separate as cleanly\nfor general moments of inertia and bias angular momentum.\n\n\n\n3.3 Attitude Dynamics 117\n\n?1 ?0.75 ?0.5 ?0.25 0 0.25 0.5 0.75 1\n?1\n\n?0.75\n\n?0.5\n\n?0.25\n\n0\n\n0.25\n\n0.5\n\n0.75\n\n1\n\nJ3<J1<J2\n\nDD\n\nFig. 3.7 Stability region map for gravity-gradient stabilization. Unshaded areas are regions of\nstable motion. The label DD identifies the DeBra-Delp region. Areas with horizontal hatching are\nunstable in roll and yaw; those with vertical hatching are unstable in pitch. The dotted line is the\nlocus of the pitch orbital eccentricity resonance\n\nWe now investigate stability in the case of h D 0, a spacecraft with only gravity-\ngradient stabilization, which has been analyzed in detail. In this case, Eq. (3.188)\nreduces to\n\nb D J1J3n2.1C 3?1 C ?1?3/ (3.193a)\nc D 4J1J3n4?1?3 (3.193b)\n\nwhere\n\n?1 ? .J2 ? J3/=J1 and ?3 ? .J2 ? J1/=J3 (3.194)\n\nThe triangle inequality for principal moments of inertia, Eq. (3.73), implies that\n?1 < ?1 < 1 and ?1 < ?3 < 1. Note that ?1 D 0 for axially-symmetric inertia\nabout the roll axis, ?3 D 0 for symmetry about the yaw axis, and ?1 D ?3 for\nsymmetry about the pitch axis.\n\nFigure 3.7 shows the stability regions in terms of these variables in the h D 0\ncase. The requirements for roll/yaw stability in this case are simply\n\n?1?3 > 0 and 1C 3?1 C ?1?3 ? 4p?1?3 (3.195)\n\n\n\n118 3 Attitude Kinematics and Dynamics\n\nThese two requirements together demand that ?1 > ?1=3. Squaring the second\nrequirement and collecting terms gives the quadratic inequality\n\n.3C ?3/2?21 C 2.3 ? 7?3/?1 C 1 ? 0 (3.196)\n\nThe roots of the equality are\n\n?1 D .3C ?3/?2\u0152.7?3 ? 3? 4\np\n3?3.?3 ? 1/? (3.197)\n\nNeither root is real if 0 < ?3 < 1, so the inequality of Eq. (3.196) is satisfied\nfor any ?1. Thus both parts of Eq. (3.195) are satisfied and roll/yaw stability is\nassured for\n\n0 < ?3 < 1 and 0 < ?1 < 1 (3.198)\n\nThe roots of Eq. (3.197) are real if ?3 < 0, with the consequence that roll/yaw\nstability requires ?1 to be either greater than the larger root or less than the smaller\nroot. The smaller root is never greater than ?1=3, though, so the only roll/yaw\nstability region for negative ?3 is\n\n?1 < ?3 < 0 and .3C ?3/?2\u0152.7?3 ? 3C 4\np\n3?3.?3 ? 1/? ? ?1 < 0 (3.199)\n\nThis region, called the DeBra-Delp region [2], has J2 < J3 < J1. It has rarely\nbeen employed in practice; almost all gravity-gradient-stabilized spacecraft are in\nthe range of inertia values specified by Eq. (3.198), i.e. J3 < J1 < J2.\n\nIt is always possible, and sometimes necessary, to supplement passive stabiliza-\ntion with active control using thrusters, magnetic torquers or reaction wheels. Active\ncontrol effort can be minimized by starting with a stable configuration, however.\nA single pitch wheel can be used to control pitch and even to stabilize the pitch\ndynamics if J1 ? J3. Roll/yaw coupling means that only two wheels are needed\nfor three-axis control. Quite often the two wheels are slightly misaligned from the\npitch axis so they can provide the momentum bias and also torques on two axes by\ncommanding them in the same or opposite directions. GOES I-M, for instance, had\ntwo 51 Nms wheels with their spin axes tilted 1:66? in the positive and negative yaw\ndirections from the negative pitch axis [24]. A much smaller 2.1 Nms wheel with its\nspin axis along yaw protected against failure of one of the two larger wheels.\n\nProblems\n\n3.1. Consider the Hill frame shown in Fig. 2.8. The deputy position expressed in\nHill frame coordinates, denoted by rdhill , is given by\n\nrdhill D rchill C ?hill D .rc C x/or C y o? C z oh\n\n\n\nProblems 119\n\nwhere rchill is the chief position vector expressed in Hill frame coordinates, ?hill is\nthe relative position vector expressed in Hill frame coordinates and rc is the chief\nposition magnitude. The vectors expressed in inertial coordinates are given by\n\nrdI D rcI C AI hill ?hill\nUsing Eq. (3.14) derive an expression for the derivative of rdI in terms of rcI , AI hill,\n?hill, and/or their derivatives, and the derivative of the true anomaly of the chief.\n\n3.2. Another way to derive the quaternion kinematics in Eq. (3.20) is to use the\nattitude matrix kinematics. Using the quaternion representation of the attitude\nmatrix given by Eq. (2.125) and the attitude matrix kinematics equation given by\nPA D ?\u0152!??A, derive the quaternion kinematics equation.\n\n3.3. Beginning with Eq. (3.21) and the definition of the quaternion in Eq. (2.124)\nshow that k!k D P# if the axis of rotation is fixed.\n3.4. Prove that the inverse of Eq. (3.28) is given by Eq. (3.30).\n\n3.5. Another way to derive the Euler angle kinematics in Eq. (3.38) is to use the\nattitude matrix kinematics. Using the Euler angle representation of the attitude\nmatrix for a 1? 2? 3 sequence in Table 9.2 and the attitude matrix kinematics\nequation given by PA D ?\u0152!??A, derive the matrix B.?;  / in Eq. (3.38) for a\n1?2?3 sequence. Also, derive an analytical expression for B?1.?;  / for a 1?2?3\nsequence.\n\n3.6. Consider the following inertia matrix:\n\nJ cB D\n2\n4\n100 0 0\n\n0 50 0\n\n0 0 25\n\n3\n5 kg-m2\n\nNumerically integrate Eq. (3.81) with LcB D 03 for a time span of 2.5 h with the\nfollowing initial conditions:\n\na) !BIB .0/ D \u01520 0:01 0?T rad/s\nb) !BIB .0/ D \u01520:01 0:0001 0:0001?T rad/s\nc) !BIB .0/ D \u01520:0001 0:01 0:0001?T rad/s\nExplain the differences between these cases.\n\n3.7. Consider the angular velocity solution for the axially symmetric case given in\nEq. (3.104). Show that the closed-form solution for the quaternion is given by\n\nq.t/ D z.t/? q0\n\n\n\n120 3 Attitude Kinematics and Dynamics\n\nwhere z.t/ is given by\n\nz.t/ D\n\n2\n664\n\nh01 cos.?/ sin.?/C h02 sin.?/ sin.?/\nh02 cos.?/ sin.?/ ? h01 sin.?/ sin.?/\nh03 cos.?/ sin.?/C sin.?/ cos.?/\ncos.?/ cos.?/ ? h03 sin.?/ sin.?/\n\n3\n775\n\nwith the definitions ? D 1\n2\n!pt , ? D 12!`t , h0 D H0=kH0k D \u0152h01 h02 h03?T ,\n\nwhere !` D H=Jt is the inertial nutation rate and H0 D J!0 is the initial angular\nmomentum vector.\n\n3.8. Instead of Eq. (3.139), we could write\n\nHB D J ?B!BIB CH?B\nwhere\n\nJ ?B ? QJB C\nnX\n`D1\n\nJ w` and H\n?\nB D\n\nnX\n`D1\n\nJ\nk\n` !\n\nw\n` w`\n\nThis form is sometimes more convenient for attitude estimation problems where the\nwheel speeds are known better than the applied torques, but it is less well suited to\ndynamics analysis. Show that the equivalent of Eq. (3.147) in this formulation is\n\nP!BIB D .J ?B /?1\u0152LB ? PH?B ?!BIB ? .J ?B!BIB CH?B/?\n\nThen show that the dynamics of a spacecraft with constant H?B are basically the\nsame as the dynamics for constant HwB using J\n\n?\nB rather than JB for the MOI.\n\n3.9. Prove the relationship shown in Eq. (3.175).\n\n3.10. The roll/yaw motion of a gravity-gradient-stabilized spacecraft would exhibit\na resonant motion analogous to the pitch motion exhibited by Eq. (3.183) if the\nsolution of Eq. (3.189) gave s2 D ?n2. Show that this roll/yaw resonance condition\nfor h D 0 is equivalent to ?1.1 ? ?3/ D 0, and thus that the roll/yaw resonance\ncondition is never satisfied inside a region of stable motion.\n\n3.11. Show that the condition for pitch resonance with orbit eccentricity, !lib D n,\nis equivalent to ?1 D .1C 3?3/=.3C ?3/, which is the curve plotted in Fig. 3.7.\n3.12. If the principal moments of inertia are all equal, both the gyroscopic and\ngravity-gradient torques will vanish. Find the solutions of Eq. (3.189) in this case\nwithout any assumptions on h except that it is nonzero.\n\n\n\nReferences 121\n\nReferences\n\n1. Abramowitz, M., Stegun, I.A.: Handbook of Mathematical Functions with Formulas, Graphs\nand Mathematical Tables. Applied Mathematics Series - 55. National Bureau of Standards,\nWashington, DC (1964)\n\n2. BeDra, D.B., Delp, R.H.: Rigid body attitude stability and natural frequencies in a circular\norbit. J. Astronaut. Sci. 8(1), 1\u201314 (1961)\n\n3. Bhat, S.P., Dham, A.S.: Controllability of spacecraft attitude under magnetic actuation. In:\nProceedings of the 42nd IEEE Conference on Decision and Control, pp. 2383\u20132388. Maui\n(2003)\n\n4. Borderies, N., Longaretti, P.: A new treatment of the albedo radiation pressure in the case of a\nuniform albedo and of a spherical satellite. Celestial Mech. Dyn. Astron. 49(1), 69\u201398 (1990)\n\n5. Bracewell, R.N., Garriott, O.K.: Rotation of artificial Earth satellites. Nature 182(4638),\n760\u2013762 (1958)\n\n6. Camillo, P.J., Markley, F.L.: Orbit-averaged behavior of magnetic control laws for momentum\nunloading. J. Guid. Contr. 3(6), 563\u2013568 (1980)\n\n7. Damaren, C.J.: Comments on \u2018fully magnetic attitude control for spacecraft subject to gravity\ngradient\u2019. Automatica 38(12), 2189 (2002)\n\n8. Dodge, F.T.: The New \u201cDynamic Behavior of Liquids in Moving Containers\u201d. Southwest\nResearch Inst., San Antonio (2000). URL http://books.google.com/books?id=RltitwAACAAJ\n\n9. Gambhir, B.L., Sood, D.R.: Spin axis magnetic coil maneuvers. In: Wertz, J.R. (ed.) Spacecraft\nAttitude Determination and Control, chap. 16. Kluwer Academic, Dordrecht (1978)\n\n10. Goldstein, H.: Classical Mechanics, 2nd edn. Addison-Wesley, Reading (1980)\n11. Grell, M.G., Shuster, M.D.: Spin plane magnetic coil maneuvers. In: Wertz, J.R. (ed.)\n\nSpacecraft Attitude Determination and Control, chap. 16. Kluwer Academic, Dordrecht (1978)\n12. Harvie III, E., Rowe, J., Tsui, Y.K.J.: Performance analysis of the GOES trim tab solar pressure\n\ntorque angular momentum control. In: Proceedings of SPIE, GOES-8 and Beyond, vol. 2812.\nDenver (1996)\n\n13. Hecht, E., Manger, W.P.: Magnetic attitude control of the Tiros satellites. Appl. Math. Mech.\n7, 127\u2013135 (1964)\n\n14. Hughes, P.C.: Spacecraft Attitude Dynamics. Wiley, New York (1986)\n15. Kane, T.R., Levinson, D.A.: Dynamics: Theory and Application. McGraw-Hill, New York\n\n(1985)\n16. Kane, T.R., Likens, P.W., Levinson, D.A.: Spacecraft Dynamics. McGraw-Hill, New York\n\n(1983)\n17. Kaplan, M.H.: Modern Spacecraft Dynamics and Control. Wiley, New York (1976)\n18. Kim, J.W., Crassidis, J.L., Vadali, S.R., Dershowitz, A.L.: International Space Station leak\n\nlocalization using attitude respone data. J. Guid. Contr. Dynam. 29(5), 1041\u20131050 (2006)\n19. Lerner, G.M.: Attitude acquisition. In: Wertz, J.R. (ed.) Spacecraft Attitude Determination and\n\nControl, chap. 19. Kluwer Academic, Dordrecht (1978)\n20. Markley, F.L.: Attitude dynamics. In: Wertz, J.R. (ed.) Spacecraft Attitude Determination and\n\nControl, chap. 16. Kluwer Academic, Dordrecht (1978)\n21. Markley, F.L., Kennedy, K.R., Nelson, J.D., Moy, E.W.: Autonomous spacecraft gyro failure\n\ndetection based on conservation of angular momentum. J. Guid. Contr. Dynam. 17(6),\n1385\u20131387 (1994)\n\n22. Markley, F.L., Nelson, J.D.: Zero-gyro safemode controller for the Hubble Space Telescope.\nJ. Guid. Contr. Dynam. 17(4), 815\u2013822 (1994)\n\n23. Parkinson, B.W., Kasdin, N.J.: A magnetic attitude control system for precision pointing of the\nrolling GP-B spacecraft. Acta Astronautica 21(6\u20137), 477\u2013486 (1990)\n\n24. Space Systems Loral: GOES I\u2013M data book (1996). http://goes.gsfc.nasa.gov/text/goes.\ndatabook.html (accessed Jan. 27, 2014)\n\nhttp://books.google.com/books?id=RltitwAACAAJ\nhttp://goes.gsfc.nasa.gov/text/goes.databook.html\nhttp://goes.gsfc.nasa.gov/text/goes.databook.html\n\n\n122 3 Attitude Kinematics and Dynamics\n\n25. Starin, S.R., O\u2019Donnell Jr., J.R., Ward, D.K., Wollack, E.J., Bay, P.M., Fink, D.R.: Anomalous\nforce on the Wilkinson Microwave Anisotropy Probe. J. Spacecraft Rockets 41(6), 1056\u20131062\n(2004)\n\n26. Vallado, D.A.: Fundamentals of Astrodynamics and Applications, 3rd edn. Microcosm Press,\nHawthorne and Springer, New York (2007)\n\n27. Wertz, J.R. (ed.): Spacecraft Attitude Determination and Control. Kluwer Academic,\nDordrecht (1978)\n\n28. Wis?niewski, R.: Linear time-varying approach to satellite attitude control using only electro-\nmagnetic actuation. J. Guid. Contr. Dynam. 23(4), 640\u2013647 (2000)\n\n29. Wis?niewski, R., Blanke, M.: Fully magnetic attitude control for spacecraft subject to gravity\ngradient. Automatica 35(7), 1201\u20131214 (1999)\n\n30. Zienkiewicz, O.C., Taylor, R.L., Zhu, J.Z.: Finite Element Method - Its Basis and Fundamen-\ntals, 6th edn. Elsevier Butterworth-Heineman, Oxford (2005)\n\n\n\nChapter 4\nSensors and Actuators\n\nThis chapter will discuss several kinds of sensors and actuators used to determine\nand control spacecraft attitude [26, 44, 54, 66]. The history of attitude sensor\ndevelopment has emphasized increased resolution and accuracy as well as decreased\nsize, weight, and power (often abbreviated as SWaP). Actuator technologies have\nalso been scaled down to be appropriate for microsatellites and cubesats. We begin\nwith a brief introduction to redundancy considerations, and then consider some\nspecific sensors and actuators.\n\n4.1 Redundancy\n\nThe space environment is stressful, and failures of ACS components have sometimes\nled to the degradation or premature termination of space missions. A requirement for\nmany missions is the ability to survive the failure of any one component, a single-\npoint failure, without any loss of capability. This is often accomplished by providing\nredundant components. Some designs leave the redundant equipment unpowered\nuntil a failure of the operating unit occurs, a configuration usually referred to as a\ncold backup configuration. If a primary unit fails in a cold backup configuration,\nthere is some delay from the time that the backup component is powered on until\nit is available for use. A warm backup configuration, in which the redundant device\nis powered on but not used, allows a quicker recovery in the event of failure of\nthe primary component. A hot backup configuration, with the redundant component\nbeing used all the time, is often preferred for actuators such as reaction wheels or\nCMGs, where the increased control authority is useful.\n\nRedundant components can be connected in a block-redundant or a cross-\nstrapped fashion. This is illustrated schematically in Fig. 4.1, where Sensors A\nand B might be a star tracker and a gyro, Actuators A and B could be two\nreaction wheels, and the numerical subscripts represent redundant components.\nAn actual control system would likely incorporate more sensors and actuators,\n\nF.L. Markley and J.L. Crassidis, Fundamentals of Spacecraft Attitude Determination\nand Control, Space Technology Library 33, DOI 10.1007/978-1-4939-0802-8__4,\n\u00a9 Springer Science+Business Media New York 2014\n\n123\n\n\n\n124 4 Sensors and Actuators\n\nsensorB1\n\nsensorA1\n\nactuatorB1\n\nactuatorA1\nCPU1\n\nsensorA2\n\nsensorB2\n\nactuatorA2\n\nactuatorB2\n\nCPU2\n\nsensorB1\n\nsensorA1\n\nactuatorB1\n\nactuatorA1\nCPU1\n\nsensorA2\n\nsensorB2\n\nactuatorA2\n\nactuatorB2\n\nCPU2\n\na b\n\nFig. 4.1 Alternative redundancy configurations. (a) Block redundant. (b) Cross strapped\n\nof course. The block-redundant system of Fig. 4.1a has two entirely separate strings;\na single-string system would just be the upper half of the figure. A failure in the\nactive string of a block-redundant system causes a switch to all the components of\nanother string. A failure in the cross-strapped system of Fig. 4.1b would generally\nresult in replacing only the failed unit with its backup. It can be seen that the\nblock-redundant and cross-strapped configurations are both single-fault-tolerant.\nThe block-redundant system would only tolerate a second fault if it were in the same\nstring as the first fault. We can see that cross-strapping usually leads to a more robust\nsystem, because it can accommodate a greater range of multiple failures. There are\ninstances, however, where cross-strapping can reduce reliability by allowing a fault\nin one component to propagate through the system.\n\nCross-strapping increases system complexity and cost. The increased expense is\nespecially prominent in the testing phase, where it is desirable to test all the paths\nthrough the control system. It can be seen from the figure that the number of paths\nin a block-redundant system increases linearly with the degree of redundancy, but\nthe number of paths increases exponentially in a fully cross-strapped system. It is\noften cost-effective to build a system with limited redundancy and/or partial cross-\nstrapping. A careful reliability analysis must be performed as part of the design\nprocess, to assess the degree of redundancy and cross-strapping needed to provide\nthe desired probability of completing the mission successfully.\n\nHardware redundancy is not the only option for protecting against single-point\nfailures. Instead, it is often possible to provide the function of a failed component\nby using an entirely different component or set of components. This often involves\nextra computation, and is referred to as analytic redundancy. One example is the\nprovision for attitude determination of the Tropical Rainfall Measuring Mission\n(TRMM) spacecraft using gyros, Sun sensors, and a three-axis magnetometer in\nplace of the horizon sensor, which is described in Sect. 5.8. This contingency mode\nwas designed to cope with potential degradation of the horizon sensor, which never\noccurred, but it enabled raising the TRMM altitude above the operational altitude of\nthe horizon sensor in order to conserve propellant and extend the mission.\n\n\n\n4.2 Star Trackers 125\n\n4.2 Star Trackers\n\n4.2.1 Overview\n\nReference [66] describes several types of star trackers, many of which are no longer\nused. Beginning around 1990, they were superseded by solid state star trackers that\ntrack many stars simultaneously [43]. We will discuss only these state-of-the-art\ntrackers, many of which autonomously match the tracked stars with stars in an\ninternal catalog and use one of the methods described in Chap. 5 to compute the star\ntracker\u2019s attitude with respect to a celestial reference frame. A typical tracker has an\nupdate rate between 0.5 and 10 Hz, a mass of about 3 kg and a power requirement on\nthe order of 10 W. It provides accuracy of a few arcseconds in the boresight pointing\ndirection, with larger errors for rotation about the boresight. References [43] and\n[34] review the operation and performance of star trackers, and [64] provides a\ndetailed description of the star tracker used by the WMAP spacecraft.\n\nA star tracker is basically a digital camera with a focal plane populated by either\nCCD (charge-coupled device) or CMOS (complementary metal-oxide semicon-\nductor) pixels (picture elements). CCDs have lower noise, but CMOS has several\nadvantages. It is the same technology used for microprocessors, so the pixels can\ninclude some data processing capabilities on the focal plane itself. Sensors taking\nadvantage of this capability are known as active pixel sensors (APS). CMOS is more\nresistant to radiation damage than CCDs, and also provides the capability of reading\nout different pixels at different rates, which is not feasible with CCDs.\n\nFigure 4.2 shows the geometry of a star tracker, which is basically the geometry\nof a pinhole camera. The x, y, and z axes constitute a right-handed coordinate\nsystem with its origin at the vertex of the optical system and its z axis along the\noptical axis, the tracker\u2019s boresight. The focal plane is a distance f , the focal length\nof the optics, behind the vertex. The optics are slightly defocused so a star image\ncovers several pixels. This enables the location of the centroid of a star image,\ncomputed as the \u201ccenter of mass\u201d of the photoelectrons in an n?n block of pixels, to\n\ny\n\nv\n\nx\n\nz\n\ns\n\nu\n\n(u0,v0)\n\n(u,v)\n\nf\n\nFig. 4.2 Star tracker\ngeometry\n\n\n\n126 4 Sensors and Actuators\n\nbe determined to an accuracy of a fraction of a pixel [34]. Optimal defocusing gives\na point spread function (PSF) with a width between 1.5 and 2 pixels, with n typically\nequal to 2 or 3 [56, 57]. The resulting accuracy, ?cent, of the centroid depends on\nthe star brightness, the exposure time, and various noise sources. Centroiding to an\naccuracy of ?cent D 0:1 pixel widths is generally achieved. Computing a weighted\ncenter of mass may reduce the effect of noise and improve this accuracy [46].\n\nThe focal plane has a .u; v/ coordinate system whose origin can be at its center\nor at one of its corners. The center of the focal plane, at the point where the z axis\npierces it, is designated by .u0; v0/. The unit vector s from the spacecraft to a star\ncan be computed from the focal plane coordinates of the centroid of its image as\n\ns D 1p\nf 2 C .u ? u0/2 C .v ? v0/2\n\n2\n4\n\nu ? u0\nv ? v0\nf\n\n3\n5 (4.1)\n\nIt is conventional to define ? ? tan?1.s2=s3/ and ? ? tan?1.s1=s3/ so that\n\ns D 1p\n1C tan2 ? C tan2 ?\n\n2\n4\n\ntan?\ntan?\n1\n\n3\n5 (4.2)\n\nThe focal plane coordinates of the centroid in terms of the star vector are\n\nu D u0 C f s1=s3 D u0 C f tan? (4.3a)\nv D v0 C f s2=s3 D u0 C f tan? (4.3b)\n\n4.2.2 Modes of Operation\n\nA star tracker has two modes of operation: tracking mode and initial attitude\nacquisition. We will first discuss the more straightforward tracking mode, in which\nthe tracker is following several stars that have already been matched with catalogued\nstars. After a fixed integration time, the star tracker reads out the number of\naccumulated photoelectrons in the pixels in regions of interest (ROI) around the\nexpected positions of the tracked stars. The location of each ROI is based on the\nstar\u2019s position at the time of previous readout and the estimated attitude motion\nof the spacecraft in the intervening time, and its size depends on the accuracy of\nthe attitude knowledge. The brightest pixels in each ROI are identified, and the\nappropriate n?n block of pixels is used to compute the centroid of each star. If a\ntracked star moves out of the field of view (FOV), the tracker searches for another\nstar, preferably well separated from the other tracked stars. The a priori knowledge\nof the approximate spacecraft attitude makes this search relatively easy.\n\n\n\n4.2 Star Trackers 127\n\nInitial attitude acquisition mode is more picturesquely known as lost-in-space\nmode [62]. In this case the tracker searches the entire FOV for the brightest clusters\nof pixels, and computes at least three centroids. The arc length separation between\nthese stars, their brightness, and some other computed properties are used to match\nthem with entries in the star catalog. This can be accomplished in a few seconds\nusing sophisticated algorithms for pattern matching and for rapidly searching the\ncatalog. Reference [62] provides a very useful survey of these methods and a\ncomplete guide to the literature.\n\n4.2.3 Field of View, Resolution, Update Rate\n\nWe will consider some trades in the design of star trackers, following the discussions\nby McQuerry, et al. [43] and Liebe [34]. The resolution of the star tracker depends\non the number of pixels, the size of the FOV, and the accuracy of the centroiding.\nWe will consider a square focal plane of size Npixels?Npixels, typical values being\n512?512 or 1;024?1;024. Assuming that the focal plane assembly is centered on\nthe optical axis, it images a spherical quadrilateral on the celestial sphere bounded\nby the four great circles given by Eq. (4.2) with ? D ??max and ? D ??max. The\narea of this FOV on the sphere is given by spherical geometry1 as\n\n?rectangle D 4 sin?1.sin?max sin?max/ ? .2?max/.2?max/ steradians (4.4)\n\nThe approximation is for small angles, and it is quite good, having an error of only\n1 % for ?max D ?max D 10?. Optical distortions often make it desirable to ignore\nstars in the corners of the FOV, reducing the useful area for ?max D ?max to that of\na small circle of radius ?max,\n\n?circle D 2\n.1 ? cos?max/ ? \n?2max steradians (4.5)\n\nEach pixel of a square focal plane subtends an angle 2?max=Npixels in the small\nangle approximation, so the resolution of the tracker is 2 ?cent?max=Npixels. Higher\nresolution can be obtained by decreasing the size of the FOV, increasing the number\nof pixels in the focal plane, or improving the centroiding. If the physical size of a\npixel and the field of view are held constant, adding pixels requires a larger focal\nplane and thus a proportionally larger focal length, increasing the weight of the\noptics. Pixel sizes have historically decreased, however, allowing more pixels in a\nsmaller focal plane.\n\nStar trackers have several sources of errors. Optical distortions can be reduced\nby calibration, and temperature-dependent errors can be minimized by controlling\nthe temperature of both the focal plane and the optics. Shot noise results from the\n\n1This can be derived, for example, from Eqs. (A-12) and (A-22) in [66].\n\n\n\n128 4 Sensors and Actuators\n\nrandom nature of photons, which obey Poisson statistics. Thus if a pixel accumulates\nne photoelectrons on average, this number will have a fluctuation with standard\ndeviation\n\np\nne . Dark current, the accumulation of electrons in the absence of light,\n\ncan also be minimized by cooling the focal plane, but this increases the power\ndemands of the tracker. Sometimes the tracker software must be modified to ignore\nhot pixels, i.e. pixels with anomalously large dark currents. The effects of shot noise\nand dark currents can be minimized by gathering more light to increase the number\nof photoelectrons, which requires either increasing the aperture of the optics, with\nconcomitant weight gain, or increasing the integration time, i.e. the time allowed\nfor photoelectrons to accumulate before counting them. Increasing integration time\nobviously slows the attainable update rate of star tracker data and also makes it more\ndifficult for the tracker to deal with spacecraft attitude motion.\n\nIfNstars are tracked simultaneously, averaging of random errors reduces the errors\nin the attitude estimate about the two axes perpendicular to the boresight by a factor\nof N?1=2stars , with resulting accuracy\n\n??cross-boresight D 2 ?cent?max\nNpixels\n\np\nNstars\n\n(4.6)\n\nFor ?cent D 0:1, Npixels D 1;024, and Nstars D 5, this gives 3.1 arcsec for a 20??20?\nFOV, and 1.3 arcsec for an 8??8? FOV. The rotation angle around the tracker\u2019s\nboresight, often called roll, cannot be determined with equal accuracy. Its estimation\nrequires some separation between the tracked stars to provide a lever arm. The\nmethods of Sect. 5.5.2 can be used to show that roll accuracy is reduced relative\nto the cross-axis accuracy by the root-mean-square (RMS) distance of stars from\nthe boresight (in radians).2 This distance for a large collection of stars uniformly\ndistributed over a square FOV is\n\n?RMS D\nvuut\nR ?max\n\n??max\nR ?max\n\n??max.x\n2 C y2/dxdy\n\nR ?max\n??max\n\nR ?max\n??max dxdy\n\nD 2?maxp\n6\n\n(4.7)\n\nUsing this RMS value gives the error in the rotation about the boresight as\n\n??roll D\np\n6 ?cent\n\nNpixels\np\nNstars\n\n(4.8)\n\nThis error is independent of the size of the FOV; for ?cent D 0:1, NP D 1;024, and\nNstars D 5, it is equal to 22 arcsec. We see that a large-FOV star tracker and a small-\nFOV tracker with the same focal plane will produce equally accurate roll attitude\nestimates, but Eq. (4.6) shows that the tracker with the smaller FOV will provide\nbetter measurements of the cross-axis attitude.\n\n2An example calculation is set as an exercise in Chap. 5.\n\n\n\n4.2 Star Trackers 129\n\n4.2.4 Star Catalogs\n\nBoth for lost-in-space star identification and for averaging of random errors, it is\ndesirable to track at least four stars, and preferably more. This drives the size of\nthe star catalog. The star availability requirement is usually stated as the probability\nthat at least N stars will be available in the tracker\u2019s FOV. The number of stars\nin the FOV can be assumed to follow a Poisson distribution, which says that the\nprobability of finding N stars in the FOV is given by\n\nP.N/ D e? NN\nNNN\nN\u0160\n\n(4.9)\n\nwhere NN is the average number of stars in the FOV. Representative values following\nfrom this assumption are that NN D 6:75 gives a 90 % probability of finding 4 stars\nin the FOV, NN D 8 gives a 90 % probability of finding 5 stars in the FOV, NN D 10\ngives a 99 % probability of finding 4 stars in the FOV, and NN D 11:7 gives a 99 %\nprobability of finding 5 stars in the FOV.\n\nThese values can immediately be used to estimate the required size of the star\ncatalog. The size of the celestial sphere is 4\n.180=\n/2 D 41;253 deg2, so the star\ncatalog should contain 11:7?41;253=64 > 7;500 stars to offer a 99 % probability of\nfinding 5 stars in a 8??8? FOV. On the other hand, only 6:75?41;253=400 ? 700\nstars are needed to offer a 90 % probability of finding 4 stars in a 20??20? FOV.\n\nThe required size of the catalog can then be used to estimate the magnitude range\nof stars that must be tracked. Haworth [24] has counted the number of stars in the\nTycho star catalog [60] in visual magnitude ranges from ?0.5 to 11.5. His values for\nthe number of stars of magnitude less than MV for 3:5 ? MV ? 10:5 can be fitted\nto within 3 % by the simple relation\n\nN.MV / D 3:9 exp.1:258MV ? 0:011M2V / (4.10)\n\nThe M2V term in this expression gives a curvature to the plot of differential star\ncounts as shown, for example, in Figure 2 of [4], but neither Eq. (4.10) nor\nHaworth\u2019s estimates are reliable for magnitudes greater thanMV D 10:5. According\nto Eq. (4.10), a catalog containing 7,542 stars must include stars as dim as MV D\n6:4, while a catalog with 696 stars need only extend to MV D 4:3, a magnitude\nsignifying 100:4.6:4?4:3/ ? 7 times as much energy flux as MV D 6:4.\n\nThese magnitude estimates are only approximate for two reasons. Firstly, the\nmagnitude of a star depends on the spectral response of the detector, and the\nresponse of a CCD or APS pixel is not the same as that of the human eye.\nFor this reason, star catalogs are created using instrument magnitudes, which are\nspecific to the detector technology employed by the tracker. Secondly, stars are not\nuniformly distributed on the celestial sphere, but tend to be concentrated in our\ngalaxy, the Milky Way. Because star densities are lower at the galactic poles, it is\noften necessary to fill in a star catalog with dimmer stars in these regions.\n\n\n\n130 4 Sensors and Actuators\n\n4.2.5 Proper Motion, Parallax, and Aberration\n\nStar catalogs give the apparent positions of stars in the inertial ICRF frame with its\norigin at the center-of-mass of the solar system, as discussed in Sect. 2.6.2. Stars\nare not all absolutely stationary in this frame, and a few exhibit proper motion of as\nmuch as several arseconds per year. Star catalogs include the proper motion of any\nstar for which it is significant, so the star location can be corrected for it when the\ncatalog is accessed. Stars with near neighbors, including double stars, are generally\nomitted from star catalogs.\n\nParallax, the change in the apparent location of a star due to the change in the\nposition of the observer, is negligible for all but the nearest stars. For a satellite\nin near-Earth orbit, the maximum parallax is equal to the radius of the Earth\u2019s\norbit divided by the distance to the star. For the nearest star, Proxima Centauri at\na distance of 4.24 light years, the maximum parallax is 3.7 ?rad, or 0.77 arcsec.\nHowever, Proxima Centauri would likely be excluded from a star catalog because it\nappears to form a triple star system with ? Centauri A and B [65]. In fact, some star\ncatalogs only include stars at distances greater than 100 light years from the solar\nsystem, so that their parallax is less than 0.03 arcsec near the Earth, and less than\n1 arcsec anywhere inside the orbit of Neptune [59].\n\nStellar aberration is a change in the apparent position of a star due to the velocity\nof the observer. It is also known as astronomical aberration or Bradley aberration,\nafter James Bradley who showed in 1729 that it was a result of the finite speed of\nlight. Stellar aberration is not to be confused with distortions in optical systems such\nas spherical aberration or chromatic aberration, which are completely unrelated.\nWe will explain aberration using Bradley\u2019s classical argument, which gives a result\ncorrect to the first order in v=c, the ratio of the observer\u2019s velocity to the speed of\nlight. A complete explanation requires special relativity, but our analysis will avoid\nthis refinement [59].\n\nFigure 4.3a illustrates Bradley\u2019s argument in the ICRF frame, in which the star\ntracker is moving with velocity v and the star is assumed to be stationary.3 The\nvertex V and focal plane FP of the tracker are shown at times t1, when the starlight\npasses through the effective pinhole at V , and t2 when it strikes the focal plane; the\ntracker is displaced a distance v?t ? v.t2? t1/ between these times. Light travels in\na straight line with speed c in an inertial reference frame, so the light from the star\nat position S true passes through V.t1/ to FP.t2/. The vector from FP.t2/ to V.t1/\nis c strue?t , as indicated on the figure. The star appears to the star tracker to have\ncome through V.t2/ to FP.t2/, so the apparent direction to the star is the direction\nof the vector sum .c strue C v/?t . Thus the apparent unit vector to the star is\n\nsapparent D s\ntrue C v=c\nkstrue C v=ck (4.11)\n\n3Proper motion is accounted for separately.\n\n\n\n4.2 Star Trackers 131\n\nFP(t2)\n\nFP(t1)\n\nV(t1)\n\nV(t2)v?t\n?v?t\n\nS true\n\nSapparent\n\nc strue?t\n\n(c strue+v)?t\n\n(c sapparent \u2013v)?t\n\nS(temit)\n\nS(tdetect)\n\nstar tracker\n\na\n\nb\n\nc sapparent?t\n\nFig. 4.3 Stellar aberration. (a) Celestial reference frame. (b) Star tracker frame\n\nIt can be seen that the apparent star vector is tilted forward from the true star vector\nin the direction of the velocity. A moving telescope with a very small field of view\nmust be tilted forward to catch the photons, much as someone walking in the rain\nmust tilt an umbrella forward to catch the raindrops.\n\nFigure 4.3b illustrates an alternative derivation in an inertial reference frame\nmoving at velocity v with respect to the ICRF, where v is the instantaneous velocity\nof the star tracker at the time the star is detected. The star tracker is stationary in\nthis frame, and the star moves with velocity ?v. The apparent position of the star\nis the direction from the tracker to the position of the star S.temit/ when the light\nwas emitted. The star moves a distance ?v?t 0 ? ?v.tdetect ? temit/ during the time\nthe light travels the distance c?t 0 from the star to the tracker. Thus the catalogued\nposition of the star at time tdetect is in the direction of .c sapparent ? v/?t 0, namely\n\nstrue D s\napparent ? v=c\nksapparent ? v=ck (4.12)\n\nEquations (4.11) and (4.12) agree to order v=c, but disagree in order .v=c/2, which\nis not surprising because they were derived using completely classical arguments.\nEquation (4.12) has the appearance of a correction for the actual motion of the star\nduring the light transmission time, but that is not at all what it represents. The star\ntracker certainly did not have a constant velocity while the light was traveling from\nthe star, and it is unlikely that the tracker even existed for most of that time.\n\n\n\n132 4 Sensors and Actuators\n\nBoth strue and sapparent are unit vectors, so the transformation between them is a\nrotation. To see this explicitly, we rewrite Eq. (4.11) to first order in v=c as\n\nsapparent ? .strue C v=c/.1C 2strue ? v=c/?1=2 ? .strue C v=c/.1 ? strue ? v=c/\n? strue C v=c ? .strue ? v=c/strue D .I3 ? \u0152?aber??/strue\n\n? exp.?\u0152?aber??/strue (4.13)\n\nwhere\n\n?aber ? .v=c/ ? strue (4.14)\n\nThe matrix exponential is the rotation vector representation of the rotation matrix,\nas defined in Sect. 2.9.2. The direction of the rotation vector, ?aber, is normal to the\nplane containing the star vector and the velocity.\n\nThe principal component of the aberration for Earth-orbiting spacecraft, with\nan amplitude of approximately 20 arcsec, is due to the motion of the Earth about\nthe Sun.4 Aberration arising from the motion of the spacecraft about the Earth is\nless than 5 arcsec. Aberration can be neglected when matching stars for attitude\ninitialization, but it must be taken into account in determining the attitude of\nany spacecraft with fine pointing requirements. A straightforward procedure is to\nuse Eq. (4.1) to compute an aberrated vector to a star from its centroid, then use\nEq. (4.12) to compute the true vector, which can then be used for precise attitude\nestimation.\n\nThe difference in the aberration of two stars is\n\n?aber1 ? ?aber2 D .v=c/ ? .strue1 ? strue2 / (4.15)\n\nThe maximum magnitude of this differential aberration is 2.v=c/ sin.?12=2/, where\n?12 is the angular separation of the star vectors. The differential aberration between\nthe boresight direction and any star is a maximum of 25 % of the full aberration\nfor a tracker with a 20??20? FOV, and 10 % of the full aberration for a tracker\nwith an 8??8? FOV. Tracked stars are usually not at the extreme edge of the focal\nplane, though, and they tend to be more or less uniformly distributed around the\nfocal plane, causing the average of their differential aberrations with respect to the\nboresight to be small. Thus aberration is often computed assuming that all stars\nare on the boresight of the tracker, i.e. at the point .u0; v0/ in the focal plane.\n\nWith the approximation that the aberration angle is the same for all stars,\nan autonomous star tracker can compute its attitude with respect to the celestial\nreference frame using the apparent star vectors without any aberration correction.\nThe resulting attitude matrix, Aaber, maps the star vectors from the celestial frame\n\n4This is v=c ? 100 ?rad, so .v=c/2 ? 0:002 arcsec, which indicates that a fully relativistic\nanalysis is not required.\n\n\n\n4.3 Sun Sensors 133\n\nto their aberrated representations in the body frame, and thus it maps all reference\nframe vectors to tracker frame values rotated by ?aber. The true attitude matrix that\nmaps the reference vectors to their true values is found by rotating by the negative\nof the aberration vector\n\nAtrue D exp.\u0152?aberT ??/Aaber D Aaber exp.\u0152?aberI ??/ (4.16)\n\nwhere the aberration angle is computed assuming the stars are all along the tracker\u2019s\nboresight. Note that the aberration correction is applied on the left or the right\nside of the attitude matrix depending on whether ?aber is represented in the tracker\nframe T or the celestial frame I . Equation (2.63) establishes the equivalence of these\ntwo procedures. If the star tracker uses the aberrated measurements to compute an\nattitude quaternion qaber, the true quaternion is given to order v=c by\n\nqtrue D 1q\n1C k?aberT k2\n\n???aberT\n1\n\n?\n? qaber D 1q\n\n1C k?aberI k2\nqaber ?\n\n???aberI\n1\n\n?\n\n(4.17)\n\nIf the star tracker is used to point a telescope or other instrument at an object that\nis closely aligned with the tracker\u2019s boresight, i.e. if the tracker is co-boresighted\nwith the instrument, we can often omit the aberration correction of both the tracker\u2019s\nattitude and the science target\u2019s location, since these will cancel. Other instruments,\nsuch as magnetometers or Sun sensors, will appear to be misaligned in this case,\nbut a 20 arcsec error may be insignificant compared with other error sources in their\nmeasurements.\n\n4.3 Sun Sensors\n\nSun sensors fall into two classes, coarse Sun sensors (CSSs) and fine or digital\nSun sensors (DSSs). The most common form of a CSS is a photocell (an eye) or\nan assembly of photocells. To a good approximation, the output of a photocell is\nan electric current directly proportional to the intensity of the light falling on it.\nThis may include light from Earth albedo or glint off nearby components of the\nspacecraft, which can pull CSS outputs off the true Sun direction by as much as 20?\nin extreme cases [5,6]. The output of a CSS eye basically gives the average direction\nto sources of light energy falling on it. It is usually an adequate approximation to\nignore these effects and treat the Sun as a point source, giving\n\nIj D\n(\nImax.nj ? s/ for nj ? s > 0\n0 for nj ? s ? 0\n\n(4.18)\n\n\n\n134 4 Sensors and Actuators\n\nwhere nj is the unit vector in the direction of the eye\u2019s outward normal and s is\nthe unit vector in the direction from the spacecraft to the Sun. The response as a\nfunction of angle can be calibrated, and compensation for albedo and glint can be\napplied if necessary.\n\nA second eye, with normal vector n?j D ?nj , would have the output\n\nI?j D\n(\nImax.n?j ? s/ D ?Imax.nj ? s/ for n?j ? s D ?nj ? s > 0\n0 for n?j ? s D ?nj ? s ? 0\n\n(4.19)\n\nso differencing the two outputs gives\n\nIj ? I?j D Imax.nj ? s/ for all nj ? s (4.20)\n\nSix CSS eyes, with normal vectors ?nj ,?nk , and?n`, give\n2\n4\nIj ? I?j\nIk ? I?k\nI` ? I?`\n\n3\n5 D Imax\n\n2\n4\n\nnj ? s\nnk ? s\nn` ? s\n\n3\n5 D Imax\n\n2\n4\n\nnTj\nnTk\nnT`\n\n3\n5 s (4.21)\n\nIf nj , nk , and n` are not coplanar, the Sun unit vector can be computed as\n\ns D 1\nImax\n\n2\n4\n\nnTj\nnTk\nnT`\n\n3\n5\n\n?12\n4\nIj ? I?j\nIk ? I?k\nI` ? I?`\n\n3\n5\n\nD .Ij ? I?j /.nk ? n`/C .Ik ? I?k/.n` ? nj /C .I` ? I?`/.nj ? nk/\nImax\u0152nj ? .nk ? n`/? (4.22)\n\nThe eye currents are slowly varying functions of the Sun direction near normal\nincidence, so the Sun vector is least well determined when the Sun vector is aligned\nwith one of the eye normal vectors. A six-eye CSS configuration (actually two\nredundant sets of six eyes) was chosen for WMAP, for which the expected position\nof the Sun was 22:5? from the ?z axis (see Fig. 7.4). The eyes were located at\nthe outer edges of the six solar panels pointing alternately 35:26? up and 35:26?\ndown from the x?y plane. Thus the unit normal vectors formed an orthogonal triad,\nperpendicular to the faces of a cube with one of its body diagonals along the?z axis.\n\nFine Sun sensors have historically relied on arrays of slits (or reticles) with linear\nphotosensitive surfaces behind them. Sun sensors of this design are described in\nWertz [66] and in Sect. 7.7 of this text. A newer DSS design is basically a star tracker\nwith a pinhole in place of the light-gathering optics, which are not needed because\nof the Sun\u2019s brightness. The resolutions of DSSs range from 1 deg to better than\n1 arc min. They have medium-size fields of view, a typical value being 128??128?,\nso CSSs are usually employed to maneuver the spacecraft to move the Sun into the\nDSS FOV.\n\n\n\n4.5 Magnetometers 135\n\nTwo-slit Sun sensors for spinning spacecraft are also described by Wertz [66].\nA command slit parallel to the spin axis notes the time at which the slit azimuth\nis in the Sun direction. A second measurement slit perpendicular to the spin axis\ndirects the sunlight to a linear array of detectors to determine the elevation of the\nSun unit vector with respect to the spin axis.\n\n4.4 Horizon Sensors\n\nHorizon sensors have been used on many Earth-orbiting spacecraft, especially on\nEarth-pointing spacecraft. The Earth has a finite size and cannot be treated as a\npoint to any degree of accuracy, so a horizon sensor detects points on the Earth\u2019s\nhorizon, as its name implies. The appearance of the Earth in visible wavelengths is\nquite complicated; aside from having oceans, vegetation, and deserts, it has phases\nlike the Moon. The appearance is more uniform at infrared wavelengths, especially\nin the narrow 14\u201316 ?m emission band of the CO2 molecule, so almost all horizon\nsensors are designed to detect infrared radiation in this range [66].\n\nHorizon sensors are fundamentally of two types: static sensors that look in fixed\ndirections, and scanning sensors that move a small FOV of a detector across the\nEarth. Static sensors, by their nature, are limited to Earth-pointing spacecraft at\nsmall pitch and roll angles and in a limited altitude range. Static horizon sensors\nlooking at four points roughly equally spaced around the Earth\u2019s horizon were\nused by TRMM and by the Television Infrared Observation Satellite (TIROS) and\nDefense Meteorological Satellite Program (DMSP) spacecraft. Scanning sensors\ncan use an oscillatory or rotational scan, with rotation provided by incorporating\nthe horizon scanner into a reaction wheel, by providing a separate mechanism, or\nby using the spin of a spin-stabilized spacecraft.\n\nUnlike star trackers and Sun sensors that detect objects with definite positions\nin a reference frame, horizon sensors detect a point on the Earth\u2019s horizon with\nan a priori unknown location. Multiple horizon crossings can be used to find a\nnadir vector by means discussed in [66], which contains a wealth of information\non horizon sensors. The nadir computed from horizon sensor measurements on an\noblate Earth is a better approximation to the geodetic nadir normal to the surface of\nthe ellipsoidal figure of the Earth than to the geocentric nadir pointing to the center\nof the Earth. As shown in Sect. 2.6.3, these directions can differ by as much as\n12 arc min. The accuracy of horizon sensors is limited to about 0:1?, mainly by the\nability to accurately model the height of the CO2 layer in the Earth\u2019s atmosphere.\n\n4.5 Magnetometers\n\nMost spacecraft magnetometers are fluxgate magnetometers [66], which are rela-\ntively small, lightweight, rugged, and inexpensive. They have no moving parts and\ndo not require a clear field of view. They do require a well-modeled magnetic field\n\n\n\n136 4 Sensors and Actuators\n\nif they are to be used as attitude sensors, which practically limits their use in this\ncapacity to low-Earth orbit. A magnetic field model is not needed if magnetometer\nmeasurements are used only to compute magnetic torque commands.\n\nMagnetometers measure the sum of the ambient field that is of interest and\nany local fields produced by the spacecraft. Local fields can be produced by\nferromagnetic materials or by current loops in solar arrays, electric motors, payload\ninstruments, or most especially attitude control torquers. If the local fields are\nknown, they can be compensated for. If they are not known, the magnetometers\ncan be located far from the sources of magnetic contamination, on a deployable\nboom if necessary, to take advantage of the 1=r3 falloff of a magnetic dipole field\n(see Sect. 11.1).\n\n4.6 Global Positioning System\n\nUsing the GPS for satellite navigation is now widespread. The GPS constellation\nwas originally developed to permit a wide variety of user vehicles an accurate\nmeans of determining position for autonomous navigation [51]. The original\nconstellation included 24 space vehicles (SVs) in known semi-synchronous (12-h)\norbits, providing a minimum of six SVs in view for ground-based navigation. The\nunderlying principle involves geometric triangulation with the GPS SVs as known\nreference points to determine the user\u2019s position to a high degree of accuracy.\nA minimum of four SVs is required so that, in addition to the three-dimensional\nposition of the user, the time of the solution can be determined and in turn employed\nto correct the user\u2019s clock. As of December 2012, 8 more satellites have been\nadded to the constellation, which was also changed to a nonuniform arrangement.\nThis allows nearly 9 SVs to be available at any time and location on the Earth,\nwhich provides considerable redundancy and improvements in user location. The\nnumber of available GPS satellites for space-based applications depends on the user\nspacecraft\u2019s altitude.\n\nThe fundamental signal in GPS is the pseudo-random code (PRC), which is a\ncomplicated binary sequence of pulses. Each SV has its own complex PRC, which\nguarantees that the receiver will not be confused with another SV\u2019s signal. The GPS\nsatellites transmit signals on two carrier frequencies: L1 at 1575.42 MHz and L2 at\n1227.60 MHz. The modulated PRC at the L1 carrier is called the Coarse Acquisition\n(C/A) code, which repeats every 1,023 bits and modulates at a 1 MHz rate. The\nC/A code is the basis for civilian GPS use. Another PRC is called the Precise (P)\ncode, which repeats on a 7-day cycle and modulates both the L1 and L2 carriers\nat a 10 MHz rate. This code is intended for military users and can be encrypted.\nPosition location is made possible by comparing how late in time the SV\u2019s PRC\nappears relative to the receiver\u2019s code. Multiplying the travel time by the speed of\nlight, one obtains the distance to the SV. This requires very accurate timing in the\nreceiver, which is provided by using a fourth SV to correct a \u201cclock bias\u201d in the\nreceiver\u2019s internal clock.\n\n\n\n4.6 Global Positioning System 137\n\nbantenna 1 antenna 2\n\nTo GPS\n\nq\n\nFig. 4.4 GPS waves and wavefront angle\n\nAttitude determination using phase differences of GPS signals received by\nantennas located at different locations is a later development, even though the\noriginal concept was proposed in 1976 by Spinney [61]. The first practical appli-\ncation for GPS attitude determination was shown by Cohen in 1993 [15]. Cohen\nand Trimble Navigation, Ltd. designed the TANS Vector sensor system, which was\nthen primarily used for airborne applications and tracked up to 6 satellites on 4\nseparate antennas. The Radar Calibration (RADCAL) satellite was the first satellite\nto provide spaced-based GPS measurements that determined spacecraft attitude\nusing post-processed data. The first realtime space-based attitude determination\napplication was the Cryogenic Infrared Spectrometers and Telescopes for the\nAtmosphere/Shuttle Pallet Satellite (CRISTA-SPAS) based on algorithms developed\nby Lightsey [35].\n\nAttitude determination using GPS signals is based on measuring the magnitude\nof the carrier wavelength directly. At least two antennas are required to form a\n\u201cbaseline\u201d vector b expressed in body-frame coordinates, as depicted in Fig. 4.4.\nIt is assumed that the baseline distance is significantly smaller than the distance\nto the GPS satellites so that planar waves are given to the receiver. The different\npath lengths from each GPS satellite to the antennas at the two ends of the baseline\ncreate a phase difference of the received signals. Note that an integer number of\ncycles may be present in this phase difference if the baseline distance, given by\nkbk, is larger than the GPS carrier wavelength, which is 19 cm for the L1 carrier.\nThis leads to the classic \u201cinteger ambiguity\u201d problem [16]. There are several steps\nrequired to perform attitude determination. A short list of the general ones is as\nfollows: (1) performing a \u201cself survey\u201d to determine several system parameters, such\nas integer ambiguities, line biases, and baselines [50], (2) determining the sightline\nvectors to all available GPS satellites, (3) maintaining a count of the integer cycles\nas the attitude changes, and (4) using the known multiple baseline vectors, sightline\nvectors, and phase differences (with integers removed) to determine the attitude,\nwhich is discussed in Sect. 5.9.\n\n\n\n138 4 Sensors and Actuators\n\nEven though the theory behind GPS-based attitude determination is sound, its\npractical implementation is susceptible to many error sources. One of the largest\nerror sources is its susceptibility to reflections off spacecraft, called multipath [10].\nThis essentially causes a slowly-varying bias in the measurements with time\nconstants determined by spacecraft dynamics relative to the GPS constellation.\nOther error sources include ephemeris errors, satellite clock errors, ionosphere\nerrors, troposphere errors, and receiver errors [52]. The accuracy of GPS attitude\ndetermination is a function of the error sources, accuracy of the self survey,\nlengths of the baselines, and satellite geometry. Another approach for GPS attitude\ndetermination involves using the signal-to-noise ratio, which can be accomplished\nusing a single antenna [3, 36, 39, 58]. Pseudolites, which are small transceivers that\nare used to create local GPS-like signals, can also be used for attitude determination.\nHowever, this leads to more complicated solutions because planar wavefronts cannot\nbe assumed in general [49].\n\nA GPS receiver built for terrestrial applications will not work properly for space\napplications in general. Lightsey [35] discusses the issues involved with modifying\na GPS receiver for space. The first issue is that higher vehicle velocities exist\nin space than for ground and air applications. For example, for low-Earth orbit\napplications this results in Doppler shifts that are more than 10 times greater than\nthose observed from the ground and Doppler shift rates that can be more than 100\ntimes higher. The conclusion from these facts is that the carrier and code tracking\nloops must be redesigned for space applications. The next issue is the \u201cfull sky\npointing\u201d problem. For ground applications one side of the vehicle generally points\nin the same direction at all times. This is vastly different for rotating spacecraft,\nwhich may cause significant outages if all the hemispherical antennas are pointed\nin the same direction. This can be mitigated by using a carrier phase measurement\ncorrection, which Lightsey defines as a design of a \u201cnon-aligned\u201d antenna array.\nAnother issue is that the GPS electronics, especially the processor units, must be\nredesigned to handle the harsh space environment. Other issues include vibrational\neffects on the antennas, which can change their baseline length, and larger multipath\nerrors than ground applications due to more reflections from the metallic spacecraft\ncomponents. All of these issues can decrease the attitude performance if they are\nnot properly accounted for in the GPS receiver design.\n\n4.6.1 GPS Satellites\n\nThe onboard GPS satellite information is usually given by a GPS ephemeris. For\nsimulation purposes a less-precise almanac is used,5 which provides orbital element\ninformation, including the time of applicability, ta, eccentricity, e, inclination, i ,\n\n5The U.S. Coast Guard Navigation Center maintains a website that contains GPS almanacs, and as\nof this writing this website is given by http://www.navcen.uscg.gov/.\n\nhttp://www.navcen.uscg.gov/\n\n\n4.6 Global Positioning System 139\n\nTable 4.1 Equations to compute GPS ECEF positions over time\n\na D pa2 Semimajor Axis\nn D\n\nr\n?\n\na3\nComputed Mean Motion\n\ntk D t ? ta Time Since Applicability\nMk D M0 C tk n Mean Anomaly\nEk D Mk C e sinEk Solve Kepler\u2019s Equation for Ek\ntan\n\n?k\n\n2\nD\nr\n1C e\n1? e tan\n\nEk\n\n2\nTrue Anomaly\n\n?k D ?0 C P? tk ? !e t Corrected Ascending Node\n\tk D vk C ! Argument of Latitude\nrk D a .1? e cosEk/ Orbital Radius\nr0k D\n\n?\nrk cos\tk\nrk sin\tk\n\n?\nOrbit Plane Position\n\nrEk D\n2\n4\n\ncos?k ? cos i sin?k\nsin?k cos i cos?k\n0 sin i\n\n3\n5 r0k ECEF Position\n\nsemimajor axis, a, right ascension, ?0, rate of right ascension, P? , argument of\nperigee, !, and mean anomaly, M0. See Chap. 10 for a discussion of the orbital\nelements. We should note that the right ascension is given with respect to the prime\nmeridian, which allows us to compute the ECEF position directly. It should be noted\nthat GPS time is based on the atomic standard time and is continuous without\nthe leap seconds that Universal Time (UT) uses to account for the non-smooth\nrotation of the Earth. GPS epoch is midnight of January 6, 1980, and GPS time\nis conventionally represented in weeks and seconds from this epoch. The GPS week\nis represented by an integer from 0 to 1,023. A rollover occurred on August 22,\n1999, so that 1,024 needs to be added for references past this date.\n\nTo simulate the GPS sightline vector a simple algorithm using GPS almanac\ndata is sufficient. The broadcast ephemeris, which contains more parameters such\nas amplitude of second-order harmonic perturbations [32], should be used if more\naccuracy is needed. For simulation purposes, counting the days past GPS epoch to\ndetermine UT is adequate (ignoring leap seconds, but not leap days). The position\nvector of the GPS satellite is denoted by rE and the position of the GPS receiver\nis denoted by pE . Table 4.1 gives the equations necessary to determine the GPS\nECEF positions. The variable !e D 7:292115 ? 10?5 rad/s is the Earth\u2019s rotation\nrate given from WGS-84, ? D 3:98600441? 1014 m3/s2 is the Earth\u2019s gravitational\nparameter, and tk is the time past the time of applicability (the subscript k denotes\nthe kth time-step). The sightline vector is computed using\n\nsj D\nrEj ? pE\nkrEj ? pEk\n\n(4.23)\n\nwhere the subscript j now denotes the j th available GPS satellite.\n\n\n\n140 4 Sensors and Actuators\n\n4.7 Gyroscopes\n\nGyroscopes on spacecraft are almost exclusively used in strapdown mode, which\nmeans that the gyro is solidly attached to the spacecraft rather than being used to\ncontrol a separate gimbaled platform. Gyros generally fall into two broad classes:\nrate gyros that read angular rates, and rate-integrating gyros (RIGs) that measure\nintegrated rates or angular displacements [19,44,54]. Gyros can also be classified by\nthe physical mechanisms they use: spinning-mass gyros, optical gyros, or Coriolis\nvibratory gyros (CVGs).\n\nBefore the 1980s, all operational gyros were spinning-mass gyros, which depend\non the tendency of the angular momentum of a rotating mass to remain fixed in\ninertial space. These are used in torque rebalance mode, meaning that the angular\nmomentum is held constant in the spacecraft frame. Equation (3.80) tells us that the\ntorque required to keep the gyro\u2019s angular momentum HB constant is\n\nLB D !BIB ?HB (4.24)\n\nThe two components of!BIB along the input axes perpendicular to HB determine the\nrequired two components of LB along the output axes, given by the cross products\nof the input axes with the direction of HB . Single-axis gyros supply and sense one\nof these torques electromagnetically, depending on mechanical pivots to provide\nthe other torque, while two-axis gyros provide and sense both of these torques\nelectromagnetically.\n\nThe most accurate spacecraft gyros have been single-axis floated gyros, as\ndepicted in Fig. 4.5. These have the gyro rotor and its drive motor contained\nin a cylindrical \u201ccan,\u201d with the rotor\u2019s spin direction along one of its diameters.\nThe perpendicular diameter is the input axis, and the output axis is directed from\none end of the can to the other. The can is supported by pivots at its ends and by\nthe buoyancy of a fluid having a density equal to the total mass of the can and its\ncontents divided by its volume. Neutral buoyancy allows the pivots to control two\n\nRotor Output\nAxis\n\nCan Sensing & Control\nPickoff\n\nCaseFluid\n\nPivot\nPivot\n\nFig. 4.5 Single-axis floated gyro\n\n\n\n4.7 Gyroscopes 141\n\ndegrees of freedom of the can while leaving it essentially free to rotate about its\noutput axis. This rotation is sensed and controlled electromagnetically to measure\nthe angular rate about the input axis. In order to minimize perturbations on the can,\nthe power and signals to drive and sense the gyro rotation are carried through the\nflotation fluid by thin flexible leads.\n\nTwo-axis gyros are called dry tuned-rotor gyros (DTGs), because they are not\nfloated [44]. The motor is rigidly fixed to the spacecraft, and the rotor is attached\nto the shaft by gimbals and torsion springs carefully designed and tuned to the spin\nspeed of the rotor to minimize their effective restoring torque, allowing the rotor to\nflex in two directions. The rotor deflection is sensed on two axes and controlled on\nthe two cross-product axes electromagnetically. DTGs have come very close to the\nperformance of floated gyros, but never achieved performance equivalent to the best\nfloated gyros. However, their relative simplicity and ruggedness led to their use on\na great number of spacecraft in the three decades beginning around 1978.\n\nThe most common failure modes of spinning-mass gyros are due to problems\nwith the rotor bearings. The floated gyros on HST, which use bromotrifluoroethylene\n(BTFE) as the flotation fluid to provide the required high density, experience a\ndifferent failure mode. Corrosion of the silver-copper alloy flex leads by the BTFE\nhas caused multiple gyro failures requiring on-orbit replacement during Space\nShuttle servicing missions [29].\n\nThe problems with spinning-mass gyros, including the difficulty and expense of\ntheir fabrication, has led to the development of alternative rate-sensing technologies,\nspecifically optical gyros and CVGs. Optical gyros depend on the Sagnac effect,\nwhich applies to light traveling in opposite directions around a closed path that\nis rotating with respect to inertial space [14, 44]. Consider a circular path of\nradius R in a plane that is rotating with clockwise angular velocity ! about an axis\nperpendicular to the plane. Light making a complete circuit clockwise must travel a\ndistance\n\nLC D c tC D 2\nRCR! tC (4.25)\nwhere tC is the time to complete the circuit and c is the speed of light. For light\ntraveling counterclockwise, we have\n\nL? D c t? D 2\nR ?R! t? (4.26)\nThe difference in the path lengths is\n\n?L D LC ? L? D c.tC ? t?/ D c\n?\n\n2\nR\n\nc ?R! ?\n2\nR\n\nc CR!\n?\n\nD 4\ncR\n2 !\n\nc2 ?R2 !2 ?\n4\nR2 !\n\nc\nD 4A!\n\nc\n(4.27)\n\nThis equation generalizes to noncircular and nonplanar paths, with A being the\narea enclosed by the path projected onto the plane perpendicular to the angular\nvelocity [55].\n\n\n\n142 4 Sensors and Actuators\n\nThe Sagnac path difference can in principle be detected as a phase difference\n?? D 2\n?L=\t rad, where \t is the wavelength of the light. However, detecting a\nrate of 0.001 deg/h D 4:85 nrad/s using helium-neon laser light with a wavelength\nof 632.8 nm in a circular loop withR D 0:1m requires measuring a phase difference\nof only 2 ? 10?11 rad, which is impossible. There are two ways to circumvent this\nproblem. The first is to make the light travel around the closed path many times,\nby using many turns of an optical fiber. An interferometric fiber optic gyro (IFOG)\nusing 5,000 turns for a total fiber length of 3,142 m only has to measure a phase\ndifference of 10?7 rad for the example above, which is feasible.6 We will discuss\nIFOGs later.\n\nThe second way to circumvent the problem of measuring small phase differences\nis to use an active laser medium in the path to replace the phase measurement by a\nfrequency measurement. This is the basic idea of a ring laser gyro (RLG). The rota-\ntion splits the laser wavelength and frequency into clockwise and counterclockwise\nmodes\n\n?? D c\n\t?\nD kc\nL?\n\n(4.28)\n\nwhere k is the integer number of wavelengths in the cavity. Then7\n\n?? D ?? ? ?C D kc\nL?\n? kc\nLC\nD kc?L\nLCL?\n\n? kc?L\nL2\n\nD 4A!\nL\t\n\n(4.29)\n\nwhere we have substituted Eq. (4.27) and k D L=\t to obtain the last form. This\nform holds for a path of any shape, where L is the perimeter and A is the enclosed\narea projected onto the plane perpendicular to the rotation. Most RLGs have paths\nin the shape of an equilateral triangle with reflecting mirrors at the vertices. If ` is\nthe length of one side then L D 3`, A D .p3=4/`2, and\n\n?? D `!p\n3\t\n\n(4.30)\n\nWith \t D 632:8 nm and ` D 0:1 m, this gives ?? D .9:1 ? 104/!, which is equal\nto 442?Hz for ! D 0:001 deg/h. The relative ease of detecting small frequency\ndifferences has led to the widespread use of RLGs on aircraft and, to a lesser extent,\non spacecraft.\n\nAn RLG has difficulty in detecting very slow rotations, because nonlinear\ninteractions between the clockwise and counterclockwise oscillations cause their\nfrequencies to lock in to each other. This is usually solved by introducing a\nsinusoidal dither of the gyro about its input axis, with typical frequency of 400 Hz\n\n6Equation (4.27) assumes that the light travels through a vacuum. The fiber\u2019s index of refraction\ncomplicates the analysis, but does not change the order-of-magnitude estimates.\n7Note that ? is measured in Hz, and ! in rad/s.\n\n\n\n4.7 Gyroscopes 143\n\nand amplitude of 0.1? [44]. Using laser oscillations with four frequencies traveling\nin a non-planar path can avoid lock-in without dithering. Although RLGs have\nestablished themselves as the best rate sensing technology in terms of performance\nand reliability in a wide range of applications, they have not been perfect. A slow\ndecrease of laser intensity, thought to be a combined effect of degradation of the\nmirror surfaces and of the lasing medium, has been observed on many RLGs. This\nis less of a problem on aircraft, which are serviced periodically, than on spacecraft.\n\nAlthough the basic concept of the IFOG is simple, the implementation is not.\nReference [45] provides many details. By the mid 1980s, the IFOG had become\ncompetitive with the RLG, despite its lower sensitivity, typically about 0.1 deg/h\nas contrasted with 0.001 deg/h achieved by RLGs. The reason for the IFOG\u2019s\nsuccess includes some desirable features like light weight, small size, limited\npower consumption, projected long lifetime and, not least, lower price. Continuing\ndevelopment has led to increased sensitivity, although a market for navigation-\ngrade IFOGs has not yet materialized; economic forces have concentrated IFOG\ndevelopment to low price, medium sensitivity applications.\n\nCVGs detect the motion of a vibrational mode in a structure caused by Coriolis\nforces. The first CVG to be developed was the hemispheric resonator gyroscope\n(HRG), which uses a flexural mode in a thin wine-glass-shaped resonator anchored\nby a thick stem. Coriolis forces arising from rotation about the stem axis cause a\nslow precession of a standing wave around the resonator with an angular rate that\ndiffers from the input rate. An HRG has two modes of operation: a rebalance\nmode that applies forces to keep the standing wave pattern fixed and a less accurate\n\u201cwhole-angle\u201d mode that measures the free motion of the pattern. HRGs have\nachieved accuracy equal to that of the best DTGs and have found many spacecraft\napplications.\n\nCVGs manufactured with micro-electro mechanical systems (MEMS) technol-\nogy are the newest development. These are packaged similarly to other integrated\ncircuits with a single part often including gyroscopic sensors for multiple axes. The\nresonant structures of MEMS gyroscopes are lithographically constructed tuning\nforks, vibrating wheels, or resonant solids of various designs. MEMS gyros have\nlow cost, low mass, and low power requirements, but also low performance and a\nshort lifetime compared to other gyros. MEMS gyros using components qualified\nfor the radiation environment of space have only recently become available.\n\n4.7.1 Gyro Measurement Model\n\nA widely used three-axis continuous-time mathematical model for a rate-integrating\ngyro is given by [20]\n\n!.t/ D !true.t/C ?true.t/C ?v.t/ (4.31a)\nP? true.t/ D ?u.t/ (4.31b)\n\n\n\n144 4 Sensors and Actuators\n\nwhere !true is the true rate, ! is the measured rate, ?true is the true bias or drift, and\n?v and ?u are independent zero-mean Gaussian white-noise processes with\n\nE\n?\n?v.t/?\n\nT\nv .?/\n\n? D ?2v ?.t ? ?/I3 (4.32a)\nE\n?\n?u.t/?\n\nT\nu .?/\n\n? D ?2u ?.t ? ?/I3 (4.32b)\nwhere ?.t ? ?/ is the Dirac delta function defined as\n\n?.t ? ?/ D 0 if t \u00a4 ?\nZ 1\n\n?1\n?.t ? ?/d? D 1\n\n(4.33)\n\nA more general gyro model includes scale factors and misalignments, which can\nalso be estimated in realtime [48, 53]. The general gyro model including scaling\nfactors and misalignments is given by\n\n! D ?I3 C S true\n\t\n!true C ?true C ?v (4.34)\n\nwith S true denoting the matrix of scale factors and misalignments.\nBoth Eq. (4.31) and Eq. (4.34) represent continuous-time gyro models but in\n\npractice discrete-time gyro measurements are employed and therefore discrete-\ntime models are required. Because the white-noise processes are assumed to be\nuncorrelated we can treat each axis separately. Dividing the single-axis version of\nEq. (4.31a) by the gyro sampling interval, ?t , and integrating gives\n\n1\n\n?t\n\nZ t0C?t\nt0\n\n!.t/ dt D 1\n?t\n\nZ t0C?t\nt0\n\n?\n! true.t/C ?true.t/C ?v.t/\n\n?\ndt (4.35)\n\nApproximating the measured and true values as constant over the interval yields8\n\n!.t0 C?t/ D ! true.t0 C?t/C 1\n?t\n\nZ t0C?t\nt0\n\n?\n?true.t/C ?v.t/\n\n?\ndt (4.36)\n\nIntegrating Eq. (4.31b) gives\n\n?true.t0 C?t/ D ?true.t0/C\nZ t0C?t\nt0\n\n?u.t/ dt (4.37)\n\nThe variance of the gyro drift bias is given by\n\nE\n?\n\u0152?true.t0 C?t/?2\n\n? D E\n(?\n?true.t0/C\n\nZ t0C?t\nt0\n\n?u.t/ dt\n\n?2)\n(4.38)\n\n8Note that we cannot make the same assumption for the stochastic variables.\n\n\n\n4.7 Gyroscopes 145\n\nUsing E f?u.t/?u.?/g D ?2u ?.t ? ?/ gives\nE\n?\n\u0152?true.t0 C?t/?2\n\n? D E ?\u0152?true.t0/?2\n?C ?2u ?t (4.39)\n\nTherefore, the bias can be simulated using\n\n?truem .t0 C?t/ D ?truem .t0/C ?u?t1=2Nu (4.40)\nwhere the subscript m denotes a modeled quantity and Nu is a zero-mean random\nvariable with unit variance.\n\nThe bias at time t is given by\n\n?true.t/ D ?true.t0/C\nZ t\nt0\n\n?u.?/ d? (4.41)\n\nSubstituting Eq. (4.41) into Eq. (4.36) gives\n\n!.t0 C?t/ D zC 1\n?t\n\nZ t0C?t\nt0\n\nZ t\nt0\n\n?u.?/ d? dt C 1\n?t\n\nZ t0C?t\nt0\n\n?v.t/ dt (4.42)\n\nwhere z ? ! true.t0 C ?t/ C ?true.t0/. The correlation between the drift and rate\nmeasurement is given by\n\nE\n?\n?true .t0 C?t/!.t0 C?t/g D E\n\n\n?\n?true.t0/C\n\nZ t0C?t\nt0\n\n?u.?/ d?\n\n?\n\n?\n?\n! true.t0 C?t/C ?true.t0/\n\nC 1\n?t\n\nZ t0C?t\nt0\n\nZ t\nt0\n\n?u.?/ d? dt C 1\n?t\n\nZ t0C?t\nt0\n\n?v.t/ dt\n\n??\n(4.43)\n\nSince ?u.t/ and ?v.t/ are uncorrelated we have\n\nE\n?\n?true.t0 C?t/!.t0 C?t/\n\n? D E ?z?true.t0/\n?\n\nC ?\n2\nu\n\n?t\n\nZ t0C?t\nt0\n\nZ t0C?t\nt0\n\nZ t\nt0\n\n?.? ? ?/ d? d? dt\n\nD E ?z?true.t0/\n?C ?\n\n2\nu\n\n?t\n\nZ t0C?t\nt0\n\n.t ? t0/ dt\n\nD E ?z?true.t0/\n?C 1\n\n2\n?2u ?t (4.44)\n\nEquation (4.44) can be satisfied by modeling the gyro measurement using\n\n!m.t0 C?t/ D ! truem .t0 C?t/C ?truem .t0/C\n1\n\n2\n?u?t\n\n1=2Nu C c Nv (4.45)\n\n\n\n146 4 Sensors and Actuators\n\nwhere the quantity c is yet to be determined and Nv is a zero-mean random\nvariable with unit variance. Note that Eq. (4.45) can be proven by evaluating\nE f?truem .t0 C?t/!m.t0 C?t/g. Solving Eq. (4.40) for Nu and substituting the\nresultant into Eq. (4.45) yields\n\n!m.t0 C?t/ D ! truem .t0 C?t/C\n1\n\n2\n\u0152?truem .t0 C?t/C ?truem .t0/?C c Nv (4.46)\n\nNote that 1\n2\n\u0152?truem .t0 C?t/C ?truem .t0/? is the \u201caverage\u201d of the bias at the two times.\n\nThis term is present due to the fact that the trapezoid rule for integration is exact for\nlinear systems. To evaluate c we compute the variance of the rate measurement:\n\nE\n?\n!2 .t0 C?t/g\n\nDE\n\n?\n\nzC 1\n?t\n\nZ t0C?t\nt0\n\nZ ?\nt0\n\n?u.?/ d? d? C 1\n?t\n\nZ t0C?t\nt0\n\n?v.?/ d?\n\n?\n\n?\n?\n\nzC 1\n?t\n\nZ t0C?t\nt0\n\nZ t\nt0\n\n?u.?/ d? dt C 1\n?t\n\nZ t0C?t\nt0\n\n?v.t/ dt\n\n??\n(4.47)\n\nSince ?u.t/ and ?v.t/ are uncorrelated and usingE f?v.t/?v.?/g D ?2v ?.t??/, then\nEq. (4.47) simplifies to\n\nE\n?\n!2.t0 C?t/\n\n? D ?\n2\nu\n\n?t2\n\nZ t0C?t\nt0\n\nZ t0C?t\nt0\n\nZ t\nt0\n\nZ ?\nt0\n\n?.? ? ?/ d? d? d? dt\n\nCE ?z2?C ?\n2\nv\n\n?t2\n\nZ t0C?t\nt0\n\nZ t0C?t\nt0\n\n?.t ? ?/ d? dt (4.48)\n\nThe quadruple integral in this equation is equal to\n\nZ t0C?t\nt0\n\nZ t0C?t\nt0\n\nmin.? ? t0; t ? t0/ d? dt D\nZ t0C?t\nt0\n\nZ t0C?t\nt0\n\nmin.x; y/ dx dy\n\nD\nZ ?t\n0\n\n?Z y\n0\n\nx dx C\nZ ?t\ny\n\ny dx\n\n?\ndy D\n\nZ ?t\n0\n\n?\n1\n\n2\ny2 C y.?t ? y/\n\n?\ndy D 1\n\n3\n?t3\n\n(4.49)\n\nTherefore, Eq. (4.48) reduces down to\n\nE\n?\n!2.t0 C?t/\n\n? D E ?z2?C 1\n3\n?2u ?t C\n\n?2v\n?t\n\n(4.50)\n\nThe variance of the modeled rate measurement in Eq. (4.45) is given by\n\nE\n?\n!2m.t0 C?t/\n\n? D E ?z2m\n?C 1\n\n4\n?2u ?t C c2 (4.51)\n\n\n\n4.8 Reaction Wheels 147\n\nComparing Eq. (4.51) to Eq. (4.50) gives\n\nc2 D ?\n2\nv\n\n?t\nC 1\n12\n?2u ?t (4.52)\n\nHence, the modeled rate measurement is given by\n\n!m.t0 C?t/ D ! truem .t0 C?t/C\n1\n\n2\n\u0152?truem .t0 C?t/C ?truem .t0/?\n\nC\n?\n?2v\n?t\nC 1\n12\n?2u ?t\n\n?1=2\nNv\n\n(4.53)\n\nGeneralizing Eqs. (4.40) and (4.53) for all times, dropping the subscript m, and\nconsidering all three axes gives the following formulas for the discrete-time rate\nand bias equations:\n\n!kC1 D !truekC1 C\n1\n\n2\n.?truekC1 C ?truek /C\n\n?\n?2v\n?t\nC 1\n12\n?2u ?t\n\n?1=2\nNvk (4.54a)\n\n?truekC1 D ?truek C ?u?t1=2Nuk (4.54b)\n\nwhere the subscript k denotes the kth time-step, and Nvk and Nuk are zero-mean\nGaussian white-noise processes with covariance each given by the identity matrix.\nReplacing !truekC1 with .I3 C S true/!truekC1 in Eq. (4.54a) provides the discrete-time\nmodel for Eq. (4.34).\n\n4.8 Reaction Wheels\n\nReaction wheels are used as the primary attitude control actuators on most\nspacecraft. Momentum-bias spacecraft may use one or two reaction wheels, but\nfull three-axis attitude control requires three or more wheels. Although numerous\nreaction wheels have operated flawlessly for decades, reaction wheel failures have\nbeen a problem on many space missions. Providing extra reaction wheels for\nredundancy gives some protection, but failure of one reaction wheel is often\nfollowed by failure of other wheels of the same design on the same spacecraft. For\nexample, four reaction wheels failed on the Far Ultraviolet Spectroscopy Explorer\n(FUSE) spacecraft in 2001, 2002, 2004, and 2007; and two each on Hayabusa in\nJuly and October 2005, Dawn in 2010 and 2012, and Kepler in 2012 and 2013 [17].\n\n\n\n148 4 Sensors and Actuators\n\n4.8.1 Reaction Wheel Characteristics\n\nReference [8] provides an overview of reaction wheel design. A reaction wheel\nassembly contains a rotating flywheel, typically supported by ball bearings, an\ninternal brushless DC electric motor, and associated electronics. Reaction wheels\nare produced with a wide range of capabilities: maximum torque from 0.01 to\n1.0 Nm, maximum angular momentum from 2 to 250 Nms, and maximum rotational\nspeeds from 1,000 to 6,000 rpm. A vendor will frequently use the same flywheel and\nbearing assembly to construct a wheel with high angular momentum capacity and a\ndifferent wheel with high torque capability. The back electromotive force developed\nat the high speeds required to provide high angular momentum makes it difficult to\nprovide high torque in the same wheel.\n\nThe motor drives of some reaction wheels accept a torque command. Other\nreaction wheels have an internal closed-loop controller that holds the reaction wheel\nspeed at a commanded value. The control electronics of some wheels are integral\nwith the wheel unit, while others locate the controller in a separate electronics box.\nA reaction wheel is generally provided with a digital or analog tachometer, or both,\nto provide a reading of the wheel\u2019s rotational speed.\n\nWheel friction, or drag, is usually modeled as a sum of viscous and Coulomb\ncomponents\n\nLwdrag D ??v !w ? ?c sign.!w/ (4.55)\nwhere the coefficients ?v and ?c are empirically determined and can exhibit\ntemperature dependence [8]. This model is adequate in many applications, but does\nnot give a good description of friction at low speeds, especially when crossing\nzero speed. A dynamic model of friction incorporating hysteresis is required\nto represent these phenomena adequately. Reference [1] provides an excellent\nreview of the issues involved in characterizing and modeling friction, and of the\nhistorical development of friction modeling. The first dynamic friction model to\nfind widespread applications was the Dahl model, introduced in 1968 [18]. Many\nmodels have been proposed since, including the LuGre model developed by control\ngroups in Lund and Grenoble [2, 12]. This modification of the Dahl model allows\nfrictional forces to be larger at low speeds, an effect known as the Stribeck effect or\nas stiction. Increasing drag torque is often an indication of potential wheel failure,\nso it is a general practice to carefully monitor the drag torque on reaction wheels on\norbiting spacecraft.\n\n4.8.2 Reaction Wheel Disturbances\n\nAlthough reaction wheels are invaluable for providing fine pointing control of\nmany spacecraft, they are also one of the major sources of attitude disturbances.\nReferences [9] and [31] provide excellent overviews of the various categories of\n\n\n\n4.8 Reaction Wheels 149\n\nreaction wheel disturbances, which can be classified as radial forces, axial forces,\nradial moments, and axial moments. Disturbance forces perturb the spacecraft\u2019s\nattitude by creating an r?F torque, where r is the vector from the spacecraft\u2019s center\nof mass to the point of application of the force. Thus the effects of reaction wheel\nforce disturbances can be minimized by locating the wheel close to the spacecraft\u2019s\ncenter of mass. The effects of disturbance moments are independent of the location\nof the wheel.\n\nDeviations of the wheels from the assumption of perfect balance made in\nSect. 3.3.5.1 are a principal contributor to disturbances. These deviations are\nclassified as static imbalance or dynamic imbalance. Static imbalance is the\ncondition that the wheel\u2019s center of mass is not on the axis of rotation. In this case,\nthe spacecraft must provide, through the bearing assembly, the centripetal force\nneeded to continuously accelerate the center of mass in a circular motion about the\naxis of rotation. If Mw is the mass of the rotor, !w is the magnitude of its angular\nvelocity, w is a unit vector along its axis of rotation, and x is a vector from the axis\nto the wheel\u2019s center of mass, the static imbalance force is\n\nFs DMw.!w/2w ? .w ? x/ D ?Mw.!w/2\n2\n4\nx1\nx2\n0\n\n3\n5 (4.56)\n\nwhere the last form assumes that w D \u01520 0 1?T . This is a radial force, constant\nin the wheel frame and rotating with angular velocity !w in the spacecraft frame.\n\nIt has magnitude Fs D Us.!w/2, where the static imbalance Us ?Mw\nq\nx21 C x22 is\n\nproportional to the perpendicular distance from the axis to the center of mass. The\nSI unit for static imbalance would be kg-m, but it is usually given in g-cm (or in\nounce-inches) because it is so small.\n\nDynamic imbalance is the condition that the axis of rotation of the wheel is not\na principal axis. In this case, keeping the wheel rotating at a constant rate !w about\nthe spin axis, which we assume to be w D \u01520 0 1?T , requires a torque\n\nLd D ! ?H D .!w/2w ? .Jw/ D .!w/2\n2\n4\n?J23\nJ13\n0\n\n3\n5 (4.57)\n\nThis is a radial moment, constant in the wheel frame and rotating with angular\nvelocity !w in the spacecraft frame. It has magnitude Ld D Ud.!w/2, where\nUd ?\n\nq\nJ 223 C J 213 is called the dynamic imbalance. It is generally specified in\n\ng-cm2, although the proper SI unit would be kg-m2.\nIn addition to static and dynamic imbalance, a reaction wheel also exhibits struc-\n\ntural dynamic modes resulting from compliance in the bearings. These modes fall\ninto the three classes illustrated in Fig. 4.6: an axial translation mode, modes\ncorresponding to radial translation in two orthogonal directions, and rocking modes\nabout two orthogonal rocking axes. If the bearing compliance is isotropic, the two\nradial translation modes will have equal frequencies.\n\n\n\n150 4 Sensors and Actuators\n\na b c\n\nFig. 4.6 Structural dynamic modes of a reaction wheel. (a) Axial translation. (b) Radial transla-\ntion. (c) Rocking\n\nThe rocking modes interact with the rotation of the wheel to give whirl modes.\nAssume that the rotor\u2019s actual spin axis is misaligned by a small rotation vector ?# .\nThen the wheel\u2019s angular momentum in a reaction wheel frame in which the nominal\nspin axis of the wheel is \u01520 0 1?T is\n\nH D diag\n\nh\nJ? J? J k\n\ni?\n? P# C .I3 ? \u0152?#??/\n\nh\n0 0 J k!w\n\niT\n\nD\n2\n4\nJ?? P#1 ? J k!w?#2\nJ?? P#2 C J k!w?#1\nJ k.? P#3 C !w/\n\n3\n5 (4.58)\n\nto first order in ?# , where the ? P# term comes from Eq. (3.45). Note that ?#3 only\nappears in this equation in the form of its derivative. We can absorb ? P#3 into !w\nto eliminate ?#3 completely from the analysis. We can treat the wheel frame as\ninertial, because its motion is negligible compared to the motion of the rotor. Thus\nthe equations of motion are\n\nPH D\n2\n4\nJ?? R#1 ? J k!w? P#2\nJ?? R#2 C J k!w? P#1\n\nJ k P!w\n\n3\n5 D L D ?J?!20\n\n2\n4\n?#1\n?#2\n0\n\n3\n5 (4.59)\n\nThe last equality assumes isotropic elastic restoring forces with coefficients on both\naxes which we choose to write as J?!20 . The third component of the equation says\nthat !w is constant, which is not surprising. We are looking for periodic solutions,\nso we write\n\n?\n?#1.t/\n\n?#2.t/\n\n?\nD\n?\n?#1.0/\n\n?#2.0/\n\n?\nei!t (4.60)\n\nSubstituting this into Eq. (4.59) gives\n\n0 D\n?\nJ?.?!2 C !20/ ?iJ k!w!\n\niJ k!w! J?.?!2 C !20/\n? ?\n?#1.0/\n\n?#2.0/\n\n?\n(4.61)\n\n\n\n4.8 Reaction Wheels 151\n\n0 1000 2000 3000 4000 5000 6000\n0\n\n50\n\n100\n\n150\n\n200\n\n250\n\n300\n\n350\n\nWheel Speed (rpm)\n\nD\nis\ntu\n\nrb\nan\n\nce\n F\n\nre\nqu\n\nen\nci\n\nes\n (\nH\n\nz)\n\nFig. 4.7 Frequencies of radial moment disturbances\n\nThe determinant of the 2? 2 matrix must vanish for a solution to exist, which gives\n0 D J?.?!2 C !20/? J k!w! D ?J?.!2 ? !20 \t 2?!w!/ (4.62)\n\nwhere we have written J k D 2?J?. Note that ? < 1 by the triangle inequality for\nprincipal moments, and that ? D 1 for an ideal infinitely thin disk. The frequencies\nof the positive and negative whirl modes are the roots of this quadratic equation;\n\n!? D\nq\n.?!w/2 C !20 ? ?!w (4.63)\n\nWe choose the positive sign of the square root because frequencies are convention-\nally defined to be positive. The higher frequency mode is a forward whirl, where the\nwhirl is in the same direction as the wheel rotation, while the lower frequency mode\nis a negative whirl, with motion opposed to the wheel rotation [9].\n\nIt is useful to plot the frequencies of the disturbances as a function of the\nreaction wheel speed in a Campbell diagram. Figure 4.7 is an example showing\nthe radial moment disturbance frequencies of a notional reaction wheel. The radial\nmoment diagram is the most interesting case because it exhibits the whirl modes.\nThe fundamental mode ! D !w is the disturbance arising from dynamic imbalance.\nThe first harmonic ! D 2!w is also apparent, as are frequencies at non-integral\nmultiples of !w arising from the bearing disturbances. The specific multiples shown\nin the figure are those shown in [9], which also has a table relating the frequencies\nof bearing disturbances to the physical properties of the bearings.\n\n\n\n152 4 Sensors and Actuators\n\nThe Campbell diagram is especially useful in showing the intersections, or\n\u201ccollisions\u201d of the frequencies of different disturbances. These intersections, marked\nby the small circles in Fig. 4.7, signify resonance conditions leading to larger\ndisturbances. It is interesting to note that the intersections with the negative whirl\nmode, with frequency !?, do not give rise to a resonant condition if the bearing\nrestoring forces are perfectly isotropic, as was assumed in Eq. (4.59), because\nthe excitation and response vectors are perfectly orthogonal in that case [9].\nThis is fortuitous, because these intersections, being at low frequencies, could be\nproblematic. They are not completely absent, of course, because the bearings are\nnever perfectly isotropic.\n\nSimulation or measurement of actual reaction wheel disturbances are shown\non a waterfall chart that looks like a Campbell diagram with a third axis to plot\nthe disturbance level. Discussions of experimental validation of reaction wheel\ndisturbance models with several examples of waterfall charts can be found in [42]\nand [38]. The study of reaction wheel disturbances is only one part of a general jitter\nanalysis [37].\n\nThe reaction wheel\u2019s motor can contribute to axial moment disturbances. The\ndrive torque provided by the motor is a source of high frequency disturbances.\nTorque ripple is a result of the drive torque being a superposition of rectified sine\nwaves. The torque ripple of a motor with a greater number of poles is at a higher\nfrequency, where it is less problematic. Cogging torques, a result of the magnets\nin the rotor moving past a ferromagnetic stator, are present regardless of whether a\ntorque is applied, but are absent from reaction wheels that have no ferromagnetic\nmaterials in the stator [9]. Migration of lubricant in the bearings can give rise to low\nfrequency torque noise, which can have a significant effect on spacecraft pointing.\nLight oils are less likely to produce torque noise than grease, but grease is less prone\nthan oil to migration during storage at one g and during launch.\n\nThe effects of reaction wheel disturbances on spacecraft jitter are often mitigated\nby mounting the reaction wheels on flexible isolators. These must be carefully\nanalyzed, however, because the interaction of the wheels\u2019 rocking modes with the\nisolator modes can lead to potentially troublesome mode collisions [11].\n\n4.8.3 Redundant Wheel Configurations\n\nSpacecraft are often equipped with more than the three reaction wheels, both\nfor redundancy and to provide greater torque and momentum storage capability.\nRedundant reaction wheels are quite commonly placed in a hot backup configuration\nfor this purpose. The torque provided by six reaction wheels allows the NASA\nSwift spacecraft to complete 50? slew maneuvers in 75 s in order to collect data\non transient gamma ray bursts. Similar configurations also allow for longer time\nintervals between momentum unloads for spacecraft, such as the James Webb Space\nTelescope (JWST), that cannot unload angular momentum continuously.\n\n\n\n4.8 Reaction Wheels 153\n\nThe momentum transfer maneuver has been studied in detail using multiple\nwheels. This problem is related to the initial acquisition after launch since the wheel\nor wheels are at rest while the spacecraft has some momentum imposed by the\nlaunch vehicle in a given axis. Reference [28] studied the strategy to transfer this\ninitial momentum to the wheel(s) as well as to avoid occurrence of a singular state,\nand [63] introduced a near minimum time eigenaxis rotation maneuver using a set\nof three reaction wheels without momentum bias for a nadir pointing spacecraft in a\ncircular low-Earth orbit. The combined eigenaxis maneuvers (using reaction wheels\nand thrusters) are presented in [13] to reduce the time spent on large rotations.\nThe reaction wheel optimization problem has been extensively analyzed in the\nliterature (e.g. see [22,23], and [41]). In the first two of these references the assembly\nconfiguration has been selected to minimize the power consumption of the wheels\nin their task of absorbing the secular portion of the environmental torques.\n\nOur analysis will implicitly assume that all the reaction wheels on a spacecraft\nare identical, which is usually, but not universally, the case. We arrange the applied\ntorque and the wheel angular momenta of the individual wheels, Lwi and H\n\nw\ni , in\n\ncolumn vectors LwW and H\nw\nW , where the subscript W denotes the n-dimensional\n\nwheel frame. The transformation from the wheel frame to the body frame is given\nby the 3 ? n distribution matrix Wn, whose columns are unit vectors in the body\nframe, wi , along the spin axes of the wheels:\n\nWn D\n?\nw1 w2 ? ? ? wn\n\n?\n(4.64)\n\nThe total wheel torque and angular momentum in the body frame are given by\n\nLwB D Wn\n?\nLw1 L\n\nw\n2 ? ? ? Lwn\n\n?T ? WnLwW (4.65a)\nHwB D Wn\n\n?\nHw1 H\n\nw\n2 ? ? ? Hwn\n\n?T ? WnHwW (4.65b)\nBecause the equations for torque and angular momentum are parallel, we will\nconcentrate on angular momentum in the following. Every result we find for angular\nmomentum has a corresponding relation for torque. It is important to note that HwW\nand HwB will not have the same magnitude in general, because Wn is generally not\nan orthogonal matrix.\n\nWe really want to invert Eqs. (4.65), that is to transform a desired body frame\nangular momentum or torque vector into the wheel frame. This is trivial for n D 3,\nwe simply set HwW D W ?13 HwB , assuming that the distribution matrix is invertible.\nInvertibility requires the distribution matrix to have full rank, rank three in this case,\nand is equivalent to the requirement that the spin axis unit vectors wi do not all lie in\na plane. This will be true for any reaction wheel configuration designed to provide\nthree-axis control.\n\nThere is no unique way to distribute the torque or angular momentum for n > 3,\nand we will consider two approaches: the pseudoinverse and minimax methods.\nEquation (4.65b) demands that the difference,?HwW , between two distinct values of\nHwW that produce the same H\n\nw\nB must satisfy the equation Wn?H\n\nw\nW D 0. This says\n\nthat ?HwW must lie in the null space of the matrix Wn, which is .n? 3/-dimensional\nif Wn has full rank, as we assume.\n\n\n\n154 4 Sensors and Actuators\n\nw2\n\nw3\n\nw1\n\nw2\n\nw3w4\n\ne2 e2\n\ne3e1\n\nFig. 4.8 Pyramid configuration\n\nLet us now look at some specific configurations of redundant reaction wheels.\nWe will consider two popular four-wheel configurations: a pyramid configuration\nand a configuration known as the NASA standard configuration that was used\non the Multimission Modular Spacecraft (MMS). Figure 4.8 shows the pyramid\nconfiguration. This configuration assumes symmetry on each coordinate plane.\nIts transformation matrix from the reaction wheel coordinate system to the body\ncoordinate system is given by\n\nW4 D\n2\n4\na ?a 0 0\nb b c c\n\n0 0 d ?d\n\n3\n5 (4.66)\n\nwhere a2Cb2 D c2Cd2 D 1. This matrix assumes a preferential direction along the\nbody e2 axis, with each wheel contributing to this direction. For a D d and b D c,\nthe spin axes make the same angle with the .e1; e3/ plane. This layout is the most\ncommon configuration for Earth-pointing spacecraft in which a constant rate along\nthe pitch axis is required to point the instruments toward the Earth\u2019s surface. The\npreferred axis of the transformation in Eq. (4.66) or of any other distribution matrix\ncan be changed by multiplying Wn on the left by the appropriate rotation matrix.\nThe null space of W4 is one-dimensional, consisting of scalar multiples of the unit\nvector\n\nn4 D 1p\n2.b2 C c2/\n\n2\n664\n\nc\n\nc\n\n?b\n?b\n\n3\n775 (4.67)\n\nThe NASA Standard four-wheel configuration places three orthogonal wheel\nspin axes along the body axes and the fourth, skew, wheel axis with projected\ncomponents along each body axis, as shown in Fig. 4.9. The transformation matrix\nfor this configuration is given by\n\nWN D\n2\n4\n1 0 0 ?\n\n0 1 0 ?\n\n0 0 1 ?\n\n3\n5 (4.68)\n\n\n\n4.8 Reaction Wheels 155\n\nw3\nw4\n\nw2\nw1\n\ne1\n\ne3\n\ne2\n\nFig. 4.9 NASA standard\nconfiguration\n\nwhere ?2 C ?2 C ?2 D 1. The null space of WN is along the unit vector\n\nnN D 1p\n1C ?2 C ?2 C ?2\n\n2\n664\n\n?\n\n?\n\n?\n\n?1\n\n3\n775 (4.69)\n\nFor the special, but very common, case given by ? D ? D ? D 1=p3, the fourth\nwheel\u2019s spin axis is at an angle of 54:7? with respect to the coordinate axes.\n\nWe will also consider two six-wheel configurations, both with distribution matrix\n\nW6 D\n2\n4\nb c b c b c\n\n0\np\n3d=2\n\np\n3a=2 0 ?p3a=2 ?p3d=2\n\na d=2 ?a=2 ?d ?a=2 d=2\n\n3\n5 (4.70)\n\nwhere a2Cb2 D c2Cd2 D 1. The null space of W6 is three-dimensional, requiring\nthree linearly independent vectors to span it. The usual case, which we will refer\nto as the pyramid configuration, has b D c and a D d , as on Swift and JWST,\nso the spin axis directions are evenly distributed around a cone centered on the e1\naxis. The other six-wheel configuration attains the maximum symmetry possible\nwith six wheels by choosing the parameters b D sin?, a D cos?, c D sin?, and\nd D cos?, with tan? D .3Cp5/=4 and tan? D .3 ? p5/=4, so that the wheel\nspin axis vectors are normal to the faces of a regular dodecahedron.9\n\n4.8.3.1 Pseudoinverse Distribution Law\n\nThe method chosen to distribute torque or angular momentum among redundant\nwheels is specific to the mission\u2019s requirements, but the most common method is to\n\n9The authors thank John P. Downing for suggesting this configuration.\n\n\n\n156 4 Sensors and Actuators\n\nuse the pseudoinverse of W , denoted by W ?. The pseudoinverse, or Moore-Penrose\ngeneralized inverse, of a real matrix satisfies the conditions: W W ?W D W ,\nW ?W W ? D W ?, and W W ? and W ?W are symmetric [21, 25].\n\nIf Wn has full rank, as we are assuming, the pseudoinverse is given by\n\nW ?n D W Tn\n?\nWnW\n\nT\nn\n\n\t?1\n(4.71)\n\nIn addition to all the conditions required of a pseudoinverse, this satisfies the\nstronger relation\n\nWnW\n?\nn D I3 (4.72)\n\nNote, however, that W ?n Wn \u00a4 In for n > 3. Equation (4.72) guarantees that\nEq. (4.65b) is satisfied if we set\n\nHwW D W ?n HwB (4.73)\n\nThe most general wheel angular momentum vector HwW satisfying Eq. (4.65b) is\ngiven by\n\nHwW D W ?n HwB C nn D W Tn\n?\nWnW\n\nT\nn\n\n\t?1\nHwB C nn (4.74)\n\nwhere nn is an arbitrary vector in the null space of Wn. This gives\n\nkHwW k2 D kW Tn\n?\nWnW\n\nT\nn\n\n\t?1\nHwBk2 C 2.HwB/T\n\n?\nWnW\n\nT\nn\n\n\t?1\nWnnn C knnk2\n\nD .HwB/T\n?\nWnW\n\nT\nn\n\n\t?1\nHwB C knnk2 (4.75)\n\nby the definition of the null space. We see that the Euclidean norm, or L2 norm,\nof the wheel momentum vector is minimized by setting nn D 0, i.e. by using the\npseudoinverse to distribute the angular momenta.\n\nNow let us consider some specific cases. The pseudoinverse of W4 for the four-\nwheel pyramid is given by Eq. (4.71) as\n\nW\n?\n4 D\n\n1\n\n2\n\n2\n664\n\n1=a b=.b2 C c2/ 0\n?1=a b=.b2 C c2/ 0\n0 c=.b2 C c2/ 1=d\n0 c=.b2 C c2/ ?1=d\n\n3\n775 (4.76)\n\nIt is easy to see that W ?4 satisfies Eq. (4.72) and that\n\nW\n?\n4 W4 D I4 ? n4nT4 (4.77)\n\n\n\n4.8 Reaction Wheels 157\n\nThe pseudoinverse of WN for the NASA standard configuration is given by\n\nW\n?\n\nN D\n1\n\n1C ?2 C ?2 C ?2\n\n2\n664\n\n1C ?2 C ?2 ??? ???\n??? 1C ?2 C ?2 ???\n??? ??? 1C ?2 C ?2\n? ? ?\n\n3\n775 (4.78)\n\nwhich satisfies Eq. (4.72) and\n\nW\n?\n\nN WN D I4 ? nNnTN (4.79)\n\nThe pseudoinverse of W6 for the six-wheel configurations is given by\n\nW\n?\n6 D\n\n1\n\n3\n\n2\n66666664\n\nb=.b2 C c2/ 0 2a=.a2 C d2/\nc=.b2 C c2/ p3d=.a2 C d2/ d=.a2 C d2/\nb=.b2 C c2/ p3a=.a2 C d2/ ?a=.a2 C d2/\nc=.b2 C c2/ 0 ?2d=.a2 C d2/\nb=.b2 C c2/ ?p3a=.a2 C d2/ ?a=.a2 C d2/\nc=.b2 C c2/ ?p3d=.a2 C d2/ d=.a2 C d2/\n\n3\n77777775\n\n(4.80)\n\nWe have seen that the pseudoinverse method for distributing torque or momen-\ntum among redundant reaction wheels minimizes the Euclidean norm of the torque\nor momentum vector in the wheel frame. That is, it minimizes the sum of the squares\nof the individual wheel torques or angular momenta. This may be optimal from an\nenergy standpoint, but it does not necessarily result in using the full capability of\nthe reaction wheel array. The pseudoinverse has the advantage of being relatively\nsimple to implement, and it also has a subtler advantage. If we distribute the angular\nmomentum according to Eq. (4.73), then the time derivative of this equation gives\n\nLwW D PHwW D W ?n PHwB D W ?n LwB (4.81)\n\nshowing that the pseudoinverse momentum and torque distribution laws are mutu-\nally consistent.\n\n4.8.3.2 Minimax Distribution Law\n\nThe ultimate capability of an assembly of reaction wheels is attained by minimizing\nthe maximum effort expended by any wheel, rather than by minimizing the sum\nof squares of the efforts expended by the reaction wheels. Since the L1 norm\nof a vector is defined to be the magnitude of its largest component, this minimax\noptimization is also referred to as the L1 method [41]. We will continue to\nemphasize optimization of angular momentum, since the results obtained can easily\nbe adapted to optimize torque distribution.\n\n\n\n158 4 Sensors and Actuators\n\nWe will only consider reaction wheel configurations where no three of the wheel\nspin axis vectors, wi , lie in a plane. This is not a restrictive assumption, as almost all\nreaction wheel assemblies satisfy it. The following argument shows that minimizing\nthe largest magnitude of individual wheel angular momentum in an array of n\nreaction wheels will result in n ? 2 of the wheels all having momentum of the\nsame magnitude. If this were not the case, we could reduce the magnitude of the\nmomentum of the wheels having the largest momentum by distributing it among\nthe other wheels. This process could be continued until there were only two wheels\nremaining with less than the maximum magnitude. The process cannot be carried\nfurther because a general three-component excess momentum vector cannot be\ndistributed between only two wheels.\n\nLet H0 denote the maximum wheel momentum magnitude. We will consider the\nproblem of maximizing the body momentum HwB for a given value of H0 because\nthis is equivalent to minimizingH0 for a given HwB . Let us first maximize the angular\nmomentum in the direction wi ? wj . This angular momentum does not depend on\nHwi and H\n\nw\nj , so the maximum in the direction wi ?wj is obtained by assigning the\n\nmaximum magnitude H0 to all the other wheels with the signs given by\n\nHwk D H0 sign.sijk/ for k \u00a4 i; j (4.82)\nwhere\n\nsijk ? .wi ? wj / ? wk (4.83)\nWith this distribution, the angular momentum in the body frame is\n\nHwB D Hwi wi CHwj wj CH0vij (4.84)\nwith\n\nvij ?\nnX\n\nkD1\nk\u00a4i;j\n\nwk sign.sijk/ (4.85)\n\nBecause the angular momenta of wheels i and j can have any magnitude less than or\nequal toH0, the range of angular momenta described by Eq. (4.84) covers a rhombus\nwith sides of length 2H0 parallel to wi and wj . The distance in the normal direction\nfrom the origin to this rhombus is H0 dij , where\n\ndij ? kwi ? wj k?1\u0152.wi ? wj / ? vij ? D kwi ? wj k?1\nnX\n\nkD1\nk\u00a4i;j\n\njsijkj (4.86)\n\nThe rhombi for all n.n ? 1/ pairs of spin axis indices form an n.n ? 1/-faced\npolyhedron. It is symmetrical about the origin, with its j i face opposite to its ij face,\nbecause vij D ?vj i . At the vertices of the polyhedron all the wheel momenta have\n\n\n\n4.8 Reaction Wheels 159\n\n3\n2\n\n1\n0\n\n1\n2\n\n3\n\nY\n\n3\n\n2\n\n1\n\n0\n\n1\n\n2\n\n3\n\nZ\n\n3\n2\n1\n0\n\n1\n\n2\n\n3\n\nX\n\nnewpoly.eps\n\nFig. 4.10 Momentum polyhedron for six-wheel pyramid\n\nmagnitude H0, and n? 1 of the momenta have this magnitude along the edges. The\npolyhedron forH0 equal to the maximum storage capacity of a single wheel bounds\nthe angular momentum storage capacity of the wheel configuration. Figure 4.10\nshows the polyhedron for a six-wheel pyramid configuration with the parameters\nb D c Dp1=3, a D d Dp2=3, and axes labeled in units of H0.10\n\nWe now want to invert Eq. (4.84) in order to transform the body frame angular\nmomentum into the wheel frame. Writing this as a matrix equation,\n\nHwB D\n?\nwi wj vij\n\n?\n2\n4\nHwi\nHwj\nH0\n\n3\n5 (4.87)\n\n10The momentum polyhedron of the dodecahedron reaction wheel configuration takes the form of\na rhombic tricontahedron, the shape of a 30-sided die.\n\n\n\n160 4 Sensors and Actuators\n\nand inverting gives\n\n2\n4\nHwi\nHwj\nH0\n\n3\n5 D 1\n\n.wi ? wj / ? vij\n\n2\n4\n.wj ? vij /T\n.vij ? wi /T\n.wi ? wj /T\n\n3\n5HwB (4.88)\n\nThe first two rows of this equation giveHwi andH\nw\nj , and the third row and Eq. (4.82)\n\ngive\n\nHwk D .wij ?HwB/ sign.sijk/ for k \u00a4 i; j (4.89)\nwhere\n\nwij ? \u0152.wi ? wj / ? vij ??1.wi ? wj / (4.90)\nComparing with Eq. (4.86) shows that\n\nkwij k D d?1ij (4.91)\nEquations (4.88) and (4.89) can be rearranged into the matrix form\n\nHwW D W ijn HwB (4.92)\nwhere the elements of the matrix W ijn are specified by Eqs. (4.88) and (4.89). This\nmatrix was explicitly constructed to satisfy Eq. (4.65b), so it follows that\n\nWnW\nij\nn D I3 (4.93)\n\nwhich is the same as Eq. (4.72) for the pseudoinverse. Thus W ijn satisfies all the\nrequirements for being a pseudoinverse except that W ijn Wn is not symmetric in\ngeneral. It appears that we have n.n ? 1/ matrices for computing the minimax\nmomentum distribution, and we need a criterion to choose among them. Before\nproceeding, however, we note from the symmetry of the equations under interchange\nof the indices i and j that W ijn D W j in , so we actually have only n.n ? 1/=2\nindependent minimax distribution matrices.\n\nWe will show the minimax distribution matrices for the four-wheel pyramid as\nan illustration. With ? ? sign.bc/, these matrices are found to be\n\nW 124 D\n1\n\n2\n\n2\n664\n\n1=a 1=b 0\n\n?1=a 1=b 0\n0 0 1=d\n\n0 0 ?1=d\n\n3\n775 ; W 344 D\n\n1\n\n2\n\n2\n664\n\n1=a 0 0\n\n?1=a 0 0\n0 1=c 1=d\n\n0 1=c ?1=d\n\n3\n775\n\nW 134 D\n1\n\n2.b C ?c/\n\n2\n664\n\n.b C 2?c/=a 1 ?c=d\n?b=a 1 ?c=d\n??b=a ? .2b C ?c/=d\n??b=a ? ??c=d\n\n3\n775\n\n\n\n4.8 Reaction Wheels 161\n\nO\n\nH0djk\n\nHwBH0dij\n\nfij\n\nfjk\n\nFig. 4.11 Identifying the\ncorrect face. See text for\nexplanation\n\nW 144 D\n1\n\n2.b C ?c/\n\n2\n664\n\n.b C 2?c/=a 1 c=d\n?b=a 1 c=d\n??b=a ? ?c=d\n??b=a ? ?.2b C ?c/=d\n\n3\n775\n\nW 234 D\n1\n\n2.b C ?c/\n\n2\n664\n\nb=a 1 ?c=d\n?.b C 2?c/=a 1 ?c=d\n\n?b=a ? .2b C ?c/=d\n?b=a ? ??c=d\n\n3\n775\n\nW 244 D\n1\n\n2.b C ?c/\n\n2\n664\n\nb=a 1 c=d\n\n?.b C 2?c/=a 1 c=d\n?b=a ? ?c=d\n\n?b=a ? ?.2b C ?c/=d\n\n3\n775 (4.94)\n\nFinding the correct matrix to compute the minimax distribution requires identify-\ning the face of the polyhedron that the body momentum vector falls on. Figure 4.11\nis an edge-on view of two adjoining faces, fij and fjk , which means that wj is\nnormal to the plane of the paper. The center of the polyhedron, the origin of body\nmomentum space, is labeled O, and the normal distances from the origin to the faces\nare specified. The projection of the body momentum vector HwB into the plane of the\npaper is also shown. We assume that the momentum is on face fij , as indicated by\nthe tip of the arrow. Equations (4.90) and (4.91) tell us that wij D d?1ij eij , where eij\nis the unit vector normal to fij , so we see from the figure that\n\nwij ?HwB\nwjk ?HwB\n\nD d\n?1\nij eij ?HwB\nd?1jk ejk ?HwB\n\n> 1 (4.95)\n\nThe inequality holds because eij ?HwB D H0dij and ejk ?HwB , the distance from the\norigin to the dashed line in the figure, is less than H0djk , the distance to fjk . Thus\nthe angular momentum will be on face fij if wij ? HwB > wjk ? HwB . Generalizing\nthis to the entire polyhedron establishes that the correct face is the one producing\n\n\n\n162 4 Sensors and Actuators\n\nthe maximum value of wij ?HwB .11 Note that fij is not the face whose normal vector\nis closest to HwB in general, because the distances dij to the different faces are not\nequal. The equality of W ijn and W\n\nj i\nn means the we only have to identify the correct\n\npair of parallel faces, and the relation wij D ?wj i says that this requires evaluating\nn.n ? 1/=2 dot products and finding the maximum value of jwij ?HwB j.\n\nIt is often better to maximize the torque provided by a reaction wheel array,\nrather than its angular momentum storage capacity. The Swift spacecraft provides an\nexcellent example. Being in near-Earth orbit, it can unload momentum continuously,\nso the stored momentum is always small; and high torques are required to slew\nrapidly in order to image transient gamma-ray bursts. Thus we command the wheel\ntorque vector LwW D W jkn LwB , where fjk is the face that maximizes jwjk ? LwB j.\nThis torque will not necessarily maintain a minimax distribution of reaction wheel\nmomenta, because the face on which jwjk ? LwB j is maximized is generally not the\nsame as the face on which jwij ? HwB j is maximized. This can be dealt with by\nsetting up a slower control loop to asymptotically drive the wheels to their minimax\nmomentum distribution. The controller can use wheel tachometer data to compute\nHwW and Eq. (4.65b) to compute the body angular momentum. Maximizing jwij ?HwB j\nidentifies the face providing the minimax momentum distribution and thus provides\nthe desired wheel momentum W ijn HwB D W ijn WnHwW . Then the torque command is\n\nLwW D W jkn LwB C ?.W ijn WnHwW ?HwW / D W jkn LwB C ?.W ijn Wn ? In/HwW (4.96)\n\nwhere LwB is the desired torque in the body frame and ? is a feedback gain.\nEquation (4.93) shows that the feedback term is in the null space of Wn, so it does\nnot affect the resultant torque in the body frame.\n\nAnother observation about minimax distribution of momentum is that unaccept-\nable jitter can result if n ? 2 wheel speeds coincide with the frequency of a flexible\nmode of the spacecraft structure. It is also desirable to avoid sustained operation of\nreaction wheels near zero speed. These problems can be avoided without perturbing\nthe spacecraft pointing by using torque or momentum in the .n ? 3/-dimensional\nnull space of Wn to separate equal wheel speeds or to drive a wheel\u2019s speed\nrapidly through zero or past a resonant frequency [41]. Minimizing jitter is most\nimportant during stable pointing of the spacecraft, especially for a precision pointing\nmission like JWST with its milli-arcsecond level stability requirements. Avoiding\nwheel speeds near zero or a resonant frequency is less important and sometimes\nunavoidable while executing slews, as will be seen in the examples in the next\nsection.\n\n11This relation, which is crucial for real-time implementation of the minimax algorithm, was\ndiscovered by Frank X. Liu.\n\n\n\n4.8 Reaction Wheels 163\n\nTable 4.2 Multiple wheel capability as a multiple of the capacity of a\nsingle wheel for pseudoinverse and minimax distribution\n\nConfiguration Wheel Failure Pseudoinverse Minimax\n\nNASA Standard None 1.155 1.414\nAny Orthogonal 0.577 0.577\nSkew 1.000 1.000\n\nFour-Wheel Pyramid None 1.333 1.633\nAny One 0.816 0.816\n\nSix-Wheel Pyramid None 2.000 2.667\nAny One 1.309 1.667\n\nDodecahedron None 2.000 2.753\nAny One 1.581 1.902\n\n4.8.3.3 Comparison of Pseudoinverse and Minimax Distribution Laws\n\nWe will now examine the maximum momentum storage capacity in the least\nfavorable direction of several wheel configurations, using the minimax or pseudoin-\nverse method to distribute the angular momentum. Recall that the same relations\nwill hold for the torque capability of the array. We denote the momentum storage\ncapacity of a single wheel by Hmax. The momentum storage capacity is determined\nby considering the maximum momentum that can be assigned to any wheel for a\ngiven magnitude of body momentum. This occurs for the pseudoinverse method\nwhen HwB is parallel to the row of the pseudoinverse matrix corresponding to that\nwheel, and the magnitude of the momentum assigned to the wheel will be the\nproduct of the magnitude of the body momentum and the Euclidean norm of that\nrow vector. Thus the momentum capacity in the least favorable direction is Hmax\ndivided by the maximum of the norms of the rows of the pseudoinverse matrix.\nAnalysis of the minimax method indicates that the maximum storage on face fij is\nat least as large as dij .12 Thus the minimax storage capacity in the least favorable\ndirection is Hmax times the minimum of dij over all the faces.\n\nTable 4.2 shows the capabilities of four wheel configurations: the NASA\nStandard configuration with ? D ? D ? D 1=p3, the four-wheel and six-wheel\npyramids with b D c D p1=3 and a D d D p2=3, and the six-wheel\ndodecahedron. Reference [41] proves that these parameters for the pyramid con-\nfigurations make their storage capability as isotropic as possible.13 It must be\nemphasized that these choices will rarely be optimal for any specific mission,\nsince moments of inertia, slewing requirements, and environmental torques are\nalmost never isotropic. However, they provide a baseline for comparing the different\n\n12This is true for all the configurations considered here, but may not hold for some pathological\nconfigurations [41].\n13The four-wheel and six-wheel pyramids with these parameters, and also the dodecahedron,\nhave WnW Tn D .n=3/I3. Then Eq. (4.75) shows that the pseudoinverse distribution method giveskHwW k2 D .3=n/kHwBk2 for these configurations.\n\n\n\n164 4 Sensors and Actuators\n\nconfigurations and distribution methods. We also present the storage capacities of\nthe four configurations with one wheel failure.\n\nThe minimax method provides more momentum storage or torque capability than\nthe pseudoinverse method for almost all cases in Table 4.2. The only exceptions\nare the four-wheel configurations with a failed wheel, which are three-wheel con-\nfigurations for which W3 has a unique inverse. The NASA Standard configuration\nprovides less capability than the four-wheel pyramid with all wheels active, and\nis quite a bit less capable in the single-point failure case if one of its orthogonal\nwheels fails. It is better only in the statistically less likely case that the failed wheel\nis the skew wheel. The dodecahedron provides little advantage over the six-wheel\npyramid configuration if all six wheels are functioning, but it performs better in the\nsingle-point failure case.\n\nWe also compare simulations of a rest-to-rest 90? slew using the minimax and\npseudoinverse methods to distribute angular momentum among six wheels in the\nsame pyramid configuration as was used for the capacity comparisons. This example\nis motivated by JWST, but differs in several details. The slew is about the body e1\naxis, the cone axis of the wheel configuration, and starts with system momentum of\n2Hmax in the body Ce2 direction. We ignore the very small changes in the system\nmomentum during the slew arising from external torques. The slew begins with a\nconstant angular acceleration of 1:6 ? 10?4 deg/s2 or 90 deg=.750 s/2 for a time\ntaccel ? 750 s. This is followed by a coast at a constant angular rate between taccel\nand .750 s/2=taccel. The slew ends with a deceleration at ?1:6 ? 10?4 deg=s2 for\na time taccel. There is no coast period if taccel D 750 s, so this limit represents an\nacceleration-limited slew in the minimum time of 25 min. The system momentum\nin the spacecraft body frame is\n\nHB D J!CHwB D A.e1; ?/\n2\n4\n\n0\n\n2Hmax\n0\n\n3\n5 (4.97)\n\nwhich gives, assuming a diagonal inertia tensor,\n\nHwB D\n2\n4\n?J1 P?\n\n2Hmax cos ?\n2Hmax sin ?\n\n3\n5 (4.98)\n\nThe simulation uses J1 D Hmax ? 750 s, consistent with values of 60 Nms for\nHmax and 45,000 kg-m2 for J1, the approximate values for JWST. It follows\nfrom Eq. (4.98) that kHwBk2 D 4H2max C .J1 P?/2. With the parameters used in the\nsimulations, this has the maximum value\n\nkHwBkmax D 2Hmax\np\n1C .\ntaccel=3;000 s/2 (4.99)\n\nFigure 4.12 shows the wheel momenta that result from using the pseudoinverse\nalgorithm to distribute the momentum of Eq. (4.98) among the six wheels, identified\n\n\n\n4.8 Reaction Wheels 165\n\n0 5 10 15 20 25 30 35 40\n?1.0\n\n?0.8\n\n?0.6\n\n?0.4\n\n?0.2\n\n0\n\n0.2\n\n0.4\n\n0.6\n\n0.8\n\n1.0\n\n2\n\n3\n\n6\n\n4\n\n5\n\n1\n\nFig. 4.12 Wheel momenta for 36-min slew using pseudoinverse distribution\n\n0 5 10 15 20 25 30 35 40\n?1.0\n?0.8\n?0.6\n?0.4\n?0.2\n\n0\n\n0.2\n\n0.4\n\n0.6\n\n0.8\n\n1.0\n\n2\n\n456\n\n4\n\n23\n2\n\n12 1\n126\n\n345\n\n1 3\n\n4556\n\n6\n\nFig. 4.13 Wheel momenta for 36-min slew using minimax distribution\n\nby the labels on the curves. The acceleration time is taccel D 303 s, which gives a\nslew time of 36 min. The magnitude of the angular momentum of wheel 5 reaches\n99:97% of Hmax, so this 90? slew cannot be performed in less than 36 min using\nthe pseudoinverse momentum distribution method. By Eq. (4.99), the maximum\nangular momentum in the body frame during this slew is 2:098Hmax, greater than the\nmaximum value of 2Hmax allowed by Table 4.2. That is not a contradiction, because\nthe angular momentum in this simulation is not in the least favorable direction.\n\nThe minimax momentum distribution method can be used to either reduce the\nmaximum wheel angular momentum for a given slew time or to slew more rapidly.\nFigure 4.13 shows the first option, keeping taccel D 303 s and reducing the maximum\nwheel angular momentum magnitude to less than 75 % ofHmax, a reduction of 25 %\ncompared to the pseudoinverse method. The plots show that there are always four\nwheels with the same angular momentum magnitude, and also that the minimax\n\n\n\n166 4 Sensors and Actuators\n\n0 5 10 15 20 25 30 35 40\n?1.0\n?0.8\n?0.6\n?0.4\n?0.2\n\n0\n\n0.2\n\n0.4\n\n0.6\n\n0.8\n\n1.0\n\n4\n\n2\n23\n\n345\n\n126\n\n56\n\n6\n\n23\n\n1\n\n456\n\n1\n\n3456\n\nFig. 4.14 Wheel momenta for 25-min slew using minimax distribution\n\nmethod leads to discontinuous wheel torque commands when the momentum moves\nbetween faces of the polyhedron. The greater slope of the momentum vs. time\ncurves shows that the minimax momentum distribution method demands higher\nwheel torques than the pseudoinverse method. The maximum wheel torque in\nFig. 4.12 is L1 D Hmax=.776 s/, while the maximum wheel torque in Fig. 4.13\nis L1 D Hmax=.353 s/, more than twice as great.\n\nFigure 4.14 shows a minimum-time, acceleration-limited (taccel D 750 s) slew\nusing minimax momentum distribution. The 25 min slew time is 30 % less than\nthe time required by the pseudoinverse method, and the maximum wheel angular\nmomentum magnitude is limited to 93.16 % of Hmax. The maximum body angular\nmomentum during this slew is 2:543Hmax, which is less than the 2:667Hmax allowed\nby Table 4.2. This slew would probably require high-torque wheels to provide the\nmaximum wheel torque of L1 D Hmax=.179 s/, however.\n\n4.9 Control Moment Gyros\n\nThis section expands on the brief discussion of CMGs for attitude control in\nSect. 3.3.5.1. Although double-gimbal control moment gyros have been developed,\ntheir mechanical complexity has led to their being supplanted by single-gimbal\ncontrol moment gyros (SGCMGs) in most applications. A SGCMG has a wheel\nspinning at constant speed about a spin axis wj with an angular momentum\nof magnitude Hwj .\n\n14 Rotating the angular momentum about a gimbal axis gj\nperpendicular to the spin axis requires a torque\n\n14Variable-speed CMGs, combining the properties of CMGs and reaction wheels, have been\nproposed but are not widely employed.\n\n\n\n4.9 Control Moment Gyros 167\n\nLwj D\nd.Hwj wj /\n\ndt\nD Hwj Pwj D Hwj P?j gj ? wj (4.100)\n\nwhere ?j is the gimbal angle in radians. The reaction torque exerted on the\nspacecraft is the negative of this. CMGs are capable of providing higher torques\nthan reaction wheels because it is easier to apply a torque to a slowly-moving\ngimbal than to a rapidly-rotating wheel. CMGs are also advantageous from energy\nconsiderations, because the rotational kinetic energy stored in a CMG rotor moving\nat constant speed does not change, whereas energy must be added to or subtracted\nfrom a reaction wheel to change its speed. The angular momentum of CMGs covers\na wide range from less than 1 Nms to greater than 2,000 Nms. Maximum gimbal\nrates are typically in the range from 0.2 to 2 rad/s, which gives an idea of the\navailable torques.\n\nIt is clear that at least three SGCMGs are needed to provide three-axis control,\nand a system of n SGCMGs gives\n\nLw D\nnX\n\njD1\nHwj\nP?j gj ? wj D W CMGn P? (4.101)\n\nwhere\n\nW CMGn ?\n?\nHw1 g1 ? w1 Hw2 g2 ? w2 ? ? ? Hwn gn ? wn\n\n?\n(4.102)\n\nand\n\nP? ? ? P?1 P?2 ? ? ? P?n\n?T\n\n(4.103)\n\nThe methods developed for reaction wheels in Sect. 4.8.3 can be used to invert these\nequations in order to find P? in terms of Lw, but there are additional complications\nfor SGCMGs. The directions of the gimbal axes are fixed, but the directions of the\nspin axes vary as the gimbal angles change, so the matrix W CMGn is not constant.\nA greater problem is that a system of SGCMGs can reach a singular configuration\nin which all the available torques lie in a plane, resulting in a loss of control\nauthority about the axis perpendicular to the plane. These singular configurations,\nand methods for avoiding them, have been studied extensively [30, 40, 67]. In a\nsystem with only three SGCMGs, the commanded gimbal rates are determined\nuniquely by the inverse of W CMGn , so there are no extra degrees of freedom\nfor steering around singular configurations. For this reason, systems of SGCMGs\ninvariably employ four or more CMGs.\n\n\n\n168 4 Sensors and Actuators\n\n4.10 Magnetic Torquers\n\nMagnetic torquers create a magnetic dipole moment, m, which in turn creates a\ntorque given by Eq. (3.159). Magnetic torques can be used either directly for attitude\ncontrol or to unload momentum accumulated by reaction wheels or CMGs. The\nsimplest torquers are made of N turns of wire in a loop of area A; sending a current\nI through such a coil produces a magnetic dipole moment of magnitude m D NIA\nin a direction perpendicular to the plane of the coil. This relation has the advantage\nof being a perfectly linear function of the current, but large areas or many turns\nare required to produce the dipole moments needed by many spacecraft. For this\nreason torque rods, which are coils of wire wrapped around ferromagnetic cores,\nare employed to obtain greater dipole moments for a given amount of current.\n\nFerromagnetic materials exhibit hysteresis, as shown in Fig. 4.15. The dipole\nmoment has a maximum value known as the saturation value, msat, when all\nthe magnetic dipoles in the ferromagnetic material line up in the same direction.\nThere is also a residual dipole, mres, when no current is applied. The sign of the\nresidual dipole depends on the direction from which the zero-current condition is\napproached, as the hysteresis curve is traversed in a counterclockwise direction. For\nmost commercially available torque rods, the residual dipole moment is less than\n1 % of the saturation moment, and the dipole moment is an approximately linear\nfunction of the current for dipole moments of at least 80 % of the saturation value,\nas indicated in the figure. Torque rods are available with saturation moments ranging\nfrom about 1 to 1;000Am2 and scale factors ranging from less than 0:1Am2=mA\nto almost 3Am2=mA, with the larger scale factors corresponding to the larger\nmoments. Note that attaining a scale factor of 1Am2=mA without a ferromagnetic\ncore would require a number of turns and coil area satisfying NA D 1;000m2.\n\nMost applications of magnetic torquers use three torquers producing moments\non orthogonal axes. It is generally not necessary to employ extra torque rods\nfor redundancy, because they usually have dual windings to provide internal\nredundancy. Sometimes more than three torque rods are used to provide additional\ncapability, giving a total magnetic dipole moment equal to the vector sum of the\nmoments provided by the individual rods. In this case, the desired net magnetic\n\nm\nmsat\n\nmres\nI\n\nFig. 4.15 Typical hysteresis\nloop; magnetic dipole\nmoment as a function of\napplied current\n\n\n\n4.11 Thrusters 169\n\nmoment can be distributed among the torquers by using one of the algorithms\ndeveloped in Sect. 4.8.3 to distribute torque or angular momentum among reaction\nwheels.\n\n4.11 Thrusters\n\nThrusters generate both forces and torques, so they can be used for both trajectory\ncontrol and attitude control, as was briefly discussed in Sect. 3.3.6.5. Reference [33]\nprovides an excellent overview of spacecraft propulsion systems. Thrusters have the\nadvantage of not being dependent on an ambient magnetic or gravitational field,\nso they can be used for control or momentum unloading in any orbit. They have\nthe disadvantage of requiring an expendable propellant, so that the life of a thruster-\ndependent mission is limited by the propellant supply. The force and torque provided\nby a thruster are\n\nFmexp D ? Pmvrel (4.104a)\nLmexp D r ? Fmexp (4.104b)\n\nwhere Pm is the rate at which mass is expelled, vrel is the velocity of the expelled\nmass relative to the spacecraft, and r is the vector from the spacecraft center of\nmass to the thruster. These equations show that the thrust and torque for a given\nmass expenditure are linearly proportional to the velocity vrel. Writing Eq. (4.104a)\nas vrel D ?p=?m shows that this parameter has the units of impulse per unit mass of\npropellant, so it is referred to as the specific impulse and can be expressed in units\nof Ns/kg. It is more common to normalize the specific impulse by the acceleration\nof gravity at the surface of the Earth, g0 D 9:80665 m/s2, to express it in time units:\n\nIsp ? vrel=g0 (4.105)\n\nThree types of thrusters are in common use for attitude control. Cold gas thrusters\nuse a non-reacting gas stored at high pressure, on the order of 30 MPa. The most\ncommon gases are nitrogen, with a specific impulse of about 70 s, and helium, with\na specific impulse of about 175 s. Using helium saves mass, but it is more expensive\nand more prone to leakage because of the small size of the helium molecule. Helium\nalso requires a propellant tank with seven times as much volume or seven times\nhigher pressure than the equivalent amount of nitrogen. Other propellants are used,\nbut more rarely, in cold gas systems.\n\nMonopropellant thrusters use a propellant that is decomposed catalytically.\nHydrazine, with Isp D 242 s, is by far the most common monopropellant.\nMonopropellant systems do not require the high pressures needed for cold gas, but\nhydrazine is a highly toxic material. This has led to interest in less toxic \u201cgreen\u201d\npropellants, such as hydroxyl ammonium nitrate (HAN), with Isp D 266 s, and\n\n\n\n170 4 Sensors and Actuators\n\nammonium dinitramide (ADN), with Isp D 253 s. These new propellants are less\nharmful to the environment, diminish operational hazards, and actually increase fuel\nefficiency due to their higher specific impulse [68].\n\nThe third class of thrusters uses electric fields to accelerate the expelled mass\nto a high velocity. The specific impulse of electric thrusters ranges from 500 to\n3;000 s, so the saving in propellant mass is apparent. The kinetic energy that must\nbe provided to the expelled mass is mv2rel=2, so the power required by the thruster,\nassuming 100 % efficiency, is\n\nPthruster D 1\n2\nPmv2rel D\n\n1\n\n2\nFmexpvrel (4.106)\n\nThis energy is stored in the pressure vessel for cold gas thrusters and is provided\nby chemical decomposition for monopropellant thrusters, but it must be provided\nby the spacecraft power system for electric propulsion. Thus we see that an electric\npropulsion system with a higher specific impulse requires less propellant but more\npower to generate a given level of thrust.\n\nAn attitude torque provided by thrusters will perturb the spacecraft\u2019s orbit unless\nit is provided by a pair of equal and opposite forces comprising a perfect couple\n\nLcouple D r1 ? Fmexp C r2 ? .?Fmexp/ D .r1 ? r2/ ? Fmexp (4.107)\n\nCouples also have the advantage of being insensitive to a shift in the spacecraft\u2019s\ncenter of mass, which would give r1 ! r1 ??r and r2 ! r2 ??r, and thus would\nleave Lcouple unchanged. Several factors make it impractical to provide perfect\ncouples, though. It is often desirable to have all the thrusters on one face of a\nspacecraft to facilitate modular integration of the propulsion system, to minimize\nthe amount of propellant plumbing required, or to protect sensitive instruments from\nthe deleterious effects of thruster plume impingement. The difficulty of providing\nperfect couples makes it important to minimize the migration of the spacecraft\u2019s\ncenter of mass, either by locating a single propellant tank at the center of mass or\nby distributing tanks symmetrically around the center of mass and drawing equal\nmasses of propellant from them.\n\n4.12 Nutation Dampers\n\nNutation dampers are passive devices designed to dissipate energy, thereby produc-\ning steady rotation of a spinning spacecraft about its axis of maximum principal\nmoment of inertia, as described in Sect. 3.3.3.2. Libration dampers are similar\nenergy-dissipation mechanisms used to eliminate libration on spacecraft employing\ngravity gradient stabilization, as discussed in Sect. 3.3.8. The energy-dissipating\nmedium in either case can be a viscous fluid, a flexible spring with high structural\ndamping, or electrical eddy currents [66].\n\n\n\n4.12 Nutation Dampers 171\n\nFig. 4.16 ST5 passive nutation damper. Source: NASA\n\nA very common type of nutation damper is the viscous ring nutation damper,\na tube bent into the shape of a ring and filled with a viscous fluid [7, 27]. If the\nfluid does not fill the ring completely, surface tension at the interfaces of the fluid\nand gas (or vacuum) can cause the fluid to be locked in place, with a resultant\nloss of damping action. For this reason, viscous ring dampers are commonly\nfully filled and equipped with bellows to accommodate thermal expansion and\ncontraction of the fluid. Some dampers, however, have omitted bellows because of\nspace limitations, tolerating vacuum bubbles at non-operational low temperatures\nand using tubing strong enough to handle high pressures at the upper end of the\noperational temperature range. The viscous ring nutation damper of NASA\u2019s Space\nTechnology-5 (ST5) mission, illustrated in Fig. 4.16 provides a good example [47].\n\nWe will use the methods of Sect. 3.3.5.1 to simulate the effect of a single\nfully-filled viscous ring nutation damper on a triaxial spacecraft with principal\nmoments J1 < J2 < J3. The damper is modeled as a reaction wheel with its\naxis perpendicular to the plane of the ring, along the axis of intermediate inertia,\nthe orientation providing the most effective damping. We will neglect external\ntorques, so the system angular momentum will have a constant magnitude H .\nLetting HB D Hu, where u is a unit vector, Eq. (3.80) can be written\n\nPu D ?!BIB ? u D ?.H=J3/\u0152D.u ? ?e2/? ? u (4.108)\n\n\n\n172 4 Sensors and Actuators\n\nwhere\n\nD ? J3J?1B D diag.\u0152 J3=J1 J3=J2 1?/ ? diag.\u0152?1 ?2 1?/ (4.109)\n\nand\n\n? ? Hw=H (4.110)\n\nwith Hw being the angular momentum of the fluid in the damper. These equations\nmust be integrated numerically, but the unit vector nature of u can be used to\n\neliminate one degree of freedom. With u1 D\nq\n1 ? u22 cos ? and u3 D\n\nq\n1 ? u22 sin ?,\n\nthe differential equation for u2 is\n\nPu2 D .H=J3/.1=2/.?1 ? 1/.1 ? u22/ sin 2? (4.111)\n\nand the differential equations for u1 and u3 are equivalent to\n\nP? D .H=J3/f.1=2/\u01522?2 ? ?1 ? 1 ? .?1 ? 1/ cos 2? ?u2 ? ?2?g (4.112)\n\nWe assume that the torque acting on the damper fluid is linearly proportional to\nand in the opposite direction from the fluid\u2019s angular velocity !w:\n\nLw D ??.J k=J3/H!w D ???H!w (4.113)\n\nwhere ? is a dimensionless damping coefficient, J k is the MOI of the moving fluid,\nand ? is defined by the last equality. The actual value of the damping coefficient\ndepends on the diameter of the tubing and the density and viscosity of the fluid,\nincorporated in a \u201cwobble Reynolds number,\u201d but we will treat it simply as a tunable\nparameter [7, 27]. Then Eqs. (3.145) and (3.141) give the equation of motion of the\ndimensionless damper angular momentum:\n\nP? D Lw=H D ???!w D ???\u0152.Hw=J k/ ? e2 ?!BIB ?\nD ???\u0152.?H=J k/ ? .u2 ? ?/H=J2? D ?.H=J3/\u0152??2u2 ? .1C ??2/?? (4.114)\n\nThe MATLAB integrator ode45 was used to integrate Eqs. (4.111), (4.112),\nand (4.114) for a spacecraft with the inertia ratios of Fig. 3.2b, which give ?1 D 2\nand ?2 D 3=2. The damper MOI was assumed to give ? D 0:005, which about an\norder of magnitude larger than a reasonable damper could provide, but was chosen\nto give readable plots. The damping coefficient was assigned the value ? D 1=p2,\nwhich we will show to be the optimal value. The initial values of ? D ?0:01\nrad and u2 D ? D 0 represent very nearly pure spin about e1, the spacecraft\naxis of minimum MOI. The results of the simulation, displayed in Fig. 4.17,\nillustrate quantitatively in non-dimensional units the qualitative behavior discussed\n\n\n\n4.12 Nutation Dampers 173\n\n0 500 1000 1500 2000 2500\n?1\n\n?0.8\n\n?0.6\n\n?0.4\n\n?0.2\n\n0\n\n0.2\n\n0.4\n\n0.6\n\n0.8\n\n1\n\n0 500 1000 1500 2000 2500\n?1\n\n?0.8\n\n?0.6\n\n?0.4\n\n?0.2\n\n0\n\n0.2\n\n0.4\n\n0.6\n\n0.8\n\n1\n\n0 500 1000 1500 2000 2500\n1\n\n1.1\n\n1.2\n\n1.3\n\n1.4\n\n1.5\n\n1.6\n\n1.7\n\n1.8\n\n1.9\n\n2\n\na b\n\nc d\n\nFig. 4.17 Simulation of spinning spacecraft with nutation damper. (a) Intermediate axis angular\nmomentum. (b) Path on momentum sphere. (c) Damping fluid spin rate. (d) Rotational kinetic\nenergy\n\nin Sect. 3.3.3. Figure 4.17a shows the component of the angular momentum along\nthe axis of intermediate inertia; it begins at zero, then acquires an oscillatory\nbehavior that grows to an amplitude close to the total system angular momentum,\nand finally decays to zero. The rotational kinetic energy in dimensionless form,\n\n2J3Ek=H\n2 D .1 ? u22/.?1 cos2 ? C sin2 ?/C ?2.u2 ? ?/2 C ?2=? (4.115)\n\nis plotted in Fig. 4.17d. It starts at the value ?1 D 2, the value for pure rotation\naround the axis of minimum inertia, and ends at 1, the value for pure rotation around\nthe axis of maximum inertia. It crosses the value ?2 D 3=2, the value for pure\nrotation around the axis of intermediate inertia, at time t? D 1184J3=H , when the\nintermediate axis momentum reaches its maximum amplitude. Figure 4.17b shows\nthe path followed by the angular momentum on the angular momentum sphere;\n\n\n\n174 4 Sensors and Actuators\n\nit spirals out from e1, crosses the terminator at time t?, and then spirals in toward e3.\nSlightly different initial conditions or a slightly different damping factor could very\neasily have caused the path on the momentum sphere to cross the other terminator,\nresulting in a final spin about ?e3 instead of e3. The path is only plotted for times\nbetween 700J3=H and 1600J3=H , which is for 1:03 < 2J3Ek=H2 < 1:98, because\nthe paths become even denser than those shown at earlier and later times. Finally,\nFig. 4.17c shows the spin rate of the damping fluid in dimensionless form,\n\nJ3!\nw=H D ?=? ? ?2.u2 ? ?/ (4.116)\n\nwhich attains its peak amplitude near t?. The rate of energy dissipation is propor-\ntional to .!w/2, but it slows slightly at time t? because energy dissipation vanishes\ninstantaneously for steady rotation about the damper axis.\n\nWe will now motivate our choice of the damping parameter ? by analyzing\nmotion near the minimum or maximum principal axis. We set ? D ?0 C ?0, where\n?0 D 0 or \n for nutation about the axis of minimum inertia, and ?0 D ?\n=2\nfor nutation about the axis of maximum inertia. We linearize Eqs. (4.111), (4.112),\nand (4.114) for small ?0, u2, and ?, noting that sin 2?0 D 0. We also define\nc ? cos 2?0 so that c D 1 for ?0 D 0 or \n , and c D ?1 for ?0 D ?\n=2. The\nlinearized equations in matrix form are\n\nd\n\ndt\n\n2\n4\n?0\nu2\n?\n\n3\n5 D H\n\nJ3\n\n2\n4\n\n0 ?c? ??2\nc.?1 ? 1/ 0 0\n\n0 ???2 ??.1C ??2/\n\n3\n5\n2\n4\n?0\nu2\n?\n\n3\n5 (4.117)\n\nwhere\n\n? D\n(\n?1 ? ?2 for c D 1\n?2 ? 1 for c D ?1\n\n(4.118)\n\nThe general solution of these coupled linear differential equations is a superposition\nof three components of the form\n\n2\n4\n?0.t/\nu2.t/\n?.t/\n\n3\n5 D\n\n2\n4\n?0.0/\nu2.0/\n?.0/\n\n3\n5 e\tt (4.119)\n\nwith coefficients satisfying initial conditions. A nontrivial solution exists only if \t\nis one of the three roots of the eigenvalue equation\n\n0 D det\n8<\n:\tI3 ?\n\nH\n\nJ3\n\n2\n4\n\n0 ?c? ??2\nc.?1 ? 1/ 0 0\n\n0 ???2 ??.1C ??2/\n\n3\n5\n9=\n;\n\nD .\t2 C Q!2p/\u0152\tCH?.1C ??2/=J3?C c??.H=J3/3?22 .?1 ? 1/ (4.120)\n\n\n\n4.12 Nutation Dampers 175\n\nwhere\n\nQ!p D H\nJ3\n\np\n?.?1 ? 1/ D\n\n(\n.H=J3/\n\np\n.J3 ? J1/.J3 ? J2/=J1J2 for c D 1\n\n.H=J1/\np\n.J2 ? J1/.J3 ? J1/=J2J3 for c D ?1\n\n(4.121)\n\nThe cubic eigenvalue equation does not have nice analytic solutions, but its\nsolutions are close to those obtained by ignoring the last term on the right side\nbecause ? is very small. Those approximate solutions are\n\n\t0 D ?H?.1C ??2/=J3 and \t? D ?i Q!p (4.122)\nThe real eigenvalue \t0 has the eigenvector \u01520 0 1?T in the ? D 0 limit. It describes\nonly uninteresting transient behavior, the rapid decay of an initial value of Hw.\n\nThe purely imaginary eigenvalues are more interesting, describing sinusoidal\nmotion with frequency Q!p . In the limit of small nutation about the e3 axis, i.e. for\nc D ?1 and 2Ek D H2=J3, this frequency agrees up to a sign with the nutation\nfrequency given by Eq. (3.120). The expression for c D 1, i.e. for nutation about the\ne1 axis, has the same form with J1 and J3 interchanged, as would be expected. Now\nwe need to consider the effect of the term in Eq. (4.120) that we have ignored up to\nthis point. This will cause a small change in \t?, so we substitute \t? D ?i Q!pC \n?\ninto Eq. (4.120), giving\n\n0 D .?2i Q!p\n? C \n2?/\u0152?i Q!p C \n? CH?.1C ??2/=J3?C c??.H=J3/3?22 .?1 ? 1/\n? ?2i Q!p\n?.?i Q!p CH?=J3/C c??.H=J3/3?22 .?1 ? 1/ (4.123)\n\nThe approximation ignores all terms of higher than first order in \n? and ?. Solving\nfor \n? gives\n\n\n? D c??.H=J3/\n3?22 .?1 ? 1/\n\n2 Q!p. Q!p \t iH?=J3/ D\nc??.H=J3/\n\n3?22 .?1 ? 1/. Q!p ? iH?=J3/\n2 Q!p\u0152 Q!2p C .H?=J3/2?\n\n(4.124)\n\nand thus\n\n\t? D ?i Q!p\n\n\n1C c?\n\n2??22\n2?\u0152.J3 Q!p=H/2 C ?2?\n\n?\nC cH\n2J3\n\n???22 .?1 ? 1/\n.J3 Q!p=H/2 C ?2 (4.125)\n\nThe quantity in the curly brackets gives a small correction to the nutation frequency,\nless than 1 % for the parameters of our simulation. The second term is much more\nimportant; it gives an exponentially growing nutation amplitude for c D 1 and\nan exponentially decaying amplitude for c D ?1, exactly what we expect for\nmotion near the axis of minimum or maximum principal MOI, respectively. The\ntime constant of the growth or decay is\n\n\n\n176 4 Sensors and Actuators\n\n? D 2J3\nH\n\n.J3 Q!p=H/2 C ?2\n???22 .?1 ? 1/\n\nD 2?\n??22 Q!p\n\n?2 C ?.?1 ? 1/\n?\np\n?.?1 ? 1/\n\n(4.126)\n\nIt is easy to see that the time constant is minimized for ? Dp?.?1 ? 1/. For ?1 D 2\nand ?2 D 3=2, ? D 1=\n\np\n2 provides the minimum time constant near both e1 and e3,\n\nwhich is why this value was chosen for the simulation. As a check, simulations with\n? D 0:6 and ? D 0:8 both gave slower damping. Choosing the optimal damping\ncoefficient gives\n\n?min D 4?\n??22 Q!p\n\n(4.127)\n\nwhich is on the order of 1=? times the nutation period. A more realistic value of ?\nthan was used in the simulations would result in damping times about ten times as\ngreat.\n\nProblems\n\n4.1. Use the properties of the Poisson distribution to verify the probabilities for\nstar availability presented in Sect. 4.2.4, i.e. NN D 6:75 gives a 90 % probability of\nhaving four or more stars in the FOV, NN D 8 gives a 90 % probability of having five\nor more stars in the FOV, NN D 10 gives a 99 % probability of having four or more\nstars in the FOV, and NN D 11:7 gives a 99 % probability of having five or more stars\nin the FOV.\n\n4.2. The discrete-time gyro simulation model in Eq. (4.54) can also be derived from\nFarrenkopf\u2019s model given in Eq. (6.116), which is summarized by\n\n? truekC1 D ? truek ??t ?truek C?t !k C w1k\n?truekC1 D ?truek C w2k\n\nwhere E\n?\nwkwTk\n\n? D Q, with wk D \u0152w1k w2k ?T and\n\nQ D\n2\n4\n?2v?t C 13?2u?t3 ? 12?2u?t2\n\n? 1\n2\n?2u?t\n\n2 ?2u?t\n\n3\n5\n\nTo simulate the correlated process noise process a Cholesky decomposition ofQ can\nbe used, with LTL D Q. First, prove that this can be done. Consider a zero-mean\nGaussian white-noise variable wk with covariance Q. Show that wk D LT pk can\nbe used to simulate the correlated process noise, where pk is zero-mean Gaussian\nwhite-noise process with covariance given by the identity matrix.\n\n\n\nProblems 177\n\nAssume the following form for L:\n\nL D\n?\n? ?\n\n? 0\n\n?\n\nDetermine ?, ? and ? from Q in terms of ?u, ?v and ?t . Next, using .? truekC1 ?\n? truek /=?t D ! truek prove that the scalar version of Eq. (4.54) can be derived from\nFarrenkopf\u2019s model.\n\n4.3. Show that the discrete-time gyro simulation model in Eq. (4.54) can effectively\nbe executed using the following model for each axis:\n\n!kC1 D ! truekC1 C yk C\n?\n?2v\n?t\nC 1\n12\n?2u ?t\n\n?1=2\nNvk\n\n?truekC1 D ?truek C ?u?t1=2Nuk\nyk D ?truek C\n\n1\n\n2\n?u?t\n\n1=2Nuk\n\nNote that the last two equations give the following discrete-time system matrices as\ndefined in Eq. (12.49): ? D 1, ? D 1, H D 1, and D D 1=2 with input given\nby ?u?t1=2Nuk . Therefore, yk is first obtained using the aforementioned discrete-\ntime state model and then substituted into the !kC1 equation to provide simulated\ndiscrete-time gyro measurements.\n\n4.4. Find, as a function of ? and !0, the wheel speed at which the upper whirl\nfrequency !C of Eq. (4.63) coincides with the first harmonic of the wheel speed\n! D 2!w. Find the numerical value of this in rpm for ? D 0:91 and !0 D 60 Hz.\nDiscuss.\n\n4.5. This problem has two parts:\n\na) Derive the wheel capabilities in Table 4.2.\nb) Derive the wheel capabilities in the two-failure cases for the six-wheel config-\n\nurations in Table 4.2. There are three different possibilities for the six-wheel\npyramid: failure of adjacent wheels (e.g. 1&2), failure of opposite wheels\n(e.g. 1&4), and the intermediate case (e.g. 1&3). In contrast to this, all two-wheel\nfailures in the dodecahedron configuration are equivalent.\n\n4.6. Repeat the analysis leading to Figs. 4.12, 4.13, and 4.14 using the four-wheel\nconfiguration W4 of Eq. (4.66) with b D c D\n\np\n1=3 and a D d D p2=3. As in the\n\nexample in the text, assume a rest-to-rest 90? slew about the body e1 axis, beginning\nwith a constant angular acceleration of 1:6 ? 10?4 deg/s2 for a time taccel ? 750 s,\nfollowed by a coast at a constant angular rate between taccel and .750 s/2=taccel,\nand ending with a deceleration at ?1:6 ? 10?4 deg/s2 for a time taccel. Use J1 D\nHmax?750 s, but assume that the system momentum for the four-wheel case is only\nHmax in the bodyCe2 direction rather than 2Hmax, as in the six-wheel case.\n\n\n\n178 4 Sensors and Actuators\n\nFind the minimum slew time for the pseudoinverse distribution law. Find the\nmaximum value of any reaction wheel momentum for the minimax distribution law\nif the slew is performed in this time. Find the minimum slew time for the minimax\ndistribution law.\n\n4.7. A common thruster configuration has four thrusters at the corners of the ?x\nface of a spacecraft, which is a distance d from the center of mass, so the vectors\nfrom the center of mass to the thrusters are\n\nr1 D\n2\n4\n?d\na\n\na\n\n3\n5 ; r2 D\n\n2\n4\n?d\n?a\na\n\n3\n5 ; r3 D\n\n2\n4\n?d\n?a\n?a\n\n3\n5 ; r4 D\n\n2\n4\n?d\na\n\n?a\n\n3\n5\n\nThe thrusters are canted at an angle ? , with tan ? < a=d , so that\n\nF1 D F2 D F\n2\n4\n\ncos ?\n0\n\n? sin ?\n\n3\n5 ; F3 D F4 D F\n\n2\n4\n\ncos ?\n0\n\nsin ?\n\n3\n5\n\na) Find the torques due to firing the thrusters individually.\nb) Show that firing all four thrusters simultaneously gives a net thrust but no net\n\ntorque.\nc) Show that firing the thrusters in pairs can give a positive or negative torque about\n\nany axis. Thus attitude control is provided by on-pulsing pairs of thrusters when\nnot performing an orbit adjustment, or by off-pulsing pairs of thrusters when the\norbit is being adjusted.\n\nReferences\n\n1. Al-Bender, F., Swevers, J.: Characterization of friction force dynamics. IEEE Contr. Syst. Mag.\n28(6), 64\u201381 (2008)\n\n2. \u00c5str\u00f6m, K.J., Canudas de Wit, C.: Revisiting the LuGre model. IEEE Contr. Syst. Mag. 28(6),\n101\u2013114 (2008)\n\n3. Axelrad, P., Behre, C.P.: Satellite attitude determination based on GPS signal-to-noise ratio.\nProc. IEEE 87(1), 133\u2013144 (1999)\n\n4. Bahcall, J.N.: Star counts and galactic structure. Annu. Rev. Astron. Astrophys. 24, 577\u2013611\n(1986)\n\n5. Bhanderi, D.D.V.: Modeling Earth albedo currents on Sun sensors for improved vector\nobservation. In: AIAA Guidance, Navigation and Control Conference. Keystone (2006). AIAA\n2006-6592\n\n6. Bhanderi, D.D.V., Bak, T.: Modeling Earth albedo for satellites in Earth orbit. In: AIAA\nGuidance, Navigation and Control Conference. San Francisco (2005). AIAA 2005-6465\n\n7. Bhuta, P.G., Koval, L.R.: A viscous ring damper for a freely precessing satellite. Int. J. Mech.\nSci. 8(5), 383\u2013395 (1966)\n\n\n\nReferences 179\n\n8. Bialke, B.: High fidelity mathematical modeling of reaction wheel performance. In: Culp, R.D.,\nIgli, D. (eds.) Guidance and Control 1998, Advances in the Astronautical Sciences, vol. 98,\npp. 483\u2013496. Univelt, San Diego (2007)\n\n9. Bialke, B.: Microvibration disturbance fundamentals for rotating mechanisms. In: Miller,\nK.B. (ed.) Guidance and Control 2011, Advances in the Astronautical Sciences, vol. 141,\npp. 417\u2013432. Univelt, San Diego (2007)\n\n10. Braasch, M.S.: Multipath effects. In: Parkinson, B., Spilker, J. (eds.) Global Positioning\nSystem: Theory and Applications, Progress in Astronautics and Aeronautics, vol. 64, chap. 14.\nAmerican Institute of Aeronautics and Astronautics, Washington, DC (1996)\n\n11. Bronowicki, A.J.: Forensic investigation of reaction wheel nutation on isolator. In:\nAIAA/ASME/AHS/ASC Structures, Structural Dynamics, and Materials Conference. Schaum-\nberg (2008)\n\n12. Canudas de Wit, C., Olsson, H., \u00c5str\u00f6m, K.J., Lischinsky, P.: A new model for control of\nsystems with friction. IEEE Trans. Automat. Contr. 40(3), 419\u2013425 (1995)\n\n13. Chen, X., Steyn, W.H.: Robust combined eigenaxis slew maneuver. In: AIAA Guidance,\nNavigation and Control Conference, pp. 521\u2013529. Portland (1999). AIAA 1999-4048\n\n14. Chow, W.W., Sanders, V.E., Schleich, W., Scully, M.O.: The ring laser gyro. Rev. Mod. Phys.\n57(1), 61\u2013103 (1985)\n\n15. Cohen, C.E.: Attitude determination using GPS. Ph.D. thesis, Stanford University (1993)\n16. Cohen, C.E.: Attitude determination. In: B. Parkinson, J. Spilker (eds.) Global Positioning\n\nSystem: Theory and Applications, Progress in Astronautics and Aeronautics, vol. 64, chap. 19.\nAmerican Institute of Aeronautics and Astronautics, Washington, DC (1996)\n\n17. Cowen, R.: The wheels come off Kepler. Nature 497(7450), 417\u2013418 (2013)\n18. Dahl, P.R.: A solid friction model. Contractor Report TOR-0158(3107-18)-1, The Aerospace\n\nCorporation, Los Angeles (1968)\n19. Fallon III, L.: Gyroscopes. In: J.R. Wertz (ed.) Spacecraft Attitude Determination and Control,\n\nchap. 6.5. Kluwer Academic, Dordrecht (1978)\n20. Farrenkopf, R.L.: Analytic steady-state accuracy solutions for two common spacecraft attitude\n\nestimators. J. Guid. Contr. 1(4), 282\u2013284 (1978)\n21. Golub, G.H., Van Loan, C.F.: Matrix Computations, 3rd edn. The Johns Hopkins University\n\nPress, Baltimore (1996)\n22. Hablani, H.B.: Momentum accumulation due to solar radiation torque, and reaction wheel\n\nsizing, with configuration optimization. In: Proceedings of the Flight Mechanics/Estimation\nTheory Symposium, pp. 3\u201322. NASA-Goddard Space Flight Center, Greenbelt (1992)\n\n23. Hablani, H.B.: Sun-tracking commands and reaction wheel sizing with configuration optimiza-\ntion. J. Guid. Contr. Dynam. 17(4), 805\u2013814 (1994)\n\n24. Haworth, D.: How many stars can you observe (2013). http://www.stargazing.net/David/\nconstel/howmanystars.html\n\n25. Horn, R.A., Johnson, C.R.: Matrix Analysis. Cambridge University Press, Cambridge (1985)\n26. Horri, N.M., Palmer, P., Giffen, A.: Active attitude control mechanisms. In: Blockley, R., Shyy,\n\nW. (eds.) Encyclopedia of Aerospace Engineering. Wiley, Chichester (2010)\n27. Hubert, C.: Modeling completely filled viscous ring nutation dampers. Technical Report\n\nB2027, NASA Goddard Space Flight Center (2002)\n28. Kawaguchi, J., Maeda, K., Matsuo, H., Ninomiya, K.: Closed loop momentum transfer\n\nmaneuvers using multiwheels. J. Guid. Contr. Dynam. 18(4), 867\u2013874 (1995)\n29. Kumar, K.: A microstructure study of corrosion in Ag-Cu flex leads, Journal of the Electro-\n\nchemical Society, 127(4), 906\u2013910 (1980)\n30. Kurokawa, H.: Survey of theory and steering laws of single-gimbal control moment gyros.\n\nJ. Guid. Contr. Dynam. 30(5), 1331\u20131340 (2007)\n31. Lee, F.C., Werner, M.: Reaction wheel jitter analysis including rocking dynamics & bearing\n\nharmonic disturbances. In: Hollowell, H.E., Culp, R.D. (eds.) Guidance and Control 2007,\nAdvances in the Astronautical Sciences, vol. 128, pp. 93\u2013110. Univelt, San Diego (2007)\n\n32. Leick, A.: GPS Satellite Surveying, 3rd edn. Wiley, Chichester (2004)\n\nhttp://www.stargazing.net/David/constel/howmanystars.html\nhttp://www.stargazing.net/David/constel/howmanystars.html\n\n\n180 4 Sensors and Actuators\n\n33. Leyva, I.A.: Spacecraft subsystems I \u2013 propulsion. In: Wertz, J.R., Everett, D.F., Puschell, J.J.\n(eds.) Space Mission Engineering: The New SMAD, Space Technology Library. Microcosm\nPress, Hawthorne (2011)\n\n34. Liebe, C.C.: Accuracy performance of star trackers \u2013 a tutorial. IEEE Trans. Aero. Electron.\nSyst. 38(2), 587\u2013599 (2002)\n\n35. Lightsey, E.G.: Development and flight demonstration of a GPS receiver for space. Ph.D.\nthesis, Stanford University (1997)\n\n36. Lightsey, E.G., Madsen, J.: Three-axis attitude determination using Global Positioning System\nsignal strength measurements. J. Guid. Contr. Dynam. 26(2), 304\u2013310 (2003)\n\n37. Liu, K.C., Kenney, T., Maghami, P., Mul\u00e9, P., Blaurock, C., Haile, W.B.: Jitter test program\nand on-orbit mitigation strategies for Solar Dynamics Observatory. In: 20th International\nSymposium on Space Flight Dynamics. NASA Goddard Space Flight Center, Annapolis (2007)\n\n38. Liu, K.C., Maghami, P., Blaurock, C.: Reaction wheel disturbance modeling, jitter analysis,\nand validation tests for Solar Dynamics Observatory. In: AIAA Guidance, Navigation and\nControl Conference. Honolulu (2008). AIAA 2008-7232\n\n39. Madsen, J., Lightsey, E.G.: Robust spacecraft attitude determination using Global Positioning\nSystem receivers. J. Spacecraft Rockets 41(4), 635\u2013643 (2004)\n\n40. Margulies, G., Aubrun, J.N.: Geometric theory of single-gimbal control moment gyro systems.\nJ. Astronaut. Sci. 26(2), 221\u2013238 (1978)\n\n41. Markley, F.L., Reynolds, R.G., Liu, F.X., Lebsock, K.L.: Maximum torque and momentum\nenvelopes for reaction-wheel arrays. J. Guid. Contr. Dynam. 33(5), 1606\u20131614 (2010)\n\n42. Masterson, R.A., Miller, D.W., Grogan, R.L.: Development and validation of reaction wheel\ndisturbance models: Empirical model. J. Sound Vib. 249(3), 575\u2013598 (2002)\n\n43. McQuerry, J.P., Radovich Jr., M.A., Deters, R.A.: A precision star tracker for the nineties:\nA system guide to applications. In: Culp, R.D., Gravseth, A.D. (eds.) Guidance and Control\n1990, Advances in the Astronautical Sciences, vol. 72, pp. 83\u2013104. Univelt, San Diego (1990).\nAAS 90\u2013014\n\n44. Merhav, S.: Aerospace Sensor Systems and Applications. Springer, New York (1962)\n45. Merlo, S., Norgia, M., Donati, S.: Fiber gyroscope principles. In: L\u00f2pez-Higuera, J.M. (ed.)\n\nHandbook of Optical Fibre Sensing Technology, chap. 16, pp. 331\u2013347. Wiley, Chichester\n(2002)\n\n46. Nicolle, M., Fusco, T., Rousset, G., Michau, V.: Improvement of Shack-Hartmann wave-front\nsensor measurement for extreme adaptive optics. Optic Lett. 29(3), 2743\u20132745 (2004)\n\n47. O\u2019Donnell Jr., J.R., Concha, M., Tsai, D.C., Placanica, S.J., Morrissey, J.R., Russo, A.M.:\nSpace Technology 5 launch and operations. In: Hallowell, H.E., Culp, R.D. (eds.) Guidance\nand Control 2007, Advances in the Astronautical Sciences, vol. 128, pp. 735\u2013753. Univelt, San\nDiego (1999). AAS 07\u2013091\n\n48. Pandiyan, R., Solaiappan, A., Malik, N.: A one step batch filter for estimating gyroscope\ncalibration parameters using star vectors. In: AIAA/AAS Astrodynamics Specialist Conference\nand Exhibit. Providence (2004). AIAA 04\u20134858\n\n49. Park, K., Crassidis, J.L.: Attitude determination methods using pseudolite signal phase\nmeasurements. J. Inst. Navigation 53(2), 121\u2013134 (2006)\n\n50. Park, K., Crassidis, J.L.: A robust GPS receiver self survey algorithm. J. Inst. Navigation 53(4),\n259\u2013268 (2006)\n\n51. Parkinson, B., Spilker, J. (eds.): Global Positioning System: Theory and Applications, Progress\nin Astronautics and Aeronautics, vol. 64. American Institute of Aeronautics and Astronautics,\nWashington, DC (1996)\n\n52. Parkinson, B.W.: GPS error analysis. In: Parkinson, B., Spilker, J. (eds.) Global Positioning\nSystem: Theory and Applications, Progress in Astronautics and Aeronautics, vol. 64, chap. 11.\nAmerican Institute of Aeronautics and Astronautics, Washington, DC (1996)\n\n53. Pittelkau, M.E.: Kalman filtering for spacecraft system alignment calibration. J. Guid. Contr.\nDynam. 24(6) (2001)\n\n54. Pittelkau, M.E.: Sensors for attitude determination. In: Blockley, R., Shyy, W. (eds.)\nEncyclopedia of Aerospace Engineering. Wiley, Chichester (2010)\n\n\n\nReferences 181\n\n55. Post, E.J.: Sagnac effect. Rev. Mod. Phys. 39(2), 475\u2013493 (1967)\n56. Salomon, P.M., Glavich, T.A.: Image signal processing in sub-pixel accuracy star trackers. In:\n\nBarbe, D.F. (ed.) Smart Sensors II, SPIE Proceedings, vol. 252, pp. 64\u201374 (1980)\n57. Secroun, A., Lampton, M., Levi, M.: A high-accuracy, small field of view star guider with\n\napplication to SMAP. Exp. Astron. 12(2), 69\u201385 (2000)\n58. Serrano, J., Potti, J., Bernedo, P., Silvestrin, P.: A new spacecraft attitude determination\n\nscheme based on the use of GPS line-of-sight vectors. In: Proceedings of the ION GPS-95,\npp. 1797\u20131806. Institute of Navigation, Fairfax (1995)\n\n59. Shuster, M.D.: Stellar aberration and parallax: A tutorial. J. Astronaut. Sci. 51(4), 477\u2013494\n(2003)\n\n60. Sinnott, R., Perryman, M.: Millennium Star Atlas, vol. 1. Sky Publishing Corporation &\nEuropean Space Agency, Cambridge (1997)\n\n61. Spinney, V.W.: Applications of the Global Positioning System as an attitude reference for near\nEarth users. In: ION National Aerospace Meeting, Naval Air Development Center. Warminster\n(1976)\n\n62. Spratling IV, B.B., Mortari, D.: A survey on star identification algorithms. Algorithms 2(1),\n93\u2013107 (2009)\n\n63. Steyn, W.H.: Near-minimum-time eigenaxis rotation maneuvers using reaction wheels. J. Guid.\nContr. Dynam. 18(5), 1184\u20131189 (1995)\n\n64. van Bezooijen, R.W.H., Anderson, K.A., Ward, D.K.: Performance of the AST-201 star tracker\nfor the Microwave Anisotropy Probe. In: AIAA Guidance, Navigation and Control Conference.\nMonterey (2002). AIAA 2002-4582\n\n65. Wertheimer, J.G., Laughlin, G.: Are Proxima Centauri and ? Centauri gravitationally bound?\nAstron. J. 132(5), 1995\u20131997 (2007)\n\n66. Wertz, J.R. (ed.): Spacecraft Attitude Determination and Control. Kluwer Academic,\nDordrecht (1978)\n\n67. Wie, B.: Singularity analysis and visualization for single-gimbal control moment gyro systems.\nJ. Guid. Contr. Dynam. 27(2), 271\u2013282 (2004)\n\n68. Witze, A.: Green fuels blast off. Nature 500(7464), 509\u2013510 (2013)\n\n\n\nChapter 5\nStatic Attitude Determination Methods\n\nAttitude determination typically requires finding three independent quantities,\nsuch as any minimal parameterization of the attitude matrix. The mathematics\nbehind attitude determination can be broadly characterized into approaches that use\nstochastic analysis and approaches that do not. We restrict the term \u201cestimation\u201d\nto approaches that explicitly account for stochastic variables in the mathematical\nformulation, such as a Kalman filter or a maximum likelihood approach [29].\nBlack\u2019s 1964 TRIAD algorithm was the first published method for determining the\nattitude of a spacecraft using body and reference observations, but his method could\nonly combine the information from two measurements [2]. One year later, Wahba\nformulated a general criterion for attitude determination using two or more vector\nmeasurements [36]. However, explicit relations to stochastic errors in the body\nmeasurements are not shown in these formulations. The connection to the stochastic\nnature associated with random measurement noise was first made by Farrell in a\nKalman filtering application that appeared in a NASA report in 1964 [11], but was\nnot published in the archival literature until 1970 [12]. Farrell\u2019s filter did not account\nfor errors in the system dynamics, which were first accounted for in a Kalman filter\ndeveloped by Potter and Vander Velde in 1968 [27].\n\nIt is useful to divide attitude determination approaches into two other categories.\nThe first category comprises static determination approaches that depend on mea-\nsurements taken at the same time, or close enough in time that spacecraft motion\nbetween the measurements can be ignored or easily compensated for. The second\ncategory comprises filtering approaches that make explicit use of knowledge of the\nmotion of the spacecraft to accumulate a \u201cmemory\u201d of past measurements. Static\napproaches have the requirement that at each time there are enough observations\navailable to fully compute the attitude, but they typically require no a priori attitude\nestimate. A purely deterministic approach incorporates just enough observation\ninformation to uniquely determine the attitude. For example, the TRIAD algorithm\nuses only three out of the four pieces of information obtainable from two measured\nvectors to compute an attitude solution. Another deterministic approach involves a\nsingle vector measurement and a single angle measurement [30]. Over-determined\n\nF.L. Markley and J.L. Crassidis, Fundamentals of Spacecraft Attitude Determination\nand Control, Space Technology Library 33, DOI 10.1007/978-1-4939-0802-8__5,\n\u00a9 Springer Science+Business Media New York 2014\n\n183\n\n\n\n184 5 Static Attitude Determination Methods\n\napproaches use more observation information than is required to compute a full\nattitude solution. For example, a star tracker onboard a space vehicle observes\nline-of-sight vectors to several stars, which are compared with known inertial\nline-of-sight vectors from a star catalog to determine the attitude of the vehicle.\nStatistical factors, such as an attitude error covariance, can be developed from a\nstatic solution.\n\nIn many spacecraft attitude systems, the attitude observations are naturally rep-\nresented as unit vectors. Typical examples are the unit vectors giving the direction\nto the Sun or a star and the unit vector in the direction of the Earth\u2019s magnetic\nfield. This chapter will consider the static approaches to attitude determination using\nvector measurements, beginning with TRIAD and then going on to consideration of\nmethods accommodating more than two measurements. We will also consider the\nerror bounds of the various estimators.\n\n5.1 The TRIAD Algorithm\n\nSome spacecraft attitude determination methods use exactly two vector measure-\nments. The two vectors are typically the unit vector to the Sun and the Earth\u2019s\nmagnetic field vector for coarse Sun-magnetic attitude determination or unit vectors\nto two stars tracked by two star trackers for fine attitude determination. TRIAD,\nthe earliest published algorithm for determining spacecraft attitude from two vector\nmeasurements, has been widely used in both ground-based and onboard attitude\ndetermination. The name \u201cTRIAD\u201d can be considered either as the word \u201ctriad\u201d or\nas an acronym for TRIaxial Attitude Determination.\n\nSuppose that we have measured the components of two unit vectors in the\nspacecraft body frame and also know these components in some reference frame.\nWe consider only unit vectors because the length of the vector has no information\nrelevant to attitude determination. Owing to the norm constraint, each of these unit\nvectors contains only two independent scalar pieces of attitude information. We\nhave seen that three parameters are required to specify the attitude matrix A, so two\nunit vector measurements are required to determine the attitude matrix, in general.\nIn fact two vectors overdetermine the attitude. The notation we have been using up\nto now would denote the representation of a vector in the body frame as xB and the\nrepresentation in the reference frame by xR. To avoid the proliferation of subscripts,\nwe shall denote the representation of the two vectors in the body frame as b1 and\nb2 and the representations of the corresponding vectors in the reference frame by r1\nand r2. It is clear that the attitude matrix is not uniquely determined if either the pair\nb1 and b2 or the pair r1 and r2 are parallel or antiparallel, because the attitude can\nonly be determined up to a rotation by angle about the pair of vectors in that case.\n\nThe attitude matrix to be determined is the matrix that rotates vectors from the\nreference frame to the spacecraft body frame, so we would like to find an attitude\nmatrix such that\n\nAri D bi ; for i D 1; 2 (5.1)\n\n\n\n5.1 The TRIAD Algorithm 185\n\nThis is not possible in general, however, for Eq. (5.1) implies that\n\nb1 ? b2 D .Ar1/ ? .Ar2/ D rT1 AT Ar2 D r1 ? r2 (5.2)\n\nThis equality is true for error-free measurements, but is not generally true in the\npresence of measurement errors. Thus it is impossible to satisfy both of Eq. (5.1)\nsimultaneously if Eq. (5.2) is not obeyed. The classical TRIAD algorithm is based\non the assumption that one of the unit vectors, which is conventionally denoted\nby b1, is much more accurately determined than the other, so the estimate satisfies\nAr1 D b1 exactly, but Ar2 D b2 only approximately.\n\nTRIAD is based on the following idea. If we have an orthonormal right-handed\ntriad of vectors fv1; v2; v3g in the reference frame, and a corresponding orthonormal\nright-handed triad fw1;w2;w3g in the spacecraft body frame, then the attitude\nmatrix\n\nA ? \u0152w1 w2 w3?\u0152v1 v2 v3?T D\n3X\niD1\n\nwivTi (5.3)\n\nwill transform the vi to the wi by\n\nAvi D wi ; for i D 1; 2; 3 (5.4)\n\nTRIAD forms the triad fv1; v2; v3g from r1 and r2, and the triad fw1;w2;w3g from\nb1 and b2 by means of\n\nv1 D r1; v2 D r? ? r1 ? r2kr1 ? r2k ; v3 D r1 ? r? (5.5a)\n\nw1 D b1; w2 D b? ? b1 ? b2kb1 ? b2k ; w3 D b1 ? b? (5.5b)\n\nThen the estimate of the attitude matrix, indicated by a caret, is given by Eq. (5.3) as\n\nOATRIAD D b1rT1 C .b1 ? b?/.r1 ? r?/T C b?rT? (5.6)\n\nIt can easily be seen that this solution satisfies the first equality of Eq. (5.1), and\nsome manipulation of dot and cross products shows that it satisfies the second\nequality if and only if Eq. (5.2) is obeyed. We note that the attitude matrix is\nundefined if either the reference vectors or the observed vectors are parallel or\nantiparallel. This is the case noted above in which there is insufficient information\nto determine the attitude uniquely.\n\nThis TRIAD attitude estimate is completely independent of the component of b2\nalong b1 and the component of r2 along r1. This is the information that is discarded\nto give the three pieces of information needed to specify the attitude matrix. Variants\nof TRIAD have been proposed that use other combinations of the reference and body\n\n\n\n186 5 Static Attitude Determination Methods\n\nvectors to form the orthonormal triads. These have been superseded by an algorithm\nto be derived later in this chapter that uses an arbitrary scalar weighting of the two\nvectors.\n\n5.2 Wahba\u2019s Problem\n\nWe can improve on the TRIAD method in two ways: by allowing arbitrary weighting\nof the measurements and by allowing the use of more than two measurements. The\nlatter is especially important for use with star trackers that can track many stars\nsimultaneously. Almost all of these improvements are based on a problem posed in\n1965 by Grace Wahba [36]. Wahba\u2019s problem is to find the orthogonal matrix A\nwith determinant C1 that minimizes the loss function\n\nL.A/ ? 1\n2\n\nNX\niD1\n\naikbi ? Arik2 (5.7)\n\nwhere fbig is a set of N unit vectors measured in a spacecraft\u2019s body frame, frig\nare the corresponding unit vectors in a reference frame, and faig are non-negative\nweights. We will discuss the choice of weights in Sect. 5.5.\n\nUsing the orthogonality of A, the unit norm of the unit vectors, and the cyclic\ninvariance of the trace, Eq. (2.11c), gives\n\nkbi ? Arik2 D kbik2 C kArik2 ? 2bi ? .Ari / D 2 ? 2 tr.AribTi / (5.8)\nThus we can write the loss function in the very convenient form\n\nL.A/ D \t0 ? tr.ABT / (5.9)\nwith\n\n\t0 ?\nNX\niD1\n\nai (5.10)\n\nand the \u201cattitude profile matrix\u201d B defined by\n\nB ?\nNX\niD1\n\naibirTi (5.11)\n\nNow it is clear the loss function is minimized when tr.ABT / is maximized. This has\na close relation to the orthogonal Procrustes problem, which is equivalent to finding\nthe orthogonal matrix A that is closest to B in the Frobenius norm (also known as\nthe Euclidean, Schur, or Hilbert-Schmidt norm) [17]\n\nkMk2F ? tr.MMT / (5.12)\n\n\n\n5.3 Quaternion Solutions of Wahba\u2019s Problem 187\n\nIt follows from\n\nkA ? Bk2F D kAk2F C kBk2F ? 2tr.ABT / D 3C kBk2F ? 2tr.ABT / (5.13)\n\nthat Wahba\u2019s problem is equivalent to the orthogonal Procrustes problem with the\nproviso that the determinant of A must beC1.\n\nAlgorithms for solving Wahba\u2019s problem fall into two classes. The first solves for\nthe attitude matrix directly, and the second solves for the quaternion representation\nof the attitude matrix. With error-free mathematics, all algorithms should lead to\nthe same attitude, and testing shows this to be the case [5, 24]. Some algorithms\nare faster than others, but execution speeds with modern processors make speed\ndifferences less important [4, 24]. Quaternion solutions have proven to be much\nmore useful in practice, so we will consider them first.\n\n5.3 Quaternion Solutions of Wahba\u2019s Problem\n\n5.3.1 Davenport\u2019s q Method\n\nPaul Davenport provided the first useful solution of Wahba\u2019s problem for spacecraft\nattitude determination [18]. He substituted Eq. (2.129) into Wahba\u2019s loss function\nto get\n\nL.A.q// D \t0 ?\nNX\niD1\n\naibTi A.q/ri D \t0 ?\nNX\niD1\n\naibTi ?\nT .q/?.q/ri (5.14)\n\nUsing several relations from Sect. 2.7 gives\n\nbTi ?\nT .q/?.q/ri D\n\n?\nbi\n0\n\n?T\n\u0152q??T \u0152q??\n\n?\nri\n0\n\n?\nD .q? bi /T .q? ri /\n\nD .bi ? q/T .ri ? q/ D qT \u0152bi??T \u0152ri??q (5.15)\n\nThis allows us to express the loss function as\n\nL.A.q// D \t0 ? qTK.B/q (5.16)\n\nwhere K.B/ is the symmetric traceless matrix\n\nK.B/ D\nNX\niD1\n\nai \u0152bi??T \u0152ri?? D\n?\nB C BT ? .trB/I3 z\n\nzT trB\n\n?\n(5.17)\n\n\n\n188 5 Static Attitude Determination Methods\n\nwith\n\nz ?\n2\n4\nB23 ? B32\nB31 ? B13\nB12 ? B21\n\n3\n5 D\n\nNX\niD1\n\nai .bi ? ri / (5.18)\n\nIt is known that a real symmetric n ? n matrix has n real eigenvalues and n\nreal eigenvectors that can be chosen to form an orthonormal basis [15, 17]. The\neigenvalue/eigenvector decomposition of K can be written as\n\nK.B/ D\n4X\niD1\n\n\tiqiqTi (5.19)\n\nwhere qi is the eigenvector with eigenvalue \ti , and the eigenvalues are labeled so\nthat \tmax ? \t1 ? \t2 ? \t3 ? \t4. Taking the trace of this equation and using the\ncyclic invariance of the trace and the orthonormality of the eigenvectors gives the\nwell known result that the trace of a diagonalizable matrix is equal to the sum of its\neigenvalues\n\ntr.K.B// D\n4X\niD1\n\n\ti (5.20)\n\nEquation (5.17) shows that the trace of K.B/ is zero, so this means that the sum of\nthe eigenvalues is zero:\n\n4X\niD1\n\n\ti D 0 (5.21)\n\nSubstituting Eq. (5.19) into Eq. (5.16) gives\n\nL.A.q// D \t0 ?\n4X\niD1\n\n\ti .qT qi /2 D \t0 ? \t1\n4X\niD1\n.qT qi /2 C\n\n4X\niD1\n.\t1 ? \ti /.qT qi /2\n\nD \t0 ? \t1 C\n4X\niD2\n.\t1 ? \ti /.qT qi /2 (5.22)\n\nwhere the third equality holds because the four eigenvectors constitute an orthonor-\nmal basis and because the i D 1 term in the second sum vanishes identically. The\nloss function is minimized if the quaternion is orthogonal to q2, q3, and q4, i.e. the\noptimal quaternion is the normalized eigenvector of K corresponding to the largest\neigenvalue\n\nOq D q1 (5.23)\n\nThis result can also be derived by using a Lagrange multiplier to append the\nquaternion norm constraint to the loss function [8].\n\n\n\n5.3 Quaternion Solutions of Wahba\u2019s Problem 189\n\nThe optimized loss function is easily seen to be equal to\n\nL.A. Oq// D \t0 ? \tmax (5.24)\n\nwhich explains our choice of the notation \t0 for the sum of the weights. The loss\nfunction is non-negative by definition, so it must be true that \tmax ? \t0. Since\nwe expect the optimal value of the loss function to be small, the value of \t0 ? \tmax\nprovides a very useful data quality check. Shuster has shown that if the measurement\nerrors are Gaussian and the weights ai are chosen to be the inverse measurement\nvariances, then TASTE ? 2.\t0?\tmax/ will obey a ?2 probability distribution with\n2N ? 3 degrees of freedom to a very good approximation [33].\n\nDavenport\u2019s algorithm does not have a unique solution if the two largest\neigenvalues of K.B/ are equal. This is not a failure of the q method; it means that\nthe data are not sufficient to determine the attitude uniquely. Very robust algorithms\nexist to solve the symmetric eigenvalue problem, and Davenport\u2019s method remains\nthe best method for solving Wahba\u2019s problem if one has access to one of these\neigenvalue decomposition algorithms.\n\n5.3.2 Quaternion Estimator (QUEST)\n\nDavenport\u2019s q method was used to compute attitude estimates for the High Energy\nAstronomy Observatory (HEAO-B) in 1978; but it could not provide the more\nfrequent attitude computations required by the MAGSAT spacecraft, launched 1\nyear later, using the computers of the time. The QUEST algorithm was devised\nto answer this need, and has become the most widely used algorithm for solving\nWahba\u2019s problem [24, 31, 35].\n\nWe can express Davenport\u2019s eigenvalue condition as\n\n04 D H.\tmax/ Oq (5.25)\n\nwhere\n\nH.\t/ ? \tI4 ?K.B/ D\n?\n.\tC trB/I3 ? S ?z\n\n?zT \t ? trB\n?\n\n(5.26)\n\nand\n\nS ? B C BT (5.27)\nEquation (5.25) is equivalent to the two equations\n\n.?I3 ? S/ Oq1W3 D Oq4z (5.28a)\n.\tmax ? trB/ Oq4 ? zT Oq1W3 D 0 (5.28b)\n\n\n\n190 5 Static Attitude Determination Methods\n\nwhere\n\n? ? \tmax C trB (5.29)\n\nIf we knew \tmax, Eqs. (5.28a) and (2.16) would give the optimal quaternion as\n\nOq D ?\n?\n\nadj.?I3 ? S/z\ndet.?I3 ? S/\n\n?\n(5.30)\n\nwhere ? is determined by normalization of Oq. Substituting Eq. (5.30) into Eq. (5.28b)\ngives an implicit equation for the maximum eigenvalue\n\n.\tmax ? trB/ det.?I3 ? S/ ? zT adj.?I3 ? S/z D 0 (5.31)\n\nThis is just the characteristic equation ofK.B/. We convert it to an explicit equation\nfor \tmax by using the definitions of the adjoint and the determinant to write\n\nadj.?I3 ? S/ D adjS C ?S C ?.? ? trS/I3 (5.32)\n\nand\n\ndet.?I3 ? S/ D ?3 ? ?2trS C ?? ? detS (5.33)\n\nwhere\n\n? ? tr.adjS/ (5.34)\n\nThe expression for the adjoint is further simplified by applying the Cayley-Hamilton\nTheorem, which says that a matrix obeys its own characteristic equation [17], to the\nmatrix S . With Eq. (2.103) this means that\n\nS3 ? S2trS C S tr.adjS/ ? I3 detS D 03?3 (5.35)\n\nMultiplying through by adjS and using Eq. (2.15) and a little algebra gives\n\nadjS D S2 ? S trS C ?I3 (5.36)\n\nWith these substitutions Eq. (5.31) can be written as a quartic equation for \t:\n\n0 D  QUEST.\t/ ?\n?\n\t2?.trB/2 C?? ?\t2?.trB/2 ?kzk2?\n\n? .\t ? trB/.zT SzC detS/ ? zT S2z D\n4Y\niD1\n.\t ? \ti / (5.37)\n\n\n\n5.3 Quaternion Solutions of Wahba\u2019s Problem 191\n\nWe have written \t instead of \tmax because this equation has four roots. We are only\ninterested in the largest root, though. Shuster\u2019s important observation was that \tmax\ncan be easily obtained by Newton-Raphson iteration of Eq. (5.37) starting from \t0 as\nthe initial estimate, since these two values will be very nearly equal if the optimized\nloss function is small, as we have previously observed. In fact, a single iteration\nis generally sufficient, and the approximation \tmax D \t0 is adequate in many\ncases. It is useful to perform at least one iteration, however, in order to compute\nthe quantity TASTE for data validation.\n\nThe efficiency of the QUEST algorithm results from its replacement of the\niterative operations on 4 ? 4 matrices required by Davenport\u2019s q method with\niterative scalar computations followed by straightforward matrix multiplications.\nNumerical analysts know that solving the characteristic equation is not the best\nway to find eigenvalues, in general, so QUEST is in principle less robust than\nDavenport\u2019s method. QUEST has proven to be extremely robust in practice, though,\nas long as the characteristic equation is evaluated in the partially-factored form\nshown in Eq. (5.37) [5]. The quartic characteristic equation has an analytic solution,\nbut this solution is slower, no more accurate, and sometimes less reliable than\nNewton-Raphson iteration.\n\n5.3.3 Another View of QUEST\n\nThe QUEST solution can be related to the adjoint of the matrix H defined in\nEq. (5.26). With Eq. (5.19) and I4 DP4iD1 qiqTi , we can express H in the form\n\nH.\t/ D\n4X\niD1\n.\t ? \ti /qiqTi (5.38)\n\nThe adjoint of this matrix is\n\nadjH.\t/ D\n4X\niD1\n.\t ? \tj /.\t ? \tk/.\t ? \t`/qiqTi (5.39)\n\nwhere fi; j; k; `g is a permutation of f1; 2; 3; 4g. Setting \t D \tmax D \t1 gives\n\nadjH.\tmax/ D .\tmax ? \t2/.\tmax ? \t3/.\tmax ? \t4/q1qT1 D ? Oq OqT (5.40)\n\nwhere ? is positive if \t1 \u00a4 \t2, which we have seen to be the condition for\nuniqueness of the attitude solution. In fact, ? is just d QUEST=d\t evaluated at\n\t D \tmax. Daniele Mortari was the first to recognize the significance of the matrix\nadjH [25].\n\n\n\n192 5 Static Attitude Determination Methods\n\nThe 4?4 component of Eq. (5.40) is1\n\n\u0152adjH.\tmax/?44 D det.?I3 ? S/ D ? Oq24 (5.41)\nand the other three elements of the fourth column are\n\n\u0152adjH.\tmax/?k4 D \u0152adj.?I3 ? S/z?k D ? Oq4 Oqk for k D 1; 2; 3 (5.42)\nComparison with Eq. (5.30) establishes that the QUEST quaternion estimate is just\nthe normalized fourth column of adjH.\tmax/ and that\n\n? D ?.? Oq4/?1 D ?\u0152? det.?I3 ? S/??1=2 (5.43)\nEquation (5.41) clearly shows that q4 is zero if ?I3 ? S is singular, or equivalently\nthat the estimate in this case is a 180? rotation. We can also see that ? is infinite\nin this limit. Quaternion normalization requires that kadj.?I3 ? S/zk tends to\n\u0152? det.?I3 ? S/?1=2 in the singular limit, so it is clear that the QUEST computation\nof the quaternion loses all numerical significance. This is quite different from the\nfailure of Wahba\u2019s problem to have a unique solution if the two largest eigenvalues\nof K.B/ are equal, and it can be avoided by a method discussed in the following\nsection.\n\n5.3.4 Method of Sequential Rotations\n\nShuster discovered the indeterminacy of the QUEST solution when ?I3 ? S is\nsingular, and he introduced the method of sequential rotations to deal with the\nproblem [31, 34, 35]. The idea behind this method is to solve for a quaternion\nqk ? qBRk representing the attitude with respect to a rotated reference frame Rk .\nThe attitude quaternion q ? qBR with respect to the original frame R is the product\nof qk and the quaternion qRkR representing the rotation between frames R and Rk .\nFor simplicity, the frames are related by a 180? rotation about one of the coordinate\naxes, i.e.\n\nq ? qBR D qBRk ? qRkR D qk ? q.ek; \n/\n\nD\n?\n\nqk1W3\nqk4\n\n?\n?\n?\n\nek\n0\n\n?\nD\n?\nqk4 ek C ek ? qk1W3\n?ek ? qk1W3\n\n?\nD Ekqk (5.44)\n\nwhere ek is the unit vector along the kth coordinate axis and where\n\nEk ?\n?\n\u0152ek?? ek\n?eTk 0\n\n?\n(5.45)\n\n1We are indebted to Yang Cheng for providing the basis of the discussion in this paragraph.\n\n\n\n5.3 Quaternion Solutions of Wahba\u2019s Problem 193\n\nThe matrix Ek is skew-symmetric and orthogonal. It has exactly one element with\nthe value ?1 in each column and exactly one element with the value ?1 in each\nrow; all its other elements are zero. Thus Ek is like a permutation matrix except\nfor the minus signs. This means that the transformation from qk to q requires no\nmultiplications; it merely permutes the components of the quaternion with some\nsign changes. The inverse transformation is\n\nqk D q? q.ek;?\n/ D ETk q (5.46)\nWe see that the kth component of q ends up as the fourth component of qk .\nBecause q is a unit quaternion, at least one of its components must have magnitude\ngreater than or equal to 1=2, so it is always possible to find a reference frame\nrotation that results in qk4 having magnitude of at least 1=2. Since QUEST prefers to\nkeep the magnitude of this component away from zero, it follows that the optimal\nreference frame rotation is a rotation about the axis corresponding to the component\nof q having the largest magnitude. If the fourth component of q has the largest\nmagnitude, no reference frame rotation is required.\n\nThese rotations are easy to implement on the input data, since a 180? rotation\nabout the kth coordinate axis simply changes the signs of the i th and j th\ncomponents of each reference vector, where fi; j; kg is a permutation of f1; 2; 3g.\nThis is equivalent to changing the signs of the i th and j th columns of the B matrix.\nThe reference system rotation is easily undone by Eq. (5.44) after the optimal\nquaternion in the rotated frame has been computed.\n\nThe original QUEST implementation performed sequential rotations one axis at a\ntime, until an acceptable reference coordinate system was found. It is not necessary\nto find a rotation resulting in qk4 ? 1=2, it is only necessary for qk4 to be larger than\nsome chosen value. It is clearly preferable to save computations by choosing a single\ndesirable rotation as early in the computation as possible. This can be accomplished\nby considering the components of an a priori quaternion if one is available. An a\npriori quaternion is generally available before computing the final attitude estimate\nin a star tracker application since an approximate attitude estimate is needed to\nidentify the stars in the tracker\u2019s field of view. This is either available from a previous\nestimate or is produced by a \u201clost-in-space\u201d algorithm using fewer (generally three\nor four) stars than are employed for the final attitude estimate.\n\nWe now want to show the effect of reference frame rotations on Davenport\u2019s\nK matrix. This is not part of the implementation of QUEST, but serves to show\nthe relation to the next algorithm we will consider. Putting A.q/ instead of B into\nDavenport\u2019s definition of the K matrix gives\n\nK.A.q// D 4q qT ? I4 (5.47)\nEquation (5.21) allows us to rewrite Eq. (5.19) as\n\nK.B/ D K.B/ ? 1\n4\n\n \n4X\niD1\n\n\ti\n\n!\nI4 D 1\n\n4\n\n4X\niD1\n\n\ti .4qiqTi ? I4/ D\n1\n\n4\n\n4X\niD1\n\n\tiK.A.qi //\n\n(5.48)\n\n\n\n194 5 Static Attitude Determination Methods\n\nBecause K.?/ is a linear function of its argument, it follows from Eq. (5.17) that2\n\nB D 1\n4\n\n4X\niD1\n\n\tiA.qi / (5.49)\n\nIn the rotated reference frame, we have\n\nBk D BA.ek;?\n/ D 1\n4\n\n4X\niD1\n\n\tiA.qi /A.ek;?\n/\n\nD 1\n4\n\n4X\niD1\n\n\tiA.qi ? q.ek;?\n// D 1\n4\n\n4X\niD1\n\n\tiA.E\nT\nk qi / (5.50)\n\nBut then we have\n\nK.Bk/ D 1\n4\n\n4X\niD1\n\n\tiK.A.E\nT\nk qi // D\n\n1\n\n4\n\n4X\niD1\n\n\tiE\nT\nk .4qiq\n\nT\ni ? I4/Ek D ETk K.B/Ek\n\n(5.51)\n\nThis result would be achieved much more directly if we could simply assert that\nall the eigenvectors of K transform according to Eq. (5.46) under reference frame\nrotations, but that is not necessarily true unless the four eigenvalues of K.B/ are\ndistinct.\n\nWe have shown that the effect of a reference frame rotation on K.B/ is to\npermute its rows and columns, with some sign changes. The form of Ek shows that\nrows and columns 4 and k are interchanged, as are the rows and columns labeled i\nand j . From this viewpoint, the purpose of reference frame rotations is to move the\nkth row and column of K.B/ to the lower-right corner of K.Bk/.\n\n5.3.5 Estimator of the Optimal Quaternion (ESOQ)\n\nESOQ avoids the need for explicit reference frame rotations by treating the four\ncomponents of the quaternion more symmetrically than QUEST [24, 25]. It is\nsimilar in finding \tmax by Newton-Raphson iteration of the characteristic equation\nof Davenport\u2019s K matrix and in locating the component of q with the maximum\nmagnitude. The algorithm is based on Mortari\u2019s observation that the optimal\n\n2Let M denote the 3 ? 3 matrix defined by the right side of Eq. (5.49). The 4?4 component\nof Eq. (5.48) means that trB D trM . Then the upper left 3 ? 3 submatrix of Eq. (5.48) says\nthat B C BT D M C MT . Finally, the remaining 3 ? 1 and 1 ? 3 submatrices tell us that\nB ? BT D M ?MT , establishing Eq. (5.49).\n\n\n\n5.3 Quaternion Solutions of Wahba\u2019s Problem 195\n\nquaternion can be computed by normalizing any column of adjH.\tmax/, not just\nthe fourth column. The implementation of this idea is straightforward.\n\nLet Hk denote the symmetric 3 ? 3 matrix obtained by deleting the kth row and\nkth column from H.\tmax/, where k can be any index between 1 and 4, and let\nhk denote the three-component column vector obtained by deleting the kth element\nfrom the kth column ofH.\tmax/. Then the kth component of the optimal quaternion\nis given by\n\nOqk D ??0 detHk (5.52)\nand the other three components are given by3\n\n? Oq1Wk?1\nOqkC1W4\n\n?\nD ?0.adjHk/hk (5.53)\n\nwhere ?0 can be determined by quaternion normalization. The index k is chosen by\nfinding the largest diagonal element \u0152adjH.\tmax/?kk D detHk of the adjoint matrix,\nor as the index of the largest component of an a priori quaternion.\n\nAssuming that QUEST and ESOQ use the same value for \tmax, it is obvious that\ntheir equations for the optimal quaternion are identical for k D 4. The results of\nthe previous section show that the only difference for other values of k is in some\nintermediate multiplications, for which any reasonable computer gives .?a/b D\na.?b/ and .?a/.?b/ D ab exactly. Variations in implementation details may give\nrise to some differences, of course.\n\nBetween these two algorithms, ESOQ may be preferred for replacing some\ncomputations with simple indexing operations. However, the computational savings\nare not large, and implementations of QUEST incorporating extensive error checks\nhave a long history of successful application.\n\n5.3.6 Second Estimator of the Optimal Quaternion (ESOQ2)\n\nThe following presentation differs somewhat from Mortari\u2019s original derivation,\nbut is equivalent [24, 26]. Multiplying Eq. (5.28a) by .\tmax ? trB/, substituting\nEq. (5.28b) for .\tmax ? trB/ Oq4 on the right side, and rearranging gives\n\nM Oq1W3 D 03 (5.54)\nwhere\n\nM ? .\tmax ? trB/.?I3 ? S/ ? zzT D \u0152m1 m2 m3? (5.55)\nComputing the determinant of M and comparing with Eq. (5.31) gives\n\ndetM D .\tmax ? trB/2 det.\tmaxI4 ?K/ (5.56)\n\n3We employ the convention that x1W0 or x5W4 is an empty vector, with no components.\n\n\n\n196 5 Static Attitude Determination Methods\n\nIt follows from \tmax being an eigenvalue of K.B/ that M is singular, as it must be\nfor Eq. (5.54) to have a non-trivial solution. Thus the three columns of M lie in a\nplane to which Oq1W3 must be orthogonal, so we can write\n\nOq1W3 D ?00.\tmax ? trB/.mi ?mj / (5.57)\n\nfor some scalar ?00 and for any pair of non-equal indices i and j . It is best to choose\nthe indices to select the cross product with maximum norm.4 Then Oq4 is determined\nby Eq. (5.28b), giving\n\nOq D ?00\n?\n.\tmax ? trB/.mi ?mj /\n\nz ? .mi ?mj /\n?\n\n(5.58)\n\nwhere ?00 can be determined by quaternion normalization. These computations lose\nnumerical significance if .\tmax? trB/ is close to zero, but we can avoid this singular\ncondition by using a reference system rotation to minimize trB . No rotation is\nperformed if trB is the minimum of fB11; B22; B33; trBg while a rotation about the\ni th axis is performed if Bii is the minimum. As in the QUEST case, the rotation\nis easily undone by Eq. (5.44) after the quaternion has been computed. Note that\neither an optimal or a merely acceptable rotated frame for ESOQ2 can be found\nby inspection of the B matrix, requiring neither an a priori attitude estimate nor an\niterative search.\n\n5.4 Matrix Solutions of Wahba\u2019s Problem\n\n5.4.1 Singular Value Decomposition (SVD) Method\n\nJ. L. Farrell and J. C. Stuelpnagel presented one of the first solutions of Wahba\u2019s\nproblem [13]. They performed a polar decomposition of B into the product of\nan orthogonal matrix and a symmetric positive semidefinite matrix, followed by a\ndiagonalization of the symmetric matrix. This two-step process is equivalent to the\nsingle-step procedure known as the singular value decomposition, for which very\nrobust algorithms have been developed, so we will only discuss the latter method\n[15, 17, 19].\n\nThe singular value decomposition of the attitude profile matrix is given by\n\nB D U?V T D U diag.\u0152s1 s2 s3?/V T (5.59)\n\n4One of the eigenvalues of the singular matrix M is zero, so its eigenvalue decomposition is M D\n?1vvT C?2wwT . Then mi ? mj D ?1?2.v ? w/k.v ? w/, where fi; j; kg is a cyclic permutation\nof f1; 2; 3g. The optimal indices are thus those with maximum j.mi ? mj /k j.\n\n\n\n5.4 Matrix Solutions of Wahba\u2019s Problem 197\n\nwhere U and V are orthogonal, and s1 ? s2 ? s3 ? 0 [15]. The matrices U and\nV are not guaranteed to have determinant C1, and we are only interested in proper\northogonal matrices, so it is convenient to define the rotation matrices\n\nUC ? U diag.\u01521 1 detU ?/ and VC ? V diag.\u01521 1 detV ?/ (5.60)\n\nThen\n\nB D UC? 0V TC D UCdiag.\u0152s1 s2 s03?/V TC (5.61)\n\nwhere\n\ns03 ? s3 detU detV (5.62)\n\nand s1 ? s2 ? js03j. We now define a rotation matrix and its Euler axis/angle\nrepresentation by\n\nW ? UTCAVC D .cos#/I3 ? sin#\u0152e??C .1 ? cos#/eeT (5.63)\n\nUsing the cyclic invariance of the trace, Eq. (2.11c), gives\n\ntr.ABT / D tr.W? 0/ D eT ? 0eC cos# ?tr? 0 ? eT? 0e\t\n\nD eT ? 0eC cos#\u0152s2 C s03 C e22.s1 ? s2/C e23.s1 ? s03/? (5.64)\n\nThe trace is maximized for # D 0, which gives W D I3 and thus the optimal\nattitude matrix\n\nOA D UCV TC D U diag.\u01521 1 detU detV ?/V T (5.65)\n\nThe optimized loss function is easily seen to be equal to\n\nL. OA/ D \t0 ? tr. OABT / D \t0 ? tr? 0 D \t0 ? .s1 C s2 C s03/ (5.66)\n\nand comparison with Eq. (5.24) shows that\n\n\tmax D s1 C s2 C s03 (5.67)\n\nEquation (5.64) reduces to tr.ABT / D s1?.1?cos#/\u0152e22.s1?s2/Ce23.s1?s03/? if\ns2C s03 D 0. The loss function does not have a unique minimum in this case because\nit is invariant under a rotation by any angle about the axis e1 ? \u01521 0 0?T . We will see\nshortly that this non-uniqueness is the same as the one found in Davenport\u2019s method\nwhen the two largest eigenvalues of K.B/ are not distinct.\n\n\n\n198 5 Static Attitude Determination Methods\n\n5.4.2 Fast Optimal Attitude Matrix (FOAM)\n\nThis method bears the same relationship to the SVD method as QUEST bears\nto Davenport\u2019s q method. It computes \tmax iteratively and uses simple matrix\noperations to avoid the need to perform the singular value decomposition of the\nattitude profile matrix [20]. Equation (5.61) allows us to write\n\ndetB D s1s2s03 (5.68a)\nkBk2F D s21 C s22 C .s03/2 (5.68b)\n\nadjBT D UCdiag.\u0152s2s03 s03s1 s1s2?/V TC (5.68c)\nBBTB D UCdiag.\u0152s31 s32 .s03/3?/V TC (5.68d)\n\nThen the optimal attitude matrix can be represented as\n\nOA D\n?\n\t2maxCkBk2F\n\n\t\nB C 2\tmax adjBT ? 2BBTB\n\n\tmax\n?\n\t2max?kBk2F\n\n\t ? 2 detB (5.69)\n\nSubstituting Eqs. (5.61), (5.67) and (5.68) into this representation, performing some\nstraightforward algebra, and comparing the result with Eq. (5.65) establishes its\nvalidity. With the exception of \tmax, all the quantities in Eq. (5.69) can be computed\nby straightforward algebraic operations. We find the maximum eigenvalue from\n\n\tmax D \t0 ? L. OA/ D tr. OABT / (5.70)\n\nSubstituting Eq. (5.69) and taking the trace, with \t in place of \tmax, gives\n\n0 D  FOAM.\t/ ?\n?\n\t2?kBk2F\n\n\t2 ? 8\t detB ? 4kadjBk2F D\n4Y\niD1\n.\t ? \ti / (5.71)\n\nwhere we have used the identity\n\nkBk4F ? tr.BBTBBT / D 2kadjBk2F (5.72)\n\nwhich is easily verified using the singular value decomposition. The numerical coef-\nficients in  QUEST.\t/ and  FOAM.\t/ must be identical with error-free mathematics,\nsince both functions are forms of the characteristic equation of Davenport\u2019s K\nmatrix. The FOAM form is somewhat simpler, though, and has also been employed\nin ESOQ and ESOQ2 implementations.\n\n\n\n5.4 Matrix Solutions of Wahba\u2019s Problem 199\n\nSubstituting Eqs. (5.68a)\u2013(5.68c) into Eq. (5.71) gives the eigenvalues of the K\nmatrix in terms of the singular values5:\n\n\t1 D s1 C s2 C s03 (5.73a)\n\t2 D s1 ? s2 ? s03 (5.73b)\n\t3 D ?s1 C s2 ? s03 (5.73c)\n\t4 D ?s1 ? s2 C s03 (5.73d)\n\nThe denominator of Eq. (5.69) is equal to\n\n2.s2 C s03/.s03 C s1/.s1 C s2/ D .\t1 ? \t2/.\t1 ? \t3/.\t1 ? \t4/=4 (5.74)\n\nThis clearly shows that the FOAM algorithm fails if s2 C s03 D \t1 ? \t2 D 0, which\nis the same indication of unobservability that we noted with Davenport\u2019s q method\nand the SVD method.\n\n5.4.3 Wahba\u2019s Problem with Two Observations\n\nThe two-observation case is of special interest for two reasons. The first is that the\ncharacteristic equation for K.B/ has a simple closed-form solution in this case,\nas was noted very early [35]. The second reason is that the solution to Wahba\u2019s\nproblem with two observations gives a generalization of the TRIAD method for\narbitrary measurement weights [21, 22].\n\nSeveral simplifications follow from having only two observations:\n\ndetB D 0 (5.75a)\nBBT D a21b1bT1 C a22b2bT2 C a1a2.r1 ? r2/.b1bT2 C b2bT1 / (5.75b)\nkBk2F D a21 C a22 C 2a1a2.b1 ? b2/.r1 ? r2/ (5.75c)\n\nadjBT D a1a2.b1 ? b2/.r1 ? r2/T (5.75d)\nkadjBkF D a1a2kb1 ? b2kkr1 ? r2k (5.75e)\n\nIt then follows from Eq. (5.71) that\n\n\tmax D\n?\na21 C a22 C 2a1a2\u0152.b1 ? b2/.r1 ? r2/C kb1 ? b2kkr1 ? r2k?\n\n?1=2\n(5.76)\n\n5Paul Davenport discovered these relations, but did not publish them.\n\n\n\n200 5 Static Attitude Determination Methods\n\nThis can be used in QUEST, ESOQ, ESOQ2, or FOAM, avoiding the need for\nNewton-Raphson iteration. If we define ?b to be the angle between b1 and b2, and\n?r to be the angle between r1 and r2, then\n\n\tmax D\n?\n\t20 ? 4a1a2 sin2\n\n?\n?b ? ?r\n2\n\n??1=2\n(5.77)\n\nThis form provides some insight, but is less useful for computation than Eq. (5.76).\nSubstituting Eqs. (5.75a)\u2013(5.75e) into (5.69) gives, after some algebra\n\nOA D .a1=\tmax/\n?\nb1rT1 C .b1 ? b?/.r1 ? r?/T\n\n?\n\nC.a2=\tmax/\n?\nb2rT2 C .b2 ? b?/.r2 ? r?/T\n\n?C b?rT? (5.78)\n\nusing the notation of Sect. 5.1. It is obvious from this equation that the optimal\nattitude estimate maps r1 and r2 into the plane spanned by b1 and b2. The TRIAD\nsolution also has this property, so the difference between the Wahba and TRIAD\nestimates can be represented as a rotation about the axis b?, which is the normal\nvector to the plane containing b1 and b2.\n\nIt is also easy to see that the solution has a unique limit as either observation\nweight goes to zero. This limit is the TRIAD solution of Eq. (5.3) if a2 D 0, and it is\nthe TRIAD solution with the roles of the two observations interchanged if a1 D 0.\nThis limit was already noted in [35]. For general weights, the optimal solution is\nsome sort of an average of the two TRIAD solutions. It is not a simple average,\nthough, because a simple average would not give an orthogonal attitude matrix. It is\ninteresting that Eq. (5.78) has a unique limit as either observation weight goes to\nzero even though Wahba\u2019s loss function does not have a unique minimum in either\nlimit, because it effectively includes only one observation.\n\nThere is an equivalent closed-form solution for the quaternion [21]:\n\nOq D\n\n8?\n\u02c6???\n\u02c6?<\n\u02c6???\n\u02c6??:\n\n1\n\n2\np\n?.? C ?/.1C b? ? r?/\n\n\"\n.? C ?/.b? ? r?/C ?.b? C r?/\n\n.? C ?/.1C b? ? r?/\n\n#\nfor ? ? 0\n\n1\n\n2\np\n?.? ? ?/.1C b? ? r?/\n\n\"\n?.b? ? r?/C .? ? ?/.b? C r?/\n\n?.1C b? ? r?/\n\n#\nfor ? < 0\n\n(5.79)\nwhere\n\n? ? .1C b? ? r?/.a1b1 ? r1 C a2b2 ? r2/C .b? ? r?/ ? .a1b1 ? r1 C a2b2 ? r2/\n(5.80a)\n\n? ? .b? C r?/ ? .a1b1 ? r1 C a2b2 ? r2/ (5.80b)\n? ?\n\np\n?2 C ?2 (5.80c)\n\n\n\n5.5 Error Analysis of Wahba\u2019s Problem 201\n\nThe above expressions are indeterminate when b? D ?r?, and are unreliable\nnear this singular condition. This problem can be avoided by applying one of the\nreference frame rotations of Sect. 5.3.4. The effect of a 180? rotation about the i th\naxis on the inner product b? ? r? is\n\n.b? ? r?/rotated D \u0152.b?/i ? .r?/i ? .b?/j ? .r?/j ? .b?/k ? .r?/k?unrotated\nD \u01522.b?/i ? .r?/i ? b? ? r??unrotated (5.81)\n\nWe ensure the largest value for .b? ? r?/rotated by performing the estimation in the\noriginal reference frame if b? ? r? is larger than any of the products .b?/i ? .r?/i in\nthis frame, or by rotating about the axis with maximum .b?/i ? .r?/i if this is greater\nthan b? ? r?. More details can be found in [21].\n\n5.5 Error Analysis of Wahba\u2019s Problem\n\nThe value of an estimate is greatly enhanced by knowledge of its accuracy. In fact,\nMalcolm Shuster\u2019s covariance analysis of the QUEST algorithm was at least as\nimportant as his invention of the algorithm itself.6 This section will provide an\nestimate of the accuracy of a solution to Wahba\u2019s problem. Because all algorithms\nyield the same estimate, assuming that it is unique, we only need to analyze the\nerrors exhibited by one algorithm. We will use Davenport\u2019s q method, which leads\nmost directly to the desired result.\n\n5.5.1 Attitude Error Vector\n\nAttitude errors are most usefully expressed in the spacecraft\u2019s body frame, so we\nparameterize the attitude errors by the first-order rotation vector ?# representing\nthe rotation between the estimated body frame OB and the true body frame B . The\ngoal of this section is to find an expression for ?# in terms of the errors of the body\nand reference frame vectors. Attitude errors are expected to be small, so we do not\nhave to worry about singularities of the rotation vector representation. We represent\nthe attitude by a quaternion, so\n\nOq ? q OBR D q OBB ? qBR D \u0152q OBB??qBR D exp\u0152.?#=2/??qBR (5.82)\nwhere we have used Eq. (2.127). All our error analysis will be carried out only to\nfirst order in small quantities, so we can approximate\n\nexp\u0152.?#=2/?? D I4 C \u0152.?#=2/?? (5.83)\n\n6Much more important, in Paul Davenport\u2019s opinion.\n\n\n\n202 5 Static Attitude Determination Methods\n\nwhich gives\n\nOq D qBR C .1=2/ ?# ? qBR (5.84)\n\nThe analysis of errors in the spacecraft\u2019s body frame does not depend on the\nspecification of the reference frame R, so we are free to choose this to coincide\nwith the body frame. With this choice, qBR is the identity quaternion, and Eq. (5.84)\nreduces to\n\nOq D\n?\n\n03\n1\n\n?\nC 1\n2\n\n?\n?#\n\n0\n\n?\n(5.85)\n\nThe body frame vectors bi and reference frame vectors ri are equal to their true,\nerror-free, values plus some errors. Because we take the reference frame to be the\nbody frame, the true values of the reference vectors and body vectors are identical.\nThus the attitude profile matrix is\n\nB D\nNX\niD1\n\nai .btruei C?bi /.btruei C?ri /T D B0 C?B (5.86)\n\nwhere\n\nB0 ?\nNX\niD1\n\naibtruei .b\ntrue\ni /\n\nT (5.87)\n\n?B ?\nNX\niD1\n\nai \u0152btruei ?r\nT\ni C?bi .btruei /T ? (5.88)\n\nand we have ignored terms of higher than first order. The matrix B0 is symmetric,\nand its trace is \t0, so\n\nK.B0/ D\n?\n2B0 ? \t0I3 03\n\n0T3 \t0\n\n?\n(5.89)\n\nWe see that K.B0/qBR D K.B0/Iq D \t0Iq , so the maximum eigenvalue is equal\nto \t0 for error-free measurements. This is expected because the loss function must\nbe zero if the measurement errors are zero. The other three eigenvectors of K0 have\nthree-vector part q1W3 D xi and scalar part q4 D 0, where xi is an eigenvector of\n.2B0 ? \t0I3/ with eigenvalue \tiC1, for i D 1; 2; 3.\n\nNow let us turn to ?B . Both btruei C?bi and btruei are unit vectors, so\n\n1 D kbtruei C?bik2 D 1C 2btruei ??bi C k?bik2 (5.90)\n\n\n\n5.5 Error Analysis of Wahba\u2019s Problem 203\n\nThe same relation holds for ri D btruei C?ri , so\n\nbtruei ??bi D ?\n1\n\n2\nk?bik2 and btruei ??ri D ?\n\n1\n\n2\nk?rik2 (5.91)\n\nIt follows that tr.?B/ D 0, to first order in the vector errors. The z vector associated\nwith ?B is, also to first order\n\n?z D\nNX\niD1\n\nai .btruei C?bi / ? .btruei C?ri / D\nNX\niD1\n\naibtruei ? .?ri ??bi / (5.92)\n\nand so\n\nK.?B/ D\n?\n?B C?BT ?z\n\n?zT 0\n\n?\n(5.93)\n\nPutting all this into Davenport\u2019s eigenvalue equation gives\n\nK.B/ Oq D \u0152K.B0/CK.?B/?\n??\n\n03\n1\n\n?\nC 1\n2\n\n?\n?#\n\n0\n\n??\n\nD \tmax Oq D .\t0 C?\t/\n??\n\n03\n1\n\n?\nC 1\n2\n\n?\n?#\n\n0\n\n??\n(5.94)\n\nMultiplying this out, discarding terms of second order, and canceling the common\nzeroth-order term K.B0/Iq D \t0Iq on the two sides gives\n\n1\n\n2\nK.B0/\n\n?\n?#\n\n0\n\n?\nCK.?B/\n\n?\n03\n1\n\n?\nD 1\n2\n\t0\n\n?\n?#\n\n0\n\n?\nC?\t\n\n?\n03\n1\n\n?\n(5.95)\n\nInserting the explicit forms of K.B0/ and K.?B/ gives\n\n?\n.1=2/.2B0 ? \t0I3/?# C?z\n\n0\n\n?\nD\n?\n.1=2/\t0 ?#\n\n?\t\n\n?\n(5.96)\n\nThe fourth component of this equation says that?\t is zero to first order in the errors\nin the vectors. This means that the loss function is of second order in these errors,\nwhich is in accordance with its definition. The first three components of Eq. (5.96)\nare more interesting; they give\n\n?# D .\t0I3 ? B0/?1?z D .\t0I3 ? B0/?1\nNX\niD1\n\naibtruei ? .?ri ??bi / (5.97)\n\n\n\n204 5 Static Attitude Determination Methods\n\nThis is the key result; it expresses the attitude error rotation vector in terms of the\nerrors in the body frame vectors and the reference vectors, with the latter mapped\ninto the true body frame. Is is also interesting to note that\n\n\t0I3 ? B0 D\nNX\niD1\n\nai\n?\nI3 ? btruei .btruei /T\n\n?\n(5.98)\n\nThe discussion following Eq. (5.89) shows that this matrix is singular if the largest\ntwo eigenvalues of K0 are equal.\n\n5.5.2 Covariance Analysis of Wahba\u2019s Problem\n\nIf we knew the errors of the vectors in the spacecraft body frame and the reference\nframe, we would correct the vectors before performing the estimation, and they\nwould no longer be errors. The usual situation is that the errors are unknown,\nbut they have some statistical distribution with known properties. These properties\nare given by expected values over the probability distribution. The details of the\nprobability distribution are not important for this section; we only need to know the\nexpected values of some quantities.\n\nWe assume that the vector errors have zero mean, except for components along\nbtruei that are necessary to satisfy the norm constraint of Eq. (5.91). Thus their\nexpected values are assumed to satisfy, for all i\n\nEf?big D ?1\n2\nEfk?bik2gbtruei and Ef?rig D ?\n\n1\n\n2\nEfk?rik2gbtruei (5.99)\n\nThe usual justification of this assumption is that we would estimate and correct for\nany other non-zero means of these quantities before estimating the attitude. Now\nthe only stochastic quantities in Eq. (5.97) are ?# , ?z, ?ri , and ?bi ; the other\nquantities are deterministic. Computing expected values is a linear operation, and\nthe cross product of a vector with itself is zero, so it follows that\n\nEf?#g D .\t0I3 ? B0/?1\nNX\niD1\n\naibtruei ? .Ef?rig ?Ef?big/ D 03 (5.100)\n\nThis shows that the expected value of the attitude error ?# is zero, which means that\na solution of Wahba\u2019s problem is an unbiased estimator.\n\nWe are interested in the expected spread of the attitude estimates about the mean\nvalue. This is given by the covariance matrix\n\nP## ? E\n?\n.?# ?Ef?#g/.?# ?Ef?#g/T ? D Ef?# ?#T g (5.101)\n\n\n\n5.5 Error Analysis of Wahba\u2019s Problem 205\n\nSubstituting Eq. (5.97) gives\n\nP## D .\t0I3 ? B0/?1Ef?z?zT g.\t0I3 ? B0/?1 (5.102)\n\nFurther progress requires some assumptions about the covariance of the vector\nerrors. We assume that the errors in the individual vectors are uncorrelated, meaning\nthat\n\nEf?bi ?bTj g D Ef?ri ?rTj g D 0 for i \u00a4 j (5.103a)\nEf?bi ?rTj g D 0 for all i; j (5.103b)\n\nWe also define the measurement covariance matrices by\n\nRbi ? Ef?bi ?bTi g (5.104a)\nRri ? Ef?ri ?rTi g (5.104b)\n\nThen\n\nEf?z?zT g D\nNX\n\ni;jD1\naiaj \u0152btruei ??Ef.?ri ??bi /.?rj ??bj /T g\u0152btruej ??T\n\nD\nNX\niD1\n\na2i \u0152b\ntrue\ni ??.Rri CRbi /\u0152btruei ??T (5.105)\n\nand\n\nP## D .\t0I3 ? B0/?1\n(\n\nNX\niD1\n\na2i \u0152b\ntrue\ni ??.Rri CRbi /\u0152btruei ??T\n\n)\n.\t0I3 ? B0/?1\n\n(5.106)\n\nWe now make a further simplifying assumption about the vector errors, namely\nthat they are axially symmetric about the true vectors. We also ignore the compo-\nnents along the true vectors shown in Eq. (5.99), which are of higher order than the\nterms we retain. These assumptions are expressed in the equations\n\nRri D ?2ri\n?\nI3 ? rtruei .rtruei /T\n\n? D ??2ri\n?\nrtruei ?\n\n?2\n(5.107a)\n\nRbi D ?2bi\n?\nI3 ? btruei .btruei /T\n\n? D ??2bi\n?\nbtruei ?\n\n?2\n(5.107b)\n\nThis has become known as the QUEST Measurement Model (QMM). If we think of\nthe error-corrupted vectors as arrows with a common base, their points should all lie\non a unit sphere. The QUEST measurement model is essentially the approximation\nthat the points all lie on the plane that is tangent to the unit sphere at the location of\n\n\n\n206 5 Static Attitude Determination Methods\n\nthe true unit vector. This is certainly a good approximation if the errors are small.\nWe note that Efk?rik2g D trRri and Efk?bik2g D trRbi , so Eq. (5.99) becomes,\nfor the QMM,\n\nEf?rig D ??2ri rtruei and Ef?big D ??2bibtruei (5.108)\n\nIt is useful to combine the error variances of the body frame vectors and reference\nframe vectors into overall measurement variances\n\n?2i ? ?2ri C ?2bi (5.109)\n\nRemembering that we have assumed rtruei D btruei for our error analysis, the error\ncovariance with the QMM is\n\nP## D .\t0I3 ? B0/?1M.\t0I3 ? B0/?1 (5.110)\n\nwhere\n\nM ?\nNX\ni;D1\n\na2i ?\n2\ni \u0152b\n\ntrue\ni ??\u0152btruei ??T D\n\nNX\ni;D1\n\na2i ?\n2\ni\n\n?\nI3 ? btruei .btruei /T\n\n?\n(5.111)\n\nIt is interesting to note that using the nonsingular, but nonphysical, measurement\ncovariance matrices Rri D ?2ri I3 and Rbi D ?2bi I3 yields the same result.\n\nIf we choose the weights to be proportional to the inverses of the measurement\nvariances,\n\nai D c=?2i (5.112)\n\nfor some constant c, we get the very simple result\n\nM D c2F; \t0I3 ? B0 D cF; and P## D F ?1 (5.113)\n\nwhere\n\nF ?\nNX\niD1\n\n??2i\n?\nI3 ? btruei .btruei /T\n\n?\n(5.114)\n\nWe will show in Sect. 5.6.1 that this choice of weights in Wahba\u2019s loss function also\nresults in the best estimate.7 Note that the covariance is independent of the scaling\n\n7We can show that Eq. (5.112) gives an extremum ofP## by differentiating Eq. (5.110) with respect\nto any ak , then substituting Eqs. (5.112) and (5.113) after differentiating, which gives zero for the\nderivative.\n\n\n\n5.5 Error Analysis of Wahba\u2019s Problem 207\n\nparameter c. Most recent work sets c D 1, so the weights are equal to the inverse\nvariances, but earlier treatments often set c D ?2tot, where\n\n?tot ?\n \n\nNX\niD1\n\n??2i\n\n!?1=2\n(5.115)\n\nso that the weights sum to unity.\nEquation (5.114) has a nice physical interpretation. The covariance matrix is\n\na measure of the uncertainty, or the lack of complete information, in computing\nthe estimate. The inverse of the covariance matrix, F , is therefore a measure of the\ninformation contributing to the estimate. Each term in the sum in Eq. (5.114) can be\ninterpreted as the information contributed by a single vector measurement. For an\nefficient estimator F is equivalent to the Fisher Information Matrix. See Sect. 12.3.4\nfor more details.\n\nIn practice, we would like to compute an estimate of the covariance without\nrequiring knowledge of the true body frame vectors. We could simply use the\nmeasured body frame vectors bi in Eq. (5.114), but it is better to use the predicted\nbody frame vectors OAri , which usually have smaller errors. We can avoid the need\nto perform the additional summation of Eq. (5.114) by using the B matrix, which\nmust be computed as part of the attitude estimation. Dispensing with the assumption\nthat the reference frame coincides with the body frame, we see from Eq. (5.113) that\na good estimate of the covariance is\n\nP## D c.\tmaxI3 ? B OAT /?1 (5.116)\nWe use \tmax instead of \t0 in this equation to preserve the important property that the\ncovariance is infinite if the two largest eigenvalues ofK are equal. Analysis parallel\nto that used to derive the FOAM attitude estimate gives the alternative form for the\ncovariance\n\nP## D c\n?\n\t2max?kBk2F\n\n\t\nI3 C 2BBT\n\n\tmax\n?\n\t2max?kBk2F\n\n\t ? 2 detB (5.117)\n\nwhich avoids a matrix inversion.\n\n5.5.3 Covariance with Two Observations\n\nThe covariance for the case of two observations can be found by substituting\nEqs. (5.75a)\u2013(5.75c) and (5.76) into Eq. (5.117). We also assume for simplicity that\nr1 ? r2 D b1 ? b2, which leads to kb1 ? b2k D kr1 ? r2k and \tmax D a1C a2. Putting\nall this together gives\n\nP## D c\na1 C a2\n\n?\nI3 C a\n\n2\n1b1b\n\nT\n1 C a22b2bT2 C a1a2.b1 ? b2/.b1bT2 C b2bT1 /\n\na1a2kb1 ? b2k2\n?\n\n(5.118)\n\n\n\n208 5 Static Attitude Determination Methods\n\nWe now use the expansion of the identity matrix in terms of the orthonormal triad\nof Sect. 5.1:\n\nI3 D w1wT1 C w2wT2 C w3wT3\n\nD b1b\nT\n1 C b2bT2 ? .b1 ? b2/.b1bT2 C b2bT1 /\n\nkb1 ? b2k2 C b?b\nT? (5.119)\n\nand substitute ai D c=?2i to get the final result\n\nP## D ?\n2\n2b1b\n\nT\n1 C ?21b2bT2\nkb1 ? b2k2 C\n\n?21 ?\n2\n2\n\n?21 C ?22\nb?bT? (5.120)\n\nIt is easy to see with the help of Eq. (5.119) that this is the inverse of Eq. (5.114) if\nmeasurement errors are negligible.\n\nThe covariance of the TRIAD estimate is found as a limiting case of the\ncovariance of the Wahba estimate. We have seen that the TRIAD estimate is the\nlimiting case of Eq. (5.78) for a1 \n a2, or equivalently for ?2 \n ?1. Taking this\nlimit of Eq. (5.120) gives\n\nPTRIAD D ?\n2\n2b1b\n\nT\n1 C ?21b2bT2\nkb1 ? b2k2 C ?\n\n2\n1b?bT? (5.121)\n\nWe noted that the Wahba and TRIAD attitude estimates only differ by a rotation\naround b?, so it is not surprising that the only difference in the covariance of the\ntwo estimates is in that direction. The TRIAD information matrix is the inverse of\nthe covariance, namely\n\nFTRIAD D ??21 .I3 ? b1bT1 /C ??22 .b2 ? b?/.b2 ? b?/T (5.122)\n\nThe first vector measurement contributes the same information to the TRIAD\nestimate as to the Wahba estimate, two components perpendicular to b1; but\nthe second vector measurement contributes only one component of information,\nperpendicular to both b2 and b?, to the TRIAD estimate. This derivation of the\nTRIAD covariance and information matrices is somewhat heuristic, but a more\nrigorous analysis gives the same result [32, 35].\n\n5.6 MLE for Attitude Determination\n\nIn this section maximum likelihood estimation (MLE) for the attitude determination\nproblem is studied. The treatment in Sect. 12.3.4 requires the measurement covari-\nance matrix R to be nonsingular, as will usually be the case if the measurement\nvector y contains actual measurements. Considering a star tracker, for example, the\n\n\n\n5.6 MLE for Attitude Determination 209\n\nactual measurements are the horizontal and vertical positions of the centroids of the\nstar images in the tracker\u2019s field of view.8 The measurement covariance matrix for\nthese measurements is nonsingular, but it is not particularly simple in the general\ncase [3].\n\nHere we want to focus on modeling the measurements as unit vectors, which\nleads to the elegant and useful estimation methods based on Wahba\u2019s loss function.\nAn apparent difficulty with this approach is that the measurement covariance matrix\nof the QMM is singular, as shown in Eq. (5.107). Shuster has shown how to define a\nconditional pdf for vector measurements that overcomes this problem [29], and we\nwill follow his approach.\n\nWe first assume that no errors exist in the reference vectors, and will relax this\nassumption later. In this case, the conditional pdf for a unit-vector measurement\nbi is\n\np.bi jAtrue; rtruei / D Nbi exp\n \n? 1\n2?2bi\n\nkbi ? Atruertruei k2\n!\n\n(5.123)\n\nThis pdf is defined over the unit sphere i.e. for bi that satisfies kbik D 1. In this pdf,\nthe single parameter ?2bi takes the place of the measurement covariance matrix, so\nthis models measurement errors with a high degree of symmetry. In fact, the errors\nin this model are as symmetric as possible consistent with the unit vector constraint\non the measurements. We will show that this model is equivalent to the QMM to a\nvery good approximation.\n\nThe normalization coefficient Nbi must be specified so that the total probability is\nunity. To compute the normalization and other integrals of interest, we parameterize\nbi as bi D Atruertruei cos ? C u sin ? cos?C v sin ? sin?, where u and v are two unit\nvectors perpendicular to Atruertruei and to each other. The area element on the unit\nsphere is sin ? d? d? D d? d?, where ? ? 1 ? cos ? . Then the normalization\nconstant is given by\n\nNbi D\n?Z 2\n\n0\n\nZ 2\n0\n\nexp.??=?2bi / d? d?\n??1\nD\nh\n2\n?2bi\n\n\n1 ? e?2=?2bi\n\n?i?1\n(5.124)\n\nThe exponential term can be neglected even for extremely large errors, reflecting\nthe fact that the pdf becomes extremely small over most of the unit sphere. For\n\nexample, if ?i is 10?, or 0.175 rad, then e?2=?\n2\nbi D 3 ? 10?29. Neglecting the\n\nexponential term is equivalent to taking the upper limit of the ? integral to be infinite,\nan approximation we will employ in the next paragraph.\n\n8The really basic measurements are the electron counts in the individual pixels of the star tracker\u2019s\nfocal plane, but these are invariably reduced to centroids before being communicated to the attitude\ncontrol system.\n\n\n\n210 5 Static Attitude Determination Methods\n\nIt is interesting to see how the unit vector pdf of Eq. (5.123) is related to the\nQMM. First, with btruei ? Atruertruei we see that\n\nEfbi ? btruei g ?\n1\n\n2\n?2bi\n\nZ 2\n0\n\nZ 1\n0\n\n.??/ exp.??=?2bi / d? d? btruei ? ??2bibtruei\n(5.125)\n\nbecause the integral over ? gives zero components along u and v. This shows\n\nthat Eq. (5.108) holds in the approximation of ignoring e?2=?\n2\nbi . Now we compute\n\nEf.bi ? btruei /.bi ? btruei /T g. The integrals involving an odd power of cos? or\nsin? will vanish in the integration over ?, and the integrals over ? of cos2 ? and\nsin2 ? both give \n . We also note that sin2 ? D 2? ? ?2 and u uT C v vT D\nI3 ? btruei .btruei /T , so\n\nEf.bi ? btruei /.bi ? btruei /T g ? ??2bi\nZ 1\n0\n\n? exp.??=?2bi / d?\n?\nI3 ? btruei .btruei /T\n\n?\n\n? 1\n2\n??2bi\n\nZ 1\n0\n\n?2 exp.??=?2bi / d?\n?\nI3 ? 3btruei .btruei /T\n\n?\n\n? ?2bi\n?\nI3 ? btruei .btruei /T\n\n? ? ?4bi\n?\nI3 ? 3btruei .btruei /T\n\n?\n(5.126)\n\nThe first term is the covariance of the QMM, Eq. (5.107b). The second term is a\nsmall correction, much larger than the neglected exponential terms but only 3 % for\nmeasurement errors as large as 10?. It is interesting to note that this term has zero\ntrace.\n\nThe likelihood of a set of N statistically independent measurements is\n\n`.b1; : : : ; bN jAtrue; rtruei / D\nNY\niD1\n\nNbi exp\n\n \n? 1\n2?2bi\n\nkbi ? Atruertruei k2\n!\n\n(5.127)\n\nMaximizing this likelihood is equivalent to minimizing the negative log-likelihood,\nwhich is given by\n\n? ln ` D\nNX\niD1\n\n \n1\n\n2?2bi\n\nkbi ? Atruertruei k2 ? ln Nbi\n!\n\n(5.128)\n\nThe data-dependent portion of the negative log-likelihood, i.e. the part exclusive\nof the ln Nbi terms, is Wahba\u2019s loss function with the weights chosen according to\nEq. (5.112), which establishes that Wahba\u2019s problem is equivalent to MLE with this\nchoice of weights.\n\nThe MLE analysis up to this point has assumed that the reference vectors\nare perfectly known. This is never the case, although the reference vectors often\nhave much smaller uncertainties than the body frame vectors. We can generalize\nthe analysis by assuming that the reference vectors have a conditional pdf over the\nunit sphere of the form\n\n\n\n5.6 MLE for Attitude Determination 211\n\np.ri jrtruei / D Nri exp\n \n? 1\n2?2ri\nkri ? rtruei k2\n\n!\n(5.129)\n\nWith the reasonable assumption of statistical independence of the reference vector\nerrors and the errors in the body frame measurements, the likelihood of the reference\nand body frame vectors is\n\n`.b1; : : : ; bN ; r1; : : : ; rN jAtrue; rtruei / D\nNY\niD1\n\nNbiNri\n\n? exp\n \n? 1\n2?2bi\n\nkbi ? Atruertruei k2 ?\n1\n\n2?2ri\nkri ? rtruei k2\n\n!\n(5.130)\n\nand the negative log-likelihood function is\n\n? ln ` D\nNX\niD1\n\n\"\n1\n\n2?2bi\n\nkbi ? Atruertruei k2 C\n1\n\n2?2ri\nkri ? rtruei k2 ? ln.NbiNri /\n\n#\n\nD\nNX\niD1\n\nn\n??2bi C ??2ri ?\n\n?\n??2bi .A\n\ntrue/T bi C ??2ri ri\n?T\n\nrtruei ? ln.NbiNri /\no\n\n(5.131)\n\nWe have to use our error-corrupted reference vectors and body frame vectors to find\na maximum likelihood estimate of both the attitude matrix Atrue and each of the\ntrue reference vectors rtruei . It is clear that we minimize the negative log-likelihood\nfunction with respect to the true reference vectors by taking rtruei to be the unit vector\nin the direction of ??2bi .A\n\ntrue/T bi C ??2ri ri , i.e.\n\nrtruei D\n??2bi .A\n\ntrue/T bi C ??2ri ri\n.??4bi C ??4ri C 2??2bi ??2ri bTi Atrue ri /1=2\n\n(5.132)\n\nThis is exactly what we would expect, a weighted average of the estimates computed\nfrom the error-corrupted reference and body frame vectors. This estimate involves\nthe as-yet-unknown attitude matrix. However, inserting this estimate of rtruei into\nEq. (5.131) gives the effective negative log-likelihood function for the attitude\n\n? ln ` D\nNX\niD1\n\n?\n??2bi C ??2ri ? .??4bi C ??4ri C 2??2bi ??2ri bTi Atrue ri /1=2? ln.NbiNri /\n\n?\n\n(5.133)\n\nThis does not look like Wahba\u2019s loss function. However, we can write\n\n??4bi C ??4ri C 2??2bi ??2ri bTi Atrue ri D .??2bi C ??2ri /2 ? 2??2bi ??2ri .1 ? bTi Atrue ri /\nD .??2bi C ??2ri /2 ? ??2bi ??2ri kbi ? Atrue rik2\n\n(5.134)\n\n\n\n212 5 Static Attitude Determination Methods\n\nIt is always true that kbi ? Atrue rik ? ?bi ?ri .??2bi C ??2ri / D ?bi =?ri C ?ri =?bi ,\nbecause the right side of this inequality is never smaller than 2 and the left side is\non the order of the ?2 by Eq. (5.125). Thus expanding the square root in Eq. (5.133)\nas a Taylor series and retaining only the first two terms gives the useful expression\n\n\u0152.??2bi C ??2ri /2 ? ??2bi ??2ri kbi ? Atrue rik2?1=2\n\n? .??2bi C ??2ri /\n\n2\n641 ? kbi ? A\n\ntrue rik2\n\n2?2bi ?\n2\nri\n\n\n??2bi C ??2ri\n\n?2\n\n3\n75 (5.135)\n\nand thus\n\n? ln ` ?\nNX\niD1\n\n?\n1\n\n2?2i\nkbi ? Atrue rik2 ? ln.NbiNri /\n\n?\n(5.136)\n\nwith ?2i D ?2bi C ?2ri , as in Eq. (5.109). The data-dependent portion of this is just\nWahba\u2019s loss function with an effective measurement variance of ?2bi C ?2ri .\n\n5.6.1 Fisher Information Matrix for Attitude Determination\n\nTo determine the Fisher information matrix using the negative log-likelihood in\nEq. (5.136), we must first decide what to use as the vector that we called xtrue in\nSect. 12.3.4. The components of the attitude matrix are not appropriate, because they\nare constrained by the orthogonality requirement. We know that three parameters\nprovide a minimal representation of a rotation, so we use the three incremental error\nangles as defined in Eq. (2.123). Thus we replace Atrue by\n\nAtrue ! exp.?\u0152?#??/Atrue ? .I3 ? \u0152?#??/ Atrue (5.137)\nwhere ?# is the vector of error angles. Substituting Eq. (5.137) into Eq. (5.136) and\ninserting the true values for bi and ri gives\n\n? ln ` ?\nNX\niD1\n\n?\n1\n\n2?2i\nk\u0152?#?? Atruertruei k2 ? ln.NbiNri /\n\n?\n\n?\nNX\niD1\n\n?\n1\n\n2?2i\n?#T \u0152btruei ??T \u0152btruei ???# ? ln.NbiNri /\n\n?\n(5.138)\n\nbecause btruei D Atruertruei . This approximate expression can be considered as exact\nfor the purpose of computing the Fisher information matrix, because the higher\norder terms neglected in Eq. (5.135) are of third and higher order in ?# and vanish\nwhen computing the information matrix.\n\n\n\n5.6 MLE for Attitude Determination 213\n\nNow the Fisher information matrix is given by\n\nF D ?@2.ln `/=\u0152.@?#/ .@?#T /???\n?#D0 D\n\nNX\niD1\n\n??2i \u0152btruei ??T \u0152btruei ??\n\nD\nNX\niD1\n\n??2i\n?\nI3 ? btruei .btruei /T\n\n?\n(5.139)\n\nremembering that btruei is a unit vector. Comparing this result to Eq. (5.114) shows\nthat any solution that minimizes Wahba\u2019s problem leads to an efficient estimator, to\nwithin first-order, since P## D F ?1.\n\nAn analysis of the observable attitude axes using the Fisher information matrix is\nshown in [8], which is repeated here. This analysis is shown for one and two vector\nobservations. For observation of a single vector the Fisher information matrix is\ngiven by\n\nF D ??2 ?I3 ? btrue.btrue/T\n?\n\n(5.140)\n\nAn eigenvalue/eigenvector decomposition can be useful to assess the observability\nof this system. Since F is a symmetric positive semi-definite matrix, then all\nof its eigenvalues are greater than or equal to zero. Furthermore, the matrix of\neigenvectors is orthogonal, which can be used to define a coordinate system. The\neigenvalues of this matrix are given by \t1 D 0 and \t2;3 D ??2. This indicates\nthat rotations about one of the eigenvectors are not observable. The eigenvector\nassociated with the zero eigenvalue is along btrue. Therefore, rotations about the\nbody vector are unknown, which intuitively makes sense. The other observable axes\nare perpendicular to this unobservable axis, which also intuitively makes sense.\n\nA more interesting case involves two vector observations. The information matrix\nfor this case is given by\n\nF D ??21\n?\nI3 ? btrue1 .btrue1 /T\n\n?C ??22\n?\nI3 ? btrue2 .btrue2 /T\n\n?\n(5.141)\n\nIf two non-collinear vector observations exist, then the system is fully observable\nand no zero eigenvalues of F will exist. The maximum eigenvalue of F can be\nshown to be given by\n\n\tmax D ??21 C ??22 (5.142)\n\nFactoring this eigenvalue out of the characteristic equation, det.\tI3?F / D 0, yields\nthe following form for the remaining eigenvalues:\n\n\t2 ? \tmax\tC ??21 ??22 kbtrue1 ? btrue2 k2 D 0 (5.143)\n\nTherefore, the intermediate and minimum eigenvalues are given by\n\n\n\n214 5 Static Attitude Determination Methods\n\n\tint D \tmax.1C ?/\n2\n\n(5.144a)\n\n\tmin D \tmax.1 ? ?/\n2\n\n(5.144b)\n\nwhere\n\n? D\n?\n1 ? 4kb\n\ntrue\n1 ? btrue2 k2\n?21 ?\n\n2\n2 \t\n\n2\nmax\n\n?1=2\n(5.145)\n\nNote that \tmax D \tmin C \tint. Also note that kbtrue1 ? btrue2 k D 0 if btrue1 is collinear\nwith btrue2 . Equation (5.144) shows \tmin D 0 and thus the inverse of the Fisher\ninformation matrix does not exist, as expected for this case. Also, \tint D \tmax for\nthis case.\n\nThe eigenvectors of F are computed by solving \tv D F v for each eigenvalue.\nThe eigenvector associated with the maximum eigenvalue can be shown to be\ngiven by\n\nvmax D ? b\ntrue\n1 ? btrue2\n\nkbtrue1 ? btrue2 k\n(5.146)\n\nThe sign of this vector is not of consequence since we are only interested in rotations\nabout this vector. This indicates that the most observable axis is perpendicular to\nthe plane formed by btrue1 and b\n\ntrue\n2 , which intuitively makes sense. The remaining\n\neigenvectors must surely lie in the btrue1 -b\ntrue\n2 plane. To determine the eigenvector\n\nassociated with the minimum eigenvalue, we will perform a rotation about the\nvmax axis and determine the angle from b1. Using the Euler axis and angle\nparameterization in Eq. (2.108) gives\n\nvmin D ?\n?\n.cos#/I3 C .1 ? cos#/vmaxvTmax ? sin#\u0152vmax??\n\n?\nbtrue1 (5.147)\n\nwhere # is the angle used to rotate btrue1 to vmin. Using the fact that vmax is\nperpendicular to btrue1 gives v\n\nT\nmaxb\n\ntrue\n1 D 0. Therefore, Eq. (5.147) reduces down to\n\nvmin D ?f.cos#/I3 ? sin#\u0152vmax??g btrue1 (5.148)\nSubstituting Eq. (5.148) into \tminvmin D F vmin and using the property of the cross\nproduct matrix leads to the following equation for # :\n\ntan# D aC b\nc\n\n(5.149)\n\nwhere\n\na ? \tmin??21 (5.150a)\nb ? ??21 ??22 .btrue1 /T \u0152btrue2 ??2btrue1 (5.150b)\n\nc ? ??\n?2\n1 ?\n\n?2\n2 .b\n\ntrue\n1 /\n\nT \u0152btrue2 ??2\u0152btrue1 ??2btrue2\nkbtrue1 ? btrue2 k\n\n(5.150c)\n\n\n\n5.6 MLE for Attitude Determination 215\n\nb1\ntrue\n\nb2\ntrue\n\nvmax\n\nvmin\n\nFig. 5.1 Observable axes\nwith two vector observations\n\nEquation (5.149) can now be solved for # , which can be used to determine vmin from\nEqs. (5.146) and (5.148). The intermediate axis is simply given by the cross product\nof vmax and vmin:\n\nvint D ?vmax ? vmin (5.151)\nA plot of the minimum and intermediate axes is shown in Fig. 5.1 for the case when\nthe angle between btrue1 and b\n\ntrue\n2 is less than 90\n\n?. Intuitively, this analysis makes\nsense since we expect that the least determined axis, vmin, is somewhere between\nbtrue1 and b\n\ntrue\n2 if these vector observations are less than 90\n\n? apart.\nThe previous analysis greatly simplifies if the reference vectors are unit vectors\n\nand the observation variances are equal, so that ?21 D ?22 ? ?2. These assumptions\nare valid for a single field-of-view star camera. The eigenvalues are now given by\n\n\tmax D 2??2 (5.152a)\n\tint D ??2.1C j.btrue1 /T b2j/ (5.152b)\n\tmin D ??2.1 ? j.btrue1 /T b2j/ (5.152c)\n\nThe eigenvectors are now given by\n\nvmax D ? b\ntrue\n1 ? btrue2\n\nkbtrue1 ? btrue2 k\n(5.153a)\n\nvint D ? b\ntrue\n1 ? sign\u0152.btrue1 /T btrue2 ?btrue2\n\nkbtrue1 ? sign\u0152.btrue1 /T btrue2 ?btrue2 k\n(5.153b)\n\nvmin D ? b\ntrue\n1 C sign\u0152.btrue1 /T btrue2 ?btrue2\n\nkbtrue1 C sign\u0152.btrue1 /T btrue2 ?btrue2 k\n(5.153c)\n\nwhere sign\u0152.btrue1 /\nT btrue2 ? is used to ensure that the proper direction of the\n\neigenvectors is determined when the angle between btrue1 and b\ntrue\n2 is greater than 90\n\n?.\n\n\n\n216 5 Static Attitude Determination Methods\n\nIf this angle is less than 90? then vmin is the bisector of btrue1 and btrue2 . Intuitively\nthis makes sense since we expect rotations perpendicular to the bisector of the two\nvector observations to be more observable than rotations about the bisector (again\nassuming that the vector observations are within 90? of each other).\n\nThe analysis presented in this section is extremely useful for the visualization\nof the observability of the determined attitude. Closed-form solutions for special\ncases have been presented here. Still, in general, the eigenvalues and eigenvectors of\nthe information matrix can be used to analyze the observability for cases involving\nmultiple observations.\n\n5.7 Induced Attitude Errors from Orbit Errors\n\nMissions sometime require accurate attitude knowledge for Earth-pointing space-\ncraft. As discussed in Chap. 1 this is true for the GOES series of spacecraft.\nA natural attitude sensor selection for Earth-pointing spacecraft is a horizon sensor\nbecause it provides an attitude estimate directly with respect to an Earth-centric\nframe. However, as is the case for GOES, a horizon sensor may not meet the\ndesired attitude knowledge requirement. For GOES a star tracker was selected\nto provide higher attitude accuracy. But a star tracker provides an estimate with\nrespect to an inertial frame. The conversion to an Earth-centric frame, such as\nthe LVLH described in Sect. 2.6.4, requires an attitude rotation from an inertial\nframe to an Earth-centric frame. For the LVLH frame the required attitude matrix to\naccomplish this rotation is given by the transpose of the matrix in Eq. (2.79). Since\nthis matrix depends on position and velocity, then these quantities will contribute\nto the overall attitude errors. This section derives the attitude error-covariance with\nadditive position and velocity orbit errors in Eq. (2.79). Since the orbit determination\nerrors are uncorrelated with the attitude sensor errors, then the overall attitude error\nis the sum of the sensor and orbit errors. In this way the additional errors induced by\nthe coupling of position and velocity to attitude can be accounted for in the overall\nattitude knowledge budget.\n\nFirst, the true variables must be defined from Eq. (2.78):\n\notrue3I D ?rtrueI =krtrueI k ? ?gtrue3 rtrueI (5.154a)\notrue2I D ?.rtrueI ? vtrueI /=krtrueI ? vtrueI k ? ?gtrue2 .rtrueI ? vtrueI / (5.154b)\notrue1I D gtrue2 gtrue3 \u0152 krtrueI k2vtrueI ? .rtrueI ? vtrueI /rtrueI ? (5.154c)\n\nAdding an error to position in o3I simply gives\n\no3I D ? r\ntrue\nI C?rI\nkrtrueI C?rIk\n\n(5.155)\n\n\n\n5.7 Induced Attitude Errors from Orbit Errors 217\n\nwhere rtrueI is the true position and ?rI is its associated error, which is assumed\nto be a zero-mean Gaussian noise process. In this section it is assumed that the\nsignal-to-noise ratio is large enough so that second-order and higher error terms are\nnegligible. The denominator in Eq. (5.155) is thus approximated by\n\nkrtrueI C?rIk D .krtrueI k2 C 2 rtrueI ??rI C k?rIk2/1=2\n\n? .krtrueI k2 C 2 rtrueI ??rI /1=2\n(5.156)\n\nNext the following first-order binomial expansion is used:\n\n.x C?x/n ? xn C nxn?1?x; ?x << x (5.157)\nUsing Eq. (5.157) with x ? krtrueI k2, ?x ? 2 rtrueI ??rI and n D ?1=2 leads to\n\no3I ? ?.rtrueI C?rI /\n?krtrueI k?1 ? krtrueI k?3rtrueI ??rI\n\n\t\n(5.158)\n\nIgnoring second-order terms gives\n\no3I ? otrue3I C\n1\n\nkrtrueI k3\n?\n.rtrueI /.r\n\ntrue\nI /\n\nT ? krtrueI k2I3\n?\n?rI\n\nD otrue3I C\n1\n\nkrtrueI k3\n\u0152rtrueI ??2?rI\n\n(5.159)\n\nTherefore the error in o3I , denoted by ?o3I , is given by\n\n?o3I D 1krtrueI k3\n\u0152rtrueI ??2?rI (5.160)\n\nIn a similar fashion the error in o2I , denoted by ?o2I , can by shown to be given by\n(which is left as an exercise to the reader)\n\n?o2I D 1krtrueI ? vtrueI k3\n\u0152.rtrueI ? vtrueI /??2\u0152.rtrueI ??vI / ? .vtrueI ??rI /? (5.161)\n\nwhere vtrueI is the true velocity and ?vI is its associated error, which is assumed to\nbe a zero-mean Gaussian noise process. The error in o1I is more complicated than\nthe other ones, but fortunately this term is not required in the analysis.\n\nThe attitude matrix with errors can now be written as\n\nAIO D AtrueIO C?AIO (5.162)\nwhere\n\nAIO ? \u0152o1I o2I o3I ? (5.163a)\nAtrueIO ? \u0152otrue1I otrue2I otrue3I ? (5.163b)\n\n?AIO ? \u0152?o1I ?o2I ?o3I ? (5.163c)\n\n\n\n218 5 Static Attitude Determination Methods\n\nWe wish to use a multiplicative attitude error in the orbit frame, which is given by\nEq. (2.180) as\n\n?AIO D .AtrueIO /T AIO ? I3 ? \u0152?#?? (5.164)\nSubstituting Eq. (5.162) into Eq. (5.164) and cancelling the I3 terms gives\n\n? \u0152?#?? D .AtrueIO /T?AIO D\n2\n4\n\n0 otrue1I ??o2I otrue1I ??o3I\notrue2I ??o1I 0 otrue2I ??o3I\notrue3I ??o1I otrue3I ??o2I 0\n\n3\n5 (5.165)\n\nThis is very similar to the derivation of Eq. (3.174), and as in that case we choose\nthe easier dot products to evaluate. After some algebra that is left to the reader as an\nexercise, this leads to\n\n?# D\n2\n4\n\notrue2I ??o3I\n?otrue1I ??o3I\notrue1I ??o2I\n\n3\n5 D O\n\n?\n?rI\n?vI\n\n?\n(5.166)\n\nwhere\n\nO ?\n\n2\n664\n\ngtrue3 .o\ntrue\n2I /\n\nT 0T3\n?gtrue3 .otrue1I /T 0T3\n\n?gtrue2 gtrue3 .rtrueI ? vtrueI /.otrue2I /T gtrue2 gtrue3 krtrueI k2.otrue2I /T\n\n3\n775 (5.167)\n\nThe position and velocity error-covariance matrix is defined by\n\nPorbit D E\n\n?\n?rI\n?vI\n\n? ?\n?rTI ?v\n\nT\nI\n\n??\n(5.168)\n\nwhich is given by the orbit determination system. Therefore, the induced attitude\nerror-covariance is given by\n\nPorbit D E\n?\n.?#/ .?#/T\n\n? D O Porbit OT (5.169)\nNote thatPorbit is a function of the true position and velocity variables in O , but these\ncan be replaced by their respective estimates from the orbit determination system in\npractice.\n\n5.8 TRMM Attitude Determination\n\nThe Tropical Rainfall Measuring Mission (TRMM) spacecraft was launched on\nNovember 27, 1997 from the Tanegashima Space Center in Tanegashima, Japan.\nThe main objectives of this mission include: (1) to obtain multi-year measurements\n\n\n\n5.8 TRMM Attitude Determination 219\n\nFig. 5.2 TRMM spacecraft\n\nof tropical and subtropical rainfall, (2) to understand how interactions between the\nsea, air, and land masses produce changes in global rainfall and climate, and (3)\nto help improve the modeling of tropical rainfall processes and their influence on\nglobal circulation.\n\nTRMM\u2019s nominal orbit altitude was 350 km, until raised to 402 km to prolong\nmission life by reducing the fuel expenditure used to compensate for atmospheric\ndrag [1]. The spacecraft is three-axis stabilized with an orbit inclination of 35?.\nA diagram of the TRMM spacecraft is shown in Fig. 5.2. The Ob1 axis is parallel to\nthe orbital velocity direction, the Ob2 axis is parallel to the negative of the orbital\nmomentum vector, and the Ob3 axis points in the nadir direction. The nominal\nmission mode requires a rotation once per orbit about the spacecraft\u2019s Ob2 axis while\nholding the remaining axis rotations near zero. Thus, the LVLH frame described in\nSect. 2.6.4 can be used to compute the desired attitude matrix from the spacecraft\u2019s\nposition/velocity vector in order to maintain an Earth-pointing configuration.\n\nThe attitude determination hardware consists of an Earth Sensor Assembly\n(ESA), Digital Sun Sensors (DSSs), Coarse Sun Sensors (CSSs), a Three-Axis\nMagnetometer (TAM), and rate-integrating gyroscopes (RIGs). The allotted attitude\nknowledge accuracy of 0.18? per axis was achieved by using the ESA for pitch\nand roll and the RIGs, updated twice per orbit by DSS measurements, for yaw.\nAs was discussed in Chap. 1, potential problems with the ESA resulted in an effort to\n\n\n\n220 5 Static Attitude Determination Methods\n\ndevelop alternative attitude determination methods using only the DSSs, TAM, and\nRIGs [1, 7]. This effort led to several simple algorithms, one of which is used as an\nonboard backup to the full-up Kalman filter employed for the TRMM contingency\nmode. Simulations of this mode, which provides accuracies comparable to those\ngiven by the Kalman filter and by the ESA-based system, are presented here.\n\nThe true magnetic field reference is modeled using a 10th-order International\nGeomagnetic Reference Field (IGRF) model, which is described in Sect. 11.1 of\nChap. 11. In order to simulate magnetic field modeling error, a 6th order IGRF is\nused to develop measurements. TAM sensor noise is modeled by a Gaussian white-\nnoise process with a mean of zero and a standard deviation of 50 nT. The two DSSs\neach have a field of view of about 50?? 50?. The body to sensor transformations for\neach sensor is given by\n\nA\nDSS1\nbody D\n\n2\n4\n?0:5736 0 ?0:8192\n0:4096 0:8666 ?0:2868\n0:7094 ?0:5 ?0:4967\n\n3\n5 (5.170a)\n\nA\nDSS2\nbody D\n\n2\n4\n?0:5736 0 0:8192\n?0:4096 0:8666 ?0:2868\n?0:7094 ?0:5 ?0:4967\n\n3\n5 (5.170b)\n\nThe two DSSs combine to provide Sun measurements for about 2/3 of a complete\norbit. The DSS sensor noise is also modeled by a Gaussian white-noise process\nwith a mean of zero and a standard deviation of 0.05?. The gyro measurements are\nsimulated using Eqs. (4.31) and (4.32) of Sect. 4.7.1, with ?u D\n\np\n10?10?10 rad/s3=2\n\nand ?v D\np\n10 ? 10?7 rad/s1=2. The initial bias for each axis is given by 0.1 deg/h.\n\nAll sensors are sampled at 10-s intervals. Note that in general gyros are typically\nsampled at higher frequencies than other attitude sensors in order to provide rate\ninformation for other control aspects, such as spacecraft jitter.\n\nAttitude results using the uncorrupted TAM, i.e. using the 10th-order model to\ngenerate the truth and the measurements, with the two DSSs are shown in Fig. 5.3a.\nThe actual errors are plotted with their 3? bounds, three times the square roots of\nthe diagonal elements of the covariance matrix given by Eq. (5.120). Gaps are given\nwhen both of the DSSs are unavailable. The large values in the 3? bounds are due\nto the vectors becoming more co-aligned, i.e. the angle between the magnetic field\nvector and Sun vector is small, thereby reducing usable information in the attitude\ndetermination solution. The computed 3? bounds provide an accurate measure to\nquantify the actual errors. Results using the corrupted TAM, i.e. using the 10th-order\nmodel to generate the truth and the 6th-order model to generate the measurements,\nwith the two DSSs are shown in Fig. 5.3b. Clearly the errors are now larger but they\nare within the typical accuracy provided by a TAM/DSS sensor suite for attitude\ndetermination on actual spacecraft.\n\n\n\n5.8 TRMM Attitude Determination 221\n\n0 1 2 3 4 5 6 7 8\n?1\n\n0\n\n1\n\n0 1 2 3 4 5 6 7 8\n?0.5\n\n0\n\n0.5\n\n0 1 2 3 4 5 6 7 8\n?1\n\n0\n\n1\n\nTime (Hr)\n\nR\nol\n\nl \n(D\n\neg\n)\n\nP\nit\nch\n\n (\nD\n\neg\n)\n\nY\naw\n\n (\nD\n\neg\n)\n\n0 1 2 3 4 5 6 7 8\n?2\n\n0\n\n2\n\n0 1 2 3 4 5 6 7 8\n?1\n\n0\n\n1\n\n0 1 2 3 4 5 6 7 8\n?2\n\n0\n\n2\n\nTime (Hr)\n\nR\nol\n\nl \n(D\n\neg\n)\n\nP\nit\nch\n\n (\nD\n\neg\n)\n\nY\naw\n\n (\nD\n\neg\n)\n\n0 1 2 3 4 5 6 7 8\n?0.05\n\n0\n\n0.05\n\n0.1\n\n0.15\n\nTime (Hr)\n\n?\n\n0 1 2 3 4 5 6 7 8\n?0.1\n\n0\n\n0.1\n\n0 1 2 3 4 5 6 7 8\n?0.1\n\n0\n\n0.1\n\n0 1 2 3 4 5 6 7 8\n?0.1\n\n0\n\n0.1\n\nTime (Hr)\n\nR\nol\n\nl \n(D\n\neg\n)\n\nP\nit\nch\n\n (\nD\n\neg\n)\n\nY\naw\n\n (\nD\n\neg\n)\n\na b\n\nc d\n\nFig. 5.3 TRMM attitude determination results. (a) Uncorrupted TAM results. (b) Corrupted TAM\nresults. (c) Filter gain. (d) Filtered results\n\nThe accuracy can be improved by employing a simple first-order filter approach\nusing the estimated quaternion together with gyro measurements [7]. Furthermore,\nthe gyro can be used to propagate an attitude solution when no DSS measurements\nare available. The first-order filter is given by\n\nOqCk D .1 ? ?/ Oq?k C ? Qqk (5.171a)\n\nOq?kC1 D exp\n?\n1\n\n2\n\u0152 Q!k???t\n\n?\nOqCk (5.171b)\n\nD\n?\n\ncos\n\n?\n1\n\n2\nk Q!kk?t\n\n?\nI4 C 1k Q!kk sin\n\n?\n1\n\n2\nk Q!kk?t\n\n?\n?. Q!k/\n\n?\nOqCk (5.171c)\n\nwhere Qqk is the quaternion determined from the TAM/DSS attitude determination\nsystem, Oq?k is the propagated estimate, OqCk is the updated estimated, Q!k is the vector\nof gyro measurements, ? is a scalar gain between 0 and 1, and ?t is the sampling\ninterval in the gyro. Using an initial estimate, which is typically Qqk , Eq. (5.171c)\n\n\n\n222 5 Static Attitude Determination Methods\n\nis used to propagate the quaternion until the next Qqk is available, at which point\nEq. (5.171a) is used to update the propagated estimate. The gain ? is typically\nchosen to be constant [8], but a more judicious approach can be developed. Here,\nthe following equation is used:\n\n? D kr1 ? r2k2?0 (5.172)\n\nwhere r1 and r2 are the normalized Sun and magnetic field reference vectors, and ?0\nis a constant. The filter gain in Eq. (5.172) is automatically adjusted to accommodate\nperiods of vector co-alignment, i.e. as the vectors become co-aligned the gain\napproaches 0. Also, ?0 is set to zero when no solution from the TAM/DSS attitude\ndetermination system is possible.\n\nThe first-order filter is essentially an \u201cadditive\u201d approach because the updated\nquaternion is a weighted sum of the propagated quaternion and TAM/DSS deter-\nmined quaternion. As will be discussed in Chap. 6, an additive approach for the\nquaternion update does not result in an estimate that maintains quaternion normal-\nization. To investigate how the additive update affects quaternion normalization,\nEq. (5.171a) may be rewritten as\n\nOqCk D Oq?k ?\n?\nIq C ?\n\n?\n. Oq?k /?1 ? Qqk ? Iq\n\n??\n(5.173)\n\nwhere Iq is the identity quaternion. If the propagated quaternion is close to the\nTAM/DSS determined quaternion, then Eq. (5.173) can be approximated accu-\nrately by\n\nOqCk ? Oq?k ?\n?\n1\n2\n? ?#\n\n1\n\n?\n(5.174)\n\nwhere ?# is the angle vector used to form the rotation matrix between Oq?k andQqk . Therefore, since ? is between 0 and 1, then normalization is maintained to\nwithin first order. For numerical precision, the quaternion estimates are explicitly\nnormalized after the update process.\n\nThe simple filter is now applied to the TRMM example. Trial and error found\nthat an initial gain of ?0 D 0:1 provides good filtered estimates. A higher gain\nwill produce estimates that are noisier and lower gain will result in estimates that\nsuffer from greater gyro bias propagation errors. A plot of the filter gain is shown\nin Fig. 5.3c. Note that at the 1-h mark the gain becomes small, which is due to the\nfact that the Sun and magnetic field vectors are nearly co-aligned at that time. This\nforces the estimate to follow the gyro propagation more closely, which results in\nsmaller estimate errors, as shown in Fig. 5.3d. Also, note that when no TAM/DSS\nquaternion estimate is given, the errors are dictated by the gyro bias, which is given\nas 0.1 deg/h. For the TRMM mission the attitude drift during these periods is within\nthe mission specifications.\n\n\n\n5.9 GPS Attitude Determination 223\n\n5.9 GPS Attitude Determination\n\nGPS attitude determination uses phase differences of GPS signals received by\nantennas located at several locations on the spacecraft. Pairs of GPS antennas can be\nused to form a set of n ? 2 baselines bi in the spacecraft body frame, as illustrated\nin Fig. 4.4. The m ? 4 unit vector sightlines sj from the user spacecraft to the GPS\nsatellites can be computed from the GPS position solution, as discussed in Sect. 4.6.\nThe different path lengths from each GPS satellite to the antennas at the two ends\nof each baseline create mn phase differences of the received signals\n\n? trueij D 2\n.n?ij C \t?1bTi Asj / (5.175)\nwhere A is the attitude matrix, \t is the wavelength of the GPS signal, and the\nintegers n?ij are the number of full wavelength differences of the paths from GPS\nsatellite j to the two antennas at the ends of baseline i . The latter are referred to\nas the integer phase ambiguities, and several algorithms have been proposed to\ncompute them [6, 10, 28]. We will not discuss these, but assume that they have\nsuccessfully solved for the integer ambiguities. We then use the measured phase\ndifferences to compute the normalized measurements\n\nzij ? \t.?ij =2\n ? n?ij / (5.176)\nThe optimal attitude solution is the attitude matrix minimizing the loss function\n\nLGPS.A/ ? 1\n2\n\nnX\niD1\n\nmX\njD1\n\naij .zij ? bTi Asj /2 (5.177)\n\nfor some weights aij . This is similar to Wahba\u2019s loss function, but is not as easy to\nminimize. Solutions can be found with difficulty, however [6].\n\nIf we knew the representations of the baseline vectors in the reference frame,\nwhich we denote by ri as in Sect. 5.2, we could use one of the algorithms of that\nsection to compute the attitude matrix. In view of Eq. (5.1), we compute these as the\nri minimizing the loss function [9]\n\nLi.ri / ? 1\n2\n\nmX\njD1\n\naij .zij ? rTi sj /2 (5.178)\n\nfor i D 1; 2; : : : ; n. The minimization gives\n\nri D S?1i\nmX\njD1\n\naij zij sj (5.179)\n\nwhere\n\nSi ?\nmX\njD1\n\naij sj sTj (5.180)\n\n\n\n224 5 Static Attitude Determination Methods\n\nThese solutions only exist if the matrices Si all have rank three, which requires that\nthe sightlines sj not be coplanar, as will generally be the case. The computational\nburden is reduced if the weights aij are independent of the baseline label i , since\nthen all the Si will be equal, and only one matrix must to be computed and inverted\nfor each set of sightlines.\n\nThe computational burden would also be reduced if we reversed the roles of\nthe baselines and sightlines, since the matrix corresponding to Si would depend\non the baselines in the body frame. Since these are constant, the matrix inverse\nin the analog of Eq. (5.179) would only need to be computed once, rather than at\neach measurement time. This would require at least three non-coplanar baselines,\nhowever, requiring more GPS antennas with unobstructed sightlines.\n\nThe final step of this method is to solve Wahba\u2019s problem for the vector sets\nfrig and fbig; the fact that they are not unit vectors is not important. There\nare several options for choosing the weights ai in Wahba\u2019s loss function, but no\nchoice produces an optimal minimum of the loss function of Eq. (5.177), in general.\nThe estimates are nearly optimal unless the sightlines are nearly coplanar, though;\nand simulations show that the computational advantages of this method do not entail\na significant loss of accuracy [9].\n\nProblems\n\n5.1. A measure for the error between the estimated attitude,A, and the true attitude,\nAtrue, is given by\n\nA .Atrue/T D .cos#err/ I3 ? sin#err\u0152e??C .1 ? cos#err/e eT\n\nwhere #err is the error angle of rotation. Show that #err is given by the following\nequation:\n\n#err D 2 sin?1\n\nkA .Atrue/T ? I3kF =\n\np\n8\n?\nD 2 sin?1\n\n\nkA ? AtruekF =\n\np\n8\n?\n\nwhere the Frobenius norm is given by Eq. (5.12).\n\n5.2. Consider the following four reference vectors:\n\nr1 D\n2\n4\n0\n\n0\n\n1\n\n3\n5 ; r2 D 1p\n\n0:12 C 1\n\n2\n4\n0\n\n0:1\n\n1\n\n3\n5\n\nr3 D 1p\n0:12 C 1\n\n2\n4\n\n0\n\n?0:1\n1\n\n3\n5 ; r4 D 1p\n\n0:12 C 1\n\n2\n4\n0:1\n\n0\n\n1\n\n3\n5\n\n\n\nProblems 225\n\nAssume that the true attitude matrix is given by the identity matrix. To generate body\nmeasurements and measurement errors use the QMM in Eq. (5.107b) with the true\nattitude, the given ri \u2019s and ?1 D ?2 D ?3 D ?4 D 0:001 ? \n=180 rad. Run 1,000\nMonte Carlo runs using Davenport\u2019s method to compute the quaternion. Plot the\nsmall angle errors along with their respected 3? bounds computed from the error-\ncovariance given by the inverse of the Fisher information matrix in Eq. (5.139).\n\n5.3. In this exercise you will compare Davenport\u2019s method, QUEST, the SVD\nmethod and FOAM for a number of test cases. Let the true attitude be given by\n\nAtrue D\n2\n4\n0:352 0:864 0:360\n\n?0:864 0:152 0:460\n0:360 ?0:480 0:800\n\n3\n5\n\nConsider the following four cases:\n\na) r1 D \u01521 0 0?T , r2 D \u01520 1 0?T , and ?1 D ?2 D 0:01 rad.\nb) r1 D \u01521 0 0?T , r2 D \u01521 0:01 0?T =k\u01521 0:01 0?T k, and ?1 D ?2 D 0:01 rad.\nc) r1 D \u01521 0 0?T , r2 D \u01521 0:01 0?T =k\u01521 0:01 0?T k, and ?1 D ?2 D 1? 10?6 rad.\nd) r1 D \u01521 0 0?T , r2 D \u01520:96 0:28 0?T =k\u01520:96 0:28 0?T k; ?1 D 0:001 rad, and\n?2 D 1 ? 10?6 rad.\nTo generate body measurements with errors use the QMM in Eq. (5.107b) with\n\nthe true attitude, the given ri \u2019s and aforementioned sigma values for each case. Run\n1,000 Monte Carlo runs using Davenport\u2019s method, QUEST, the SVD method and\nFOAM to compute the attitude, A, for each case. Then compute the following error\nmetric:\n\n#err D 2 sin?1\n\nkA ? AtruekF =\n\np\n8\n?\n\nCompute the numerical mean and standard deviation of #err for each algorithm and\ncompare their relative accuracies.\n\n5.4. Suppose that you wish to determine the average quaternion, denoted by qave,\nfrom a set of weighted quaternions given by qi , i D 1; 2 : : : ; N , with weights wi .\nSimply summing the weighted set of quaternions and dividing by N has two issues.\nFirst, it does not produce a unit vector in general. Second, changing the sign of any\nqi should not change the average, but it is clear that the weighted sum approach does\nnot have this property. To find an averaged quaternion that overcomes these issues\nthe following loss function is chosen to be minimized [23]:\n\nJ.qave/ D\nNX\niD1\n\nwikA.qave/ ? A.qi /k2F ; s.t. qTaveqave D 1\n\nwhere the Frobenius norm is described in Problem 5.1. Show that the solution for\nqave can be found by first forming the following matrix:\n\nM ?\nNX\niD1\n\nwiqiqTi\n\n\n\n226 5 Static Attitude Determination Methods\n\nand then taking the eigenvector associated with the maximum eigenvalue of M to\nobtain qave. For this problem you will use a different solution approach than the one\nshown in [23] though. Start with the following relation given from Problem 5.1:\nkA.qave/ ? A.qi /k2F D 8 sin2.#i=2/, where #i is the angle of rotation of the matrix\n?A.?q/ ? A.qave/AT .qi /.\n\nUsing the eigenvector associated with the maximum eigenvalue of M is equiva-\nlent to Davenport\u2019s solution of Wahba\u2019s problem. But the QUEST solution cannot\nbe used directly using the matrix M . How can this matrix be modified so that the\nQUEST solution can be used? Note that the matrix K in the QUEST algorithm is\ntraceless. Show that your modification does not change the solution for qave.\n\n5.5. Use Eqs. (5.113) and (5.114) to demonstrate the star tracker accuracies for\nmultiple stars claimed in Sect. 4.2.3. Assume there are five stars with the same error\nstandard deviation ?i D ? at\n\nb1 D\n2\n4\n0\n\n0\n\n1\n\n3\n5 ; b2 D\n\n2\n4\ns\n\n0\n\nc\n\n3\n5 ; b3 D\n\n2\n4\n?s\n0\n\nc\n\n3\n5 ; b4 D\n\n2\n4\n0\n\ns\n\nc\n\n3\n5 ; b5 D\n\n2\n4\n0\n\n?s\nc\n\n3\n5\n\nwhere s ? sin ? , c ? cos ? , and where we have omitted the superscript true.\nCompute the information matrix and invert it to find the covariance. The square\nroots of its diagonal elements are the standard deviations of the attitude errors about\nthe three axes. You should find that\n\n?x D ?y D ?p\n5 ? 2s2 ?\n\n?p\nNstars\n\n?z D ?\n2s\n? ?p\n\nNstars\np\n4=5 ?\n\nThe two approximations are both valid for small ? , and\np\n4=5 ? is the RMS angular\n\ndistance of the stars from the boresight, given by b1.\n\n5.6. Suppose that you are given unit Sun and magnetic field reference vectors,\ndenoted by rsun and rmag, respectively, and a body TAM unit-vector observation,\ndenoted by bmag. The Sun sensor is a \u201cslit\u201d type design that tells only when the Sun\nis in a particular slit plane, but not orientation in that plane. So the body Sun unit-\nvector, denoted by bsun, is unknown but another unit vector, denoted by vslit, exists\nsuch that bsun ? vslit D 0. Assuming that rsun ? rmag D bsun ? bmag, find bsun from the\ngiven unit vectors. Note this problem is equivalent to finding the intersection of a\ncone and a plane with the vertex of the cone constrained to lie in the plane.\n\n5.7. Consider the following true and measured vectors for a star tracker model,\ngiven by Eq. (4.2):\n\nbtrue D 1p\n1C k? truek2\n\n?\n? true\n\n1\n\n?\n; b D 1p\n\n1C k?k2\n?\n?\n\n1\n\n?\n\n\n\nProblems 227\n\nwhere ? true ? \u0152tan2 ?true tan2 ?true?T and ? ? \u0152tan2 ? tan2 ??T . The measured and\ntrue vectors are related by ? D ? trueC?? , where?? is a zero-mean Gaussian noise\nprocess with covariance R? . Using the analysis in Sect. 5.7 show that the following\nexpression is valid to within first-order:\n\nb D btrue ? 1p\n1C k? truek2 \u0152b\n\ntrue??2I3?2 ??\n\nwhere\n\nI3?2 D\n2\n4\n1 0\n\n0 1\n\n0 0\n\n3\n5\n\nThe covariance of b is then given by\n\nRb D 1\n1C k? truek2 \u0152b\n\ntrue??2I3?2 R? I T3?2\u0152btrue??2\n\nDetermine R? in terms of ? true D \u0152? true1 ? true2 ?T so that Rb is exactly equal to the\nQMM given by Eq. (5.107b).\n\n5.8. In this exercise noise will be added to both the body and reference vectors.\nThis can occur when the errors in an assumed star catalog are significant compared\nto the sensor errors. Assume that the reference vectors are modeled by\n\nrmodeli D\nztruei C?zi\nkztruei C?zik\n\nwhere ztruei is some true position vector and ?zi is a zero-mean Gaussian noise\nprocess with covariance Rzi . Using the analysis in Sect. 5.7 show that the following\nexpression is valid to within first-order:\n\nrmodeli D rtruei C?ri\nwhere rtruei D ztruei =kztruei k and\n\n?ri D ? 1kztruei k\n\u0152rtruei ??2?zi\n\nThe \u201cmeasured\u201d vector with errors is related to the true body vector through\n\nri ? .Atrue/T btruei C .Atrue/T ?bi C?ri\n\n\n\n228 5 Static Attitude Determination Methods\n\nThis vector will be used in the nonlinear least squares solution. Here it is assumed\nthat ?bi and ?ri are uncorrelated. Using the QMM for ?bi show that the\ncovariance of .Atrue/T ?bi C?ri , denoted by Ri , can be given by\n\nRi D ??2bi \u0152rtruei ??2 C\n1\n\nkztruei k2\n\u0152rtruei ??2Rzi \u0152rtruei ??2\n\nNote that Ri is independent of the attitude matrix. Also, Ri is a singular matrix, but\nthe rank-one approach of [3] can be employed to overcome this issue. Define the\nfollowing matrix:\n\nNRi D Ri C 1\n2\n\ntr.Ri /.rtruei /.r\ntrue\ni /\n\nT\n\nThe loss function to be minimized is given by\n\nJ D 1\n2\n\nNX\ni?1\n.ri ? AT bi /T NR?1i .ri ? AT bi /\n\nDerive the attitude error-covariance.\nNote that to determine an optimal solution for the attitude a total least squares\n\n[8] solution must be employed since errors exist both in the body and reference\nvectors. However, the nonlinear least squares solution in Example 12.4 can provide\nnear optimal solutions. The true body vectors are given by\n\nbtrue1 D\n2\n4\n0\n\n0\n\n1\n\n3\n5 ; btrue2 D\n\n2\n4\n\n0\n\n0:1p\n1 ? 0:12\n\n3\n5\n\nNote that the angle between these vectors is 5.74?. The MRP vector will be\nestimated for the attitude, as shown in Example 12.4. The true MRP and associated\nattitude matrix are given by\n\nptrue D\n\n2\n664\n\n1\n\n1Cp2\n0\n\n0\n\n3\n775 ; A.ptrue/ D\n\n2\n4\n1 0 0\n\n0 0 1\n\n0 ?1 0\n\n3\n5\n\nAssume that kztrue1 k D 30 and kztrue2 k D 50. To generate body measurements use the\nQMM in Eq. (5.107b) with ?bi D 0:001 deg for i D 1; 2. The covariances for Rz1\nand Rz1 are equal, denoted by Rz, which is given by\n\nRz D\n2\n4\n7 ? 10?6 7 ? 10?7 1 ? 10?5\n7 ? 10?7 3 ? 10?5 ?5 ? 10?6\n1 ? 10?5 ?5 ? 10?6 2 ? 10?5\n\n3\n5\n\n\n\nProblems 229\n\nx\n\ny\n\nx\n\ny\n\nFig. 5.4 Ellipse with rotation\n\nUsing the approach outlined in Example 12.4 create synthetic measurements for\nboth the body and reference vectors. Next, determine the estimated MRP using\nthe estimate model Ori D AT . Op/bi . Perform 1,000 Monte Carlo runs and show\nthat the attitude errors are bounded from the 3? bounds computed from the derived\nattitude error-covariance.\n\n5.9. A problem that is closely related to the attitude determination problem involves\ndetermining ellipse parameters from measured data. Figure 5.4 depicts a general\nellipse rotated by an angle ? . The basic equation of an ellipse is given by\n\n.x0 ? x00/2\na2\n\nC .y\n0 ? y00/2\nb2\n\nD 1\n\nwhere .x00; y00/ denotes the origin of the ellipse and .a; b/ are positive values. The\ncoordinate transformation follows\n\nx0 D x cos ? C y sin ?\ny0 D ?x sin ? C y cos ?\n\nShow that the ellipse equation can be rewritten as\n\nAx2 C Bxy C Cy2 CDx CEy C F D 0\nMany possibilities exist for this equation. Use the form that produces the following\nexpression for F :\n\nF D 1\n2\n\n?\nb\n\na\nx002 C\n\na\n\nb\ny002 ? ab\n\n?\n\nWith your determined coefficients show that the following constraint is satisfied:\n4AC ? B2 D 1.\n\n\n\n230 5 Static Attitude Determination Methods\n\nGiven a set of coefficients A, B , C , D, E, and F , show that the formulas for ? ,\na, b, x00, and y00 are given by\n\ncot.2?/ D A ? C\nB\n\na D\nr\nQ0\nA0\n; b D\n\nr\nQ0\nC 0\n\nx00 D ?\nD0\n\n2A0\n; y00 D ?\n\nE 0\n\n2C 0\n\nwhere\n\nA0 D A cos2 ? C B sin ? cos ? C C sin2 ?\nB 0 D B.cos2 ? ? sin2 ?/C 2.C ? A/ sin ? cos ? D 0\n\nC 0 D A sin2 ? ? B sin ? cos ? C C cos2 ?\nD0 D D cos ? CE sin ?\nE 0 D ?D sin ? CE cos ?\n\nF 0 D F\n\nQ0 ? A0\n?\nD0\n\n2A0\n\n?2\nC C 0\n\n?\nE 0\n\n2C 0\n\n?2\n? F 0\n\n(hint: show that the new variables follow the rotated ellipse equation: A0x02 C\nB 0x0y0 C C 0y02 C D0x0 C E 0y0 C F 0 D 0). Also, prove that B 0 D 0. Given the\nfollowing quantities:\n\nA D 3:0000; B D ?6:9282; C D 7:0000\nD D ?5:5359; E D 17:5885; F D 4:0000\n\ncompute ? , x00, y00, a and b.\nSuppose that a set of measurements for x and y exist, and we form the following\n\nvector of unknown parameters:\n\nxtrue ? ?Atrue B true C true Dtrue E true F true?T\n\nOur goal is to determine an estimate of xtrue, denoted by x, from this measured data\nset. Show that the minimum norm-squared loss function can be written as\n\nJ.x/ D xTHTH x\nsubject to\n\nxT Z x D 1\n\n\n\nReferences 231\n\nwhere the i th row of H is given by\n\nHi D\n?\nx2i xi yi y\n\n2\ni xi yi 1\n\n?\n\nDetermine the matrix Z that satisfies the constraint 4AC ? B2 D 1. Find the form\nfor the optimal solution for x using an eigenvalue/eigenvector approach. Note, a\nmore robust approach involves using a reduced eigenvalue decomposition [16] or a\nsingular value decomposition approach [14].\n\nWrite a computer program for your derived solution and perform a simulation\nto test your algorithm. Note that for a given set of x0 values, y0 can be determined\nusing\n\ny0 D y00 ? b\nr\n1 ? .x\n\n0 ? x00/2\na2\n\nwhere the ? term gives values for the upper and lower half of the ellipse. Use the\ncomputed ? , x00, y00, a and b from before and pick at least 1,200 samples of x0 and\ny0 values that span the entire ellipse. Then convert these to x and y using the inverse\ntransformation\n\nx D x0 cos ? ? y0 sin ?\ny D x0 sin ? C y0 cos ?\n\nUsing your formulated eigenvalue/eigenvector solution compute the optimal solu-\ntion for x. Next add noise to x and y using a zero-mean Gaussian white-noise\nprocess with standard deviation given by 0:01 and recompute your solution using\nmeasured values instead of the true ones.\n\n5.10. Derive the expression given in Eq. (5.161). Also, derive the expression given\nin Eq. (5.167).\n\n5.11. The loss function in Eq. (5.177) can be derived from a maximum likelihood\napproach by assuming that each aij is given by ??1ij , which is the inverse of the\nvariance of the assumed zero-mean Gaussian noise on zij . Using this loss function\nderive the attitude Fisher information matrix.\n\nReferences\n\n1. Andrews, S.F., Bilanow, S.: Recent flight results of the TRMM Kalman filter. In: AIAA\nGuidance, Navigation and Control Conference. Monterey, CA (2002). AIAA 2002-5047\n\n2. Black, H.D.: A passive system for determining the attitude of a satellite. AIAA J. 2(7),\n1350\u20131351 (1964)\n\n3. Cheng, Y., Crassidis, J.L., Markley, F.L.: Attitude estimation for large field-of-view sensors.\nJ. Astronaut. Sci. 54(3/4), 433\u2013448 (2006)\n\n\n\n232 5 Static Attitude Determination Methods\n\n4. Cheng, Y., Shuster, M.D.: The speed of attitude estimation. In: Akella, M.R., Gearhart, J.W.,\nBishop, R.H., Treder, A.J. (eds.) Proceedings of the AAS/AIAA Space Flight Mechanics\nMeeting 2007, Advances in the Astronautical Sciences, vol. 127, pp. 101\u2013116. AAS/AIAA,\nUnivelt, San Diego (2007)\n\n5. Cheng, Y., Shuster, M.D.: Improvement to the implementation of the QUEST algorithm.\nJ. Guid. Contr. Dynam. 37(1), 301\u2013305 (2014)\n\n6. Cohen, C.E.: Attitude determination. In: Parkinson, B., Spilker, J. (eds.) Global Positioning\nSystem: Theory and Applications, Progress in Astronautics and Aeronautics, vol. 64, chap. 19.\nAmerican Institute of Aeronautics and Astronautics, Washington, DC (1996)\n\n7. Crassidis, J.L., Andrews, S.F., Markley, F.L., Ha, K.: Contingency designs for attitude deter-\nmination of TRMM. In: Proceedings of the Flight Mechanics/Estimation Theory Symposium,\npp. 419\u2013433. NASA-Goddard Space Flight Center, Greenbelt (1995)\n\n8. Crassidis, J.L., Junkins, J.L.: Optimal Estimation of Dynamic Systems, 2nd edn. CRC Press,\nBoca Raton (2012)\n\n9. Crassidis, J.L., Markley, F.L.: New algorithm for attitude determination using Global Position-\ning System signals. J. Guid. Contr. Dynam. 20(5), 891\u2013896 (1997)\n\n10. Crassidis, J.L., Markley, F.L., Lightsey, E.G.: Global Positioning System integer ambiguity\nresolution without attitude knowledge. J. Guid. Contr. Dynam. 22(2), 212\u2013218 (1999)\n\n11. Farrell, J.L.: Attitude determination by Kalman filtering. Contractor Report NASA-CR-598,\nNASA Goddard Space Flight Center, Washington, DC (1964)\n\n12. Farrell, J.L.: Attitude determination by Kalman filtering. Automatica 6, 419\u2013430 (1970)\n13. Farrell, J.L., Stuelpnagel, J.C.: A least-squares estimate of satellite attitude. SIAM Rev. 7(3),\n\n384\u2013386 (1966)\n14. Gander, W., Golub, G.H., Strebel, R.: Least-squares fitting of circles and ellipses. In:\n\neditorial board Bulletin Belgian Mathematical Society (ed.) Numerical Analysis (in honour\nof Jean Meinguet), pp. 63\u201384 (1996)\n\n15. Golub, G.H., Van Loan, C.F.: Matrix Computations, 3rd edn. The Johns Hopkins University\nPress, Baltimore (1996)\n\n16. Hal\u00edr?, R., Flusser, J.: Numerically stable direct least squares fitting of ellipses. In: 6th Inter-\nnational Conference in Central Europe on Computer Graphics and Visualization, WSCG \u201998,\npp. 125\u2013132. University of West Bohemia, Campus Bory, Plzen - Bory (1998)\n\n17. Horn, R.A., Johnson, C.R.: Matrix Analysis. Cambridge University Press, Cambridge (1985)\n18. Lerner, G.M.: Three-axis attitude determination. In: Wertz, J.R. (ed.) Spacecraft Attitude\n\nDetermination and Control, chap. 12. Kluwer Academic, Dordrecht (1978)\n19. Markley, F.L.: Attitude determination using vector observations and the singular value\n\ndecomposition. J. Astronaut. Sci. 36(3), 245\u2013258 (1988)\n20. Markley, F.L.: Attitude determination using vector observations: A fast optimal matrix\n\nalgorithm. J. Astronaut. Sci. 41(2), 261\u2013280 (1993)\n21. Markley, F.L.: Fast quaternion attitude estimation from two vector measurements. J. Guid.\n\nContr. Dynam. 25(2), 411\u2013414 (2002)\n22. Markley, F.L.: Optimal attitude matrix from two vector measurements. J. Guid. Contr. Dynam.\n\n31(3), 765\u2013768 (2008)\n23. Markley, F.L., Cheng, Y., Crassidis, J.L., Oshman, Y.: Averaging quaternions. J. Guid. Contr.\n\nDynam. 30(4), 1193\u20131196 (2007)\n24. Markley, F.L., Mortari, D.: Quaternion attitude estimation using vector observations. J. Astro-\n\nnaut. Sci. 48(2/3), 359\u2013380 (2000)\n25. Mortari, D.: ESOQ: A closed-form solution of the Wahba problem. J. Astronaut. Sci. 45(2),\n\n195\u2013204 (1997)\n26. Mortari, D.: Second estimator of the optimal quaternion. J. Guid. Contr. Dynam. 23(5),\n\n885\u2013888 (2000)\n27. Potter, J.E., Vander Velde, W.E.: Optimum mixing of gyroscope and star tracker data. J.\n\nSpacecraft 5(5), 536\u2013540 (1968)\n28. Psiaki, M.L., Mohiuddin, S.: Global Positioning System integer ambiguity resolution using\n\nfactorized least-squares techniques. J. Guid. Contr. Dynam. 30(2), 346\u2013356 (2007)\n\n\n\nReferences 233\n\n29. Shuster, M.D.: Maximum likelihood estimation of spacecraft attitude. J. Astronaut. Sci. 37(1),\n79\u201388 (1989)\n\n30. Shuster, M.D.: Deterministic three-axis attitude determination. J. Astronaut. Sci. 52(3),\n405\u2013419 (2004)\n\n31. Shuster, M.D.: The quest for better attitudes. J. Astronaut. Sci. 54(3/4), 657\u2013683 (2006)\n32. Shuster, M.D.: The TRIAD algorithm as maximum likelihood estimation. J. Astronaut. Sci.\n\n54(1), 113\u2013123 (2006)\n33. Shuster, M.D.: The TASTE test. J. Astronaut. Sci. 57(1/2), 61\u201371 (2009)\n34. Shuster, M.D., Natanson, G.A.: Quaternion computation from a geometric point of view.\n\nJ. Astronaut. Sci. 41(4), 545\u2013556 (1993)\n35. Shuster, M.D., Oh, S.D.: Attitude determination from vector observations. J. Guid. Contr. 4(1),\n\n70\u201377 (1981)\n36. Wahba, G.: A least-squares estimate of satellite attitude. SIAM Rev. 7(3), 409 (1965)\n\n\n\nChapter 6\nFiltering for Attitude Estimation and\nCalibration\n\nAttitude estimation refers to the process of estimating the current attitude state\nof a system from a set of measured observations. The state estimation problem\ninvolves finding the best estimate of the true system state using a dynamic model\nand measurements that are both corrupted with random noise of known statistics.\nThe variables to be estimated are usually collected into a state vector, which\ntypically includes other variables in addition to the attitude. For example, star tracker\nmeasurements can be combined with a kinematics model, which is propagated using\ngyroscopic measurements. However, all gyros have inherent drift, or bias, which\ncauses inaccuracies in the propagated model. A complementary filter is used to\nsimultaneously estimate the attitude and gyro drift from the measurements. Filtering\ncan generally provide a more accurate attitude estimate than static methods because\nit incorporates memory of past observations.\n\nThis chapter presents the basics of filtering for attitude estimation. It is assumed\nthat the reader is familiar with the basic ideas of estimation/filtering theory as\nreviewed in Chap. 12. Reference [21] includes a survey of early attitude estimation\napproaches, and a survey of more modern attitude estimation approaches can be\nfound in [12]. We begin with general discussions of attitude representations for\nKalman filtering. This is followed by an overview of the equations for an extended\nKalman filter (EKF) using the quaternion to represent the \u201cglobal\u201d attitude and a\nthree-component representation of attitude errors. Alternative ways to use gyro data\nin attitude filters are then compared, followed by several applications. An EKF is\ndeveloped for gyro calibration, which includes estimation of biases, scale factors,\nand misalignments, as well as the attitude. A \u201cmission mode\u201d EKF is then shown\nthat estimates attitude and gyro biases, which is the estimator typically used for\nactual onboard applications. We then examine a very useful single-axis covariance\nanalysis of the accuracy that attitude filters can be expected to provide. Finally,\nbatch and realtime methods for three-axis magnetometer calibration are developed.\nThe batch approaches involve a suboptimal linear solution and an optimal nonlinear\nleast squares solution, and the realtime approach uses an EKF formulation.\n\nF.L. Markley and J.L. Crassidis, Fundamentals of Spacecraft Attitude Determination\nand Control, Space Technology Library 33, DOI 10.1007/978-1-4939-0802-8__6,\n\u00a9 Springer Science+Business Media New York 2014\n\n235\n\n\n\n236 6 Filtering for Attitude Estimation and Calibration\n\n6.1 Attitude Representations for Kalman Filtering\n\nSection 2.9 presented several different representations of spacecraft attitude, some\nof which are more suitable for filtering applications than others. The only represen-\ntations that have seen widespread application are three-component representations\nand the four-component quaternion representation. We will briefly discuss the\nadvantages and drawbacks of the different representations, after which we will\nconcentrate on quaternion-based filters.\n\n6.1.1 Three-Component Representations\n\nThree-component representations are the most natural representations for filtering,\nbecause only three parameters are needed to represent rotations. As was pointed\nout in Sect. 2.9, though, all three-parameter representations of the rotation group\nhave discontinuities or singularities. A filter using a three-dimensional attitude\nrepresentation must provide some guarantee of avoiding these singular points.\n\nThe earliest Kalman filters for spacecraft attitude estimation used Euler angles,\nspecifically a roll, pitch, yaw sequence of Tait-Bryan angles, which have a very\nintuitive meaning if they do not become too large [13, 14]. This is a very useful\nrepresentation if the middle angle of the sequence, which is generally the pitch\nangle, stays well away from positive or negative rotations of 90?. Filters for pitch,\nroll, and yaw have been used mostly for Earth-pointing spacecraft, which typically\nhave small pitch angles. One disadvantage of this representation is that it requires\na fair number of trigonometric function evaluations, but this has become less of an\nissue with increasing computing power, especially in onboard computers.\n\nThe Gibbs vector or Rodrigues parameter representation has been used in a\nKalman filter [18], but it is not well suited to filtering because of its inability to\nrepresent 180? rotations. It provides an excellent representation of small attitude\nerrors, however, as we shall see.\n\nThe modified Rodrigues parameters (MRPs) are non-singular for rotations of\nless than 360?, and rotations greater than 180? can be represented by an MRP in\nthe shadow set, as discussed in Sect. 2.9.5. This has advanced the use of MRPs in\nattitude estimation Kalman filters [10, 19]. The transformation to the shadow set is\nmade at some angle greater than 180? to avoid \u201cchattering\u201d between the two MRP\nrepresentations if the rotation angle dwells for an extended period in the vicinity\nof 180?. When transforming to the shadow set, it is necessary to transform the\ncovariance matrix to the new parameters. This transformation is discussed in the\nliterature.\n\nThe rotation vector is very similar to the MRPs in having a singularity for 360?\nrotations. When its magnitude k#k becomes greater than 180?, the representation\ncan be switched to an equivalent rotation of magnitude 2\n ? k#k in the opposite\ndirection. The rotation vector has no clear advantage over the MRPs for filtering,\nthough, and has the disadvantage of requiring the evaluation of trigonometric\nfunctions.\n\n\n\n6.1 Attitude Representations for Kalman Filtering 237\n\n6.1.2 Additive Quaternion Representation\n\nThe quaternion has become the representation of choice for attitude estimation\nbecause it is the lowest-dimensional parameterization that is free from singularities.\nHowever, the quaternion must obey its normalization constraint, which can cause\nissues in the standard EKF.\n\nThe normalization problem is apparent in the Kalman filter update equation1\n\nOqC D Oq? CK\u0152y ? h.Ox?/? (6.1)\n\nwhere Ox? is the pre-update estimate of the state vector that includes the quaternion\nas four of its components. It is clear that OqC and Oq? cannot both be normalized to\nunity unless there is some special relation between Oq? and K\u0152y ? h.Ox?/?. No such\nrelation holds in the general case, so the filter update can spoil the normalization.\n\nThere is a deeper problem with quaternion normalization. An unbiased estimator\nhas the property that the expectation of the estimated value is the true value, as\ndiscussed in Sect. 12.3.2, i.e.\n\nEf Oqg D qtrue (6.2)\nWe define the additive quaternion error as the algebraic difference between the true\nquaternion and its estimate\n\n?q ? qtrue ? Oq (6.3)\nso\n\nkOqk2 D kqtrue ??qk2 D kqtruek2 ? 2?qT qtrue C k?qk2 (6.4)\n\nIt follows trivially from Eq. (6.3) that the expectation of?q is zero, as it is for every\nunbiased estimator, and the true quaternion is assumed to have unit norm, so the\nexpectation of this equation is\n\nEfkOqk2g D 1CEfk?qk2g D 1C tr.Pqq/ (6.5)\n\nwhere Pqq ? Ef?q?qT g is the quaternion covariance. Thus we see that an\nunbiased estimate of the four-component quaternion must violate the unit norm\nconstraint.\n\nSuppose that we give up on the requirement that the estimator be unbiased and\ndevelop a biased estimator obeying the unit norm constraint, i.e. an estimator giving\nkqtruek D kOqk D 1. We will show that this leads to a different problem. For such an\nestimator Eq. (6.4) would give\n\n1See Sect. 12.3.7.1 for a review of the Kalman filter.\n\n\n\n238 6 Filtering for Attitude Estimation and Calibration\n\n2?qT qtrue D k?qk2 (6.6)\n\nBecause the estimator is biased, the covariance is\n\nPqq D Ef?q?qT g ?Ef?qgEf?qT g (6.7)\n\nThen\n\n.qtrue/T Pqq qtrue D Ef.qtrue/T ?q?qT qtrueg ?Ef.qtrue/T ?qgEf?qT qtrueg\n\nD 1\n4\n\nh\nEfk?qk4g ? ?Efk?qk2g\t2\n\ni\nD 1\n4\n\n?\nEfk?qk4g ? tr.Pqq/2\n\n?\n(6.8)\n\nThis becomes very small as the attitude errors become small, indicating that the\ncovariance matrix is ill-conditioned in that limit.2 The ill-conditioning has been\nobserved in toy models [24], numerical studies [5], and analysis [31]. It is worth\nnoting that if the norm constraint had been linear, the quaternion covariance would\nhave been truly singular.\n\nAt least four methods have been proposed to deal with these problems within the\nframework of additive quaternion filtering, but none is completely satisfactory.\n\nThe first method is to renormalize the estimate by brute force\n\nOq ? Efqtrueg=kEfqtruegk (6.9)\n\nIf the update K\u0152y ? h.Ox?/? is orthogonal to Oq?, then Eq. (6.1) shows that the\nrenormalization makes only a second-order correction in the quaternion errors.\nIn this case brute force normalization is consistent with the EKF, which is a first-\norder estimator. If the update is not orthogonal to Oq?, it is difficult to justify brute\nforce normalization.\n\nThe second method is to modify the Kalman filter update equations to enforce\nthe norm constraint by means of a Lagrange multiplier [42]. These two approaches\nboth yield biased estimates of the quaternion.\n\nThe third method is to give up on enforcing the quaternion norm, and to define\nthe attitude matrix as\n\nA.q/ D kqk?2 ??q24 ? kq1W3k2\n\t\nI3 C 2q1W3 qT1W3 ? 2q4\u0152q1W3??\n\n?\n(6.10)\n\nThis definition is guaranteed to provide an orthogonal attitude matrix. We call\nthis the ray representation, because any quaternion along a ray through the origin\ncorresponds to the same attitude matrix. This approach avoids the complications\narising from enforcing the norm constraint, but introduces an unobservable degree of\nfreedom, the quaternion norm. The result is that one eigenvalue of Pqq is unaffected\n\n2But not singular, as was claimed in [21].\n\n\n\n6.1 Attitude Representations for Kalman Filtering 239\n\nby measurements and thus retains its initial value, which can cause loss of numerical\nprecision if the attitude estimates become very accurate. This method has been used\nsuccessfully, however [32, 33].\n\nThe fourth method is to give up on enforcing the quaternion norm, but to continue\nto define the attitude matrix by Eq. (2.125), which is Eq. (6.10) without the factor\nof kqk?2. The attitude matrix is not orthogonal in this case. This is a significant\ndrawback of the method, but the lack of orthogonality gives rise to measurement\nresiduals resulting in Kalman filter updates that tend to drive the quaternion norm to\nunity. This method can lead to an ill-conditioned covariance matrix [24].\n\n6.1.3 Multiplicative Quaternion Representation\n\nThe basic idea of the multiplicative EKF (MEKF) is to use the quaternion as the\n\u201cglobal\u201d attitude representation and use a three-component state vector ?# for the\n\u201clocal\u201d representation of attitude errors. Instead of writing the true quaternion as\nthe sum of the estimated quaternion and an error quaternion, we write it as the\nproduct of an error quaternion and the estimate\n\nqtrue D ?q.?#/? Oq (6.11)\n\nNote that qtrue, ?q, and Oq are all properly normalized unit quaternions. This idea\nwas first applied to the Space Precision Attitude Reference System (SPARS) in\n1969 [29, 39], was later developed for NASA\u2019s Multimission Modular Spacecraft\n(MMS) [27], and has been widely applied to a great number of space missions. The\nappearance of ?q on the left of Oq in Eq. (6.11) means that the attitude error vector\nis defined in the body reference frame. This is the most widely used form of the\nMEKF, but some authors write qtrue D Oq? ?q0 in place of Eq. (6.11), defining the\nattitude error vector to be in the reference frame [16].\n\nWe have written the error vector as ?# , but any of the error representations\ndiscussed in Sect. 2.10 can be used: the rotation vector, two times the vector part\nof the quaternion, two times the vector of Rodrigues parameters, four times the\nvector of MRPs, or the vector of roll, pitch, and yaw angles. The MEKF updates the\nerror state\n\n?x ?\n?\n?#\n\n??\n\n?\n(6.12)\n\nwhere ? true D O?C?? is a vector of other variables to be estimated. Thus we have a\nconventional EKF that computes an unconstrained and unbiased estimate of?x. The\ncorrectly normalized four-component Oq is not actually part of the EKF, but a reset\noperation moves the updates into this global variable to keep the error quaternion\n\n\n\n240 6 Filtering for Attitude Estimation and Calibration\n\nsmall and thus far away from any singularities [21, 23]. It is important to note that\nthe estimate Oq is not defined as an expectation, which is how the MEKF avoids the\npitfalls of Sect. 6.1.2.3\n\nIf the vector ? has n components, the MEKF covariance is a well-conditioned\n.nC 3/?.nC 3/ matrix, while the covariance matrix of a filter estimating the full\nquaternion would be .nC4/?.nC4/. The conceptual advantage of this dimensional\nreduction, as more truly representing the actual degrees of freedom of the system,\nhas been debated at length [5, 23, 24, 31, 36, 37], but the computational advantages\nare indisputable. Another great advantage of the MEKF is that the covariance of\nthe attitude error angles has a transparent physical interpretation. The covariance\nof estimators using other attitude representations has a less obvious interpretation\nunless the attitude matrix is close to the identity matrix.\n\nEquation (6.11) is equivalent to\n\nAtrue D A.qtrue/ D A.?#/A. Oq/ D A.?#/ OA (6.13)\n\nThis shows that the attitude matrix could also be used as the global representation,\nbut the quaternion has two advantages. The first is compactness; it only has four\ncomponents rather than nine. The second is that if computational errors cause the\nquaternion norm to deviate from unity, it is easy to normalize the quaternion by\ndividing all its components by its norm. It is not so straightforward to restore the\northogonality constraint on the attitude matrix if computational errors cause the\nconstraint to be violated.\n\n6.2 Attitude Estimation\n\n6.2.1 Kalman Filter Formulation\n\nOur attitude filters all use some variant of the MEKF, which proceeds by iteration\nof three steps: measurement update, state vector reset, and propagation to the next\nmeasurement time. The measurement update step updates the error state vector.\nThe reset moves the updated information from the error state to the global attitude\nrepresentation and resets the components of the error state to zero. The propagation\nstep propagates the global variables to the time of the next representation. The error\nstate variables do not need to be propagated because they are identically zero over\nthe propagation step. We will now discuss these three steps in more detail.\n\n3Reference [23] writes qtrue D ?q.?#/ ? qref, where qref is a \u201creference\u201d quaternion, and\nderives the propagation and update equations to ensure that Ef?#g is only nonzero between the\nmeasurement update and reset. It turns out that qref obeys the same equations as our Oq and is the\nbest attitude estimate, so the treatment here is mathematically equivalent, although less rigorous.\n\n\n\n6.2 Attitude Estimation 241\n\n6.2.1.1 Measurement Update\n\nThe observation model is given by Eq. (12.103), which for attitude estimation is\n\ny D h.qtrue; ? true/C v (6.14)\nwhere v is a vector of Gaussian errors with covariance matrixR. The MEKF updates\nthe error state of Eq. (6.12), not the global state representation Oq and O?, so the\nmeasurement sensitivity matrix is\n\nH.q; ?/ D @h\n@.?x/\n\nD\n?\n@h\n\n@.?#/\n\n@h\n@?\n\n?\n? ?H# H?\n\n?\n(6.15)\n\nThe alternative representations for ?q.?#/ are all equivalent to first order in ?# , as\nwas shown in Sect. 2.10, so we can express the error quaternion to first order in the\nerror vector as\n\n?q ?\n?\n?#=2\n\n1\n\n?\nD Iq C 1\n\n2\n\n?\n?#\n\n0\n\n?\n(6.16)\n\nThen Eqs. (6.11) and (2.98) give\n\nqtrue ?\n?\n\nIq C 1\n2\n\n?\n?#\n\n0\n\n??\n? Oq D OqC 1\n\n2\n?# ? Oq D OqC 1\n\n2\n?. Oq/?# (6.17)\n\nIt follows that the attitude part of the measurement sensitivity matrix can be\nevaluated by using the chain rule\n\nH# D @h\n@q\n\n@q\n@.?#/\n\nD 1\n2\n\n@h\n@q\n?. Oq/ (6.18)\n\nAn even more convenient form of the measurement sensitivity matrix for the\ncommon case of vector measurements will be derived in Sect. 6.2.2.\n\nImmediately after a reset or propagation, the quantities ? O# and ? O? are zero.\nIf several measurements are processed at one time without an intervening reset,\nthough, these quantities may have finite values. In order to avoid recalculating\nthe nonlinear function h. Oq; O?/, we use the first-order Taylor series to compute the\nexpectation\n\nEfh.qtrue; ? true/g ? h. Oq; O?/CH. Oq; O?/\n\"\n? O#\n? O?\n\n#\n(6.19)\n\nThe state update for the kth measurement is then\n\n\"\n? O#Ck\n? O?Ck\n\n#\nD\n\"\n? O#?k\n? O??k\n\n#\nCKk\n\n(\nyk ? hk. Oq?k ; O?\n\n?\nk / ?Hk. Oq?k ; O?\n\n?\nk /\n\n\"\n? O#?k\n? O??k\n\n#)\n(6.20)\n\n\n\n242 6 Filtering for Attitude Estimation and Calibration\n\nThe Kalman gain computation and covariance update have the standard Kalman\nfilter forms.\n\nMany modern-day devices, such as star trackers, provide quaternion-out capabil-\nities along with associated error covariances. The MEKF measurement model for\nincorporating these quaternion \u201cmeasurements\u201d can be derived from\n\nqk ? Oq?1k D ?q.?#k/ (6.21)\n\nwhere qk is the quaternion measurement and we understand Oqk to be Oq?k .\nBecause it is important that the measurement update should agree closely with\nthe measurement residual computation, the measurement model should use the\nsame parameterization for ?q.?#k/ as is used in the reset, rather than a first-\norder approximation. The Rodrigues vector parameterization has the advantage that\nthe observation model is insensitive to the sign ambiguity in the tracker output\nquaternion qk . Using this parameterization, the measurement used in the filter and\nits predicted value are given by Eqs. (2.136), (2.184), (6.19), and (6.21) as\n\nyk D ?#k D 2 .qk ? Oq\n?1\nk /1W3\n\n.qk ? Oq?1k /4\n(6.22a)\n\nhk. Oq?k ; O?\n?\nk /CHk. Oq?k ; O?\n\n?\nk /\n\n\"\n? O#?k\n? O??k\n\n#\nD 2 . Oqk ? Oq\n\n?1\nk /1W3\n\n. Oqk ? Oq?1k /4\nC \u0152I3 03?n?\n\n\"\n? O#?k\n? O??k\n\n#\nD ? O#?k\n(6.22b)\n\nThe measurement sensitivity matrix is simply given by Hk D \u0152I3 03?n?, and the\nmeasurement covariance matrix, Rk , is a 3?3matrix of attitude measurement error\nangles.\n\nUsing a quaternion-out approach simplifies the computations in the EKF, but\nissues such as estimator consistency need to be considered when using the EKF to\nfuse multiple measurement sets. See [7] for more details.\n\n6.2.1.2 Reset\n\nThe discrete measurement update assigns finite post-update values to ? O#C and\n? O?C, but the components of the global state still retain the values Oq? and O??. A reset\nprocedure is used to move the update information to a post-update estimate global\n\nstate vector OqC and O?C, while simultaneously resetting ? O# and? O? to zero. The reset\ndoes not change the overall estimate, so the reset must obey\n\nOqC D ?q.03/? OqC D ?q.? O#C/? Oq? (6.23a)\nO?C D O?C C 0n D O?? C? O?C (6.23b)\n\n\n\n6.2 Attitude Estimation 243\n\nAfter the update, ?#?k and ??? are reset to zero. Thus the reset moves information\nfrom one part of the estimate to another part. This reset rotates the reference frame\nfor the attitude covariance, so that we might expect the covariance to be rotated,\neven though no new information is added. However, the covariance depends on the\nassumed statistics of the measurements, not on the actual measurements. Therefore,\nbecause the update is zero mean, the mean rotation caused by the reset is actually\nzero, and so the covariance is in fact not affected by the reset.4\n\nIf a reset is done after each measurement update, Eq. (6.20) simplifies to\n\n\"\n? O#Ck\n? O?Ck\n\n#\nD Kk\n\nh\nyk ? hk. Oq?k ; O?\n\n?\nk /\ni\n?\n?\nK#k\nK?k\n\n? h\nyk ? hk. Oq?k ; O?\n\n?\nk /\ni\n\n(6.24)\n\nIn this case, the reset of the non-attitude state can be done implicitly as part of the\nmeasurement update, giving\n\nO?Ck D O?\n?\nk CK?k\n\nh\nyk ? hk. Oq?k ; O?\n\n?\nk /\ni\n\n(6.25)\n\nThen only the quaternion has to be reset explicitly. The reset is often delayed for\ncomputational efficiency until all the updates for a set of simultaneous measure-\nments have been performed, though, in which case all the terms in Eq. (6.20) must\nbe included. It is imperative to perform a reset either implicitly or explicitly before\nbeginning the time propagation, however, to avoid the necessity of propagating ?#?k\nand ??? between measurements.\n\nThe quaternion reset in Eq. (6.23a) is the special feature of the MEKF. This\nreset has to preserve the quaternion norm, so an exact unit-norm expression for\nthe functional dependence of ?q on ?# must be used, not the linear approximation\nof Eq. (6.16). Using the Rodrigues parameter vector has the practical advantage that\nthe reset operation for this parameterization is\n\nOqC D ?q.? O#C/? Oq? D 1q\n1C k? O#C=2k2\n\n\"\n? O#C=2\n1\n\n#\n? Oq? (6.26)\n\nUsing an argument similar to Eq. (6.17), this can be accomplished in two steps:\n\nq? D\n\"\n? O#C=2\n1\n\n#\n? Oq? D Oq? C 1\n\n2\n?. Oq?/? O#C (6.27)\n\nfollowed by\n\nOqC D q\n?\n\nkq?k (6.28)\n\n4Not everyone agrees with this statement; see [25] and [34].\n\n\n\n244 6 Filtering for Attitude Estimation and Calibration\n\nThe first step is just the usual linear Kalman update, and the second step is\nmathematically equivalent to a brute force normalization. Thus the MEKF using\nRodrigues parameters for the error vector provides a theoretical justification for\nthe brute force update. It has the additional advantage of completely avoiding the\npossibility of accumulated errors in the quaternion norm after many updates.\n\nThe Rodrigues parameters also have the conceptual advantage that they map the\nrotation group into three-dimensional Euclidean space, with the largest possible\n180? attitude errors mapped to points at infinity. Thus probability distributions\nwith infinitely long tails, such as Gaussian distributions, make sense in Rodrigues\nparameter space.\n\n6.2.1.3 Propagation\n\nAn EKF must propagate the expectation and covariance of the state. The MEKF is\nunusual in propagating the expectations Oq and O? and the covariance of the error-\nstate vector in Eq. (6.12). We now derive the expressions needed for propagation,\nbeginning by differentiating Eq. (6.11):\n\nPqtrue D ? Pq? OqC ?q? POq (6.29)\n\nThe true and estimated quaternions satisfy the kinematic equations\n\nPqtrue D 1\n2\n\n?\n!true\n\n0\n\n?\n? qtrue (6.30a)\n\nPOq D 1\n2\n\n? O!\n0\n\n?\n? Oq (6.30b)\n\nwhere!true and O! are the true and estimated angular rates, respectively. Substituting\nthese equations and Eq. (6.11) into Eq. (6.29) gives\n\n1\n\n2\n\n?\n!true\n\n0\n\n?\n? ?q? Oq D ? Pq? OqC 1\n\n2\n?q?\n\n? O!\n0\n\n?\n? Oq (6.31)\n\nMultiplying on the right by Oq?1 and rearranging terms gives [21]\n\n? Pq D 1\n2\n\n??\n!true\n\n0\n\n?\n? ?q ? ?q?\n\n? O!\n0\n\n??\n(6.32)\n\nSubstituting !true D O!C?! into Eq. (6.32), where ?! is the error angular velocity,\nleads to\n\n\n\n6.2 Attitude Estimation 245\n\n? Pq D 1\n2\n\n?? O!\n0\n\n?\n? ?q ? ?q?\n\n? O!\n0\n\n??\nC 1\n2\n\n?\n?!\n\n0\n\n?\n? ?q\n\nD ?\n? O! ? ?q1W3\n\n0\n\n?\nC 1\n2\n\n?\n?!\n\n0\n\n?\n? .?q ? Iq C Iq/ (6.33)\n\nNote that this is an exact kinematic relationship since no linearizations have been\nperformed yet. The only nonlinearity in the errors appears in the last term on the\nright hand side. Both ?! and ?q ? Iq are small, though, so we can ignore their\nproduct in the spirit of the linearized EKF, resulting in\n\n? Pq D ?\n? O! ? ?q1W3\n\n0\n\n?\nC 1\n2\n\n?\n?!\n\n0\n\n?\n(6.34)\n\nThe first three components of this, after substituting Eq. (6.16), are\n\n? P# D ? O! ? ?# C ?! (6.35)\n\nand the fourth component is ? Pq4 D 0. Equation (6.35), which is just Eq. (3.48) in\nmodified notation, is the equation needed to propagate the covariance of the attitude\nerror-angle covariance. Detailed models will be provided during the presentations\nof specific estimators.\n\nThe expectation of Eq. (6.35) is\n\n?\nPO# D ? O! ? ? O# (6.36)\n\nbecause ?! has zero expectation. This says that if ? O# is zero at the beginning of\na propagation it will remain zero through the propagation, which is equivalent to\nsaying that ? Oq will be equal to the identity quaternion throughout the propagation.\n\n6.2.1.4 Gyros for Dynamic Model Replacement\n\nPrecise angular rate information is required for precise pointing and attitude\nmaneuvers, and also for filtering noisy attitude sensor data. In principle, this\ncould be provided by a dynamic model based on the equations in Chap. 3.\nMany spacecraft, including virtually all spacecraft with stringent pointing and/or\nmaneuvering requirements, are provided with accurate gyros, which are the most\ncrucial of all the attitude sensors. The usual Kalman filter update equations can be\nemployed to include gyro data in an EKF as measurements.\n\nA great number of attitude filters incorporate gyro information as part of the\ndynamic model rather than using than using the gyro information as a Kalman\nmeasurement update. This alternative is often referred to as using gyros in\nthe dynamic model replacement mode. The reasons for favoring this method\n\n\n\n246 6 Filtering for Attitude Estimation and Calibration\n\nare twofold. Firstly, gyro information may well be much more accurate than the\navailable models of rotational dynamics and torques, and inaccurate dynamic\nmodels could actually corrupt the gyro data. The second reason for using gyros in\ndynamic replacement mode, which is particularly important for onboard filtering, is\nthat it requires much less computation. A filter including actual rotational dynamic\nmodels and treating the gyro data as measurements should be more accurate in\ntheory, but it can be inferior in practice.\n\nThe basic idea of dynamic model replacement is to use Eq. (4.31a) or (4.34) to\nget the true angular velocity !true in terms of the gyro-sensed rate !. This true\nangular rate or its expectation is then substituted directly into Eqs. (6.30) and (6.36).\nThe details of this method will be presented in the following discussions of specific\nfilters.\n\n6.2.2 Gyro Calibration Kalman Smoother\n\nGyros must be calibrated to provide accurate rate measurements. Both sequential\nfiltering [30] and batch [28] approaches can be used for this calibration. The tradi-\ntional attitude on-orbit calibration approach uses the 6-state EKF discussed in the\nfollowing section to estimate the current attitude and gyro biases simultaneously\n[21]. This filter assumes unvarying alignment of the sensors involved in attitude\nestimation. However, sensor misalignment is inevitable and would contribute\nto unreliable attitude estimates [38]. More stringent attitude pointing accuracy\nrequires misalignments to be estimated and incorporated into the attitude estimator.\nThe importance of proper calibration for use in fault detection or rate derivation has\nbeen noted in several papers [3, 4, 41].\n\nAlthough several methods exist for gyro calibration, we present a batch pro-\ncess based on the smoother shown in Sect. 12.3.7.3. A sequential EKF is first\nexecuted forwards in time and then smoothed estimates are provided by employ-\ning Eq. (12.139) backwards in time with final conditions given by Eq. (12.138).\nA calibration model for a 3-axis gyro often comprises a set of 3 biases and a 3?3\nscale factor/misalignment matrix containing 3 scale factors and 6 misalignments,\nfor a total of 12 calibration parameters [30]. The term \u201cbias\u201d implies a constant\noffset in the measurements, but in reality this offset actually drifts and is typically\nmodeled using a random walk process. However, in most cases, this drift occurs\nslowly over many orbits. The other calibration parameters can vary as well but\ntypically not as much as the gyro drift. Here a 15-state model is derived to estimate\nthe attitude as well as all gyro calibration parameters. Unlike magnetometers, all\ngyro calibration procedures require an external attitude or independent rate sensor.\nHere it is assumed that star tracker measurements are available. Once the calibration\nparameters are determined using the smoother, then a realtime 6-state filter can\nbe employed for the spacecraft mission mode. Periodic calibration of the gyro is\ntypically done throughout the spacecraft lifetime, at time intervals dictated by the\nrequired accuracy in the attitude estimates or rate estimates for other purposes, such\nas jitter control.\n\n\n\n6.2 Attitude Estimation 247\n\nThe 16-component global state vector is made up of the true quaternion, qtrue,\ngyro drift biases, ?true, scale factors, strue, and misalignments, ktrueU and k\n\ntrue\nL . The\n\n15-component state error vector is\n\n?x.t/ ? ??#T .t/ ??T .t/ ?sT .t/ ?kTU .t/ ?kTL.t/\n?T\n\n(6.37)\n\nwhere ?# is the local vector of small attitude errors and the other components are the\nerrors in the gyro biases, scale factors, and misalignments defined as the difference\nbetween their true and estimated values by ?? ? ?true ? O? , ?s ? strue ? Os, ?kU ?\nktrueU ? OkU , and ?kL ? ktrueL ? OkL.\n\nThe gyro model is given by Eqs. (4.34) and (4.31b) from Sect. 4.7.1:\n\n! D .I3 C S true/!true C ?true C ?v (6.38a)\nP? true D ?u (6.38b)\n\nwhere the spectral densities of ?v and ?u are ?\n2\nv I3 and ?\n\n2\nv I3, respectively. The matrix\n\nS true is written as\n\nS true ?\n2\n4\nstrue1 k\n\ntrue\nU1 k\n\ntrue\nU2\n\nktrueL1 s\ntrue\n2 k\n\ntrue\nU3\n\nktrueL2 k\ntrue\nL3 s\n\ntrue\n3\n\n3\n5 (6.39)\n\nwith true vectors given by strue ? \u0152strue1 strue2 strue3 ?T , ktrueU ? \u0152ktrueU1 ktrueU2 ktrueU3 ?T , and\nktrueL ? \u0152ktrueL1 ktrueL2 ktrueL3 ?T . The dynamics of strue, ktrueU , and ktrueL are given by\n\nPstrue D ?s (6.40a)\nPktrueU D ?U (6.40b)\nPktrueL D ?L (6.40c)\n\nwhere the spectral densities of ?s , ?U , and ?L are ?\n2\ns I3, ?\n\n2\nU I3, and ?\n\n2\nLI3, respec-\n\ntively. The error-state vector obeys the linearized dynamic equation\n\n?Px.t/ D F.t/?x.t/CG.t/w.t/ (6.41)\n\nwhere F.t/ is the Jacobian of f .x; t / and\n\nw.t/ ? ??Tv .t/ ?Tu .t/ ?Ts .t/ ?TU .t/ ?TL.t/\n?T\n\n(6.42)\n\nThe matrices F.t/, G.t/, and the spectral density Q.t/ of w.t/ are now derived for\nthe 15-state filter.\n\n\n\n248 6 Filtering for Attitude Estimation and Calibration\n\nIf the error terms in S true are small, which is almost always a valid assumption, then\n.I3 C S true/?1 ? .I3 ? S true/, leading to\n\n!true D .I3 ? S true/.! ? ?true ? ?v/ (6.43a)\nO! D .I3 ? OS/.! ? O? / (6.43b)\n\nThen ?! is given by\n\n?! D ??S.! ? O? ??? ? ?v/ ? .I3 ? OS/.?? C ?v/ (6.44)\n\nwhere ?S ? S true ? OS . Ignoring second-order terms leads to\n\n?! D ?diag.! ? O? /?s ? OU?kU ? OL?kL ? .I3 ? OS/.?? C ?v/ (6.45)\n\nwith\n\nOU D\n\n2\n64\n!2 ? O?2 !3 ? O?3 0\n0 0 !3 ? O?3\n0 0 0\n\n3\n75 (6.46a)\n\nOL D\n\n2\n64\n\n0 0 0\n\n!1 ? O?1 0 0\n0 !1 ? O?1 !2 ? O?2\n\n3\n75 (6.46b)\n\nwhere diag is defined in Eq. (2.8) and ?s, ?kU , and ?kL are implicitly defined by\nEq. (6.39). Hence, the matrices F.t/, G.t/, and Q.t/ are given by\n\nF.t/ D\n\n2\n666664\n\n?\u0152 O!.t/?? ?.I3 ? OS/ ?diag.! ? O? / ? OU ? OL\n03?3 03?3 03?3 03?3 03?3\n03?3 03?3 03?3 03?3 03?3\n03?3 03?3 03?3 03?3 03?3\n03?3 03?3 03?3 03?3 03?3\n\n3\n777775\n\n(6.47a)\n\nG.t/ D\n\n2\n666664\n\n?.I3 ? OS/ 03?3 03?3 03?3 03?3\n03?3 I3 03?3 03?3 03?3\n03?3 03?3 I3 03?3 03?3\n03?3 03?3 03?3 I3 03?3\n03?3 03?3 03?3 03?3 I3\n\n3\n777775\n\n(6.47b)\n\nQ.t/ D blkdiag ???2v I3 ?2u I3 ?2s I3 ?2U I3 ?2L I3\n?\t\n\n(6.47c)\n\nwhere blkdiag denotes a block diagonal matrix of appropriate dimension.\n\n\n\n6.2 Attitude Estimation 249\n\nAssume that N vector observations are available at time tk . We concatenate them to\nform the 3N -dimensional measurement vector\n\nyk D\n\n2\n6664\n\nA.qtrue/r1\nA.qtrue/r2\n\n:::\n\nA.qtrue/rN\n\n3\n7775\n\n??\n??\n??\n??\n?\ntk\n\nC\n\n2\n6664\n\n?1\n\n?2\n:::\n\n?N\n\n3\n7775\n\n??\n??\n??\n??\n?\ntk\n\n? hk.xtruek /C vk (6.48a)\n\nR D blkdiag ?R1 R2 ? ? ? R3\n?\n\n(6.48b)\n\nwhere Ri is the covariance of ?i . We often make the simplifying assumption\nthat the measurement errors are isotropic so that Ri D ?2i I3. The errors of unit\nvector measurements are not isotropic, though, and the QUEST measurement model\n(QMM) from Eq. (5.107) should be used instead. But this produces a singular matrix\nto be inverted in the EKF. It turns out that the assumption of isotropic errors can be\njustified, as will be shown in the following section.\n\nWe now derive the observation sensitivity matrix Hk.Ox?k / for this observation.\nThe true attitude matrix, A.qtrue/, is related to the a priori attitude, A. Oq?/, through\n\nA.qtrue/ D A.?q/A. Oq?/ (6.49)\n\nThe first-order approximation of the error-attitude matrix, A.?q/, is given by\n\nA.?q/ ? I3 ? \u0152?#?? (6.50)\n\nFor a single sensor the true and estimated body vectors are given by\n\nbtrue D A.qtrue/r (6.51a)\nOb? D A. Oq?/r (6.51b)\n\nSubstituting Eqs. (6.49) and (6.50) into Eq. (6.51) yields\n\n?b ? btrue ? Ob? D ?\u0152?#??A. Oq?/r D \u0152 Ob????# (6.52)\n\nThe sensitivity matrix for all measurement sets is therefore given by\n\nHk.Ox?k / D\n\n2\n6666664\n\nh Ob?1 ?\ni\n03?12h Ob?2 ?\n\ni\n03?12\n\n:::\n:::h Ob?N?\n\ni\n03?12\n\n3\n7777775\n\n??\n??\n??\n??\n??\n??\ntk\n\n(6.53)\n\n\n\n250 6 Filtering for Attitude Estimation and Calibration\n\nTable 6.1 Extended Kalman filter for gyro calibration\n\nInitialize Oq.t0/ D q0; O? .t0/ D ?0; Os.t0/ D s0OkU .t0/ D kU0 ; OkL.t0/ D kL0 ; P.t0/ D P0\n\nGain Kk D P?k HTk .Ox?k /\u0152Hk.Ox?k /P?k HTk .Ox?k /CRk??1\n\nHk.Ox?k / D\n\n2\n664\n\u0152A.Oq?/r1?? 03?12\n\n:\n:\n:\n\n:\n:\n:\n\n\u0152A.Oq?/rN?? 03?12\n\n3\n775\n\n??\n??\n??\n??\ntk\n\nUpdate PCk D \u0152I ?KkHk.Ox?k /?P?k\n? O#?k D 03\nOxCk D Ox?k CKk\u0152yk ? hk.Ox?k /?\nOxk ?\n\nh\n? O#Tk O? Tk OsTk OkTUk OkTLk\n\niT\n\nhk.Ox?k / D\n\n2\n6664\n\nA.Oq?/r1\nA.Oq?/r2\n\n:\n:\n:\n\nA.Oq?/rN\n\n3\n7775\n\n??\n??\n??\n??\n?\ntk\n\nOq? D Oq?k C 12?.Oq\n?\n\nk /?\nO#Ck\n\nOqCk D q?=kq?k\n\nPropagation O!.t/ D \u0152I3 ? OS.t/?\u0152!.t/? O? .t/?\nPOq.t/ D 1\n\n2\n? .Oq.t// O!.t/\n\nPP .t/ D F.t/ P.t/C P.t/ F T .t/CG.t/Q.t/GT .t/\n\nThe final part in the EKF involves the quaternion and bias updates. The state\nupdate follows Eq. (6.25), which assumes that the state is reset before every\nmeasurement update and that the non-attitude part of the state is reset implicitly.\nThus\n\nOxCk D Ox?k CKk\u0152yk ? hk.Ox?k /? (6.54)\n\nwhere Oxk ?\nh\n? O#Tk O?\n\nT\n\nk OsTk OkTUk OkTLk\niT\n\nand hk.Ox?k / is the estimated observation,\ngiven by\n\nhk.Ox?k / D\n\n2\n6664\n\nOb?1Ob?2\n:::\nOb?N\n\n3\n7775\n\n??\n??\n??\n??\n?\ntk\n\n(6.55)\n\nThe attitude estimation algorithm is summarized in Table 6.1. The filter is\nfirst initialized with a known state (the bias initial condition is usually assumed\n\n\n\n6.2 Attitude Estimation 251\n\nzero) and error covariance matrix. The first three diagonal elements of the error\ncovariance matrix correspond to attitude errors. Then, the Kalman gain is computed\nusing the measurement-error covariance Rk and sensitivity matrix in Eq. (6.53).\nThe state error covariance follows the standard EKF update, while the state update is\ncomputed using Eq. (6.54). The quaternion is reset following Eqs. (6.27) and (6.28).\nFinally, the estimated angular velocity is used to propagate the quaternion kinematic\nmodel and error covariance in the EKF.\n\nA discrete-time propagation, given by Eq. (12.131), can be used for the covari-\nance matrix in order to reduce the computational load. The first step is to set up the\nfollowing 2n ? 2n matrix, where n D 15 in the present case [40]:\n\nA D\n? ?F GQGT\n0n?n F T\n\n?\n?t (6.56)\n\nThe matrix exponential is then calculated:\n\nB D eA D\n?\n\nB11 B12\n0n?n B22\n\n?\nD\n?\n\nB11 ?\n?1\nk Qk\n\n0n?n ?Tk\n\n?\n(6.57)\n\nThe state transition and covariance matrices are then given as\n\n?k D BT22 (6.58a)\nQk D ?kB12 (6.58b)\n\nNote that Eq. (6.56) is only valid for constant system and covariance matrices, but\nthis is a good approximation for small ?t . Often adequate results are provided by\nan even simpler first-order approximation:\n\n?k ? In C?t F.t/ (6.59a)\nQk ? ?t GQGT (6.59b)\n\nThen Eq. (3.17) gives the discrete-time quaternion propagation as\n\nOq?kC1 D exp\u0152.??=2/?? OqCk ? N?. O!Ck / OqCk (6.60)\n\nwith\n\nN?. O!Ck / ?\n\n2\n66664\n\ncos\n\n?\n1\n\n2\nk O!Ck k?t\n\n?\nI3 ?\n\nh O Ck ?\ni O Ck\n\n? O CTk cos\n?\n1\n\n2\nk O!Ck k?t\n\n?\n\n3\n77775\n\n(6.61)\n\n\n\n252 6 Filtering for Attitude Estimation and Calibration\n\nwhere\n\nO Ck ?\nsin\n\n?\n1\n\n2\nk O!Ck k?t\n\n?\nO!Ck\n\nk O!Ck k\n(6.62)\n\nExample 6.1. In this example, simulation results are presented for the aforemen-\ntioned gyro calibration algorithm. A 90-min simulation run is shown. Quaternion\nmeasurements are assumed to exist, sampled every second, and the covariance of\nthe measurements is given by Rk D 36I3 arcsec2. This assumes that errors in\neach axis are equivalent. Using one star tracker typically produces errors along the\nboresight axis that are an order of magnitude larger than the other axes. Using two\nstar trackers that are orthogonal produces errors that are more nearly isotropic. Also,\ntwo star trackers are typically employed for redundancy purposes. The spacecraft\nangular velocity is given by!true D 0:1?\u0152sin.0:01t/ sin.0:0085t/ cos.0:0085t/?T\ndeg/s. This angular velocity is used to increase the observability of the calibration\nparameters. Missions typically perform calibration maneuvers to ensure proper\nobservability. The other parameters used in the simulation are given by\n\n\u2022 Initial gyro bias: 0:1 deg/h for each axis,\n\u2022 Gyro scale factors: s1 D 1;500 ppm, s2 D 1;000 ppm, s3 D 1;500 ppm,\n\u2022 Gyro misalignments: kU1 D 1;000 ppm, kU2 D 1;500 ppm, kU3 D 2;000 ppm,\nkL1 D 500 ppm, kL2 D 1;000 ppm, kL3 D 1;500 ppm,\n\n\u2022 Gyro noise parameters: ?u D\np\n10 ? 10?10 rad/s3=2, ?v D\n\np\n10 ? 10?7 rad/s1=2,\n\n?s D ?U D ?L D 0,\n\u2022 Initial quaternion: qtrue0 D\n\np\n2=2 ? \u01521 0 0 1?T .\n\nwhere ppm denotes parts per million. The gyros are also assumed to be sampled\nevery second. The EKF attitude is initialized using the measurement quaternion and\nthe initial covariance is given by .6=3;600 ? \n=180/2I3 rad2. All gyro calibration\nparameters are assumed to be initialized to zero. The initial covariances for these\nparameters are: initial gyro bias covariance of .0:2=3;600 ? \n=180/2I3 (rad/s)2,\ninitial scale factor covariance of .0:002=3/2I3 rad2, initial upper misalignment\ncovariance of .0:002=3/2I3 rad2, and initial lower misalignment covariance of\n.0:002=3/2I3 rad2.\n\nThe EKF errors with their respective 3? bounds for the attitude, gyro biases,\nscale factors and upper misalignments are shown in Fig. 6.1. Roll, pitch, and yaw\ndenote the components of ?# . The attitude errors converge in about 15 min and\ngood filtering performance is obtained. The gyro biases are also well estimated with\n3? bounds of about 0.01 deg/h in each axis. The scale factors and misalignments\ntake slightly longer to converge than the attitude and gyro biases, but they are also\nwell estimated with 3? bounds of about 25 ?rad in each axis. The EKF estimates\nare then employed in a smoother to further refine the estimates. The smoothed\nestimates and covariances of each parameter are nearly constant over the entire\nsimulation run. Estimates with their respective 3? bounds are shown in Table 6.2.\nClearly, as expected, the smoother is able to provide more accurate results than the\nEKF.\n\n\n\n6.2 Attitude Estimation 253\n\n0 15 30 45 60 75 90\n?20\n\n0\n\n20\n\n0 15 30 45 60 75 90\n?20\n\n0\n\n20\n\n0 15 30 45 60 75 90\n?20\n\n0\n\n20\n\nTime (Min)\n\nR\nol\n\nl \n(m\n\nra\nd)\n\nP\nit\nch\n\n (\nmr\n\nad\n)\n\nY\naw\n\n (\nmr\n\nad\n)\n\n0 15 30 45 60 75 90\n?0.02\n\n0\n\n0.02\n\n0 15 30 45 60 75 90\n?0.02\n\n0\n\n0.02\n\n0 15 30 45 60 75 90\n?0.02\n\n0\n\n0.02\n\nTime (Min)\n\nb 1\n (\nD\n\neg\n/H\n\nr)\nb 2\n\n (\nD\n\neg\n/H\n\nr)\nb 3\n\n (\nD\n\neg\n/H\n\nr)\n\n0 15 30 45 60 75 90\n?60\n\n0\n\n60\n\n0 15 30 45 60 75 90\n?60\n\n0\n\n60\n\n0 15 30 45 60 75 90\n?60\n\n0\n\n60\n\nTime (Min)\n\ns 1\n (\npp\n\nm\n)\n\ns 2\n (\npp\n\nm\n)\n\ns 3\n (\npp\n\nm\n)\n\n0 15 30 45 60 75 90\n?60\n\n0\n\n60\n\n0 15 30 45 60 75 90\n?60\n\n0\n\n60\n\n0 15 30 45 60 75 90?60\n\n0\n\n60\n\nTime (Min)\n\nk U\n1 \n(p\n\npm\n)\n\nk U\n2 \n(p\n\npm\n)\n\nk U\n3 \n(p\n\npm\n)\n\na b\n\nc d\n\nFig. 6.1 Extended Kalman filter results. (a) Attitude errors and 3? bounds. (b) Bias errors and 3?\nbounds. (c) Scale errors and 3? bounds. (d) Upper misalignment errors and 3? bounds\n\nTable 6.2 Smoother results\nfor gyro calibration\n\nParameter Truth Estimate\n\n?1 (deg/h) 0.1 0:0981? 0:0065\n?2 (deg/h) 0.1 0:1029? 0:0065\n?3 (deg/h) 0.1 0:0999? 0:0065\ns1 (ppm) 1;500 1;497? 14:5800\ns2 (ppm) 1;000 997? 13:5651\ns3 (ppm) 1;500 1;488? 13:6671\nkU1 (ppm) 1;000 991? 13:5936\nkU2 (ppm) 1;500 1;501? 13:6984\nkU3 (ppm) 2;000 1;999? 13:7233\nkL1 (ppm) 500 499? 14:6252\nkL2 (ppm) 1;000 994? 14:6197\nkL3 (ppm) 1;500 1;497? 13:6126\n\n\n\n254 6 Filtering for Attitude Estimation and Calibration\n\n6.2.3 Filtering and the QUEST Measurement Model\n\nThe previous section asserted that using the QMM causes the matrix HPHTCR to\nbe singular at all times, where H is given by Eq. (6.53) and\n\nR D blkdiag ???21 \u0152 Ob1??2 ??22 \u0152 Ob2??2 ? ? ? ??2N \u0152 ObN??2\n?\n\n(6.63)\n\nA matrix M is singular if and only if it has a null vector, i.e. a nonzero vector z\nsuch that M z D 0. Since the matrices HPHT and R both contain the same cross\nproduct matrices it is easy to see that\n\nz D ? ObT1 ObT2 ? ? ? ObTN\n?T\n\n(6.64)\n\nis a null vector of HPHT CR. Note that other null vectors may exist, but all we\nneed is one to prove that using the QMM leads to a matrix that cannot be inverted\nin the EKF gain equation.\n\nThere are several ways to avoid this singularity. The first is to note that we never\nreally measure a unit vector. In the case of a star tracker, for example, the actual\nmeasurement vector is given by Eq. (4.3) as\n\nh.xtrue/ D\n?\n\nu\nv\n\n?\nD\n?\n\nu0\nv0\n\n?\nC f\nr st3\n\n?\nr st1\nr st2\n\n?\n(6.65)\n\nwhere rst D BA.qtrue/rtrue, B is the orthogonal star tracker alignment matrix, rtrue\nis the star unit vector in the celestial coordinate frame, and the subscripts 1; 2; 3 are\nCartesian indices. The attitude part of the sensitivity matrix for this measurement\nmodel is found by the chain rule to be\n\nH# D @h\n@rst\n\n@rst\n\n@.?#/\nD f\n. Or st3 /2\n\n? Or st3 0 ?Or st1\n0 Or st3 ?Or st2\n\n?\n\u0152Orst??B (6.66)\n\nThen R and HPHTCR are well-conditioned 2 ? 2 matrices.\nIt is often desirable to compute a unit vector from the sensor measurements for\n\ninput to the filter, in order to provide a universal filter interface from a variety of\nsensors. The nonsingular unit vector measurement covariance matrix of Eq. (5.126)\ncould be used in place of the QMM, but this would produce an ill-conditioned matrix\nHPHT CR, which is not much of an improvement. Fortunately, Malcolm Shuster\nfound a way out of this dilemma.\n\nShuster\u2019s analysis of this singularity issue leads to a remarkably simple solution\n[35]. Let \t be a unit vector that is very close to Atruer, and let f\t; ?.\t/; ?.\t/g\nbe a right-handed orthogonal triad. We can determine b by measuring only two\ncomponents nearly perpendicular to Atruer:\n\n?1 D ?.\t/ ? b (6.67a)\n?2 D ?.\t/ ? b (6.67b)\n\n\n\n6.2 Attitude Estimation 255\n\nThe measurement vector is given in terms of the projection matrix\n\nU.\t/ ? ??.\t/ ?.\t/?T (6.68)\n\nby\n\n\n ? \u0152?1 ?2?T D U.\t/b (6.69)\n\nThe projection matrix satisfies the identities\n\nU.\t/U T .\t/ D I2 (6.70a)\nUT .\t/ U.\t/ D I3 ? \t\tT (6.70b)\n\nSubstituting the measurement model b D AtruerC ? into Eq. (6.69) leads to\n\n\n D U.\t/AtruerC e (6.71)\n\nwhere e D U.\t/?. If ? obeys the QMM, Ef??T g D ?2\u0152I3 ? .Atruer/.Atruer/T ?,\nthen the projected error e satisfies\n\nE feg D 0 (6.72a)\nE\n?\ne eT\n\n? D ?2 ?I2 ? \u0152U.\t/Atruer?\u0152U.\t/Atruer?T\n?\n\n(6.72b)\n\nSince \t is very close to Atruer then kU.\t/Atruerk ? 1 and we can neglect the\nsecond term in Eq. (6.72b), yielding\n\nR? ? E\n?\ne eT\n\n? D ?2I2 (6.73)\n\nwhich is a nonsingular matrix.\nThe vector \t has been undefined, except for being close to Atruer. This will\n\nnow be specifically defined in the Kalman filter setting. Substituting Eqs. (6.49)\nand (6.50) into Eq. (6.71) leads to\n\n\n D U.\t/.I3 ? \u0152?#??/ Ob? C e (6.74a)\nD U.\t/. Ob? C Ob? ? ?#/C e (6.74b)\n\nIf we choose \t D Ob?, the first term in Eq. (6.74b) vanishes because U. Ob?/ Ob? D 0.\nDefining U? ? U. Ob?/ gives\n\n\n ? U?b D U?\u0152 Ob????# C e (6.75)\n\n\n\n256 6 Filtering for Attitude Estimation and Calibration\n\nNow define the following error vector: ?x ? \u0152?#T ??T ?T , where ?? is an n ? 1\nvector of non-attitude error states, such as the error gyro biases. Then the linearized\nmeasurement equation becomes\n\n\n D H ?xC e (6.76)\n\nwhere H is given by\n\nH D ?W 02?n\n?\n\n(6.77)\n\nwith W ? U?\u0152 Ob???.\nThe predicted innovations covariance is given by\n\nE? D H P?HT CR? D W P?##W T C ?2I2\nD U?\n\n\n\u0152 Ob???P?## \u0152 Ob???T C ?2I3\n\n?\n.U?/T\n\n(6.78)\n\nwhere P?## is the upper-left 3 ? 3 corner of P?. Because \t is very close to Atruer,\nthe inverse of this is, to a very good approximation,\n\n.E?/?1 D U?\n\n\u0152 Ob???P?## \u0152 Ob???T C ?2I3\n\n??1\n.U?/T (6.79)\n\nNote that this would be trivial if U? were orthogonal, but it is not.\nThe Kalman gain is given by K D P?HT .H P?HT CR?/?1. If we define\n\nH ? ?\u0152 Ob??? 03?n\n?\n\n(6.80a)\n\nK ? P?H T .H P?H T C ?2I3/?1 (6.80b)\n\nthen we have\n\nH P?H T C ?2I3 D \u0152 Ob???P?## \u0152 Ob???T C ?2I3 (6.81a)\nKH D K H (6.81b)\n\nEquation (6.81) indicates that the QMM can be effectively replaced by ?2I3, in\nthe sense that it leads to the same filter that uses the projected measurements in\nEq. (6.67)! Note that the projection matrixU? does not appear in H or K . We have\nrecovered the usual Kalman filter equations for a unit vector measurement, but with\na nonsingular isotropic measurement covariance matrix in place of the singular\nQMM expression. Shuster shows that all other equations in the original EKF remain\nunchanged. This analysis can easily be extended to multiple observations.\n\n\n\n6.2 Attitude Estimation 257\n\nTable 6.3 Extended Kalman filter for attitude estimation\n\nInitialize Oq.t0/ D Oq0; O? .t0/ D O? 0\nP.t0/ D P0\n\nGain Kk D P?k HTk .Ox?k /\u0152Hk.Ox?k /P?k HTk .Ox?k /CRk??1\n\nHk.Ox?k / D\n\n2\n664\n\u0152A.Oq?/r1?? 03?3\n\n:\n:\n:\n\n:\n:\n:\n\n\u0152A.Oq?/rN?? 03?3\n\n3\n775\n\n??\n??\n??\n??\ntk\n\nUpdate PCk D \u0152I ?KkHk.Ox?k /?P?k\n?OxCk D Kk\u0152yk ? hk.Ox?k /?\n?OxCk ?\n\nh\n? O#CTk ? O? CTk\n\niT\n\nhk.Ox?k / D\n\n2\n6664\n\nA.Oq?/r1\nA.Oq?/r2\n\n:\n:\n:\n\nA.Oq?/rN\n\n3\n7775\n\n??\n??\n??\n??\n?\ntk\n\nOq? D Oq?k C\n1\n\n2\n?.Oq?k /? O#\n\nC\n\nk\n\nOqCk D q?=kq?k\nO? C\nk D O? ?k C? O? Ck\n\nPropagation O!.t/ D !.t/? O? .t/\nPOq.t/ D 1\n\n2\n? .Oq.t// O!.t/\n\nPP .t/ D F.t/ P.t/C P.t/ F T .t/CG.t/Q.t/GT .t/\n\n6.2.4 Mission Mode Kalman Filter\n\nThe EKF described in the Sect. 6.2.2 can be used for full gyro calibration, and\nimproved estimates can be obtained using a smoother. As mentioned previously,\nthe mission mode EKF estimates only attitude and gyro biases, assuming that the\nscale factors and misalignments have already been determined. The 6-state EKF\nattitude estimator is shown in Table 6.3. Note that in this formulation ?Ox is used\nand only one update is performed at each time step, so that the measurement update\nfollows Eq. (6.24) and an explicit update of the bias vector is performed. This\nformulation and the one in the next section are equivalent and both have been seen\nin the open literature. Thus we feel it is important to see how each approach is\nimplemented.\n\n\n\n258 6 Filtering for Attitude Estimation and Calibration\n\nThe matrices F.t/, G.t/, and Q.t/ are given by\n\nF.t/ D\n??\u0152 O!.t/?? ?I3\n\n03?3 03?3\n\n?\n(6.82a)\n\nG.t/ D\n??I3 03?3\n03?3 I3\n\n?\n(6.82b)\n\nQ.t/ D\n?\n?2v I3 03?3\n03?3 ?2u I3\n\n?\n(6.82c)\n\nClosed-form expressions for the discrete-time matrices are possible in this case. The\ndiscrete error-state transition matrix is given by\n\n? D\n?\n?11 ?12\n?21 ?22\n\n?\n(6.83a)\n\n?11 D I3 ? \u0152 O!?? sin.k O!k?t/k O!k C \u0152 O!??\n2 f1 ? cos.k O!k?t/g\n\nk O!k2 (6.83b)\n\n?12 D \u0152 O!??f1 ? cos.k O!k?t/gk O!k2 ? I3?t ? \u0152 O!??\n2 fk O!k?t ? sin.k O!k?t/g\n\nk O!k3\n(6.83c)\n\n?21 D 03?3 (6.83d)\n?22 D I3 (6.83e)\n\nIt is left as an exercise to derive these equations and to show that?11 is an orthogonal\nmatrix.\n\nThe conversion from the spectral density Q.t/ to discrete-time covariance Qk is\ngiven by [8]\n\nQk D\nZ ?t\n0\n\n?.t/G.t/Q.t/GT .t/?T .t/ dt (6.84)\n\nIt is assumed in the ensuing derivations for Qk that O! is constant throughout the\nsampling interval. Partition the matrix Qk into 3 ? 3 sub-matrices:\n\nQk D\n\"\nQ11k Q12k\nQT12k Q22k\n\n#\n(6.85)\n\nPerforming the multiplication B.t/ ? ?.t/G.t/Q.t/GT .t/?T .t/ gives\n\nB.t/ D\n?\n?2v?11?\n\nT\n11 C ?2u?12?T12 ?2v?11?T21 C ?2u?12?T22\n\n?2v?21?\nT\n11 C ?2u?22?T12 ?2v?21?T21 C ?2u?22?T22\n\n?\n(6.86)\n\n\n\n6.2 Attitude Estimation 259\n\nUsing Eqs. (6.83d) and (6.83e) and the orthogonality of ?11 simplifies B.t/ to\n\nB.t/ D\n?\n?2v I3 C ?2u?12?T12 ?2u?12\n\n?2u?\nT\n12 ?\n\n2\nu I3\n\n?\n(6.87)\n\nTherefore, Q22k is simply given by\n\nQ22k D .?2u?t/I3 (6.88)\n\nIntegrating ?12 gives\n\nQ12k D ?2u\nZ ?t\n0\n\n?12 dt D ?2u\n\n\n\u0152 O!k??k O!kk?t ? sin.k O!kk?t/k O!kk3 ?\n\n1\n\n2\n?t2I3\n\n? \u0152 O!k??2\n1\n2\nk O!kk2?t2 C cos.k O!kk?t/ ? 1\n\nk O!kk4\n)\n\n(6.89)\n\nIf the sampling rate is below Nyquist\u2019s limit (for example, with a safety factor of 10\nwe require k O!k?t < \n=10 for all time), then Q12k ? ? 12?2u?t2I3.\n\nPerforming the multiplication ?12?T12 yields\n\n?12?\nT\n12 D ?\u0152 O!??2\n\n1 ? 2 cos.k O!k t /C cos2.k O!k t /\nk O!k4\n\n? \u0152 O!??2 k O!k\n2t2 ? 2k O!k t sin.k O!k t /C sin2.k O!k t /\n\nk O!k4\n\nC 2\u0152 O!??2 k O!k t\n2 ? t sin.k O!k t /\nk O!k3 C t\n\n2I3\n\nD ?\u0152 O!??2 2 ? 2 cos.k O!k t / ? k O!k\n2t2\n\nk O!k4 C t\n2I3 (6.90)\n\nThe integral of ?12?T12 dt is\n\nZ ?t\n0\n\n?12?\nT\n12 dt D ?\u0152 O!??2\n\n2k O!k?t ? 2 sin.k O!k?t/ ? 1\n3\nk O!k3?t3\n\nk O!k5 C\n1\n\n3\n?t3I3\n\n(6.91)\nTherefore, Q11k is given by\n\nQ11k D .?2v?t/I3\n\nC ?2u\n(\n1\n\n3\n?t3I3 ? \u0152 O!k??2\n\n2k O!kk?t ? 2 sin.k O!kk?t/ ? 13k O!kk3?t3\nk O!kk5\n\n)\n\n(6.92)\n\n\n\n260 6 Filtering for Attitude Estimation and Calibration\n\nIf the sampling rate is below Nyquist\u2019s limit, then Q11k ?\n?\n?2v?t C 13?2u?t3\n\n\t\nI3.\n\nThen, the discrete process noise covariance is approximated by\n\nQk ?\n\n2\n66664\n\n?\n?2v?t C\n\n1\n\n3\n?2u?t\n\n3\n\n?\nI3 ?\n\n?\n1\n\n2\n?2u?t\n\n2\n\n?\nI3\n\n?\n?\n1\n\n2\n?2u?t\n\n2\n\n?\nI3\n\n?\n?2u?t\n\n\t\nI3\n\n3\n77775\n\n(6.93)\n\nIt should be noted that Eq. (6.93) is exact when F.t/ is given by\n\nF.t/ D\n?\n03?3 ?I3\n03?3 03?3\n\n?\n(6.94)\n\nEquation (6.93) is often used because the sampling rate is often below Nyquist\u2019s\nlimit. These discrete-time forms make the EKF especially suitable for onboard\nimplementation.\n\n6.2.5 Murrell\u2019s Version\n\nThe gain calculation in the filter shown in Table 6.1 requires inverting a 3N ?\n3N matrix. Murrell\u2019s variation of the filter can be used to avoid this expensive\ncomputation [27]. Even though the EKF involves nonlinear models, a linear update\nis still performed. Therefore, linear tools such as the principle of superposition\nare applicable. Murrell\u2019s filter uses this principle to process one 3 ? 1 vector\nobservation at a time, delaying the reset until all N observations have been\nprocessed. In this case, all the terms of Eq. (6.20) must be included. A flow diagram\nof Murrell\u2019s approach is given in Fig. 6.2. The first step involves propagating the\nquaternion, gyro bias, and error covariance to the current observation time. Then the\nattitude matrix is computed and the error state vector is initialized to zero. Next, the\nerror covariance and state quantities are updated using a single vector observation.\nThis update is continued (replacing the propagated error covariance and state vector\nwith the updated values) until all vector observations are processed. Finally, a reset\nmoves the updated values into the global state representation, and the global state\nand error covariance are propagated to the next observation time. Therefore, this\napproach reduces taking an inverse of a 3N ? 3N matrix to taking an inverse of a\n3 ? 3 matrix N times, significantly decreasing the computational load.\n\nExample 6.2. This example is a simulation of an EKF using a typical star tracker\nto determine the attitude of a spacecraft in a 90-min low-Earth orbit. The spacecraft\nrotates at one revolution per orbit about its?x body axis, which is the i3 vector of the\ninertial reference frame shown in Fig. 2.3. The star tracker\u2019s boresight is assumed\nto be along the z (yaw) body axis pointed in the anti-nadir direction, and is initially\n\n\n\n6.2 Attitude Estimation 261\n\nPropagate\n\nCompute\n\nSensitivity Matrix\n\nGain\n\nUpdate Covariance\nPk\n\n+ = [I?KkHk]Pk?\n\nResidual\n\nUpdate State\n\nYes\n\ni= i+1\n\nNo\ni <N?\n\nReset\n\nNext\nObservation\n\nTime\n\nInitialize\nD x??k = 0, i = 1\n\nD x??k = D x?k+\n\nDx?k\n+ = Dx??k  + Kk[ek?HkD x??k ]\n\nq??k , P?k , b? k\n?\n\nq?k\n+,Pk\n\n+,  b?k\n+\n\nPk\n? = Pk+\n\nA(q?k\n?)\n\nHk = [[A(q?k?)ri\u00d7] 03\u00d73]|tk\n\nKk = Pk\n?HkT [HkPk\n\n?Hk\nT + si\n\n2I3]\n?1\n\ne k = (bi ? A(q??)ri)|tk\n\nFig. 6.2 Computationally efficient attitude estimation algorithm\n\naligned with the i1 vector of the inertial reference frame. The star tracker can sense\nup to 10 stars in a 6??6? field of view. The catalog contains stars that can be sensed\nup to a magnitude of 6.0 (larger magnitudes indicate dimmer stars).\n\nThe star tracker body observations are obtained by using the measurement model\npresented in Sect. 4.2 with ? D .0:005=3/?. We also assume that no Sun intrusions\nare present (although this is not truly realistic). Star images are taken at 1-s intervals.\nThe goal of the EKF is to estimate the attitude and gyro biases by filtering the star\ntracker measurements. The noise parameters for the gyro measurements are given\nby ?u D\n\np\n10 ? 10?10 rad/s3=2 and ?v D\n\np\n10 ? 10?7 rad/s1=2. The initial bias\n\nfor each axis is given by 0.1 deg/h. Also, the gyro measurements are sampled at\nthe same rate as the star tracker measurements (i.e. at 1 Hz). We should note that in\n\n\n\n262 6 Filtering for Attitude Estimation and Calibration\n\n0 15 30 45 60 75 90\n0\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n9\n\n10\n\n11\n\n12\n\nTime (Min)\n\nA\nva\n\nila\nbl\n\ne \nSt\n\nar\ns\n\n0 15 30 45 60 75 90\n?2\n?1\n\n0\n1\n2 x 10\n\n?3\n\nx 10\n?3\n\n0 15 30 45 60 75 90\n?2\n?1\n\n0\n1\n2\n\n0 15 30 45 60 75 90\n?0.02\n?0.01\n\n0\n0.01\n0.02\n\nTime (Min)\n\nR\nol\n\nl \n(D\n\neg\n)\n\nP\nit\nch\n\n (\nD\n\neg\n)\n\nY\naw\n\n (\nD\n\neg\n)\n\n0 15 30 45 60 75 90\n?0.1\n\n0\n0.1\n\n0.2\n0.3\n\n0 15 30 45 60 75 90\n?0.1\n\n0\n0.1\n\n0.2\n0.3\n\n0 15 30 45 60 75 90\n?0.1\n\n0\n\n0.1\n\n0.2\n0.3\n\nTime (Min)\n\nb 1\n (\nD\n\neg\n/H\n\nr)\nb 2\n\n (\nD\n\neg\n/H\n\nr)\nb 3\n\n (\nD\n\neg\n/H\n\nr)\n\na\n\nb c\n\nFig. 6.3 Mission mode extended Kalman filter results. (a) Number of available stars. (b) Attitude\nerrors and 3? bounds. (c) Gyro drift estimates\n\npractice the gyros are sampled at a much higher frequency, which is usually required\nfor jitter control. The initial covariance for the attitude error is set to 0:12 deg2,\nand the initial covariance for the gyro drift is set to 0:22 (deg/h)2. Converting these\nquantities to radians and seconds gives the initial attitude and gyro drift covariances\nfor each axis: P a0 D 3:0462 ? 10?6 rad2 and P b0 D 9:4018 ? 10?13 (rad/s)2, so\nthat the initial covariance matrix is given by P0 D diag\u0152P a0 P a0 P a0 P b0 P b0 P b0 ?.\nThe initial attitude estimate for the EKF is given by the true quaternion, which is\ngiven by qtrue0 D\n\np\n2=2 ? \u01520 1 0 1?T . The initial gyro drift biases in the EKF are\n\nset to zero.\nFigure 6.3a shows a plot of the number of available stars. Note that at a few times\n\nonly one star is available, so the static attitude determination methods of Chap. 5\ncannot be employed at these times. However, this is not an issue with the EKF\nsince an update is still possible even with one star. Note that an EKF-based solution\nis possible unless there is never more than one star available and it is always the\nsame star. Figure 6.3b shows a plot of the attitude errors and associated 3? bounds.\n\n\n\n6.3 Farrenkopf\u2019s Steady-State Analysis 263\n\nClearly, the computed 3? bounds do indeed bound the attitude errors. Note that the\nyaw errors are much larger than the roll and pitch errors because the boresight of\nthe star tracker is along the yaw axis. Figure 6.3c shows that the EKF is able to\naccurately estimate the gyro drift bias. The \u201cdrift\u201d in this plot looks very steady,\ndue to the fact that a high-grade three-axis gyro has been used in the simulation.\nThis example clearly shows the power of the EKF, which has been successfully\napplied for attitude estimation of many spacecraft. The unscented Kalman filter\nprovides a more robust approach to initial condition errors [11].\n\n6.3 Farrenkopf\u2019s Steady-State Analysis\n\nIn this section we consider the case of single-axis attitude estimation with an angle\nmeasurement and gyro outputs used in place of a dynamic model. The single angle\ncase is useful because Farrenkopf found a closed-form solution for its Kalman\nfilter error-covariance [15]. We will use an alternative derivation that includes an\nadditional source of gyro errors not included in Farrenkopf\u2019s original analysis [26].\n\nThe true single-axis attitude angle ? true obeys the kinematic equation\n\nP? true D ! true (6.95)\n\nwhere ! true is the true angular velocity. A rate-integrating gyro measures an angle\n?RIG, which is the integral of\n\nP?RIG D ! D ! true C ?true C ?v (6.96)\n\nwhere ! is the rate sensed by the gyro, which is corrupted by the gyro drift ?true and\na zero-mean Gaussian white-noise process ?v with spectral density ?2v . The drift rate\nis modeled by a random walk process, given by\n\nP?true D ?u (6.97)\n\nwhere ?u is a zero-mean Gaussian white-noise process with spectral density given\nby ?2u . Thus the three-component state x D \u0152? true ?true ?RIG?T obeys the discrete-\ntime propagation equation\n\nx.t C ?t/ D\n2\n4\n1 0 0\n\n0 1 0\n\n0 ?t 1\n\n3\n5 x.t/C\n\n2\n4\n1\n\n0\n\n1\n\n3\n5 ?? true C\n\n2\n4\n0\n\nNu\nNv\n\n3\n5 (6.98)\n\n\n\n264 6 Filtering for Attitude Estimation and Calibration\n\nIn this equation ?t is the interval between gyro measurements and is not assumed to\nbe infinitesimal. The angular motion ?? true, the integral of ! true over ?t , is also not\ninfinitesimal. The quantities Nu and Nv are defined by\n\nNu D\nZ tC?t\nt\n\n?u.t\n0/dt 0 (6.99a)\n\nNv D\nZ tC?t\nt\n\n?\n?v.t\n\n0/C .t C ?t ? t 0/?u.t 0/\n?\ndt 0 (6.99b)\n\nNow we will use the gyro measurement in place of the unknown angular\nmotion ?? true. This is what we mean by saying that we use the gyros as a replacement\nfor a dynamic model. The gyro measurement at the end of the propagation interval is\n\n?out.t C ?t/ D ?RIG.t C ?t/C ve D\n?\n0 ?t 1\n\n?\nx.t/C ?? true CNv C ve (6.100)\n\nwhere ve is a zero-mean Gaussian measurement noise with variance ?2e . We assume\nthat ?u, ?v , and ve are uncorrelated. Solving this equation for ?? true in terms of\n?out.t C ?t/ and substituting back into Eq. (6.98) gives\n\nx.t C ?t/D\n2\n4\n1 0 0\n\n0 1 0\n\n0 ?t 1\n\n3\n5 x.t/C\n\n2\n4\n1\n\n0\n\n1\n\n3\n5??out.tC?t/? ?0 ?t 1? x.t/?Nv?ve\n\n?C\n2\n4\n0\n\nNu\nNv\n\n3\n5\n\nD\n2\n4\n1 ??t ?1\n0 1 0\n\n0 0 0\n\n3\n5 x.t/C\n\n2\n4\n1\n\n0\n\n1\n\n3\n5 ?out.t C ?t/C\n\n2\n4\n?Nv ? ve\n\nNu\n?ve\n\n3\n5 (6.101)\n\nThis is the discrete-time state propagation equation with the gyros used in dynamic\nmodel replacement mode. Because ?u, ?v , and ve have zero mean, the expectation\nOx ? Efxg and the state error vector ?x ? x ? Ox obey\n\nOx.t C ?t/ D ?.?t/ Ox.t/C\n2\n4\n1\n\n0\n\n1\n\n3\n5 ?out.t C ?t/ (6.102a)\n\n?x.t C ?t/ D ?.?t/?x.t/C\n2\n4\n?Nv ? ve\n\nNu\n?ve\n\n3\n5 (6.102b)\n\nwhere\n\n?.?t/ D\n2\n4\n1 ??t ?1\n0 1 0\n\n0 0 0\n\n3\n5 (6.103)\n\n\n\n6.3 Farrenkopf\u2019s Steady-State Analysis 265\n\nThe covariance P ? Ef?x?xT g propagates according to\n\nP.t C ?t/ D ?.?t/P.t/?T .?t/CQ.?t/ (6.104)\n\nwhere\n\nQ.?t/ D E\n\n8?\n<\n:?\n\n2\n4\n?Nv ? ve\n\nNu\n?ve\n\n3\n5\n2\n4\n?Nv ? ve\n\nNu\n?ve\n\n3\n5\nT\n9>=\n>;\n\nD\n\n2\n666664\n\n?2v ?t C 13?2u ?t3 C ?2e ? 12?2u ?t2 ?2e\n\n? 1\n2\n?2u ?t\n\n2 ?2u ?t 0\n\n?2e 0 ?\n2\ne\n\n3\n777775\n\n(6.105)\n\nThe expectation calculations involved inQ.?t/ are very similar to the computations\nin Sect. 4.7.1. It is easy to show by mathematical induction that propagation by n\nsteps gives\n\nP.t C n?t/ D ?.n?t/P.t/?T .n?t/CQ.n?t/ (6.106)\n\nThis equation has two remarkable properties. The first is that it depends only on\nthe total propagation time n?t and not on n and ?t separately. The second is that the\nnoise term ?e does not accumulate, so that the covariance only depends on the output\nnoise of the last readout.\n\nNow assume that we have measurements from an angle sensor at an interval ?t\nthat is some multiple of the gyro measurement time. It doesn\u2019t matter what the angle\nsensor is, but we assume that its measurement variance is the scalar ?2n . We want to\nfind a steady-state solution for the covariance, which means that we have the same\ncovariance P? before every angle sensor measurement and the same covariance\nPC after every measurement update. These obey the Kalman filter propagation and\nupdate equations (see Table 12.2)\n\nP? D ?.?t/PC?T .?t/CQ.?t/ (6.107a)\nPC D P? ? P?HT .HP?HT C ?2n/?1HP? (6.107b)\n\nThe measurement sensitivity matrix is H D \u0152 1 0 0 ?, so HP?HT is a scalar. Equa-\ntion (6.107) are equivalent to 12 coupled scalar equations for the 12 independent\ncomponents of the symmetric covariance matrices P? and PC. Solving them is\nstraightforward but difficult, so we will just state the solution:\n\n\n\n266 6 Filtering for Attitude Estimation and Calibration\n\nP? D ?2n\n\n2\n666664\n\n?2 ? 1 ?? Su=?t S2e\n\n?? Su=?t\n?\n? ? .1C S2e /??1 C 12Su\n\n?\nSu=?t\n\n2 0\n\nS2e 0 S\n2\ne\n\n3\n777775\n\n(6.108a)\n\nPC D ?2n\n\n2\n666664\n\n1 ? ??2 ???1Su=?t ??2S2e\n\n???1Su=?t\n?\n? ? .1C S2e /??1 ? 12Su\n\n?\nSu=?t\n\n2 ??1S2e Su=?t\n\n??2S2e ??1S2e Su.?t/?1 S2e .1 ? ??2S2e /\n\n3\n777775\n\n(6.108b)\n\nwhere\n\nSu ? ?u?t3=2=?n (6.109a)\nSv ? ?v?t1=2=?n (6.109b)\nSe ? ?e=?n (6.109c)\n\nand where ? obeys the quartic equation\n\n0 D ?4 ? Su?3 ?\n?\n2.1C S2e /C S2v ? S2u =6\n\n?\n?2 ? .1C S2e /Su? C .1C S2e /2\n\nD ??2 ? 2.? C Su=4/? C 1C S2e\n? ?\n?2 C 2.? ? Su=4/? C 1C S2e\n\n?\n(6.110)\n\nwith\n\n? ?\nr\n1C S2e C\n\n1\n\n4\nS2v C\n\n1\n\n48\nS2u (6.111)\n\nEquation (6.110) has four roots, but the only root giving a positive definite PC is\nthe largest one, namely\n\n? D ? C 1\n4\nSu C 1\n\n2\n\nr\n2?Su C S2v C\n\n1\n\n3\nS2u (6.112)\n\nWe are not interested in the entire covariance matrix. The quantities of greatest\ninterest are the standard deviation of the angle estimate, which is the square root\nof the 1?1 component of the covariance, and the standard deviation of the drift\nestimate, which is the square root of the 2?2 component. The standard deviations\nprior to the sensor update are\n\n\n\n6.3 Farrenkopf\u2019s Steady-State Analysis 267\n\n??? D ?n\np\n?2 ? 1 (6.113a)\n\n? ?? D\np\n2?n?u?t\n\n?1=4\nq\n? ? .1C S2e /??1 C Su=2 (6.113b)\n\nand after the update\n\n?C? D ?n\np\n1 ? ??2 (6.114a)\n\n?C? D\np\n2?n?u?t\n\n?1=4\nq\n? ? .1C S2e /??1 (6.114b)\n\nIf ?e D 0, the third columns and third rows of Q, P?, and PC are all zero,\nreflecting the fact that the gyro measurements give perfect knowledge of ?RIG. In this\ncase, the covariance propagation and update equations are equivalent to\n\nQP? D Q? .?t/ QPC Q? T .?t/C QQ.?t/ (6.115a)\nQPC D QP? ? QP? QHT . QH QP? QHT C ?2n/?1 QH QP? (6.115b)\n\nwhere QP?, QP?, QPC, QQ, and Q? are the upper-left 2 ? 2 blocks of P?, PC, Q, and\n? with ?e D 0, respectively, and QH D \u0152 1 0 ?. This is the model originally analyzed\nby Farrenkopf, and it is the basis of most of the Kalman filters used on spacecraft\nand presented in this text. It corresponds to the dynamical model of Eqs. (6.95)\nand (6.38) with S true D 0, namely\n\nP? true D ! ? ?true ? ?v (6.116a)\nP?true D ?u (6.116b)\n\nThis is the dynamical model that was used in Farrenkopf\u2019s original paper, and it has\nbeen used by guidance and control engineers for many years [15]. It was the basis\nfor the analysis in Sect. 4.7.1 and will be employed extensively in this chapter.\nIt is useful to retain the dependence on gyro electronic noise ?e for covariance\nestimates, though.\n\nFigure 6.4 shows the pre- and post-update angle standard deviations for angle\nsensor update times between 0.01 and 100 s for parameters characteristic of a ring\nlaser gyro with very low drift: ?v D 0:025 deg/h1=2 D 7:27?rad/s1=2 and ?u D\n3:7 ? 10?3 deg/h3=2 D 3 ? 10?4 ?rad/s3=2. The angle sensor is assumed to be a star\ntracker having measurement noise with standard deviation ?n D 15?rad. The solid\ncurves are for ?e D 5?rad, and the dashed curves are for ?e D 0. It is clear from\nthe figure that gyro output white noise is only important for frequent star tracker\nupdates, and that it causes the estimation accuracy to fall more slowly in that limit.\n\nIn the limiting case of very frequent updates, the pre-update and post-update\nattitude error standard deviations both approach constant values if ?e \u00a4 0. In this\ncase ? ? ? ?p1C S2e and\n\n\n\n268 6 Filtering for Attitude Estimation and Calibration\n\n0.01 0.1 1 10 100\n1\n\n10\n\n100\n\nsq\n?\n\nsq\n+\n\nFig. 6.4 Steady-state attitude estimation standard deviations, solid curves for ?e D 5?rad, dashed\ncurves for ?e D 0\n\n??? ! ?e; and ?C? !\n?e?np\n?2e C ?2n\n\n(6.117)\n\nIf ?e D 0, the frequent-update case approaches the continuous-update limit,\ngiven by\n\n??? ! ?n.S2v C 2Su/1=4 D ?t1=4?1=2n\n?\n?2v C 2?n?u?t1=2\n\n\t1=4\n(6.118)\n\nThe even simpler limiting form when the contribution of ?u to the attitude error is\nnegligible is given by\n\n??? ! ?t1=4.?n?v/1=2 (6.119)\n\nwhich indicates a one-half power dependence on both ?n and ?v , and a one-fourth\npower dependence on the update time ?t . This shows why it is extremely difficult\nto improve the attitude performance by simply increasing the update frequency.\nTo lowest order in ?u, the standard deviation of the gyro drift bias approaches\n\n? ?? ! .?u?v/1=2 (6.120)\n\nin the frequent update limit, regardless of whether or not ?e is zero. The fact that the\nattitude covariance has a \u201cfloor\u201d determined by ?e reveals a shortcoming of using\ngyros in model replacement mode. Rotational inertia prevents the spacecraft from\n\n\n\n6.4 Magnetometer Calibration 269\n\nexecuting motions on the order of ?e on very short time scales, and a filter incorpo-\nrating actual spacecraft dynamics would reflect this fact. The extra computational\neffort cannot be justified if Farrenkopf\u2019s covariance estimates indicate that mission\nrequirements can be met without dynamic modeling.\n\nFarrenkopf\u2019s equations bound the expected attitude and bias errors to provide an\ninitial estimate of attitude performance. Using the noise parameters of Example 6.2\nin Eq. (6.119) gives an approximate 3? bound of 6:96?rad for the attitude error,\nwhich is very to close the actual solution of 7:18 ?rad. Even though the actual\nmodel is not a single-axis model, Farrenkopf\u2019s analysis can provide good estimates\nfor various gyro parameters and sampling intervals. Converting 6:96 ?rad to\ndegrees gives 4 ? 10?4 deg, which closely matches the roll and pitch errors of the\nresults shown in Fig. 6.3b.\n\n6.4 Magnetometer Calibration\n\nA paramount issue to the attitude accuracy obtained using magnetometer measure-\nments is the precision of the onboard calibration. The accuracy obtained using\na three-axis magnetometer (TAM) depends on a number of factors, including:\nbiases, scale factors, and non-orthogonality corrections. Scale factors and non-\northogonality corrections occur because the individual magnetometer axes are\nnot orthonormal, typically due to thermal gradients within the magnetometer or\nto mechanical stress from the spacecraft [1]. Magnetometer calibration is often\naccomplished using batch methods, where an entire set of data must be stored\nto determine the unknown parameters. This process is often repeated many times\nduring the lifetime of a spacecraft in order to ensure that the best possible precision\nis obtained from magnetometer measurements.\n\nThe magnetometer calibration problem is easy to solve if an accurate attitude\nestimate is known a priori. However, this is generally not the case. Fortunately,\nthe norms of the body-measurement and geomagnetic-reference vectors provide\nan attitude-independent scalar observation. For the noise-free case, these norms\nare identical because the attitude matrix preserves the length of a vector. This\nprocess is also known as \u201cscalar checking\u201d [22]. Unfortunately, even for the simpler\nmagnetometer-bias determination problem, the loss function to be minimized is\nquartic in nature. Gambhir proposed the most common technique to overcome this\ndifficulty, a \u201ccentering\u201d approximation to yield a quadratic loss function that can be\nminimized using simple linear least squares [17]. Alonso and Shuster expand upon\nGambhir\u2019s approach by using a second step that employs the centered estimate as\nan initial value to an iterative nonlinear least squares approach. Their algorithm,\ncalled \u201cTWOSTEP\u201d [2], has been shown to perform well when other algorithms fail\ndue to divergence problems. The algorithm presented here is Alonso and Shuster\u2019s\nextension of this approach to perform a complete calibration involving biases as well\nas scale factors and non-orthogonality corrections [1]. All of these approaches are\nbased on batch processing. A realtime approach is shown in [9].\n\n\n\n270 6 Filtering for Attitude Estimation and Calibration\n\n6.4.1 Measurement Model\n\nIn this section the TAM measurement model and attitude-independent observation\nare summarized. More details on these concepts can be found in [1]. The magne-\ntometer measurements can be modeled as\n\nBk D .I3 CDtrue/?1.OT Atruek Rk C btrue C ?k/; k D 1; 2; : : : ; N (6.121)\n\nwhere Bk is the measurement of the magnetic field by the magnetometer at time\ntk , Rk is the corresponding value of the geomagnetic field with respect to the\nEarth-Centered/Earth-Fixed (ECEF) system, Atruek is the unknown attitude matrix\nof the magnetometer with respect to the Earth-fixed coordinates, Dtrue is an\nunknown fully-populated matrix of scale factors (the diagonal elements) and non-\northogonality corrections (the off-diagonal elements), O is an orthogonal matrix\n(see [1] for a discussion on the physical connotations of this matrix), btrue is the\nbias vector, ?k is the measurement noise vector that is assumed to be a zero-\nmean Gaussian process with covariance ?k , and N is the total number of available\nmeasurements. The matrix Dtrue can be assumed to be symmetric without loss of\ngenerality, because any skew-symmetric contribution is equivalent to a rotation that\ncan be absorbed into O:\n\nDtrue D\n2\n4\nDtrue11 D\n\ntrue\n12 D\n\ntrue\n13\n\nDtrue12 D\ntrue\n22 D\n\ntrue\n23\n\nDtrue13 D\ntrue\n23 D\n\ntrue\n33\n\n3\n5 (6.122)\n\nThe goal of the full attitude-independent calibration problem is to estimateDtrue and\nbtrue, because an attitude-independent method cannot observe O .\n\nAn attitude-independent approach is possible by computing\n\nyk ? kBkk2 ? kRkk2\n\nD ?BTk \u01522Dtrue C .Dtrue/2?Bk C 2BTk .I3 CDtrue/btrue ? kbtruek2 C vk\n(6.123)\n\nwhere the effective noise is given by\n\nvk ? 2\u0152.I3 CDtrue/Bk ? btrue?T ?k ? k?kk2 (6.124)\nThe effective noise is approximately Gaussian with mean?k ? E fvkg and variance\n?2k ? E\n\n?\nv2k\n? ? ?2k given by\n\n?k D ?tr.?k/ (6.125a)\n?2k D 4\u0152.I3 CDtrue/Bk ? btrue?T ?k\u0152.I3 CDtrue/Bk ? btrue?C 2\n\n?\ntr?2k\n\n\t\n\n(6.125b)\n\n?k D E\n?\n?k?\n\nT\nk\n\n?\n(6.125c)\n\n\n\n6.4 Magnetometer Calibration 271\n\nNote that the measurement variance is a function of the unknown parameters.\nThe attitude-independent measurement in Eq. (6.123) is highly nonlinear in the\n\ncalibration parameters. We can define a modified state vector so that the nonlinear\ndependence appears in only one term. To accomplish this task the following\nquantities are first defined:\n\nE true ? 2Dtrue C .Dtrue/2 D\n2\n4\nE true11 E\n\ntrue\n12 E\n\ntrue\n13\n\nE true12 E\ntrue\n22 E\n\ntrue\n23\n\nE true13 E\ntrue\n23 E\n\ntrue\n33\n\n3\n5 (6.126a)\n\nctrue ? .I3 CDtrue/btrue (6.126b)\n\nSk ?\nh\nB21k B\n\n2\n2k\nB23k 2B1kB2k 2B1kB3k 2B2kB3k\n\niT\n(6.126c)\n\nEtrue ? ?E true11 E true22 E true33 E true12 E true13 E true23\n?T\n\n(6.126d)\n\nNote that E true is also symmetric. The attitude-independent measurement can now\nbe written as\n\nyk D Lkx0true ? kb.x0true/k2 C vk (6.127)\nwhere the row vector Lk and the modified state vector x0true are defined by\n\nLk ?\n?\n2BTk ?STk\n\n?\n(6.128a)\n\nx0true ? ?.ctrue/T .Etrue/T ?T (6.128b)\n\nNow the only nonlinear dependence on x0true is in the term kb.x0true/k2.\nEquation (6.127) can be solved by iteration. We start with an initial estimate Ox00,\n\nwhich can be zero, and compute\n\nOx0i D P 0\nNX\nkD1\n\n1\n\n?2k\n\n?\nyk C kb.Ox0i?1/k2 ? ?k\n\n\t\nLTk for i D 1; 2; : : : (6.129)\n\nwhere N is the number of observations and\n\nP 0 D\n \n\nNX\nkD1\n\n??2k LTk Lk\n\n!?1\n(6.130)\n\nThe iteration is terminated when Ox0i ? Ox0i?1 is less than some chosen tolerance.\nThis computation requires the conversion from Ox0 back to the variables b and\n\nD [1]. The conversion of the true and estimated quantities is identical. Since E is\nsymmetric its singular value decomposition is given by\n\nE D U S UT (6.131)\n\n\n\n272 6 Filtering for Attitude Estimation and Calibration\n\nwhere U is orthogonal and S is diagonal with elements s1, s2, and s3. To determine\nD first compute the following elements of a diagonal matrix W :\n\nwj D ?1C\np\n1C sj ; j D 1; 2; 3 (6.132)\n\nThen the matrix D is given by\n\nD D U W UT (6.133)\n\nThe vector b is simply given by\n\nb D .I3 CD/?1c (6.134)\n\n6.4.2 Centered Solution\n\nThe centering approximation effectively removes the nonlinear dependence of kbk2\nin Eq. (6.127), making it possible to develop a solution for the calibration parameters\nthat does not require iteration [17]. We define center variables, indicated by an\noverbar, and centered variables, indicated by a breve, as follows:\n\nN?2 ?\n \n\nNX\nkD1\n\n??2k\n\n!?1\n(6.135a)\n\nNL ? N?2\nNX\nkD1\n\n??2k Lk; MLk ? Lk ? NL (6.135b)\n\nNy ? N?2\nNX\nkD1\n\n??2k yk; Myk ? yk ? Ny (6.135c)\n\nNv ? N?2\nNX\nkD1\n\n??2k vk; Mvk ? vk ? Nv (6.135d)\n\nN? ? N?2\nNX\nkD1\n\n??2k ?k; M?k ? ?k ? N? (6.135e)\n\nThe center variables and centered variables have the measurement models\n\nNy D NL x0true ? kb.x0true/k2 C Nv (6.136a)\nMyk D MLkx0true C Mvk (6.136b)\n\n\n\n6.4 Magnetometer Calibration 273\n\nNote that Eq. (6.136b) is now linear in x0true, so linear least squares can be employed.\nThe centering process has introduced correlations among the noise terms Mvk ,5 but\nthese are generally ignored in practice, giving the centered estimate, OMx0 and its\napproximate covariance, MP 0, as [2]\n\nMP 0 D\n \n\nNX\nkD1\n\n??2k MLTk MLk\n!?1\n\n(6.137a)\n\nOMx0 D MP 0\nNX\nkD1\n\n??2k . Myk ? M?k/ MLTk (6.137b)\n\nSince the centered solution is linear, a sequential formulation can be derived to\nprovide realtime estimates. First, the sequential formulas for the averaged quantities\nare given by\n\nNLkC1 D 1\n?2kC1 C N?2k\n\n?\n?2kC1 NLk C N?2kLkC1\n\n\t\n(6.138a)\n\nNykC1 D 1\n?2kC1 C N?2k\n\n?\n?2kC1 Nyk C N?2kykC1\n\n\t\n(6.138b)\n\nN?kC1 D 1\n?2kC1 C N?2k\n\n?\n?2kC1 N?k C N?2k?kC1\n\n\t\n(6.138c)\n\nwhere\n\nN?2kC1 D\n? N??2k C ??2kC1\n\n\t?1\n(6.139)\n\nNext, the following centered variables are defined:\n\nMLkC1 ? LkC1 ? NLkC1 (6.140a)\nMykC1 ? ykC1 ? NykC1 (6.140b)\nM?kC1 ? ?kC1 ? N?kC1 (6.140c)\n\nFinally, the sequential formulas for the centered estimate of OMx0 and covariance MP 0\nare given by\n\nKkC1 ? MP 0k MLTkC1\n\n MLkC1 MP 0k MLTkC1 C ?2kC1\n\n??1\n(6.141a)\n\nOMx0kC1 D OMx\n0\nk CKkC1\n\n\nMykC1 ? M?kC1 ? MLkC1 OMx0k\n\n?\n(6.141b)\n\n5Note, in particular, that\nPN\n\nkD1 ?\n?2\nk Mvk D 0.\n\n\n\n274 6 Filtering for Attitude Estimation and Calibration\n\nMP 0kC1 D .I9 ?KkC1 MLkC1/ MP 0k (6.141c)\n\nNote that only an inverse of a scalar quantity is required in this process, which can\nbe initialized using a small batch of data. Also, there is an approach for determining\n?2kC1 that uses the previous estimate in Eq. (6.125b).\n\n6.4.3 The TWOSTEP Algorithm\n\nThe second step of the TWOSTEP algorithm uses a nonlinear maximum likelihood\nminimization to find the optimal estimate of x0true. The first step computes the\ncentered solution to initialize the nonlinear least squares iteration process. The data-\ndependent part of the negative log-likelihood function to be minimized in the second\nstep is:\n\nJ.x0true/ D 1\n2\n\nNX\nkD1\n\n?\n1\n\n?2k\n.yk ? Lkx0true C kb.x0true/k2 ? ?k/2 C log ?2k\n\n?\n(6.142)\n\nThe partial derivative of h.x0/ ? Lkx0 ? kb.x0/k2 with respect to x0 is required\nfor the nonlinear least squares iterations. The partial of Lkx0 is simply given by LTk .\nThe partial derivatives of kb.x0/k2 are given by\n\n@kb.x0/k2\n@cm\n\nD 2\u0152.I3 CE/?1c?m (6.143a)\n\n@kb.x0/k2\n@Emn\n\nD ?.2 ? ?mn/\u0152.I3 CE/?1c?m\u0152.I3 CE/?1c?n (6.143b)\n\nwhere \u0152.I3CE/?1c?m is themth element of .I3CE/?1c. As mentioned previously,\nthe least squares solution process typically ignores the nonlinear dependence of ?2k\non the unknown parameters.\n\nOnce estimates Oc and OE for ctrue and E true are found, the estimates Ob and OD for\nbtrue and Dtrue can be determined using Eqs. (6.133) and (6.134). Define\n\nOx ?\nh ObT ODT\n\niT\n(6.144a)\n\nOD ? ? OD11 OD22 OD33 OD12 OD13 OD23\n?T\n\n(6.144b)\n\nThe covariance associated with Ox, denoted P , must be computed from P 0, the\ncovariance of Ox0, which is given by Eqs. (12.98) and (12.99) as the inverse of the\nFisher information matrix. The conversion to P is computed by\n\nP D @.\nOb; OD/\n\n@.Oc; OE/ P\n0\n\"\n@. Ob; OD/\n@.Oc; OE/\n\n#T\n(6.145)\n\n\n\n6.4 Magnetometer Calibration 275\n\nNote that in actuality the true variables should be used instead of the estimated ones\nin Eq. (6.145). However, since the true variables are unknown the estimated ones are\nused instead. The partials can be computed using\n\n@. Ob; OD/\n@.Oc; OE/ D\n\n\"\n@.Oc; OE/\n@. Ob; OD/\n\n#?1\nD\n?\nI3 C OD McD. Ob/\n06?3 MED. OD/\n\n??1\n(6.146a)\n\nMcD. Ob/ D\n\n2\n64\nOb1 0 0 Ob2 Ob3 0\n0 Ob2 0 Ob1 0 Ob3\n0 0 Ob3 0 Ob1 Ob2\n\n3\n75 (6.146b)\n\nMED. OD/ D 2 I6 C\n\n2\n66666664\n\n2 OD11 0 0 2 OD12 2 OD13 0\n0 2 OD22 0 2 OD12 0 2 OD23\n0 0 2 OD33 0 2 OD13 2 OD23\nOD12 OD12 0 OD11C OD22 OD23 OD13\nOD13 0 OD13 OD23 OD11C OD33 OD12\n0 OD23 OD23 OD13 OD12 OD22C OD33\n\n3\n77777775\n\n(6.146c)\n\nA strategy to handle the dependence of ?2k on the parameters is to first assume b\ntrue\n\nand Dtrue are zero to compute ?2k and employ the nonlinear least squares iteration\nprocess. Then use the estimates of btrue andDtrue to determine a new ?2k and employ\nanother nonlinear least squares iteration process. This refinement strategy continues\nuntil the estimates no longer change. In many cases this refinement strategy needs\nonly one iteration.\n\nExample 6.3. In this example, results of the TWOSTEP and centered formulations\nare shown using simulated data. The simulated spacecraft is modeled after the\nTRMM spacecraft. This is an Earth-pointing spacecraft (rotating about its y-axis)\nin low-Earth orbit with an inclination of 35? [3]. The geomagnetic field is simulated\nusing a 10th-order International Geomagnetic Reference Field (IGRF) model [20].\nThe magnetometer-body and geomagnetic-reference vectors for the simulated runs\neach have a magnitude of about 50 micro-Tesla (?T). The measurement noise is\nassumed to be white and Gaussian, and the covariance is taken to be isotropic with\na standard deviation of 0.05 ?T. The measurements are sampled every 10 s over an\n8-h span. The true values for the bias b and elements of the D matrix are shown in\nTable 6.4. Large values for the biases are used to test the robustness of the centered\nand TWOSTEP algorithms.\n\nOne thousand runs have been executed, which provide a Monte Carlo simulation.\nShown in Table 6.4 are the averaged batch solutions given by the TWOSTEP and\ncentered algorithms, each with their computed 3? bounds. Both the centered and\nTWOSTEP algorithms do a good job at estimating all parameters in the mean sense,\nbut the centered algorithm has larger variations than the TWOSTEP algorithm.\n\n\n\n276 6 Filtering for Attitude Estimation and Calibration\n\nTable 6.4 Results using\nsimulated magnetic field data\n\nParameter Truth Centered TWOSTEP\n\nb1 5 ?T 4:9972? 0:3373 4:9983? 0:0445\nb2 3 ?T 3:0157? 0:2549 2:9841? 0:0525\nb3 6 ?T 5:9955? 0:5447 5:9972? 0:0464\nD11 0:05 0:0500? 0:0035 0:0500? 0:0002\nD22 0:10 0:1001? 0:0023 0:0994? 0:0020\nD33 0:05 0:0500? 0:0094 0:0500? 0:0003\nD12 0:05 0:0499? 0:0027 0:0499? 0:0010\nD13 0:05 0:0499? 0:0054 0:0499? 0:0002\nD23 0:05 0:0499? 0:0045 0:0499? 0:0010\n\n0 100 200 300 400 500 600 700 800 900 1000\n2.5\n\n3\n\n3.5\n\n4\n\n4.5\n\n5\n\n5.5\n\n6\n\n6.5\n\n7\n\nB\nia\n\ns \nE\n\nst\nim\n\nat\nes\n\n (\nm\n\nT\n)\n\nB\nia\n\ns \nE\n\nst\nim\n\nat\nes\n\n (\nm\n\nT\n)\n\nRun Number\n\n0 100 200 300 400 500 600 700 800 900 1000\n2.5\n\n3\n\n3.5\n\n4\n\n4.5\n\n5\n\n5.5\n\n6\n\n6.5\n\n7\n\nRun Number\n\na b\n\nFig. 6.5 (a) Centered and (b) TWOSTEP bias estimates\n\nThis can also be seen in Fig. 6.5, which plots the bias estimates for each Monte\nCarlo run. Results using colored noise, which is more realistic, can be found in [1].\n\n6.4.4 Extended Kalman Filter Approach\n\nThis section presents an EKF to determine the calibration parameters in real\ntime [9]. An advantage of this formulation over the sequential centered approach\nis that it computes Ob and OD directly without a conversion from Oc and OE. Since the\nparameters to be estimated are constant, the state dynamic model is POx.t/ D 0, where\nOx is the state vector defined by Eq. (6.144). The measurement model of Eq. (6.123)\nis written as yk D hk.xtrue/C vk , where using Eq. (6.126) gives\n\nhk.xtrue/ D ?STk Etrue.Dtrue/C 2BTk .I3 CDtrue/btrue ? kbtruek2 (6.147)\n\nSince no process noise appears in the state model, the updated quantities (state and\ncovariance) are given by their respective propagated quantities. The EKF equations,\nwhich can be found in Chap. 12, then reduce to\n\n\n\n6.4 Magnetometer Calibration 277\n\nOxkC1 D Oxk CKk\u0152ykC1 ? hkC1.Oxk/? (6.148a)\nPkC1 D \u0152I9 ?KkHkC1.Oxk/?Pk (6.148b)\n\nKk D PkHTkC1.Oxk/\n?\nHkC1.Oxk/PkHTkC1.Oxk/C ?2kC1.Oxk/\n\n??1\n(6.148c)\n\nwhere P is the covariance of the estimated parameters for btrue and Dtrue. The state\ndependence of the measurement variance is shown through Eq. (6.125b). The 1 ? 9\nmeasurement sensitivity matrix H.x/ is given by\n\nH.x/ ? @h.x/\n@x\nD ?2BT .I3 CD/ ? 2bT ?STMED. OD/C 2J\n\n?\n(6.149)\n\nwhere S is defined by Eq. (6.126c), MED. OD/ by Eq. (6.146c), and\n\nJ ? ?B1b1 B2b2 B3b3 B1b2 C B2b1 B1b3 C B3b1 B2b3 C B3b2\n?\n\n(6.150)\n\nThe sensitivity matrix H.Ox/ in the EKF evaluates H.x/ at its current estimate, and\nthe notations hkC1.Oxk/, HkC1.Oxk/, and ?2kC1.Oxk/ denote an evaluation at the k C 1\ntime-step measurement using BkC1 and at the k time-step estimate using Oxk .\n\n6.4.5 TRACE Spacecraft Results\n\nIn this section, EKF results using real data from the Transition Region And Coronal\nExplorer (TRACE) spacecraft are shown. TRACE is in a Sun-synchronous low-\nEarth orbit. The data collected for the spacecraft is given during an inertial pointing\nmode. The errors associated with the geomagnetic field model are typically spatially\ncorrelated and may be non-Gaussian in nature [6]. This violates the assumptions for\nall the estimators shown in this text. We still assume that the measurement noise is\nwhite and Gaussian, but the standard deviation is now increased to a value of 0.3\n?T, which bounds the errors in a practical sense. The measurements are sampled\nevery 3 s over a 6-h span.\n\nThe EKF initializes every component of the state vector to zero at time t D 0.\nThe initial covariance matrix is diagonal, given by\n\nP0 D blkdiag .\u0152I3 0:0001I6?/ .?T/2 (6.151)\n\nwhere blkdiag denotes a block diagonal matrix of appropriate dimension.\nFigure 6.6a shows EKF estimates for the bias vector. Figure 6.6b shows the 3?\nbounds for the bias estimates. Note that the bias estimates with the larger 3?\nbounds have greater variability, which is due to the relative observability between\nparameters (the second bias is the least observable parameter in this case). Similar\nresults are obtained for the D matrix parameters.\n\n\n\n278 6 Filtering for Attitude Estimation and Calibration\n\n0 1 2 3 4 5 6\n?1\n\n?0.8\n\n?0.6\n\n?0.4\n\n?0.2\n\n0\n\n0.2\n\n0.4\n\nTime (Hr)\n\n0 1 2 3 4 5 6\n0\n\n0.1\n\n0.2\n\n0.3\n\n0.4\n\n0.5\n\n0.6\n\n0.7\n\n0.8\n\n0.9\n\n1\n\nTime (Hr)\n\nb1\nb2\nb3\n\n3s\n B\n\nou\nnd\n\ns \n(m\n\nT\n)\n\nB\nia\n\ns \nE\n\nst\nim\n\nat\nes\n\n (\nm\n\nT\n)\n\nb1\nb2\nb3\n\na b\n\nFig. 6.6 TRACE bias estimates and 3? bounds. (a) EKF bias estimates. (b) EKF 3? bounds\n\n0 1 2 3 4 5 6\n?1\n\n?0.5\n\n0\n\n0.5\n\n1\n\n0 1 2 3 4 5 6\n?0.5\n\n?0.25\n\n0\n\n0.25\n\n0.5\n\nTime (Hr)\n\nU\nnc\n\nal\nib\n\nra\nte\n\nd \n(m\n\nT\n)\n\nC\nal\n\nib\nra\n\nte\nd \n\n(m\nT\n\n)\n\nFig. 6.7 Norm residual using\nreal TRACE data\n\nAn investigation of the residuals between the norm of the estimated vector, using\nthe uncalibrated and calibrated body vectors, and the geomagnetic-reference vector\nis useful to check the consistency of the results. A plot of these residuals is shown\nin Fig. 6.7. A spectrum analysis shows the presence of sinusoidal variations with\nperiods equivalent to the orbital period (? 90 min) and higher-order harmonics\n(see [6] for a model of this process). Clearly, the uncalibrated results have higher\nresiduals than the calibrated results. This shows the power of using an onboard\ncalibration algorithm that can be executed in real time.\n\nProblems\n\n6.1. Derive the relations in Eq. (6.33).\n\n6.2. Derive the measurement sensitivity matrix in Eq. (6.66).\n\n6.3. Prove that Eq. (6.79) is a good approximation to Eq. (6.78) if \t is very close\nto Atruer.\n\n\n\nProblems 279\n\nTable 6.5 Orbital elements for GPS satellites\n\nGPS Orbital elements\n\n1 a D 26;560 km, e D 2:6221? 10?3, M0 D ?82:277 deg, i D 55:037 deg\n?0 D 46:492 deg, P? D ?4:4332? 10?7 deg/s, ! D 24:008 deg\n\n2 a D 26;561 km, e D 1:2955? 10?2, M0 D ?38:066 deg, i D 53:808 deg\n?0 D 44:973 deg, P? D ?4:5511? 10?7 deg/s, ! D ?144:31 deg\n\n3 a D 26;561 km, e D 1:6708? 10?2, M0 D ?27:429 deg, i D 53:692 deg\n?0 D ?22:198 deg, P? D ?4:8392? 10?7 deg/s, ! D 77:836 deg\n\n4 a D 26;560 km, e D 1:0645? 10?2, M0 D 154:02 deg, i D 53:751 deg\n?0 D 45:899 deg, P? D ?4:5708? 10?7 deg/s, ! D 61:387 deg\n\n5 a D 26;561 km, e D 3:5214? 10?3, M0 D 89:435 deg, i D 54:277 deg\n?0 D 106:11 deg, P? D ?4:6624? 10?7 deg/s, ! D 21:164 deg\n\n6 a D 26;560 km, e D 8:3880? 10?3, M0 D 78:699 deg, i D 54:067 deg\n?0 D ?17:551 deg, P? D ?4:7738? 10?7 deg/s, ! D ?10:890 deg\n\n6.4. The state transition matrix obeys the following relationships:\n\n?.t; t/ D 0\nd\n\ndt\n?.t; ?/ D F.t/?.t; ?/\n\nProve that the discrete error-state transition matrix in Eq. (6.83) obeys these\nrelationships.\n\n6.5. Prove that ?11 defined by Eq. (6.83b) is an orthogonal matrix.\n\n6.6. Reproduce the simulation results of Example 6.2 using Murrell\u2019s approach.\n\n6.7. In this problem you will develop an EKF program for attitude estimation using\nGPS phase difference measurements discussed in Sect. 5.9. First, propagate six GPS\nsatellites using the algorithm in Table 4.1 with orbital elements given in Table 6.5\nand a time of applicability given by ta D 61;440 s. Next, create the GPS receiver\nspacecraft orbit in GCI coordinates using the algorithm in Table 10.1 with the\nfollowing orbital elements: a D 6777:3 km, e D 1:584 ? 10?4, M0 D 93:4312?,\ni D 34:9654?, ? D 346:4609?, and ! D 266:6234?. Convert this GCI-based\norbit into ECEF coordinates using Eq. (2.67) with an epoch of January 5, 2014 at\n17:03:47. Use an interval of 0.1 s with a total run time of 600 s for both the GPS\nsatellites and the receiver spacecraft. Then, create sightline vectors using Eq. (4.23).\n\nAssuming an initial quaternion of qtrue0 D\np\n2=2 ? \u01520 1 0 1?T , propagate the\n\nattitude using an angular velocity of !.t/ D \n=180 ? \u01520 0 0:1?T rad/s for all time.\nCreate synthetic phase difference measurements using the following equation:\n\nzij D bTi A.qtrue/sj C vij\n\n\n\n280 6 Filtering for Attitude Estimation and Calibration\n\nwhere vij is a zero-mean Gaussian noise process with standard deviation of\n0:026 cm. The three baseline vectors are given by\n\nb1 D\n?\n100 0 0\n\n?T\ncm\n\nb2 D\n?\n0 100 0\n\n?T\ncm\n\nb3 D\n?\n100 100 0\n\n?T\ncm\n\nCreate synthetic gyro measurements using the model shown in Eq. (4.54) with S D\n0, ?u D\n\np\n10 ? 10?10 rad/s3=2, and ?v D\n\np\n10 ? 10?7 rad/s1=2. Sample the gyro\n\nmeasurements using an interval of 0.1 s. The initial bias for each axis is given by\n0.1 deg/h. The initial covariance for the attitude error is set to .1=3/2 deg2, and the\ninitial covariance for the gyro drift is set to 12 (deg/h)2. Converting these quantities\nto (rad/s)2 gives the following initial attitude and gyro drift covariances for each\naxis: P a0 D 0:3385?10?4 rad2 and P b0 D 0:2350?10?10 .rad/s/2, so that the initial\ncovariance is given by\n\nP0 D diag\n?\nP a0 P\n\na\n0 P\n\na\n0 P\n\nb\n0 P\n\nb\n0 P\n\nb\n0\n\n?\n\nUse the discrete-time covariance propagation in Eq. (12.132) with $k D I6, and ?k\nand Qk given by Eqs. (6.83) and (6.93), respectively. The initial attitude condition\nin the EKF is given by the true quaternion. The initial gyro bias conditions in the\nEKF are set to zero. Plot the attitude estimate errors along with their respective 3?\nbounds and gyro bias estimates obtained from the EKF simulation results.\n\n6.8. Another linearization approach for the MEKF involves defining the attitude\nerrors in inertial space by using [16]\n\nqtrue D Oq? ?q.?#/\n\nShow that the linearized F.t/ andG.t/matrices for the mission mode Kalman filter\nare given by\n\nF.t/ D\n?\n03?3 ?AT . Oq/\n03?3 03?3\n\n?\n; G.t/ D\n\n??AT . Oq/ 03?3\n03?3 I3\n\n?\n\nDerive the new Hk.Ox?k / matrix and quaternion update equation for this approach.\nRedo Example 6.2 using this new filter and compare the results to the standard\nMEKF given in Table. Note that Eq. (6.11) is used to compute the attitude errors\nfor both filters. So the attitude portion of the error-covariance for the inertial-space\nMEKF must be rotated from inertial space to body space for this comparison.\n\n6.9. Derive the discrete error-state transition matrix from the matrix F.t/ given in\nProblem 6.8. Also, derive the discrete-time covariance using Eq. (6.84) from your\nderived discrete error-state transition matrix and the matrix G.t/ in Problem 6.8.\n\n\n\nProblems 281\n\n6.10. In this exercise you will use the MEKF to estimate the attitude from TAM\nand Sun sensors as well as gyro measurements. The first step involves determining\nthe position of the spacecraft. Assume the following orbital elements: a D\n6777:2745 km, e D 0:0001584, M0 D 93:4312?, i D 34:9654?, ? D 346:4609?,\nand ! D 266:6234?. The epoch is March 31, 2011 at 02:32:41. Determine the\nposition and velocity of the spacecraft using Table 10.1 with a time interval of 10 s\nand a total run time of 8 h. Next, compute the reference magnetic field using the\ndipole model in Eq. (11.5) and the reference Sun vector and Sun availability using\nthe methods shown in Sect. 11.3. The true initial attitude is given by Eq. (2.79). The\nconstant angular velocity vector is ! D \u01520 ? 1:13156 ? 10?3 0?T rad/s.\n\nSimulate TAM sensor noise using a Gaussian white-noise process with a mean of\nzero and a standard deviation of 50 nT per axis. Here is assumed that one Sun sensor\nis used and its axes are aligned with the body axes of the spacecraft. The Sun sensor\nnoise is also modeled by a Gaussian white-noise process with a mean of zero\nand a standard deviation of 0.05? per axis. Simulate gyro measurements using\nEqs. (4.31) and (4.32) of Sect. 4.7.1, with ?u D\n\np\n10 ? 10?10 rad/s3=2, and\n\n?v D\np\n10 ? 10?7 rad/s1=2. The initial bias for each axis is given by 0.1 deg/h. The\n\ninitial covariance for the attitude error is set to .1=3/2 deg2 per axis, and the initial\ncovariance for the gyro drift is set to 12 (deg/h)2 per axis. Converting these quantities\nto radians and seconds gives the following initial attitude and gyro drift covariances\nfor each axis: P a0 D 0:3385 ? 10?4 rad2 and P b0 D 0:2350 ? 10?10 .rad/s/2, so that\nthe initial covariance is given by\n\nP0 D diag\n?\nP a0 P\n\na\n0 P\n\na\n0 P\n\nb\n0 P\n\nb\n0 P\n\nb\n0\n\n?\n\nUse the discrete-time covariance propagation in Eq. (12.132) with $k D I6,\nand ?k and Qk given by Eqs. (6.83) and (6.93), respectively. All sensors are\nsampled at 10-s intervals. Run the MEKF using the TAM, available Sun and gyro\nmeasurements. Set the initial attitude estimate to the true quaternion and set all\ninitial bias estimates to zero. Plot the attitude errors along with their respective 3?\nbounds, as well as the estimated gyro biases.\n\n6.11. Perform the following quaternion multiplication in Eq. (6.33):\n\n1\n\n2\n\n?\n?!\n\n0\n\n?\n?\n?\n?q1W3\n?q4\n\n?\n\nand show the exact nonlinear differential equations for ? Pq1W3 and ? Pq4. Next, consider\nthe following error-MRP:\n\n?p D ?q1W3\n1C ?q4\n\nTake the time derivative of ?p, substitute in the quantities for ?q1W3, ?q4, and their\nrespective derivatives, in terms of ?p, to develop the exact nonlinear differential\n\n\n\n282 6 Filtering for Attitude Estimation and Calibration\n\nequation for ? Pp. Next using the approximation ?p ? ?#=4, show that the first-order\nequation for ? P# is given by Eq. (6.35).\n6.12. In this exercise you will develop an MEKF based on the MRPs. Here it\nis assumed that MRP measurements are given using the following discrete-time\nmeasurement model:\n\np D vp ? ptrue D\n?\n1 ? kptruek2\t vp C\n\n?\n1 ? kvpk2\n\n\t\nptrue ? 2 vp ? ptrue\n\n1C kptruek2kvpk2 ? 2 vp ? ptrue\n\nwhere vp is a zero-mean Gaussian white-noise process with covariance Rp .\nAssuming that the signal-to-noise ratio is large, show that this equation can be\napproximated by\n\np ? ptrue C NR vp\nwhere\n\nNR ? ?1 ? kptruek2\t I3 C 2 \u0152ptrue??C 2 .ptrue/ .ptrue/T\n\nTherefore, the covariance of p, denoted by R, is given by R D NRRp NRT . The\nmultiplicative error-MRP is given by ?p D ptrue ? Op?1. The small angle approxi-\nmation is given by ?p ? ?#=4, where the kinematic equation for ?# is given by\nEq. (6.35). The mission mode multiplicative MRP propagation equations are given\nin Table 6.3, replacing the quaternion kinematics with the MRP kinematics, given\nby Eq. (3.24). Derive the multiplicative MRP update equation using a state vector\n\ngiven by?OxCk ? \u0152? O#\nCT\nk ?\n\nO?CT\nk ?\n\nT and the MRP measurement model shown above.\nNext, program the MEKF MRP equations to estimate the attitude and gyro\n\nbiases from MRP measurements. The initial condition for the true MRP is given\nby ptrue0 D \u01520:3 0:1 ? 0:5?T and the true angular rate for all time is given by\n!true.t/ D \u0152?0:2 0:2 ? 0:192?T deg/s. Generate synthetic MRP measurements\nusing a covariance of Rp D .20=3;600/ ? .\n=180/I3 and take MRP samples at 5-s\nintervals. Simulate gyro measurements using Eqs. (4.31) and (4.32) of Sect. 4.7.1,\nwith ?u D\n\np\n10 ? 10?10 rad/s3=2, and ?v D\n\np\n10 ? 10?7 rad/s1=2. The initial bias\n\nis given by ?true0 D \u0152?1 2 ? 3?T deg/h. Sample the gyro measurements at 0.5-s\nintervals. Set the initial state estimate to zeros for both the MRPs and gyro biases.\nSet the initial covariance matrix to\n\nP0 D diag\u0152P a0 P a0 P a0 P b0 P b0 P b0 ?\n\nwith P a0 D 16 ? 0:175 rad2 and P b0 D 0:005 (rad/s)2. Use the discrete-time\ncovariance propagation in Eq. (12.132) with $k D I6, and ?k and Qk given by\n\n\n\nReferences 283\n\nEqs. (6.83) and (6.93), respectively. Use a total simulation run time of 200 min. Plot\nthe attitude errors along with their respective 3? bounds, as well as the estimated\ngyro biases.\n\n6.13. This problem has two parts:\n\na) Derive Eq. (6.99b).\nb) Derive the Q matrix in Eq. (6.105).\n\n6.14. Prove Eq. (6.106) by mathematical induction.\n\n6.15. Show that Eqs. (6.108) and (6.110) satisfy Eqs. (6.107).\n\n6.16. Derive the relations in Eqs. (6.113) and (6.114).\n\n6.17. Show that the dynamic model of Eq. (6.116) leads to the covariance propaga-\ntion and update given by (6.115).\n\n6.18. Derive the asymptotic limits in Eqs. (6.117)\u2013(6.120).\n\n6.19. Redo the simulation shown in Example 6.3. Pick various truth values for the\nbiases and Dij calibration parameters as well as various noise levels to assess the\nrobustness of the centered and TWOSTEP algorithms.\n\nReferences\n\n1. Alonso, R., Shuster, M.D.: Complete linear attitude-independent magnetometer calibration.\nJ. Astronaut. Sci. 50(4), 477\u2013490 (2002)\n\n2. Alonso, R., Shuster, M.D.: TWOSTEP: A fast robust algorithm for attitude-independent\nmagnetometer-bias determination. J. Astronaut. Sci. 50(4), 433\u2013451 (2002)\n\n3. Andrews, S.F., Bilanow, S.: Recent flight results of the TRMM Kalman filter. In: AIAA\nGuidance, Navigation and Control Conference. Monterey (2002). AIAA 2002-5047\n\n4. Andrews, S.F., Morgenstern, W.M.: Design, implementation, testing, and flight results of the\nTRMM Kalman filter. In: AIAA Guidance, Navigation and Control Conference. Boston\n(1998). AIAA 1998-4509\n\n5. Carmi, A., Oshman, Y.: On the covariance singularity of quaternion estimators. In: AIAA\nGuidance, Navigation and Control Conference. Hilton Head (2007). AIAA 2007-6814\n\n6. Crassidis, J.L., Andrews, S.F., Markley, F.L., Ha, K.: Contingency designs for attitude deter-\nmination of TRMM. In: Proceedings of the Flight Mechanics/Estimation Theory Symposium,\npp. 419\u2013433. NASA-Goddard Space Flight Center, Greenbelt (1995)\n\n7. Crassidis, J.L., Cheng, Y., Nebelecky, C.K., Fosbury, A.M.: Decentralized attitude estimation\nusing a quaternion covariance intersection approach. J. Astronaut. Sci. 57(1/2), 113\u2013128 (2009)\n\n8. Crassidis, J.L., Junkins, J.L.: Optimal Estimation of Dynamic Systems, 2nd edn. CRC Press,\nBoca Raton (2012)\n\n9. Crassidis, J.L., Lai, K.L., Harman, R.R.: Real-time attitude-independent three-axis magne-\ntometer calibration. J. Guid. Contr. Dynam. 28(1), 115\u2013120 (2005)\n\n10. Crassidis, J.L., Markley, F.L.: Attitude estimation using modified Rodrigues parameters. In:\nProceedings of the Flight Mechanics/Estimation Theory Symposium, pp. 71\u201383. NASA-\nGoddard Space Flight Center, Greenbelt (1996)\n\n11. Crassidis, J.L., Markley, F.L.: Unscented filtering for spacecraft attitude estimation. J. Guid.\nContr. Dynam. 26(4), 536\u2013542 (2003)\n\n\n\n284 6 Filtering for Attitude Estimation and Calibration\n\n12. Crassidis, J.L., Markley, F.L., Cheng, Y.: Survey of nonlinear attitude estimation methods.\nJ. Guid. Contr. Dynam. 30(1), 12\u201328 (2007)\n\n13. Farrell, J.L.: Attitude determination by Kalman filtering. Contractor Report NASA-CR-598,\nNASA Goddard Space Flight Center, Washington, DC (1964)\n\n14. Farrell, J.L.: Attitude determination by Kalman filtering. Automatica 6, 419\u2013430 (1970)\n15. Farrenkopf, R.L.: Analytic steady-state accuracy solutions for two common spacecraft attitude\n\nestimators. J. Guid. Contr. 1(4), 282\u2013284 (1978)\n16. Gai, E., Daly, K., Harrison, J., Lemos, L.: Star-sensor-based attiude/attitude rate estimator.\n\nJ. Guid. Contr. Dynam. 8(5), 560\u2013565 (1985)\n17. Gambhir, B.: Determination of magnetometer biases using Module RESIDG. Tech. Rep. 3000-\n\n32700-01TN, Computer Sciences Corporation (1975)\n18. Idan, M.: Estimation of Rodrigues parameters from vector observations. IEEE Trans. Aero.\n\nElectron. Syst. 32(2), 578\u2013586 (1996)\n19. Karlgaard, C.D., Schaub, H.: Nonsingular attitude filtering using modified Rodrigues parame-\n\nters. J. Astronaut. Sci. 57(4), 777\u2013791 (2010)\n20. Langel, R.A.: The main field. In: Jacobs, J.A. (ed.) Geomagnetism, pp. 249\u2013512. Academic\n\nPress, Orlando (1987)\n21. Lefferts, E.J., Markley, F.L., Shuster, M.D.: Kalman filtering for spacecraft attitude estimation.\n\nJ. Guid. Contr. Dynam. 5(5), 417\u2013429 (1982)\n22. Lerner, G.M.: Three-axis attitude determination. In: Wertz, J.R. (ed.) Spacecraft Attitude\n\nDetermination and Control, chap. 12. Kluwer Academic, Dordrecht (1978)\n23. Markley, F.L.: Attitude error representations for Kalman filtering. J. Guid. Contr. Dynam.\n\n26(2), 311\u2013317 (2003)\n24. Markley, F.L.: Attitude estimation or quaternion estimation? J. Astronaut. Sci. 52(1 & 2),\n\n221\u2013238 (2004)\n25. Markley, F.L.: Lessons learned. J. Astronaut. Sci. 57(1 & 2), 3\u201329 (2009)\n26. Markley, F.L., Reynolds, R.G.: Analytic steady-state accuracy of a spacecraft attitude estimator.\n\nJ. Guid. Contr. Dynam. 23(6), 1065\u20131067 (2000)\n27. Murrell, J.W.: Precision attitude determination for multimission spacecraft. In: Proceedings of\n\nthe AIAA Guidance, Navigation, and Control Conference, pp. 70\u201387. Palo Alto (1978)\n28. Pandiyan, R., Solaiappan, A., Malik, N.: A one step batch filter for estimating gyroscope\n\ncalibration parameters using star vectors. In: AIAA/AAS Astrodynamics Specialist Conference\nand Exhibit. Providence (2004). AIAA 04-4858\n\n29. Pauling, D.C., Jackson, D.B., Brown, C.D.: SPARS algorithms and simulation results. In:\nProceedings of the Symposium on Spacecraft Attitude Estimation, vol. 1, pp. 293\u2013317.\nAerospace Corporation, El Segundo (1969)\n\n30. Pittelkau, M.E.: Kalman filtering for spacecraft system alignment calibration. J. Guid. Contr.\nDynam. 24(6) (2001)\n\n31. Pittelkau, M.E.: An analysis of the quaternion attitude determination filter. J. Astronaut. Sci.\n51(1) (2003)\n\n32. Psiaki, M.L., Klatt, E.M., Kintner Jr., P.M., Powell, S.P.: Attitude estimation for a flexible\nspacecraft in unstable spin. J. Guid. Contr. Dynam. 25(1), 88\u201395 (2002)\n\n33. Psiaki, M.L., Theiler, J., Bloch, J., Ryan, S., Dill, R.W., Warner, R.E.: ALEXIS spacecraft\nattitude reconstruction with thermal/flexible motions due to launch damage. J. Guid. Contr.\nDynam. 20(5), 1033\u20131041 (1997)\n\n34. Reynolds, R.G.: Asymptotically optimal attitude filtering with guaranteed covergence. J. Guid.\nContr. Dynam. 31(1), 114\u2013122 (2008)\n\n35. Shuster, M.D.: Kalman filtering of spacecraft attitude and the QUEST model. J. Astronaut.\nSci. 38(3), 377\u2013393 (1990)\n\n36. Shuster, M.D.: Constraint in attitude estimation part I: Constrained estimation. J. Astronaut.\nSci. 51(1), 51\u201374 (2003)\n\n37. Shuster, M.D.: Constraint in attitude estimation part II: Unconstrained estimation. J. Astronaut.\nSci. 51(1), 75\u2013101 (2003)\n\n\n\nReferences 285\n\n38. Shuster, M.D., Pitone, D.S.: Batch estimation of spacecraft sensor alignments, II. Absolute\nalignment estimation. J. Astronaut. Sci. 39(4), 547\u2013571 (1991)\n\n39. Toda, N.F., Heiss, J.L., Schlee, F.H.: SPARS: The system, algorithms, and test results. In:\nProceedings of the Symposium on Spacecraft Attitude Estimation, vol. 1, pp. 361\u2013370.\nAerospace Corporation, El Segundo (1969)\n\n40. van Loan, C.F.: Computing integrals involving the matrix exponential. IEEE Trans. Automat.\nContr. AC-23(3), 396\u2013404 (1978)\n\n41. Ward, D.K., Davis, G.T., O\u2019Donnell Jr., J.R.: The Microwave Anisotropy Probe guidance, nav-\nigation and control hardware suite. In: AIAA Guidance, Navigation and Control Conference.\nMonterey (2002). AIAA 2002-4579\n\n42. Zanetti, R., Majji, M., Bishop, R.H., Mortari, D.: Norm-constrained Kalman filtering. J. Guid.\nContr. Dynam. 32(5), 1458\u20131465 (2009)\n\n\n\nChapter 7\nAttitude Control\n\n7.1 Introduction\n\nSpacecraft attitude control is essential to meet mission pointing requirements, such\nas required science modes and thruster pointing requirements for orbital maneuvers.\nEarly spacecraft mission designs used passive spin stabilization to hold one axis\nrelatively fixed by spinning the spacecraft around that axis, usually the axis of\nmaximum moment of inertia. Spin stabilization was mostly used due to the limited\ncontrol actuation and lack of sophisticated computer technology to implement\ncomplex control laws. Spin-stabilized spacecraft are very stable, but they have to\nbe sensitively balanced; every component has to be designed and located with\nspacecraft balance in mind. This can be extremely difficult to accomplish to the\nrequired accuracy. In most cases the last few weights are added and adjusted\nonly after actual flight hardware is delivered and installed, and the spacecraft is\nexperimentally spin tested. Allowances must also be made for everything onboard\nthat can move during flight.\n\nIn the modern era advancements in sensors, actuators, and computer processors\nallow for three-axis stabilized spacecraft designs, although spinners are still used to\nthis day for many missions. Attitude control law theory also has been extensively\nstudied and advanced, allowing for guaranteed control stability even with nonlinear\nattitude dynamics. The control of spacecraft for large angle slewing maneuvers\nposes a difficult problem, however. These difficulties include the highly nonlinear\ncharacteristics of the governing equations, control rate, and saturation constraints\nand limits, and incomplete state knowledge due to sensor failure or omission.\nThe control of spacecraft with large angle slews can be accomplished by either open-\nloop or closed-loop schemes. Open-loop schemes usually require a pre-determined\npointing maneuver and are typically determined using optimal control techniques,\nwhich involve the solution of a two-point boundary value problem (e.g. the time\noptimal maneuver problem [37]). Open-loop schemes are sensitive to spacecraft\n\nF.L. Markley and J.L. Crassidis, Fundamentals of Spacecraft Attitude Determination\nand Control, Space Technology Library 33, DOI 10.1007/978-1-4939-0802-8__7,\n\u00a9 Springer Science+Business Media New York 2014\n\n287\n\n\n\n288 7 Attitude Control\n\nparameter uncertainties and unexpected disturbances [47]. Closed-loop systems\ncan account for parameter uncertainties and disturbances, and thus provide a more\nrobust design methodology.\n\nFor many years now, much effort has been devoted to the closed-loop design of\nlarge angle slews. In [50] a number of simple control schemes are derived using\nquaternion and angular velocity (rate) feedback. Asymptotic stability is shown\nby using a Lyapunov function analysis for all cases. Reference [45] expands\nupon these formulations by deriving simple control laws based on both a Gibbs\nvector parameterization and a modified Rodrigues parameterization, each with rate\nfeedback. Lyapunov functions are shown for all the controllers developed in [45]\nas well. Other full state feedback techniques have been developed that are based\non variable-structure (sliding-mode) control, which uses a feedback linearizing\ntechnique and an additional term aimed at dealing with model uncertainty [41]. This\ntype of control has been successfully applied for large angle maneuvers using a\nGibbs vector parameterization [18], a quaternion parameterization [15, 46], and a\nmodified Rodrigues parameterization [13]. Another robust control scheme using\na nonlinear H1 control methodology has been developed in [22]. This scheme\ninvolves the solution of Hamilton-Jacobi-Isaacs inequalities, which essentially\ndetermines feedback gains for the full state feedback control problem so that\nthe spacecraft is stabilized in the presence of uncertainties and disturbances.\nAnother class of controllers involves adaptive techniques, which update the model\nduring operation based on measured performances (e.g. see [41]). An adaptive\nscheme which estimates external torques by tracking a Lyapunov function has been\ndeveloped by [35]. This method has been shown to be very robust in the presence of\nspacecraft modeling errors and disturbances.\n\nThe aforementioned techniques all utilize full state knowledge (i.e. attitude and\nrate feedback). The problem of controlling a spacecraft without full state feedback\nis more complex. The basic approaches used to solve this problem can be divided\ninto methods which estimate the unmeasured states using a filter algorithm and\nmethods which develop control laws directly from output feedback. Filtering\nmethods of Chap. 6, such as the extended Kalman filter, have been successfully\napplied on numerous spacecraft systems without the use of rate-integrating gyro\nmeasurements (e.g. see [9, 11, 14]). An advantage of these methods is that the\nattitude may be estimated by using only one set of vector attitude observations\n(such as magnetometer observations). However, these methods are usually much\nless accurate than methods that use gyro measurements. A more direct technique has\nbeen developed in [25], which solves the attitude problem without rate knowledge.\nThis method is based on a passivity approach, which replaces the rate feedback by\na nonlinear filter of the quaternion. A model-based filter reconstructing the angular\nvelocity is not needed in this case.\n\nThis chapter presents the fundamental concepts for modern spacecraft control\ndesigns. First, attitude control laws are developed using both external torques\nand reaction wheels for both regulation and tracking cases. An example from a\nreal mission, the Wilkinson Microwave Anisotropy Probe (WMAP), is shown for\nattitude tracking. Next, attitude thruster control is discussed using pulse-width\n\n\n\n7.2 Attitude Control: Regulation Case 289\n\npulse-frequency modulation. This is followed by attitude control using magnetic\ntorquers for both detumbling and momentum dumping. Then, the effects of noise\non the control systems are discussed and mitigation approaches are shown. Finally,\nan actual attitude control system design, based on the SAMPEX spacecraft, is\nshown. This spacecraft design is useful to show the combined effects of using filters\nshown in Chap. 6 with linear controllers to meet mission designs.\n\n7.2 Attitude Control: Regulation Case\n\nRegulation control is defined as bringing the attitude to some fixed location (usually\nthe identity quaternion) and the angular velocity to zero. The quaternion attitude\nkinematics and Euler\u2019s rotational equation of motion are given in Chap. 3 (removing\nsuperscripts here for brevity):\n\nPq D 1\n2\n?.q/! D 1\n\n2\n?.!/q (7.1a)\n\nJ P! D ?\u0152!??J!C L (7.1b)\n\nThe goal is to drive the actual quaternion to some commanded and constant\nquaternion denoted by qc . This requires that the angular velocity approach zero.\nThe error quaternion is given by\n\n?q ?\n?\n?q1W3\n?q4\n\n?\nD q? q?1c (7.2)\n\nwhere\n\n?q1W3 D ?T .qc/q (7.3a)\n?q4 D qT qc (7.3b)\n\nTaking the time derivative of Eq. (7.2) gives\n\n? Pq D Pq? q?1c (7.4)\n\nSubstituting Eq. (7.1a) into Eq. (7.4) and using Eq. (7.2) leads to\n\n? Pq D 1\n2\n?.!/?q (7.5)\n\nUsing the definition of ?.!/, the differential equations for ?q1W3 and ?q4 are\nspecifically given by\n\n\n\n290 7 Attitude Control\n\n? Pq1W3 D 1\n2\n\u0152?q1W3??!C 1\n\n2\n?q4! (7.6a)\n\n? Pq4 D ?1\n2\n?qT1W3! (7.6b)\n\nThe goal of the controller is to drive ! to zero and ?q to the identity quaternion\nIq D \u01520 0 0 1?T .\n\nSeveral feedback controllers are presented in [50]. The first is given by\n\nL D ?kp ?q1W3 ? kd ! (7.7)\n\nwhere kp and kd are positive scalar gains. Substituting Eq. (7.7) into Eq. (7.1b) gives\nthe closed-loop system governed by Eq. (7.5) and\n\nP! D ?J?1 ?\u0152!??J!C kp?q1W3 C kd!\n\t\n\n(7.8)\n\nThe only equilibrium point is \u0152?qT1W3 !T ?T D 0.\nStability is proven using Lyapunov\u2019s direct method. Reference [50] uses a\n\ndifference between the actual and command quaternions in the definition of the\ncandidate Lyapunov function. Here, a multiplicative approach is employed, which\nleads to the same result as in [50] but is more intuitive in terms of the quaternion\nerror kinematics. Define the following candidate Lyapunov function:\n\nV D 1\n4\n!T J!C 1\n\n2\nkp ?qT1W3?q1W3 C\n\n1\n\n2\nkp .1 ? ?q4/2 ? 0 (7.9)\n\nNote that V D 0 when ! D 0 and ?q D Iq , which is the equilibrium point. The\ntime derivative of V is given by\n\nPV D 1\n2\n!T J P!C kp ?qT1W3? Pq1W3 ? kp .1 ? ?q4/? Pq4 (7.10)\n\nSubstituting Eqs. (7.6) and (7.8) into Eq. (7.10) gives\n\nPV D ?1\n2\n\n?\n!T ?q1W3\n\n\t ?\nkp C kp?q4 ? kp.1C ?q4/\n\n? ? 1\n2\nkd !\n\nT!\n\nD ?1\n2\nkd !\n\nT! ? 0 (7.11)\n\nThus, the closed-loop system is stable since PV ? 0.\nAsymptotic stability can be proven using LaSalle\u2019s theorem (see Sect. 12.2.2).\n\nThe equality in Eq. (7.11) is given when ! D 0, where ?q1W3 can be anything.\nWe must check that the system cannot remain in a state where PV D 0 while\n?q1W3 \u00a4 0. Equation (7.11) guarantees that limt!1! D 0. The closed-loop\ndynamics in Eq. (7.8) shows that this asymptotic condition can only be achieved\n\n\n\n7.2 Attitude Control: Regulation Case 291\n\nif limt!1 ?q1W3 D 0 also. Thus, this control law asymptotically reorients the\nspacecraft to the desired attitude from an arbitrary initial orientation. Note that ?q4\ncan be?1, but this does not matter since both signs produce the same attitude.\n\nHowever, the control law in Eq. (7.7) does not guarantee that the shortest path is\nprovided to the final orientation. This becomes an issue when the fourth component\nof the initial error quaternion is negative. Reference [50] shows two other control\nlaws that overcome this issue. One of them is a slight modification of Eq. (7.7),\ngiven by\n\nL D ?kp sign.?q4/?q1W3 ? kd ! (7.12)\n\nNote that if ?q4 < 0 then a positive feedback term is introduced, which provides\nthe shorter path to reach the desired equilibrium point. Thus Eq. (7.12) is always\npreferred over Eq. (7.7) unless ?q4 D 0 exactly, which is not a concern for practical\napplications.\n\nThe control law in Eq. (7.7) is linear in the state. Nonlinear control laws can also\nbe used. Consider the following control law:\n\nL D ?kp ?q1W3 ? kd .1? ?qT1W3?q1W3/! (7.13)\n\nThis law also produces a globally asymptotic stable response, which can be proven\nusing Lyapunov\u2019s direct method (which is left as an exercise for the reader).\nWhen the minus sign is used then by the quaternion unity constraint we have\n1 ? ?qT1W3?q1W3 D ?q24 . The shortest distance control law can be achieved by using\n\nL D ?kp sign.?q4/?q1W3 ? kd .1? ?qT1W3?q1W3/! (7.14)\n\nThe aforementioned control laws can also be used with reaction wheels. For the\nreaction-wheel-only case Eq. (3.147) expresses Euler\u2019s rotational equation as\n\nJ P! D ?\u0152!??.J!C h/ ? Ph (7.15)\n\nwhere J now includes the transverse inertia of the wheels, h ? HwB is the\nwheel angular momentum, and Ph is the wheel torque. Note that the total angular\nmomentum, J!C h, is conserved as discussed in Sect. 3.3.5.1. An equivalent but\nmore useful form of Eq. (7.15) for control purposes is given by\n\nJ P! D ?\u0152!??J!C NL (7.16a)\nPh D ?\u0152!??h ? NL (7.16b)\n\nwhere NL is an effective wheel torque input. Adding Eqs. (7.16a) and (7.16b) shows\nthat these two equations are consistent with Eq. (7.15). Now define the following\ncontrol laws for the wheel torques:\n\n\n\n292 7 Attitude Control\n\n0 50 100 150 200 250 300\n?0.2\n\n0\n0.2\n0.4\n0.6\n0.8\n\n0 50 100 150 200 250 300\n?0.2\n\n0\n0.2\n0.4\n0.6\n0.8\n\n0 50 100 150 200 250 300\n?0.2\n?0.1\n\n0\n0.1\n0.2\n\n0 50 100 150 200 250 300\n0\n\n0.4\n\n0.8\n\n1.2\n\n?q\n1\n\n?q\n2\n\n?q\n3\n\n?q\n4\n\nTime (Sec)\n\n0 50 100 150 200 250 300\n\u201340\n\n?20\n\n0\n\n20\n\n0 50 100 150 200 250 300\n?40\n\n?20\n\n0\n\n20\n\n0 50 100 150 200 250 300\n?10\n\n?5\n\n0\n\n5\n\nL\n1 \n(N\n\nm\n)\n\nL\n2 \n(N\n\nm\n)\n\nL\n3 \n(N\n\nm\n)\n\nTime (Sec)\n\na b\n\nFig. 7.1 (a) Quaternion errors and (b) control torques\n\nNL D ?kp sign.?q4/?q1W3 ? kd ! (7.17a)\nNL D ?kp sign.?q4/?q1W3 ? kd .1? ?qT1W3?q1W3/! (7.17b)\n\nUsing the candidate Lyapunov function in Eq. (7.9) proves that these control laws\nprovide asymptotic stability with reaction wheels.\n\nExample 7.1. In this example the control law in Eq. (7.12) is used to perform a\nreorientation maneuver with large initial errors. The inertia matrix of the spacecraft\nis given by\n\nJ D\n2\n4\n10000 0 0\n\n0 9000 0\n\n0 0 12000\n\n3\n5 kg-m2\n\nThe initial quaternion is given by q.t0/ D \u01520:6853 0:6953 0:1531 0:1531?T and\nthe initial angular velocity is given by !.t0/ D \u01520:5300 0:5300 0:0530?T deg/s.\nThe desired quaternion is the identity quaternion. The control gains are set to\nkp D 50 and kd D 500. A plot of the quaternion errors is shown in Fig. 7.1a. The\nfourth error-quaternion component approaches 1 while the other three components\napproach zero. The control torques are shown in Fig. 7.1b. Note the large control\ntorques at the beginning of the maneuver, which are due to the large initial errors.\nFrom these plots it is clear that the control law provides a reorientation maneuver to\nthe desired attitude.\n\nExample 7.2. In this example the control law in Eq. (7.17a) is used to perform a\nreorientation maneuver using reaction wheels. The inertia matrix of the spacecraft\nis given by\n\n\n\n7.2 Attitude Control: Regulation Case 293\n\n0 2 4 6 8 10 12 14 16 18 20\n?0.4\n\n0\n\n0.4\n\n0.8\n\n0 2 4 6 8 10 12 14 16 18 20\n?0.04\n\n?0.02\n\n0\n\n0.02\n\n0 2 4 6 8 10 12 14 16 18 20\n?0.1\n\n0\n\n0.1\n\n0.2\n\n0 2 4 6 8 10 12 14 16 18 20\n0.6\n\n0.8\n\n1\n\n1.2\n\nTime (Min)\n\n0 2 4 6 8 10 12 14 16 18 20\n0\n\n60\n\n120\n\n180\n\n240\n\n0 2 4 6 8 10 12 14 16 18 20\n?120\n\n?80\n\n?40\n\n0\n\n40\n\n0 2 4 6 8 10 12 14 16 18 20\n0\n\n40\n\n80\n\n120\n\nh 1\n (\nN\n\nm\ns)\n\nh 2\n (\nN\n\nm\ns)\n\nh 3\n (\n\nN\nm\n\ns)\n\nTime (Min)\n\n?q\n1\n\n?q\n2\n\n?q\n3\n\n?q\n4\n\na b\n\nFig. 7.2 (a) Quaternion errors and (b) wheel momenta\n\nJ D\n2\n4\n6400 ?76:4 ?25:6\n?76:4 4730 ?40\n?25:6 ?40 8160\n\n3\n5 kg-m2\n\nThe initial quaternion is given by q.t0/ D\np\n2=2 \u01521 0 0 1?T and the initial angular\n\nvelocity is given by !.t0/ D \u01520:01 0:01 0:01?T rad/s. The desired quaternion is\nthe identity quaternion. The initial wheel momentum is set to h.t0/ D 0. The gains\nare set to kp D 10 and kd D 150. A plot of the quaternion errors is shown in\nFig. 7.2a. The fourth error-quaternion component approaches 1 while the other three\ncomponents approach zero. The wheel momenta are shown in Fig. 7.2b. Note that\nwheel momenta do not decrease to zero once the desired attitude is achieved.\nThis is due to the conservation of momentum in the spacecraft. For this case,\nsince h.t0/ D 0 then the norm of the momentum is kJ!.t0/k D 112:4586Nms.\nThe angular velocity of the spacecraft still achieves its desired zero value at the\nend of the maneuver and the momentum of the spacecraft is reoriented to perform\nthis maneuver. As before, from these plots it is clear that the control law provides a\nreorientation maneuver to the desired attitude.\n\nWe next convert the momenta from this example to two specific implementations\nof the four-wheel configurations discussed in Sect. 4.8.3, using the pseudoinverses\nof the distribution matrices:\n\nW4 D 1p\n2\n\n2\n4\n1 ?1 0 0\n1 1 1 1\n\n0 0 1 ?1\n\n3\n5 ; WN D\n\n2\n4\n1 0 0 1=\n\np\n3\n\n0 1 0 1=\np\n3\n\n0 0 1 1=\np\n3\n\n3\n5\n\nPlots of the converted momenta are shown in Fig. 7.3. Clearly, the different\nconfigurations produce different momenta for each wheel. The Euclidean norm of\nthe wheel momenta for the pyramid configuration at the final time is 96.8044 Nms,\n\n\n\n294 7 Attitude Control\n\n0 2 4 6 8 10 12 14 16 18 20\n?200\n\n?150\n\n?100\n\n?50\n\n0\n\n50\n\n100\n\n150\n1\n2\n3\n4\n\nW\nhe\n\nel\n M\n\nom\nen\n\nta\n (\n\nN\nm\n\ns)\n\nTime (Min)\n\n0 2 4 6 8 10 12 14 16 18 20\n?150\n\n?100\n\n?50\n\n0\n\n50\n\n100\n\n150\n\n200\n1\n2\n3\n4\n\nW\nhe\n\nel\n M\n\nom\nen\n\nta\n (\n\nN\nm\n\ns)\n\nTime (Min)\n\na b\n\nFig. 7.3 Comparison between wheel configurations. (a) Pyramid configuration. (b) NASA stan-\ndard configuration\n\nwhile the norm of the wheel momenta for the NASA standard configuration at the\nfinal time is 111.8695 Nms.\n\n7.3 Attitude Control: Tracking Case\n\nThe previous section described approaches to maneuver a spacecraft to a fixed\nattitude while driving the angular velocity to zero. This has applications to inertially\npointing spacecraft like the Hubble Space Telescope. This section discusses various\nforms of attitude tracking that are used to control the spacecraft to follow a desired\ntime-varying trajectory. Note that tracking also encompasses regulation by simply\nsetting the desired attitude to a constant and the desired angular velocity to zero.\nOptimal control methods that minimize a user-defined cost function are based on\nsolving two-point boundary value problems [21]. They provide the control trajectory\nover the desired time interval and cannot be executed in real time. They are very\nuseful for analysis purposes but less useful for real spacecraft mission designs,\ne.g. time-optimal control to provide rapid re-pointing of the spacecraft [37].\n\nFeedback methods are more suitable for actual attitude tracking control applica-\ntions because they can be executed in real time. Feedback-based attitude tracking\ncontrol is a widely studied topic. Most controllers are model based, e.g. they\ntypically require knowledge of the inertia matrix. No one controller can work for\nevery spacecraft mission objective in terms of pointing and jitter requirements.\nSome are more sensitive to noise effects and/or modeling errors, while others are\nsensitive to external torque disturbances, such as torques induced by solar radiation\npressure. So called \u201crobust\u201d controllers have been developed to mitigate these\nsensitivities. Here, the use of variable-structure (sliding-mode) control is shown as\n\n\n\n7.3 Attitude Control: Tracking Case 295\n\nan introduction to spacecraft tracking. Sliding-mode control is robust to arbitrary\nmodel parameter inaccuracies, but comes at the price of possibly high control\nactivity [41]. Section 12.2.3 presents a brief overview of sliding-mode control.\n\nThe sliding-mode controller developed in [15] is shown here for both the case\nof external torques and internal reaction wheels. The dynamic equation is given by\nEq. (7.1b) for the external torque case and by Eq. (7.16) for the reaction wheel case.\nFirst we must select the sliding surface. An obvious choice is to use a form that is\nsimilar to the right side of Eq. (7.7). Here the difference between the actual angular\nvelocity and the commanded angular velocity, denoted by !c , is used so that the\nsliding surface vector is given by\n\ns D .! ?!c/C k ?q1W3 (7.18)\n\nwhere k is some positive scalar constant. Note that here the commanded quaternion\nqc may be time varying, but it must be consistent with the commanded angular\nvelocity, i.e. qc must be derived from the quaternion kinematics driven by !c .\nIf s D 0 then the actual attitude and angular velocity will track the commanded\ninputs. Reference [15] shows that Eq. (7.18) can actually be derived from optimal\ncontrol theory.\n\nTaking the time derivative of Eq. (7.18) gives\n\nPs D . P! ? P!c/C k ? Pq1W3 (7.19)\n\nEvaluating Eq. (6.32) with ! ? !true and !c ? O! gives an expression for ? Pq1W3:\n\n? Pq1W3 D 1\n2\n?q4.! ?!c/C 1\n\n2\n?q1W3?.!C!c/ (7.20)\n\nSubstituting Eqs. (7.1b) and (7.20) into Eq. (7.19) gives\n\nPs D ?J?1\u0152!??J!C J?1Le ? P!c C k\n2\n\u0152?q4.! ?!c/C ?q1W3?.!C!c/? (7.21)\n\nNote that L is replaced with Le because the equivalent control law must first be\nderived, as explained in Sect. 12.2.3. As also explained in that section the time\nderivative of the Lyapunov function in Eq. (12.66) requires that Ps D 0. Using this\ncondition gives the following equivalent control law:\n\nLe D J\n\n\nk\n\n2\n\u0152?q4.!c ?!/ ? ?q1W3?.!C!c/?C P!c\n\n?\nC \u0152!??J! (7.22)\n\nAs explained in Sect. 12.2.3, a discontinuous term is added across the sliding surface\nto account for model uncertainties. In order to reduce the resulting chattering phe-\nnomenon, a saturation function is used instead of the signum function. The resulting\ncontrol law will provide the sliding-mode attitude tracking law, however it is not\n\n\n\n296 7 Attitude Control\n\nguaranteed to reorient the spacecraft in the shortest distance. Reference [15] proves\nthat the following sliding-mode control law reorients the spacecraft in the shortest\ndistance:\n\ns D .! ?!c/C k sign.?q4/?q1W3 (7.23a)\n\nL D J\n\n\nk\n\n2\n\u0152j?q4j.!c ?!/ ? sign.?q4/ ?q1W3?.!C!c/?C P!c ?G Ns\n\n?\nC \u0152!??J!\n\n(7.23b)\n\nwhere G is a positive definite matrix and the i th component of Ns is given by\n\nNsi D sat.si ; \ni /; i D 1; 2; 3 (7.24)\n\nwhere \ni is a positive quantity and si is the i th component of the sliding vector given\nby Eq. (7.23a). The saturation function is defined by\n\nsat.si ; \ni / ?\n\n8?\n<?\n\u02c6?:\n\n1 for si > \ni\n\nsi =\ni for jsi j ? \ni\n?1 for si < ?\ni\n\n(7.25)\n\nNote that Ns drives the system to the sliding surface. If reaction wheels are used\nto control the spacecraft, then as in Sect. 7.2 the same control law is used with NL\nreplacing L.\n\nThe robustness of the sliding-mode controller is now shown. We first define the\nfollowing bounded modeling errors for the inertia matrix:\n\nJ?1 D OJ?1 C ?J?1 (7.26)\n\nwhere OJ is the nominal inertia matrix. Next, neglecting the gyroscopic term in\nEuler\u2019s rotational equation and adding an external disturbance input yields\n\nP! D J?1LC J?1d (7.27)\n\nwhere d denotes a bounded disturbance input. Under these conditions the time-\nderivative of the sliding manifold can be approximated by\n\nPs D ?J?1 OJ\n\n\nk\n\n2\n\u0152j?q4j.!c ?!/ ? sign.?q4/ ?q1W3?.!C!c/?C P!c ?G Ns\n\n?\n\n? J?1 OJG NsC J?1d (7.28)\n\nwhere it is assumed that the higher-order perturbations in the inertia matrix are\nsmall. We also assume that the thickness of the boundary layer \n and the gain G are\nsufficiently large to keep the time derivative of the associated Lyapunov function\n\n\n\n7.3 Attitude Control: Tracking Case 297\n\nnegative definite in the presence of modeling errors and external disturbances.\nThen the dynamics of the sliding manifold can be approximated by\n\nPs ? ?1\n\n\nJ?1 OJG sC J?1d (7.29)\n\nTherefore, s will satisfy the inequality\n\nksk < k\n . OJG/?1k ? kdkmax (7.30)\nif the time derivative of the sliding manifold is small after all transients have\ndecayed. Equation (7.30) is valid using either external torques or reaction wheels\nin the control system.\n\nExample 7.3. In this example the sliding-mode controller is used to control the\nattitude of the WMAP spacecraft using quaternion and angular velocity obser-\nvations. The WMAP mission created a full-sky map of the cosmic microwave\nbackground and measured its anisotropy with 0.3? angular resolution in order to\nanswer fundamental cosmological questions such as the age of the universe, the\nvalue of the Hubble constant, and the existence and nature of dark matter.\n\nWMAP is in a Lissajous orbit [23] about the Earth-Sun L2 Lagrange point\nwith an approximately 180-day period (see Sect. 10.5). Because of its distance,\n1.5 million km from Earth, this orbit affords great protection from the Earth\u2019s\nmicrowave emission, magnetic fields, and other disturbances, with the dominant\ndisturbance torque being solar radiation pressure. It also provides for a very stable\nthermal environment and near 100 % observing efficiency, since the Sun, Earth,\nand Moon are always behind the instrument\u2019s field of view. In this orbit WMAP\nsees a Sun/Earth angle between 2? and 10?. The instrument scans an annulus in\nthe hemisphere away from the Sun, so the universe is scanned twice as the Earth\nrevolves once around the Sun. Reference [27] presents an overview of the WMAP\nattitude control system.\n\nThe spacecraft instruments are shown in Fig. 7.4. The spacecraft orbit and\nattitude specifications are shown in Fig. 7.5. To provide the scan pattern, the\nspacecraft spins about the z-axis at 0.464 rpm, and the z-axis cones about the Sun-\nline at 1 rev/h. A 22:5? ? 0:25? angle between the z-axis and the Sun direction\nmust be maintained to provide a constant power input, and to provide constant\ntemperatures for alignment stability and science quality. The spacecraft\u2019s attitude\nis defined by a 3?1?3 Euler angle rotation relative to a rotating, Sun-referenced\nframe. The three commanded Euler angles are ?c , ?c , and  c , and the desired states\nfor the observing mode are\n\nP?c D 1 rev\nh\nD 0:001745 rad\n\ns\n\n?c D 22:5? D 0:3927 rad\nP c D 0:464 rpm D 0:04859 rad\n\ns\n\n\n\n298 7 Attitude Control\n\nPassive Radiator\n\nOmni Antenna\nz\n\ny\n\nx\n\n1.5 m Primary\nReflector\n\nThermal Straps\n\nDiffraction\nShielding\n\nComposite\nTruss Structure\n\nUpper MLI Shield\n(20 Layers)\n\nSolar Panel\nwith 20 Layers of\nMLI on Back Side\n\n(1 of 6) \n\nLower MLI Shield\n(6 Layers)\n\nAnalog Electronics Unit (AEU)\n\nReaction Wheel\n(1 of 3)\n\nFPA is 1 m long\nSolar Panels are 1 m wide\n\nPropulsion Tank\n\nStar Tracker\n\nOmni Antenna\nMedium Gain Patch Antenna\n\n(Mounted on Sun Side)\n\nGyro\n\nThruster\n(1 of 6)\n\nLaunch Vehicle Interface Ring\n\nDigital Electronics Unit (DEU)\nPower Distribution Unit (PDU)\n\n0.52 m Secondary\nReflector with\n\nDiffraction Shielding\n\nFig. 7.4 WMAP spacecraft\n\nThe desired Euler angles for ?c and c are determined by integrating the Euler rates.\nThe scan pattern can be simulated by first multiplying the transpose of the 3?1?3\nattitude matrix, shown in Table 9.1, by the vector \u0152cos ?c 0 sin ?c?T , which gives\nthe following components:\n\na1 D cos?c cos ?c cos c ? sin?c cos2 ?c sin c C sin?c sin2 ?c\na2 D sin?c cos ?c cos c C cos?c cos2 ?c sin c ? cos?c sin2 ?c\n\na3 D cos ?c sin ?c.sin c C 1/\n\n\n\n7.3 Attitude Control: Tracking Case 299\n\nAnti-Sun\n(0\u00b0 in ecliptic plane)\n\n22.5\u00b0\n\nShaded region\nscanned in 1 hr\n\nLissajous orbit\nabout L2\n\nEarth\n\nSUN\n\n1.5 x 108 km\n\n30km/s\n\nSpin plane\n( ^ to spin axis)\n\nL2\n2.5x105 km\n\n1.5 x 106 km\n\n[ Not to Scale ]\n\nPlane ^ solar vector\n(+90\u00b0 in ecliptic plane)\n\nSpin Axis\n\nSpin Rate\n(0.464 rpm)\n\nA-side line of sight\n(22.5\u00b0 from spin plane)\n\n(?90\u00b0 in ecliptic plane)\n\nSpin Axis\nPrecession\n(1 rev / hr) B-side line of sight\n\n(22.5\u00b0 from spin plane)\n\nFig. 7.5 WMAP mission specifications\n\nThe x and y coordinates are given by\n\nx D a1\n1C a3 ; y D\n\na2\n\n1C a3\nFigure 7.6 shows the scan pattern for one complete precession (1 h), displayed in\necliptic coordinates in which the ecliptic equator runs horizontally across the map.\nThe bold circle shows the path for a single spin (2.2 min).\n\nThe commanded quaternion is determined using\n\nqc1 D sin\n?\n?c\n\n2\n\n?\ncos\n\n?\n?c ?  c\n2\n\n?\n\nqc2 D sin\n?\n?c\n\n2\n\n?\nsin\n\n?\n?c ?  c\n2\n\n?\n\nqc3 D cos\n?\n?c\n\n2\n\n?\nsin\n\n?\n?c C  c\n\n2\n\n?\n\n\n\n300 7 Attitude Control\n\nAnti-Sun\nVector\n\n+48\u00b0 +93\u00b0?48\u00b0?93\u00b0\n\nNorth Ecliptic Pole\n\nSouth Ecliptic Pole\n\nFig. 7.6 WMAP mission\nscan pattern\n\nqc4 D cos\n?\n?c\n\n2\n\n?\ncos\n\n?\n?c C  c\n\n2\n\n?\n\nThe kinematic equation that transforms the commanded Euler rates to the com-\nmanded body rates is given by Eq. (3.41) with P?c D 0:\n\n!c D\n2\n4\nP?c sin ?c sin c\nP?c sin ?c cos c\n\nP c\n\n3\n5 rad\n\ns\n\nIts derivative, which is required for the sliding-mode controller, is given by\n\nP!c D P?c P c\n2\n4\n\nsin ?c cos c\n? sin ?c sin c\n\n0\n\n3\n5 rad\n\ns2\n\nThe initial quaternion for the simulation test is given by\n\nq.t0/ D \u01520 0 sin.?=2/ cos.?=2/?T ? qc.t0/\n\nThe initial angular velocity is set to !.t0/ D 0. Three reaction wheels are used to\ncontrol the spacecraft. The initial wheel momentum is set to h.t0/ D 0. The true\ninertia matrix of the spacecraft is given by\n\nJ D\n2\n4\n399 ?2:81 ?1:31\n?2:81 377 2:54\n?1:31 2:54 377\n\n3\n5 kg-m2\n\n\n\n7.3 Attitude Control: Tracking Case 301\n\nThe nominal (assumed) inertia matrix used in the controller is given by\n\nOJ D\n2\n4\n380 ?2:81 ?1:31\n?2:81 360 2:54\n?1:31 2:54 340\n\n3\n5 kg-m2\n\nThe following external disturbance is also added:\n\nd D\n2\n4\n0:005 sin.0:05 t/\n\n0:003\n\n0:005 cos.0:05 t/\n\n3\n5 Nm\n\nThe simulation uses the following parameters: ? D 60?, k D 0:015, G D 0:15I3,\nand \n D 0:01. A plot of the angle errors is given in Fig. 7.7a. Convergence occurs\nin about 20 min. The slight oscillations are due to the disturbance. A plot of the\nangular velocity errors is shown in Fig. 7.7b, which clearly shows that the desired\nangular velocity profile is achieved. The wheel momenta are shown in Fig. 7.7c.\nNote that the total angular momentum for the spacecraft is zero because !.t0/ D 0\nand h.t0/ D 0. Therefore any increase in J! causes an equal negative value\nfor h. Figure 7.7d presents plots of the upper bound given by Eq. (7.30) and the\nactual norm of the sliding vector. This shows the effectiveness of using Eq. (7.30) to\naccurately bound the sliding manifold errors.\n\n7.3.1 Alternative Formulation\n\nWe now describe another tracking control law that we will use when we consider\nthe effects of noise [30]. First, define the following angular velocity difference:\n\n?! D ! ? ?A!c (7.31)\n\nwhere ?A D AATc . The time derivative of ?A is given by\n\n? PA D PAATc C A PATc D ?\u0152!???AC ?A\u0152!c??\nD ?\u0152!???AC ?A\u0152?AT .! ? ?!/?? D ?\u0152?!???A (7.32)\n\nwhere Eq. (2.63) has been used. The corresponding error quaternion kinematics\nequation is given by Eq. (7.5).\n\nTaking the time derivative of Eq. (7.31) and left multiplying by the inertia matrix\ngives\n\nJ ? P! D J P! ? J ? PA!c ? J ?A P!c (7.33)\n\n\n\n302 7 Attitude Control\n\n0 10 20 30 40 50 60\n?2\n\n?1\n\n0\n\n1\n\n2\n\n0 10 20 30 40 50 60\n?4\n\n?2\n\n0\n\n2\n\n4\n\n0 10 20 30 40 50 60\n?60\n\n?30\n\n0\n\n30\n\nR\nol\n\nl \n(D\n\neg\n)\n\nP\nit\nch\n\n (\nD\n\neg\n)\n\nY\naw\n\n (\nD\n\neg\n)\n\nTime (Min)\n\n0 10 20 30 40 50 60\n?0.02\n\n?0.01\n0\n\n0.01\n0.02\n\n0 10 20 30 40 50 60\n?0.02\n?0.01\n\n0\n0.01\n0.02\n\n0 10 20 30 40 50 60\n?0.2\n\n0\n\n0.2\n\n0.4\n\ndw\n3  (\n\nD\neg\n\n/S\nec\n\n)\ndw\n\n2  \n(D\n\neg\n/S\n\nec\n)\ndw\n\n1  \n(D\n\neg\n/S\n\nec\n)\n\nTime (Min)\n\n0 2 4 6 8 10 12 14 16 18 20\n?0.4\n?0.2\n\n0\n0.2\n0.4\n\n0 2 4 6 8 10 12 14 16 18 20\n?0.4\n\n?0.2\n\n0\n\n0.2\n\n0 2 4 6 8 10 12 14 16 18 20\n?20\n?19\n?18\n?17\n?16\n\nh 1\n (N\n\nm\ns)\n\nh 2\n (N\n\nm\ns)\n\nh 3\n (N\n\nm\ns)\n\nTime (Min)\n\n0 10 20 30 40 50 60\n0\n\n0.5\n\n1\n\n1.5\n\n2\n\n2.5\n\n3 x 10\n?6\n\nSl\nid\n\ne \nN\n\nor\nm\n\n a\nnd\n\n B\nou\n\nnd\n\nTime (Min)\n\na b\n\nc d\n\nFig. 7.7 WMAP simulation results. (a) Angle errors. (b) Angular velocity errors. (c) Wheel\nmomenta. (d) Slide norm and upper bound\n\nSubstituting Eqs. (7.1b) and (7.3.1) into Eq. (7.33), and after some simple algebraic\nmanipulations leads to the following dynamic equation:\n\nJ ? P! D ?.?!; !c; ?A/?! ? \u0152.?A!c/??J ?A!c ? J ?A P!c C L (7.34)\n\nwhere ?.?!; !c; ?A/ is the skew-symmetric matrix\n\n?.?!; !c; ?A/ ? \u0152.J ?!/??C\u0152.J ?A!c/???\u0152.?A!c/??J?J \u0152.?A!c/?? (7.35)\n\nAs with the sliding-mode control approach, !c can be any possible commanded\ntrajectory. A stabilizing control law is given by\n\nL D \u0152.?A!c/??J ?A!c C J ?A P!c ? kp ?q1W3 ? kd ?! (7.36)\n\nThe stability proof for this control law is left as an exercise for the reader. Note that\nwhen !c D 0 then Eq. (7.36) is identical to Eq. (7.7).\n\n\n\n7.4 Attitude Thruster Control 303\n\n7.4 Attitude Thruster Control\n\nPrevious sections have presented a theoretical framework for the use of external\ntorques to control the attitude. External-torque control is rarely used for fine-\npointing but is needed to dump momentum in order to prevent saturation of control\nwheels, and is often used for initial attitude acquisition after launch and for safehold\nmodes to cope with reaction wheel failures. The only external means of applying\nfull three-axis external torques is by the use of thrusters. Magnetic torquers can\nalso generate torques, but not in all three axes simultaneously. Magnetic torquers\nare often used for low-Earth orbits while thrusters are used for high-Earth orbits or\ninterplanetary missions where magnetic fields are weak and unpredictable. Use of\nthrusters in autonomous safehold modes is dangerous, however, because thrusters\ncan impart a large amount of angular momentum to the system, which magnetic\ncontrol torques can remove only with great difficulty (if at all) after the thruster\npropellant has been expended.\n\nThe most common attitude control method by thrusters uses pulse-width pulse-\nfrequency (PWPF) modulation. The PWPF modulator translates the continuous\ncommanded control torque signal to an on/off signal. The pulse width is achieved by\nmodulating the width of the activated reaction pulse proportionally to the level of the\ntorque command input, while the pulse frequency modulates the distance between\nthe pulses. Usually the width is very short and the frequency is set to a level that is\nmuch faster than the spacecraft rigid-body dynamics.\n\nFigure 7.8 shows the main components of a PWPF modulator, which includes a\nSchmidt trigger, a lag filter, and a feedback loop. The Schmidt trigger is an on/off\nrelay with a deadband and hysteresis. When a positive input to the Schmidt trigger\nis greater than Uon, the trigger output is Um. When the input falls below Uoff, the\ntrigger output is 0. This response is also reflected for negative inputs, i.e. when a\nnegative input to the Schmidt trigger is less than ?Uon, the trigger output is ?Um,\nand when the input is above ?Uoff the trigger output is 0.\n\nThe variable Kp is a gain used to amplify or reduce the commanded input.\nThe filter is a simple first-order filter with time constant ?m and filter gain Km.\nThe hysteresis effect for positive inputs is as follows. The output of the filter\nincreases until it reaches the Uon value and the signal is set to the prescribe Um\n\nSchmidt Trigger\n\nFig. 7.8 Pulse-width pulse-frequency modulated system\n\n\n\n304 7 Attitude Control\n\nFig. 7.9 Behavior of a pulse-width pulse-frequency modulator with filter\n\nvalue. Because of the negative feedback loop, the signal then begins to decrease\nuntil it reaches the Uoff value and the signal is set to 0. The width of the hysteresis\nis given by h ? Uon ? Uoff. The behavior of this process is shown in Fig. 7.9.\n\nThe PWPF modulator is a popular choice for attitude control thrusters because\nof its good fuel efficiency characteristics. If the spacecraft can be considered to\nbe a rigid body then static behavior can be used to analyze the characteristics of\nthe PWPF modulator. Reference [1] uses a describing function approach to analyze\nthe case when flexible dynamics are present. In the static case the input, e.t/, is\nconsidered to be a constant here set to simply e, and the PWPF has nearly a linear\nduty cycle. Then f .t/ is given by\n\nf .t/ D f .0/C \u0152Km e ? f .0/?.1 ? e?t=?m/ (7.37)\n\nNote that as time approaches infinity, f .t/ approaches Km e. Let e D r ? u, where\nr D Kp rc is a constant input into the summer in Fig. 7.8 and u is the constant\noutput. The on-time, otherwise known as the pulse width, is denoted by Ton. This can\nbe found by setting f .0/ D Uon and f .Ton/ D Uoff in Eq. (7.37) and solving for\nTon, which yields\n\nTon D ??m ln\n?\n1 ? h\n\nUon ?Km.r ? u/\n?\n\n(7.38)\n\nIf Ton is small so that the first-order approximation e?Ton=?m ? 1 ? Ton=?m is good,\nthen Eq. (7.38) can be approximated by [39]\n\nTon ? ?m h\nUon ?Km.r ? u/ (7.39)\n\n\n\n7.4 Attitude Thruster Control 305\n\nThe output is zero when the thruster is off, so the off-time can be found by setting\ne D r , f .0/ D Uoff, and f .Toff/ D Uon in Eq. (7.37) and solving for Toff, yielding\n\nToff D ??m ln\n?\n1 ? h\n\nKm r ? Uoff\n?\n\n(7.40)\n\nThe first-order approximation for the exponential gives\n\nToff D ?m h\nKm r ? Uoff (7.41)\n\nThe output frequency, denoted by f , is calculated using\n\nf D 1\nTon C Toff (7.42)\n\nThe duty cycle, denoted by DC , can be used to determine how well the modulator\noutput follows its input. This quantity is given by\n\nDC D Ton\nTon C Toff (7.43)\n\nThe internal deadband is defined as the magnitude of the signal required to activate\nthe Schmidt trigger. Assuming zero dynamics in the filter and Kp D 1, from\nFig. 7.8, this occurs when Km r ? Uon. Thus, the internal deadband, denoted by\nrDB, is given by\n\nrDB D Uon\nKm\n\n(7.44)\n\nEquation (7.44) indicates that increasing Km can reduce the size of deadband.\nIn order to ensure that Uon is the upper bound of the deadband, Km > 1 should be\nchosen. The minimum pulse width, denoted by?, is found by substituting Eq. (7.44)\nfor r in Eq. (7.38) and setting u D Um, which yields\n\n? D ??m ln\n?\n1 ? h\n\nKmUm\n\n?\n(7.45)\n\nThe saturation level, denoted by rsat, is obtained when the thrusters are on all\nthe time. This is determined by equating the maximum value of the filter output,\nKm.rsat ? Um/, to the Schmidt trigger off condition, Uoff. Solving for rsat gives\n\nrsat D Um C Uoff\nKm\n\n(7.46)\n\n\n\n306 7 Attitude Control\n\nTable 7.1 Recommended ranges for PWPF parameters\n\nParameter Static analysis Dynamic analysis Recommended\n\nKm 2 < Km < 7 N/A 2 < Km < 7\n?m 0:1 < ?m < 1 0:1 < ?m < 0:5 0:1 < ?m < 0:5\n\nUon Uon > 0:3 N/A Uon > 0:3\nUoff Uoff < 0:8Uon N/A Uoff < 0:8Uon\nKp N/A Kp ? 20 Kp ? 20\n\n0 50 100 150 200 250 300\n?0.2\n\n0\n0.2\n0.4\n0.6\n0.8\n\n0 50 100 150 200 250 300\n?0.2\n\n0\n0.2\n0.4\n0.6\n0.8\n\n0 50 100 150 200 250 300\n?0.2\n?0.1\n\n0\n0.1\n0.2\n\n0 50 100 150 200 250 300\n0\n\n0.4\n0.8\n1.2\n\n?q\n1\n\n?q\n2\n\n?q\n3\n\n?q\n4\n\nTime (Sec)\n\n0 50 100 150 200 250 300\n?25\n\n0\n\n25\n\n0 50 100 150 200 250 300\n?25\n\n0\n\n25\n\n0 50 100 150 200 250 300\n?25\n\n0\n\n25\n\nL\n1 \n(N\n\nm\n)\n\nL\n2 \n(N\n\nm\n)\n\nL\n3 \n(N\n\nm\n)\n\nTime (Sec)\n\na b\n\nFig. 7.10 (a) Quaternion errors and (b) control torques using PWPF thrusters\n\nEquation (7.46) gives the maximum value for the pseudo-linear region. Reference\n[4] provides recommended parameter values based on static and dynamic tests,\nwhich are shown in Table 7.1. Although these values may not be suitable for every\napplication, they provide a good starting point for the design of a PWPF thruster.\n\nExample 7.4. In this example a PWPF controller and the control law in Eq. (7.12)\nare used for the spacecraft with parameters described in Example 7.1. Three PWPF\nthrusters are used with each rc.t/ given by Li , i D 1; 2; 3, in Eq. (7.12). The output\nof each PWPF thruster is the corresponding torque input to the spacecraft. The initial\nquaternion is again given by q D \u01520:6853 0:6953 0:1531 0:1531?T and the\ninitial angular velocity is again given by ! D \u01520:5300 0:5300 0:0530?T deg/s.\nThe desired quaternion is the identity quaternion. The gains are kp D 50 and\nkd D 500. The PWPF parameters are Km D 5, ?m D 0:5, Uon D 10,\nUoff D 6, Kp D 275, and Um D 20. A plot of the quaternion errors is shown in\nFig. 7.10a. The fourth error-quaternion component approaches 1 while the other\nthree components approach zero. The control torques, shown in Fig. 7.10b, are\nlarge at the beginning of the maneuver and have signs equivalent to the ones shown\nin Fig. 7.1b. From these plots it is clear that the PWPF thrusters also provide a\nreorientation maneuver to the desired attitude. Fewer thruster firings are required\nat the end of the maneuver. Gains and the PWPF parameters are often scheduled\n\n\n\n7.5 Magnetic Torque Attitude Control 307\n\nin practice at various phases of the maneuver to provide the desired steady-state\nperformance. Reference [24] provides a study on optimal tuning of the PWPF\nparameters.\n\n7.5 Magnetic Torque Attitude Control\n\nAttitude control using magnetic torquers was first proposed in the early 1960s [48].\nOne of the main uses of magnetic torquers is to dump excess momentum induced\nby external disturbances. This is typically required to insure that wheels do not\nsaturate. Recall that wheels only redistribute a spacecraft\u2019s angular momentum\nsince they are internal body mechanisms. When disturbances are present excess\nmomentum can build up in the spacecraft. The secular (orbit-averaged) component\nof external disturbance torques would lead to saturation of the momentum capacity\nof the reaction wheels, so either mass expulsion or magnetic control torques are\nneeded to dump excess wheel angular momentum. Magnetic control torques have\nseveral advantages for near-Earth missions, including smoothness of application,\nessentially unlimited mission life (due to the absence of expendables), and absence\nof catastrophic failure modes [43]. It is important to note that magnetic torquers need\nnot compensate for the entire disturbance torque in such an application, but only\nfor its secular component [8]. Other uses include detumbling, initial acquisition,\nprecession control, nutation damping, and momentum control.\n\nMagnetic torquers use the Earth\u2019s magnetic field to produce a torque.\nAs described in Sect. 11.1 in Chap. 11, the Earth\u2019s magnetic field magnitude\ndecreases as the inverse cube of the distance from the center of the Earth. Thus\nthe magnetic torque will be several orders of magnitude smaller at high-Earth orbits,\nsuch as geosynchronous orbits, than at low-Earth orbits. Magnetic control torques\nare typically on the order of 10?5 to 10?4 Nm for low-Earth orbits, depending on\na number of factors such as orbit inclination. Another issue is that the torques are\nconstrained to lie in a two-dimensional plane orthogonal to the magnetic field, so\nonly two out of three axes can be controlled at a given time instant. However, full\nthree-axis control is available provided that the spacecraft\u2019s orbital plane does not\ncoincide with the geomagnetic equatorial plane and does not contain the magnetic\npoles [7].\n\nReference [38] provides a good example, which is summarized here. Suppose\nthat one magnetic torquer is aligned with the spin axis of the spacecraft. Activating\nthis torquer will cause the spin axis to precess about the direction of the magnetic\nfield when the magnetic field has a component that is perpendicular to the spin\naxis. If the spacecraft orbit is in the magnetic equatorial plane then the spin axis\ncan only be precessed about the direction of the North magnetic pole. In this case\nthree-axis attitude control is not possible. However, if the orbit plane is offset from\nthe magnetic equatorial plane, then the direction of the magnetic field will change\n\n\n\n308 7 Attitude Control\n\nFig. 7.11 Magnetic torquer control\n\nduring the orbit and magnetic attitude control is possible. The magnetic equatorial\nplane is only 11? from the Earth\u2019s equator.1 Thus for equatorial orbits the axis\npointing in the direction of motion has the most control authority. For polar orbits\nthe axis orthogonal to the direction of motion and to the Earth-pointing direction\nhas the most control authority.\n\nA survey of magnetic spacecraft attitude control can be found in [40]. Figure 7.11\ndepicts the magnetic control scheme for the aforementioned spin-axis control.\nThe torque generated by the magnetic torquers is given by\n\nL D m ? B (7.47)\n\nwhere m is the commanded magnetic dipole moment generated by the torquers and\nB is the local geomagnetic field expressed in body-frame coordinates. This is related\nto the magnetic field vector, R, expressed in reference-frame coordinates through the\nattitude matrix: B D AR. The vector R depends on the spacecraft\u2019s orbital position.\nThe magnetic moment is given in units of Am2 and the magnetic flux density of the\ngeomagnetic field is given in units of 1Wb=m2 D 1Tesla (T) D 104 Gauss (G).\n\n7.5.1 Detumbling\n\nIn this section a magnetic control law is developed that can be used to detumble a\nspacecraft (i.e. null its angular velocity vector). Detailed theory behind this control\nlaw can be found in [6]. The control is effected by commanding a magnetic dipole\nmoment:\n\nm D kkBk ! ? b (7.48)\n\n1See Sect. 11.1.\n\n\n\n7.5 Magnetic Torque Attitude Control 309\n\nwhere b D B=kBk, ! is the angular velocity and k is a positive scalar gain. This\ngives a control torque\n\nL D kkBk .! ? b/ ? B D k .! ? b/ ? b D ?k .I3 ? b b\nT /! (7.49)\n\nThe control torque is clearly perpendicular to b. To prove the stability of this control\nlaw consider the following candidate Lyapunov function:\n\nV D 1\n2\n!T J! (7.50)\n\nUsing Eq. (7.1b) with Eq. (7.49), PV can be shown to be given by\nPV D ?k!T .I3 ? b bT /! (7.51)\n\nSince the eigenvalues of .I3 ? b bT / are always 0, 1, and 1, then PV is only negative\nsemi-definite. Stated another way, when ! is parallel to b then PV D 0. This is not a\nconcern in practice, though [6].\n\nIf no angular velocity information is available, we use Eq. (3.14) for the magnetic\nfield vector, which in the notation of this section is\n\nPB D A PR ?! ? B (7.52)\n\nWe assume, as is the case for the initial stages of detumbling, that PR? PB, so a good\napproximation to Eq. (7.48) is given by\n\nm D ? kkBk\nPB (7.53)\n\nwhere B is the field sensed by onboard magnetometers. This is an alternative version\nof the well-known B-dot control shown in [43]. As stated in [6] global asymptotic\nstability cannot be proven using Eq. (7.53). But, the absolute angular velocity can\nbe reduced down to a value of the same order of magnitude as the orbit rate (around\n10?3 rad/s) as in the case when the standard B-dot command law is used. Note that\nin practical application, PB would be computed by a finite difference approach, which\nintroduces more noise in the control signal. A filter could be employed to reduce the\nnoise levels, but B-dot control is often implemented as a bang-bang control law.\nAssume that we have n torquers, and that the i th torquer can produce a maximum\ndipole of ?mmaxi in a direction specified by the unit vector ui . Then the bang-bang\nB-dot detumbling control commands are\n\nmi D ?mmaxi sign.ui ? PB/ for i D 1; : : : ; n (7.54)\n\n\n\n310 7 Attitude Control\n\n0 20 40 60 80 100 120 140 160 180\n?0.6\n?0.3\n\n0\n0.3\n0.6\n\n0 20 40 60 80 100 120 140 160 180\n?0.3\n\n0\n0.3\n0.6\n0.9\n\n0 20 40 60 80 100 120 140 160 180\n?0.3\n\n0\n\n0.3\n\n0.6\n\nw\n1 \n(D\n\neg\n/S\n\nec\n)\n\nw\n2 \n(D\n\neg\n/S\n\nec\n)\n\nw\n3 \n(D\n\neg\n/S\n\nec\n)\n\nTime (Min)\n\n0 20 40 60 80 100 120 140 160 180\n?0.08\n?0.04\n\n0\n0.04\n0.08\n\n0 20 40 60 80 100 120 140 160 180\n?0.2\n\n?0.1\n\n0\n\n0.1\n\n0 20 40 60 80 100 120 140 160 180\n?0.12\n?0.08\n?0.04\n\n0\n0.04\n\nTime (Min)\n\nL\n1 \n(N\n\nm\n)\n\nL\n2 \n(N\n\nm\n)\n\nL\n3 \n(N\n\nm\n)\n\na b\n\nFig. 7.12 Detumbling simulation results. (a) Angular velocities. (b) Control torques\n\nTo avoid feedback from the torquers to the magnetometers, the computation of PB is\ninhibited for some period after any mi changes sign.\n\nReference [6] provides a gain expression based on analyzing the closed-loop\ndynamics of the component of ! perpendicular to the Earth\u2019s magnetic field:\n\nk D 4\nTorb\n\n.1C sin ?m/ Jmin (7.55)\n\nwhere Torb is the orbital period in seconds, ?m is the inclination of the spacecraft\norbit relative to the geomagnetic equatorial plane and Jmin is the minimum principal\nmoment of inertia. Note that k is always positive. Constant positive values can also\nbe used to achieve design specifications if desired.\n\nExample 7.5. In this example the control law in Eq. (7.49) is used to null the angular\nvelocity of a rotating spacecraft. The gain is given by Eq. (7.55). The inertia of the\nspacecraft is given in Example 7.2. Note that the minimum principal moment of\ninertia is given by 4726.01952 kg-m2. The GCI inertial position and velocity of\nthe spacecraft are given by r0 D \u01521029:7743 6699:3469 3:7896?T km and v0 D\n\u0152?6:2119 0:9524 4:3946?T km/s. The epoch time is May 10, 2011 at 4:56:36.9191\na.m. This information is required to generate the reference magnetic field. The initial\nquaternion is given by q.t0/ D\n\np\n2=2 \u01521 0 0 1?T and the initial angular velocity\n\nis given by !.t0/ D \u01520:01 0:01 0:01?T rad/s. A plot of the angular velocity\ntrajectories is shown in Fig. 7.12a and the associated magnetic control torques are\nshown in Fig. 7.12b. Clearly, the control law is able to detumble the spacecraft.\n\n\n\n7.5 Magnetic Torque Attitude Control 311\n\n7.5.2 Momentum Dumping\n\nAs stated previously the most common use of magnetic torquers for low-Earth\norbiting spacecraft is momentum dumping. Excess momentum is usually built up in\nthe spacecraft through external disturbances, which are non-conservative. A periodic\ndisturbance torque along one spacecraft axis results in a cyclic variation in the\nangular velocity along that axis, while a constant (secular) disturbance results in a\nlinear increase in angular velocity, where the wheel is accelerated at a constant rate\nin order to transfer the excess momentum from the external disturbance to the wheel\n[26]. Eventually saturation of the wheels will occur due to the excess momentum,\nwhich can only be dumped through external torques.\n\nA common approach to design a magnetic torquer control law for momentum\ndumping is to command a magnetic dipole moment [8]:\n\nm D kkBk h ? b (7.56)\n\nwhich is just like the detumbling control of Eq. (7.48) with the angular velocity\nvector replaced by the wheel angular momentum. The resulting torque is given by\n\nL D ?k .I3 ? b bT /h (7.57)\n\nAs with the detumbling case a torque cannot be exerted when h is parallel to b, but\nas before, this is not a concern for practical applications.\n\nExample 7.6. In this example the control law in Eq. (7.57) is used to reduce the\nwheel momentum for the simulation shown in Example 7.2. All the parameters,\nsuch as the inertia matrix, the initial quaternion, the initial angular velocity, the\ninitial wheel momentum, and control gains are identical to the ones shown in\nExample 7.2. The initial position, velocity and epoch are the same as the ones shown\nin Example 7.5. The goal is to reduce the overall momentum by about half in less\nthan 3 h. To accomplish this goal the gain k in Eq. (7.57) is set to 0.0001.\n\nThe momentum dumping control law is not turned on until the 30-min mark.\nThis allows the spacecraft to first complete its reorientation maneuver. A plot\nof the quaternion errors is shown in Fig. 7.13. As before, the fourth error-\nquaternion component approaches 1 while the other three components approach\nzero. The wheel momenta are shown in Fig. 7.13. Note that the wheel momenta\nbegin to approach zero after the momentum dumping control law is executed.\nThe commanded dipoles are shown in Fig. 7.13. The spacecraft momentum is shown\nin Fig. 7.13. At the end of 3 h we clearly see that the momentum is reduced by the\ndesired goal. The magnitude of control torques, not shown here, is around 10?3 Nm.\nThis is about an order of magnitude higher than a typical magnetic control torque\nfor momentum dumping. In practice the gain k would be set to a much lower\nlevel because reducing momentum by half over the short time period shown in this\n\n\n\n312 7 Attitude Control\n\n0 30 60 90 120 150 180\n?0.4\n\n0\n0.4\n0.8\n\n0 30 60 90 120 150 180\n?0.04\n?0.02\n\n0\n0.02\n\n0 30 60 90 120 150 180\n?0.1\n\n0\n0.1\n0.2\n\n0 30 60 90 120 150 180\n0.6\n0.8\n\n1\n1.2\n\nTime (Min)\n\n0 30 60 90 120 150 180\n0\n\n60\n120\n180\n240\n\n0 30 60 90 120 150 180\n?120\n?80\n?40\n\n0\n40\n\n0 30 60 90 120 150 180\n0\n\n40\n\n80\n\n120\n\nTime (Min)\n\nTime (Min)\n\n0 30 60 90 120 150 180\n60\n\n70\n\n80\n\n90\n\n100\n\n110\n\n120\n\nT\not\n\nal\n M\n\nom\nen\n\ntu\nm\n\n (\nN\n\nm\ns)\n\nh 1\n (N\n\nm\ns)\n\nh 2\n (N\n\nm\ns)\n\nh 3\n (N\n\nm\ns)\n\n?q\n1\n\n?q\n2\n\n?q\n3\n\n?q\n4\n\na b\n\nc d\n\n0 30 60 90 120 150 180\n?400\n\n?200\n\n0\n\n200\n\nm\n1 \n\n(A\n?\n\nm\n2)\n\n0 30 60 90 120 150 180\n?400\n\n?200\n\n0\n\n200\n\nm\n2 \n\n(A\n?\n\nm\n2)\n\n0 30 60 90 120 150 180\n?400\n?200\n\n0\n200\n400\n\nm\n3 \n\n(A\n?\n\nm\n2)\n\nTime (Min)\n\nFig. 7.13 Momentum dumping simulation results. (a) Quaternion errors. (b) Wheel momenta. (c)\nCommanded dipoles. (d) Spacecraft momentum\n\nexample is typically not required. The magnetic control law is usually continuously\nactive to dump excess momentum due to external disturbances during the mission\nmode.\n\n7.6 Effects of Noise\n\nNone of the control simulations presented in the previous sections of this chapter\nincorporates measurement noise, which is always present in practice for any attitude\nsensor. In most cases the filtering methods in Chap. 6 are employed to filter noisy\nmeasurements and the estimates are used in the feedback controllers. For linear\nsystems replacing the \u201ctrue\u201d values with the Kalman filter estimates in the control\nlaw turns out to actually be the optimal approach, as is proven by the Separation\nTheorem [12], also known as the Certainty Equivalence Principle [5, 16, 42]\n(see Sect. 12.3.9). This theorem states that the solution of the overall optimal\n\n\n\n7.6 Effects of Noise 313\n\ncontrol problem with incomplete state knowledge is given by the solution of two\nseparate sub-problems: (1) the estimation problem solved using the Kalman filter\nto provide optimal state estimates, and (2) the control problem using the optimal\nstate estimates, which is derived from the standard optimal control results. Another\nway to show this separation of the overall control design involves the eigenvalue\nseparation property [2], which states that the eigenvalues of the overall closed-loop\nsystem are given by the eigenvalues of the control system together with those of\nthe state estimator system. Unfortunately, no such theorem is available for general\nnonlinear systems. Still, the combined Kalman filter and feedback control approach\nworks well for most attitude control systems.\n\nThe quaternion is the parameterization of choice for both estimation and control\nbecause it avoids singularity issues. As explained previously, the mapping of\nquaternions to rotations is globally two-to-one because q and ?q represent the\nsame attitude. Neglecting this property in the control law can induce a phenomenon\ncalled unwinding, which may produce a control law that does not guarantee that\nthe shortest path is provided to the final orientation, as described in Sect. 7.2.\nTo overcome this path issue a discontinuous set of quaternions is used through the\nsignum function, as also shown in previous sections of this chapter. The problem\nwith the signum function is that it is not robust when noise is present, meaning that\nnoise can destroy any global attractivity property [33].\n\nReference [30] provides an excellent example of the noise and unwinding issues.\nWe consider an attitude regulation problem whose goal is to drive the attitude error\nto zero, which means to drive the error quaternion to?Iq , using the angular velocity\nas the input. The error quaternion kinematics are given by\n\n? Pq1W3 D 1\n2\n\u0152?q1W3??!C 1\n\n2\n?q4! (7.58a)\n\n? Pq4 D ?1\n2\n?qT1W3! (7.58b)\n\nConsider the control law given by ! D ??q1W3 and the following candidate\nLyapunov function:\n\nV1.?q/ D 2 .1 ? ?q4/ D .1 ? ?q4/2 C k?q1W3k2 (7.59)\nClearly V1.?q/ ? 0 with equality if and only if ?q D Iq , and V1.?q/ achieves its\nmaximum when ?q D ?Iq . The time derivative of V1.?q/ with ! D ??q1W3 is\n\nPV1.?q/ D ?k?q1W3k2 (7.60)\nwhich is almost always negative. However, there are two equilibrium points: a stable\none at ?q D Iq and an unstable one at ?q D ?Iq . This leads to the classic unwinding\nissue, which is depicted in Fig. 7.14a. If ?q4 is initially negative, the controller\nincreases the attitude error before driving it to zero.\n\n\n\n314 7 Attitude Control\n\nNoise-Induced\nChattering sign( )\n\nHysteresis\nRegion\n\na b\n\nFig. 7.14 Noise chattering and hysteretic regulation. (a) Quaternion attitude control. (b) Hys-\nteretic regulation\n\nNow consider the control law ! D ??q4?q1W3 and the following candidate\nLyapunov function:\n\nV2.?q/ D 1 ? ?q24 D k?q1W3k2 (7.61)\nIn this case V2.?q/ D 0 if and only if ?q D ?Iq , and its maximum value is achieved\nwhen ?q4 D 0, which corresponds to a 180? rotation. Taking the time derivative of\nV2.?q/ with ! D ??q4?q1W3 leads to\n\nPV2.?q/ D ??q24k?q1W3k2 (7.62)\nwhich is always negative except at the two stable equilibrium points ?q D ?Iq .\nAlso note that V2.?q/ D V2.??q/ and !.?q/ D !.??q/. This clearly solves the\nunwinding problem, but ! D 0 when ?q4 D 0 so convergence takes longer to\nachieve as initial conditions are closer and closer to 180? rotations.\n\nIn an attempt to overcome the convergence and unwinding issues, the control law\n! D ?sign.?q4/?q1W3 is chosen with the following candidate Lyapunov function:\n\nV3.?q/ D\n(\n2 .1 ? ?q4/ D .1 ? ?q4/2 C k?q1W3k2 ?q4 ? 0\n2 .1C ?q4/ D .1C ?q4/2 C k?q1W3k2 ?q4 < 0\n\n(7.63)\n\nTaking the time derivative of V3.?q/ with ! D ?sign.?q4/?q1W3 leads to\nPV3.?q/ D ?k?q1W3k2 (7.64)\n\nwhich is always negative except at the two stable equilibrium points ?q D ?Iq .\nThus this control law achieves global asymptotic stability, but it is not robust to\nmeasurement noise. Reference [29] shows that for an arbitrarily small noise signal,\nwith initial conditions close to 180? rotations, this control law keeps the state near\nthe discontinuity for all time. This is the noise-induced chattering problem depicted\nin Fig. 7.14a.\n\n\n\n7.6 Effects of Noise 315\n\nTo solve the unwinding and noise-induced chattering problems [30] develops\na hybrid controller, which incorporates hysteresis-based switching using a single\nbinary logic variable for each quaternion error state. The strategy is depicted in\nFig. 7.14b, where ? 2 .0; 1/ denotes the hysteresis half-width. Define the following\nfunction:\n\nsign.s/ D\n(\n\nsign.s/ jsj > 0\nf?1; 1g s D 0 (7.65)\n\nWhen s D 0 the value of sign.s/ is C1 if s approaches zero from the positive side\nand ?1 if s approaches from the negative side. Now consider the following control\nlaw: ! D ?h ?q1W3, where h 2 f?1; 1g and the dynamics of h are given by\n\nPh D 0 when .?q; h/ 2 fh ?q4 ? ??g (7.66a)\nhC D sign.?q4/ when .?q; h/ 2 fh ?q4 ? ??g (7.66b)\n\nwhere hC denotes the value of the logic variable after being updated. This function\nrepresents a hysteretic regulation in the control law. It is a hybrid approach\ngeneralizing the control laws ! D ??q1W3 and ! D ?sign.?q4/?q1W3, where ?\nin Eq. (7.66) manages a tradeoff between robustness to measurement noise and\nhysteresis-induced inefficiency. The control law ! D ?sign.?q4/?q1W3 is recovered\nwhen ? D 0. Setting ? to value greater than or equal to 1 gives a simple control law\nwith the full unwinding effect.\n\nReference [30] applies the aforementioned hybrid approach to the control law\ngiven in Eq. (7.36). The hybrid control law is given by\n\nL D \u0152.?A!c/??J ?A!c C J ?A P!c ? kph ?q1W3 ? kd ?! (7.67)\n\nwhere ? 2 .0; 1/ and the dynamics of h are given by Eq. (7.66).\n\nExample 7.7. This example reproduces the example results of [30]. It involves a\nregulation case that takes any initial quaternion and angular velocity to the identity\nquaternion and zero angular velocity, respectively. Let p D \u01521 2 3?T =k\u01521 2 3?k.\nThe inertia matrix is given by J D 10 ? diag.\u0152p1 p2 p3?/ and the control gains are\ngiven by kp D kd D 1. The hysteresis half-width is chosen to be ? D 0:4. Synthetic\nquaternion measurements are generated using\n\nq D q\ntrue Cm v\n\nkqtrue Cm vk\nwhere v is a zero-mean Gaussian white-noise process with covariance given by\nthe identity matrix and m is drawn from a uniform distribution on the interval\n\u01520; 0:2?. These noise parameters produce a 1? attitude measurement error of about\n6.5? in each axis, which is not realistic for any spacecraft attitude sensor; however,\n\n\n\n316 7 Attitude Control\n\n0 5 10 15\n?1\n\n?0.8\n\n?0.6\n\n?0.4\n\n?0.2\n\n0\n\n0.2\n\n0.4\n\n0.6\n\n0.8\n\n1\n\nHybrid\nDiscontinuous\n\nhq\n4\n\nTime (Sec)\n\n0 10 20 30 40 50 60 70\n0\n\n20\n\n40\n\n60\n\n80\n\n100\n\n120\n\n140\n\n160\n\n180\nHybrid\nDiscontinuous\n\nq \n (D\n\neg\n)\n\nTime(Sec)\n\n0 10 20 30 40 50 60 70\n0\n\n0.05\n\n0.1\n\n0.15\n\n0.2\n\n0.25\n\n0.3\n\n0.35\n\n0.4\n\n0.45\n\n0.5\nHybrid\nDiscontinuous\n\n?? ?\n(r\n\nad\n/s\n\nec\n)\n\nTime (Sec)\n\n0 10 20 30 40 50 60 70\n0\n\n0.5\n\n1\n\n1.5\n\n2\n\n2.5\n\n3\n\n3.5\n\nHybrid\nDiscontinuous\n\nt 0\nL\n\nT\n L\n\n d\nt\n\nTime (Sec)\n\na b\n\nc d\n\nFig. 7.15 Noise sensitivity results. (a) Scalar component quaternion errors. (b) Rotation angle\nerrors. (c) Norm of angular velocity errors. (d) Control effort\n\nthis noise level more distinctly shows the effectiveness of the hybrid control law.\nNo noise is added to the true velocity vector. Finally, the initial condition for h is\ngiven by h.0/ D 1.\n\nIn the first simulation the initial quaternion and angular velocity are given by\nqtrue.0/ D \u0152pT 0?T and !true.0/ D 0, respectively. Plots of h q4, the rotation angle\nerror ? D 2 cos?1 jq4j, norm of the angular velocity, and control effort are shown\nin Fig. 7.15. Setting ? D 0 gives the discontinuous controller case. The unwinding\ncontroller case is not shown because its results are identical to the hybrid controller\nresults because h does not change in the hybrid case. Figure 7.15a shows the\nsensitivity to noise for the discontinuous controller case where the chattering\nbehavior is clearly visible. This behavior causes a lag in the response, which in\nturn requires more control effort as shown by Fig. 7.15d. The hybrid controller is\nclearly more robust to measurement noise and requires less control effort than the\ndiscontinuous controller.\n\n\n\n7.6 Effects of Noise 317\n\n0 5 10 15\n?1\n\n?0.8\n\n?0.6\n\n?0.4\n\n?0.2\n\n0\n\n0.2\n\n0.4\n\n0.6\n\n0.8\n\n1\n\nHybrid\nDiscontinuous\nUnwinding\n\nTime (Sec)\n\n0 10 20 30 40 50 60 70\n0\n\n20\n\n40\n\n60\n\n80\n\n100\n\n120\n\n140\n\n160\n\n180\nHybrid\nDiscontinuous\nUnwinding\n\nTime (Sec)\n\n0 10 20 30 40 50 60 70\n0\n\n0.1\n\n0.2\n\n0.3\n\n0.4\n\n0.5\n\n0.6\nHybrid\nDiscontinuous\nUnwinding\n\nTime (Sec)\n\n0 10 20 30 40 50 60 70\n0\n\n0.5\n\n1\n\n1.5\n\n2\n\n2.5\n\n3\n\n3.5\n\nHybrid\nDiscontinuous\nUnwinding\n\nt 0\n\nTime (Sec)\n\nhq\n4\n\nq \n (D\n\neg\n)\n\n?? ?\n(r\n\nad\n/s\n\nec\n)\n\nL\nT\n\n L\n d\n\nt\n\na b\n\nc d\n\nFig. 7.16 Effects of unwinding. (a) Scalar component quaternion errors. (b) Rotation angle errors.\n(c) Norm of angular velocity errors. (d) Control effort\n\nThe second simulation shows how control laws that exhibit unwinding can resist\na \u201cbeneficial\u201d angular velocity. All parameters are identical to the first simulation\nexcept that the initial quaternion is given by qtrue.0/ D \u0152p1 ? 0:22pT ? 0:2?T\nand the initial angular velocity is !true.0/ D 0:5p. Figure 7.16 shows the results\nfor the hybrid, discontinuous, and unwinding controller cases. The unwinding\ncontroller case is given by setting ? > 1. The initial velocity is specifically\nchosen so that it is in the direction that decreases the angle between the initial\nquaternion and commanded quaternion. The discontinuous controller immediately\npulls the quaternion toward ?Iq (note that h immediately jumps to ?1 and stays\nthere). The hybrid controller initially pulls the quaternion toward CIq , but after\nthe initial angular velocity pushes the attitude past the hysteresis width, its value\nof h switches and then pulls the quaternion toward ?Iq . The unwinding-inducing\ncontroller always pulls the quaternion toward Iq . Figure 7.16d shows that the\nunwinding-inducing controller requires the most control effort, as expected, while\nthe discontinuous and hybrid controller give comparable control efforts.\n\n\n\n318 7 Attitude Control\n\nExample 7.8. In this example a more realistic scenario is presented using the\nWMAP spacecraft. The tracking control law is given by Eq. (7.36) with control\ngains given by kp D 5 and kd D 3. Noise is added to the true angular velocity by\nusing a zero-mean Gaussian white-noise process with standard deviation given byp\n?t\np\n10?10?7 rad/s, where the sampling interval is given by?t D 0:1 s. Realistic\n\nnoise is also added to the true quaternion using a multiplicative approach. It is\nassumed that the noise is isotropic, which is a valid assumption when multiple star\ntrackers pointed sufficiently apart are used on the spacecraft. The standard deviation\nfor all components of the 3 ? 1 attitude noise vector, denoted by vq , is given by\n.0:5=3/? 10?3 deg. The \u201cnoise\u201d quaternion is given by qnoise D \u0152vTq 1?T =k\u0152vTq 1?k.\nThe measured quaternion is generated using q D qtrue ? qnoise. The hysteresis half-\nwidth is chosen to be ? D 0:4 for the hybrid controller and ? D 3 for the unwinding\ncontroller. The initial condition for h is given by h.0/ D 1 for all controllers. Results\nfor the scalar component quaternion errors, the rotation error angles, the norm of the\nvelocity errors and the torque norm are shown in Fig. 7.17, which indicate that the\nhybrid controller provides the best performance. This example shows that under\nrealistic noise errors the hybrid controller can provide superior results over standard\ncontrol approaches to handle noise chattering effects.\n\n7.7 SAMPEX Control Design\n\nThis section presents the attitude determination and control design for a real space-\ncraft called the Solar, Anomalous and Magnetospheric Particle Explorer (SAMPEX)\nwhich was the first of the NASA Small Explorer (SMEX) missions. It was launched\non July 3, 1992 into an 82? inclination orbit with an apogee of 670 km and a perigee\nof 520 km, with a planned mission life of 3 years. Its scientific instruments included\nthe Heavy Ion Large Telescope (HILT), the Low Energy Ion Composition Analyzer\n(LEICA), the Mass Spectrometer Telescope (MAST), and the Proton/Electron\nTelescope (PET). Over its lifetime, SAMPEX provided the first continuous record\nof high sensitivity measurements of energetic ions and relativistic electrons over\nalmost two solar cycles. New insights were given into the acceleration, transport\nand loss processes in the Earth\u2019s magnetosphere, driven by high speed streams\nor coronal mass ejections in the solar wind. SAMPEX also discovered doubly\ncharged anomalous cosmic rays of interstellar origin, limiting the time scale for\nacceleration of these ions in the outer heliosphere to a few years. One of the\nsignificant achievements of SAMPEX was to confirm the existence of the trapped\ncomponent of the anomalous cosmic rays. During its first year it confirmed that these\nrays are singly charged and located in a narrow belt of trapped cosmic rays within\nthe inner of the two Van Allen radiation belts. This discovery provided proof of a\nthird radiation belt. Furthermore, SAMPEX also successfully addressed important\nscientific objectives concerning solar energetic particles because it was launched\n\n\n\n7.7 SAMPEX Control Design 319\n\n0 1 2 3 4 5 6 7 8 9 10\n?1\n\n?0.8\n\n?0.6\n\n?0.4\n\n?0.2\n\n0\n\n0.2\n\n0.4\n\n0.6\n\n0.8\n\n1\n\nHybrid\nDiscontinuous\nUnwinding\n\nTime (Min)\n\n0 1 2 3 4 5 6 7 8 9 10\n0\n\n20\n\n40\n\n60\n\n80\n\n100\n\n120\n\n140\n\n160\n\n180\nHybrid\nDiscontinuous\nUnwinding\n\nTime (Min)\n\n0 1 2 3 4 5 6 7 8 9 10\n0\n\n0.05\n\n0.1\n\n0.15\n\n0.2\n\n0.25\n\n0.3\n\n0.35\n\n0.4\nHybrid\nDiscontinuous\nUnwinding\n\n?? ???\n?\n\n(r\nad\n\n/s\nec\n\n)\n\nTime (Min)\n\n0 10 20 30 40 50 60\n0\n\n10\n\n20\n\n30\n\n40\n\n50\n\n60\n\n70\n\n80\n\nHybrid\nDiscontinuous\nUnwinding\n\nTime (Min)\n\nt 0\nL\n\nT\n L\n\n d\nt\n\nq \n (D\n\neg\n)\n\na b\n\nc d\n\nhd\nq 4\n\nFig. 7.17 Hybrid, discontinuous and unwinding results for WMAP. (a) Scalar component quater-\nnion errors. (b) Rotation angle errors. (c) Norm of angular velocity errors. (d) Control effort\n\nwhen the Sun had just passed the peak of its 11-year solar cycle and begun to move\ntoward solar minimum.\n\nFigure 7.18 is a schematic of SAMPEX, showing the science instruments and\ndefinitions of the body axes. The attitude control system (ACS) consists of one\nreaction wheel, three magnetic torquer bars, one two-axis fine Sun sensor, five\ncoarse Sun sensors, and one three-axis magnetometer (TAM). The spin axis of\nthe reaction wheel and the boresight of the fine Sun sensor are along the body\ny-axis, or pitch axis, j ? \u01520 1 0?T .2 Attitude determination is performed using\nthe TRIAD algorithm of Sect. 5.1 with data from the Sun sensor and TAM. The\nthree-axis attitude requirement is 2?. During its lifetime SAMPEX had three primary\nscience modes and included a number of submodes [44]. All science modes have a\nSun angle constraint to maintain the body y-axis to within ? 5? of the Sun line in\norder to keep the solar arrays pointed towards the Sun. The primary science modes\ninclude the following:\n\n2This has no relation to the orbit plane because SAMPEX is not Earth-pointing.\n\n\n\n320 7 Attitude Control\n\nFig. 7.18 SAMPEX\nschematic\n\n\u2022 Vertical Pointing. This mode tends to maximize zenith pointing over the poles.\n\u2022 Orbit Rate Rotation (ORR). This mode provides a smooth scan of the celestial\n\nsphere while maintaining the Sun angle constraint.\n\u2022 Special Pointing. This mode orients the instrument boresights perpendicular to\n\nthe field lines of the Earth\u2019s magnetic field in regions of low field strength and\nparallel to the field lines in regions of high field strength, which allows better\ncharacterization of heavy ions trapped by the field.\n\nThe submodes include the following:\n\n\u2022 Coast. This submode turns off the magnetic torquers and holds the wheel speed\nat its most recent value. This submode is used to drift through mathematical\nsingularities in the attitude determination when the magnetic field and Sun\nvectors are co-aligned within 5? during Sun availability and within 40? during\neclipse. The angle between these vectors can be found by taking the inverse\ncosine of the dot product of the inertial magnetic and Sun vectors.\n\n\u2022 Eclipse. This submode is enabled when the Sun presence flag returns a value\nof false. It turns off the magnetic torquers and determines the Sun vector from\nthe assumption that the reaction wheel angular momentum keeps the spacecraft\ny-axis inertially fixed. This assumption is reasonable for short periods of time\n(<1 h). The body Sun vector is assumed to be given by bsun D j and attitude\ndetermination is performed normally using the TAM vector and assumed Sun\nbody-vector. Note that the eclipse duration can be up to 45 min per orbit in\nshadow seasons.\n\nTwo other modes are also used. The first is a magnetometer calibration mode\nthat senses the unwanted component of the signal on the TAM produced by the\n\n\n\n7.7 SAMPEX Control Design 321\n\ntorquer bars and then estimates the coupling matrix values to compensate for the\ncontamination. The other is a Sunpoint-only mode that is a digital implementation\nof the spacecraft\u2019s analog safehold mode.\n\nSAMPEX\u2019s science mission was terminated on June 30, 2004, after it had\nexceeded its 3 year mission life goal by a factor of almost 4, but the spacecraft\ncontinued to be operated as a testbed. On August 18, 2007 the reaction wheel began\nto fail after more than 15 years of continuous operation. The spacecraft was then\nsuccessfully placed into a spin stabilized mode described in [44] until it reentered\nthe Earth\u2019s atmosphere on November 13, 2012.\n\n7.7.1 Attitude Determination\n\nAs previously mentioned SAMPEX uses a TAM and a Sun sensor in the ACS\nhardware. The Sun sensor has a field of view of ?64? and outputs 8 bits of Gray\ncode data for each axis with a resolution of 0.5?, which dominates the sensor noise.\nThis is converted to binary and the two binary counts, Na and Nb , are converted to\nthe Sun\u2019s image plane coordinates through [19]\n\nx D sxNa ? bx (7.68a)\nz D szNb ? bz (7.68b)\n\nwhere .sx; sz/ are scale factors in units of cm/count and (bx; bz/ are biases in units\nof cm. For the SAMPEX Sun sensor these parameters are given by sx D sz D\n0:002754 and bx D bz D ?0:350625. The body Sun vector is computed using [10]\n\nbsun D 1p\nx2 C z2 C h2\n\n2\n4\n\n?n xp\nh2 ? .n2 ? 1/.x2 C z2/\n\n?n z\n\n3\n5 (7.69)\n\nwhere n is the refraction index of the glass and h is the glass thickness in cm. For\nSAMPEX n D 1:4553 and h D 0:448. To simulate the Sun sensor from the inertial\nSun vector rsun, this vector is first converted to body coordinates using the attitude\nmatrix: bsun ? \u0152bsun1 bsun2 bsun3 ?T D A rsun. Then the components x and z are\ncomputed using\n\nz D ? h bsun3q\nn2 ? b2sun1 ? b2sun3\n\n(7.70a)\n\nx D z bsun1\nbsun3\n\n(7.70b)\n\n\n\n322 7 Attitude Control\n\nwhere the sign of z is easily determined by the known body motion. A Sun sensor\nmeasures an azimuth ?, and a coelevation ? , which are computed by\n\n? D atan2.x; z/ (7.71a)\n\n? D tan?1\n\"\n\nn\np\nx2 C z2p\n\nh2 ? .n2 ? 1/.x2 C z2/\n\n#\n(7.71b)\n\nMeasurements are obtained by adding zero-mean Gaussian white-noise to ? and\n? with standard deviations ?? and ?? , respectively. For SAMPEX the standard\ndeviation of both of the variables is given by 0.01?. Next, the 0.5? resolution is\nsimulated using the MATLAB \u201cround\u201d command, i.e. round(meas=res/ ? res,\nwhere meas is the measurement including noise and res is the resolution. Note\nthat ?? , ?? , and res must all be converted to radians. To produce the simulated body\nvector measurements, first the tangent of the angles for the rotations around the ?x\nand z axes, denoted by ? and ?, are computed using\n\ntan? D tan ? sin? (7.72a)\ntan? D tan ? cos? (7.72b)\n\nwhere ? and ? here are the measured values, including noise and the 0.5? resolution.\nThe measured unit vector is then given by\n\nbsun D ? 1p\n1C tan2 ? C tan2 ?\n\n2\n4\n\ntan?\n1\n\ntan?\n\n3\n5 (7.73)\n\nwhere the sign is easily determined from the true body vector.\nA triaxial search coil magnetometer is used on SAMPEX, which outputs 12 bit\n\nwords for each axis. Its resolution is 31.25 nT and its range is?64;000 nT. The TAM\nbody vector is denoted by bmag and the respective inertial vector is denoted by rmag,\nwhich is computed using a 10th-order geomagnetic field model. TAM measurements\nare computed by first converting the inertial vector into body coordinates and then\nadding zero-mean Gaussian white-noise. For the SAMPEX TAM the covariance\nmatrix of this noise is assumed to be isotropic with standard deviation given by 30\nnT per axis. The SAMPEX algorithm contains a procedure to calibrate the torque-\nrod/magnetometer coupling matrix, denoted by C . It turns off all torquer bars and\nobtains an uncontaminated measurement, denoted by bumag. Then it sequentially\nturns on each torquer bar with a 10 Am2 excitation and obtains a contaminated\nmeasurement, denoted by bcmag. The relationship of these vectors is given by\n\nbcmag D bumag C C m (7.74)\n\n\n\n7.7 SAMPEX Control Design 323\n\nwhere m is the dipole moment of the torquer rods computed from the torque\nmagnetic assembly current feedback. The matrix components of C can be computed\nusing a simple least-squares procedure with multiple observations of bumag and b\n\nc\nmag.\n\nOnce the TRIAD solution produces an attitude matrix, the spacecraft angular\nvelocity is computed by first using a first-order finite difference to estimate the\nderivative of the attitude matrix:\n\nPA ? AkC1 ? Ak\n?t\n\n(7.75)\n\nwhere ?t D 0:5 s is the sampling interval. Then the cross product matrix of\nthe angular velocity is determined using the average values from the two possible\nsolutions of the off-diagonal elements:\n\n? \u0152!kC1?? D 1\n2\n\n? PAAT ? . PAAT /T ? D 1\n2?t\n\n.AkC1ATk ? AkATkC1/ (7.76)\n\nThe total spacecraft angular momentum is given by\n\nH D J!CHw j (7.77)\n\nwhere J is the inertia matrix and Hw is the momentum of the wheel. For SAMPEX\nthe inertia matrix is given by\n\nJ D\n2\n4\n14:1005 ?0:1898 ?0:9897\n?0:1898 19:2526 ?0:4881\n?0:9897 ?0:4881 12:0668\n\n3\n5 kg-m2 (7.78)\n\nThe wheel momentum is computed using the measured angular velocity of the\nwheel, denoted by !w, with Hw D J w!w, where the inertia of the wheel is given\nby J w D 4:1488 ? 10?3 kg-m2.\n\nThe computed values of H are very noisy due to the 0.5? resolution in the\nSun sensor. A simple Kalman filter is used to provide filtered estimates of these\ncomputed values. The angular momentum dynamics is given by\n\nPH D ?! ?HC Lmag (7.79)\n\nwhere Lmag is the magnetic control torque in body coordinates. Using a first-order\nfinite difference to approximate PH and a first-order finite difference to approximate\nPA in ?\u0152!?? D PAAT ? .AkC1ATk ? I3/=?t leads to the following discrete-time\n\nprediction equation [31]:\n\nH?kC1 D AkC1ATk HCk C?t Lmagk (7.80)\n\n\n\n324 7 Attitude Control\n\nThe update equation for the Kalman filter is given by\n\nHCk D .1 ?K/H?k CK Hderivedk (7.81)\nwhere Hderivedk is given by Eq. (7.77) using computed values for the spacecraft and\nwheel angular velocities, and respective known inertia quantities. A Kalman gain of\nK D 0:01 is chosen, which provides good filtered estimates without excessive lag\nin the control signal.\n\n7.7.2 Magnetic Torque Control Law\n\nThe magnetic torquers are used to control the magnitude and direction of the\nsystem angular momentum when SAMPEX is in sunlight. The commanded angular\nmomentum magnitude, denoted by Hc , is 0.81349 Nms.3 The desired direction is\nboth along the body y-axis to damp spacecraft nutation and along the Sun line\nto keep the solar arrays Sun-pointing. An undesired component of the spacecraft\nangular momentum, denoted by ?H, can be computed as\n\n?H D .H ?Hc j/C .H ?Hc bsun/ D 2H ?Hc .jC bsun/ (7.82)\nThe magnetic torquers are commanded to have dipole moment given by\n\nm D kmag?H ? bmag (7.83)\nwhere kmag is a constant gain, given by 7:376 ? 10?13 for SAMPEX. The control\ntorque is computed using Eq. (7.47):\n\nLmag D m ? bmag (7.84)\n\nThe measured values of bmag and bsun are used to compute the control torque.\nAs previously mentioned, magnetic control is turned off during eclipse because con-\ntrolling the angular momentum is undesirable when Sun sensor data are unavailable.\nAngular momentum conservation keeps the solar arrays pointing toward the Sun\nwhen it is behind the Earth.\n\n7.7.3 Science Modes\n\nReaction wheel control is used to align the instrument boresights, which are along\nthe spacecraft z-axis, with a target vector denoted by u. This section shows details\nof the three science modes of SAMPEX, each of which has a different target\n\n3This is equal to 0.6 ft-lb-s and has been erroneously given as 0.6 Nms in the literature.\n\n\n\n7.7 SAMPEX Control Design 325\n\nbsun (1 axis)\n\nuram\n\nvbody\n\nu \u00d7 bsun\n(2 axis)\n\nu (3 axis)\n\nFig. 7.19 Flatley coordinate\nsystem\n\nvector. All science modes have a rotation about the body y-axis, so the target\nvector is always in the body x-z plane. All three science modes also employ a\nvelocity avoidance constraint. This constraint was added due to orbital debris and\nmicrometeoroid fluxes that were 50\u2013100 times higher than the flux tables used in the\noriginal SAMPEX proposal. The SAMPEX HILT sensor includes a flow-through\nisobutane proportional counter that is susceptible to penetration by debris and other\nfluxes [20]. Keeping the HILT sensor pointed away from the velocity vector, which\nthe direction of maximum flux, compensates for the higher than expected fluxes.\n\nSince all three science modes use the velocity avoidance algorithm, it is discussed\nfirst. The RAM angle is defined as the angle between the HILT boresight and the\nvelocity vector. An optimal RAM angle is 90? since it does not degrade any of the\nscience modes while providing an estimated 89 % chance of survival for the HILT\nsensor over a 3 year mission period. This RAM angle was actually later reduced to\n80? and the HILT sensor still functioned properly for nearly 20 years!\n\nThe velocity avoidance algorithm can be easily developed by using a new\ncoordinate system, dubbed the \u201cFlatley Coordinate System,\u201d and shown in Fig. 7.19.\nThe body Sun vector is its first axis, the target vector is its third axis, and their cross\nproduct is its second axis. The angle ' is the angle between the target vector and the\nunit velocity vector expressed in body coordinates, denoted by vbody; and ? is the\nangle between the target vector and the RAM vector, uram, which is the target vector\ncorrected for velocity avoidance. Note that both u and uram are perpendicular to the\nSun vector. If u ? vbody ? cos'min, where 'min is the minimum RAM angle, then the\nvelocity avoidance algorithm is not necessary.\n\nThe attitude matrix that rotates vectors from the body frame to the Flatley frame\nis given by\n\nAFB D\n2\n4\n\nbTsun\nwT\n\nuT\n\n3\n5 (7.85)\n\n\n\n326 7 Attitude Control\n\nwhere w ? u?bsun=ku?bsunk. The velocity vector in Flatley coordinates, denoted\nby f D \u0152f1 f2 f3?T , can be determined using f D AFB vbody. The vector uram in\nFlatley coordinates is simply uram D \u01520 sin ? cos ??T . The desired constraint to\ndetermine uram is given by\n\nuram ? f D f2 sin ? C f3 cos ? D cos'min (7.86)\n\nSquaring both sides of Eq. (7.86), and using the relations cos2 ? D 1 ? sin2 ? and\nf3 cos ? D cos'min ? f2 sin ? leads to the following quadratic equation for sin ? :\n\n.f 22 C f 23 / sin2 ? ? 2f2 cos'min sin ? C cos2 'min ? f 23 D 0 (7.87)\n\nThe solution for sin ? is given by\n\nsin ? D\nf2 cos'min ? jf3j\n\nq\nf 22 C f 23 ? cos2 'min\n\nf 22 C f 23\n(7.88)\n\nIf f2 ? 0 then sin ? < 0 and the negative sign is chosen in the radical, otherwise the\npositive sign is chosen since if f2 < 0 then sin ? > 0 is true. The vector uram can\nnow be computed using simple sine and cosine relationships from Fig. 7.19:\n\nuram D .u ? bsun/ sin ? C u cos ? (7.89)\n\nNote that if ? D 0 then uram D u as expected and that if ? D 0 then Eq. (7.86)\nshows that f3 D cos'min. In practice the measured values for bsun are used.\nThe attitude matrix is required to compute the velocity vector in body coordinates.\nFinally, the velocity vector in inertial coordinates is computed using an onboard\norbit propagator, which is updated from ground observations.\n\nFor all three modes the pitch error angle, which is used in the control system, is\ngiven by\n\ne D atan2.?uram1 ; uram3 / (7.90)\n\nwhere uram1 and uram3 are the first and third components of uram, respectively. Note\nthat in some cases the velocity avoidance algorithm is turned off. For these cases we\nsimply set sin ? D 0 and cos ? D 1 in Eq. (7.89), so uram D u. Equation (7.90) can\nstill be used in the control law.\n\n7.7.3.1 Vertical Pointing Mode\n\nThe vertical pointing mode minimizes the angle between the spacecraft z-axis\nand the zenith vector within the Sun pointing constraint [19]. This mode has the\nundesirable property of pointing directly into the velocity vector twice per orbit\n\n\n\n7.7 SAMPEX Control Design 327\n\nwhen the Sun is in the orbit plane, but the velocity avoidance algorithm overcomes\nthis problem. The target vector in inertial coordinates is given by\n\nuref D rsun ? .r ? rsun/krsun ? .r ? rsun/k (7.91)\n\nwhere rsun is the Sun unit vector in inertial coordinates and r is the spacecraft\nposition vector in inertial coordinates. The body target vector is found by using\nu D Auref where A is the computed attitude matrix from the TRIAD algorithm.\nThis mode clearly has the spacecraft z-axis as close to zenith as possible while\nremaining perpendicular to the Sun.\n\n7.7.3.2 Orbit Rate Rotation Mode\n\nIn the ORR mode the spacecraft z-axis rotates at one revolution per orbit in a plane\nperpendicular to the Sun vector, which provides a smooth scan of the celestial\nsphere, while maintaining the y-axis Sun pointing requirement. At the same time,\nthe z-axis is desired to point as close to North as possible at the northernmost point\nin the orbit, South as possible at the southernmost point, and parallel to the equator\nat the equatorial crossings [19]. To develop the target vector we first define the North\npole vector in inertial coordinates: p D \u01520 0 1?T and also compute the unit orbit\nnormal vector:\n\nn D r ? vkr ? vk (7.92)\n\nwhere r is the inertial position vector and v is the inertial velocity vector. We now\ncompute the orbit angle as seen from the northernmost point in the orbit using the\nfollowing vectors:\n\na D p ? nkp ? nk (7.93a)\n\nc D n ? a (7.93b)\n\nNote that a is the vector in the direction of the ascending node and the vector c is in\nthe direction of the northernmost point in the orbit. The sine and cosine of the orbit\nangle, defined by ?, can be computed from\n\nsin? D ?r ? akrk (7.94a)\n\ncos? D r ? ckrk (7.94b)\n\n\n\n328 7 Attitude Control\n\nThe two vectors w D c?rsun=kc?rsunk and rsun?w provide an orthonormal basis for\nthe plane perpendicular to the Sun. Note that w is a vector that points perpendicular\nto the Sun and lies in the equatorial plane. Thus when the spacecraft is near the\nequator, it is desired to have the target vector point along w, which corresponds to\norbit angles of ? D \n=2 and ? D 3\n=2. The vector rsun?w is also perpendicular to\nthe Sun and points as close as possible to the northernmost point given the Sun\nconstraint. Thus when the spacecraft is near the poles it is desired to have the\ntarget vector point along rsun ? w, which corresponds to orbit angles of ? D 0\nand ? D \n . Since it is desired to rotate the body y-axis about the positive Sun line,\nthe orientation of the orbit normal relative to the Sun line must be considered in the\ntarget vector. If the Sun passes through the orbit plane when the spacecraft is near the\nequator, this will cause a 180? flip, which we would like to prevent. The following\ntarget vector, expressed in inertial coordinates, has all these properties:\n\nuref D .rsun ? w/ cos? C Ts w sin? (7.95)\n\nwhere Ts is the target sign variable, which has initial value of sign.rsun ? n/. If the\nSun passes through the orbit plane, the next time the spacecraft comes within 0.5? of\nthe northernmost or southernmost point of the orbit, whichever comes first, then the\nvariable Ts will change sign, which will keep the spacecraft rotating about the Sun\nline without causing a flip. The body target vector is again found by using u D Auref\nwhere A is the computed attitude matrix from the TRIAD algorithm.\n\nReference [20] shows the following limiting cases for the ORR mode. When\nthe Sun is perpendicular to the orbit plane, the ORR mode reduces to a zenith\npointing mode, as shown in Fig. 7.20a. Since the target vector is given by Eq. (7.95)\nthe rotation about the z-axis along the orbital path is zenith pointing, as shown in\nFig. 7.20b. For the case when the Sun is parallel to the orbit plane, the ORR mode\nbecomes a zenith pointing mode over the poles and points in the r ? p direction at\nthe equator. Figure 7.21a shows that w D c ? rsun, and since the target vector is\ngiven by Eq. (7.95) the orientation of the z-axis can be determined throughout the\norbital path, as shown in Fig. 7.21.\n\n7.7.3.3 Special Pointing Mode\n\nAfter the discovery of a third radiation belt it was desired to change the pointing\nalgorithm to orient the instrument boresights perpendicular to the magnetic field line\nwhile passing through a region in the South Atlantic containing a high concentration\nof trapped particles. Figure 7.22 served as the \u201crequirements document\u201d from Dan\nBaker, a project scientist, and Glenn Mason, the SAMPEX Principal Investigator,\nwhich led to the SAMPEX special pointing mode. Details of this mode, documented\nin [28], are repeated here. In order to satisfy these revised science requirements, the\npointing mode was modified using the magnetic field strength krmagk as a delimiter\nto point the spacecraft perpendicular to the magnetic field vector whenever the field\nstrength is determined to be less than some specified value, which was set to 3 ?\n\n\n\n7.7 SAMPEX Control Design 329\n\nOrbital Path\n\nEarth\n\nr\n\nwTarget Sign\nw\n\nrsun (Sun out of page)\n\nn (Orbit normal out of page)\n\nrsun (Sun out of page)\n\nn (Orbit normal out of page)\n\nEarth\n\nOrbital Path\n\nrsun    w\n\nuorr\n\na\n\nb\n\nFig. 7.20 Sun is perpendicular to the orbit plane. (a) Orbit rate rotation mode geometry. (b) Orbit\nrate rotation mode target pointing vector along the orbital path\n\n104 nT. This pointing uses magnetometer data to determine the field direction in the\nspacecraft reference frame. Since the magnetometer data was judged to provide a\ngood pointing reference, the specification was changed in the high-field regions to\npoint as close to the magnetic field vector as possible, consistent with the constraint\nthat the y-axis be pointed at the Sun. At northern latitudes, the desired orientation\nis anti-parallel to the field, and in the South the orientation is parallel to the field. In\nboth cases, then, the spacecraft points away from the Earth in the polar regions.\n\nIn the low-field region the target vector is to be perpendicular to both the\nSun vector and the magnetic field vector. This requirement is obviously satisfied\nby choosing the target vector in the direction of the cross product bsun ? bmag.\nThe negative of this vector clearly satisfies the same requirement. One and only\none of these two vectors is more than 90? from the velocity vector, and we choose\nthis one to satisfy the velocity avoidance requirement. Since the magnetic control\nkeeps the Sun vector within a few degrees of the y-axis vector j, the cross product\nbsun ? bmag can be well approximated by j ? bmag, so the target vector is computed\nfrom the components of bmag as\n\n\n\n330 7 Attitude Control\n\nOrbital Path\n\nEarth\n\nr\n\nr sun\n\n\u2022\n\nTarget Sign w (into page)\n\nEarth\n\nOrbital Path\n\nuorr\n\n\u2022\n\n\u2022 n\n\nrsun\n\nw ( out of page)\n\na\n\nb\n\nrsun    w\n\nFig. 7.21 Sun is parallel to the orbit plane. (a) Orbit rate rotation mode geometry. (b) Orbit rate\nrotation mode target pointing vector along the orbital path\n\nu D ?1q\nb2mag1 C b2mag3\n\n2\n4\nbmag3\n0\n\n?bmag1\n\n3\n5 (7.96)\n\nThe upper sign is chosen if v ? .rsun ? rmag/ ? 0 and the lower sign is chosen\nif v ? .rsun ? rmag/ > 0, where v is the spacecraft velocity vector in inertial\ncoordinates computed from the onboard ephemeris. Note that binary decisions are\nbased on velocity and magnetic field vectors computed in the inertial frame from\nthe ephemeris, in order to prevent toggling arising from noisy measurements; but\nthat the TAM-sensed magnetic field vector in the body frame is used to compute the\nactual pointing vector.\n\n\n\n7.7 SAMPEX Control Design 331\n\nFig. 7.22 Requirements specification for SAMPEX special pointing mode\n\nThe angle error in Eq. (7.90) is generally small, but it is on the order of 90?\nduring transitions between parallel pointing and perpendicular pointing. In these\ncases, the wheel is commanded in the direction that requires the smallest rotation\nto null the angle error. Due to changing geometry however, some time during a\npassage through a low field region, a 180? pitch maneuver is generally required to\nsatisfy the avoidance requirement. The special pointing algorithm assures that any\n180? turns will be executed in a direction away from the velocity vector. Thus a\ncomputed pitch error angle magnitude greater than 2.5 rad is taken to signify a large\nreorientation maneuver. The sign of the x-axis component of the spacecraft velocity\nvector v in the body frame is then used to determine the direction of this maneuver,\nsuch that the instrument boresights are rotated away from the velocity vector rather\nthan toward it.\n\n\n\n332 7 Attitude Control\n\nIn the high-field region, krmag1k > 3?104 nT, the target vector is to be perpendicular\nto the body y-axis and as close as possible to parallel or antiparallel to the magnetic\nfield vector bmag. Thus the target vector is given by\n\nu D ?1q\nb2mag1 C b2mag3\n\n2\n4\nbmag1\n0\n\nbmag3\n\n3\n5 (7.97)\n\nwhere the positive sign is used when SAMPEX is in the southern hemisphere\nand the negative sign in the northern hemisphere, as determined from the onboard\nephemeris. In the high-field region the existing onboard velocity avoidance algo-\nrithm is still used.\n\nDuring coast mode the reaction wheel speed angular momentum is commanded\nto the fixed value of the commanded momentum,Hc , rather than to its instantaneous\nvalue at entry to coast mode as in the ORR mode. Since the total system angular\nmomentum is maintained at Hc by magnetic torquer commands, this has the effect\nof halting spacecraft attitude motion in coast mode. This change was necessitated by\nthe observation that coast mode could be entered during one of the rapid 90? or 180?\nmaneuvers of the spacecraft, and holding the spacecraft y-axis rate constant at a high\nvalue could result in several rotations during coast mode. This undesirable behavior\nwas actually seen in some simulations, but is avoided by the final pointing law.\n\n7.7.4 Reaction Wheel Control Law\n\nThe single reaction wheel is used to drive down the angle error shown in Eq. (7.90).\nA proportional-integral-derivative (PID) control law [17] is used to command the\nwheel torque, denoted by Lw. The derivative signal is computed using a simple\nfinite-difference approach:\n\nPe ? ek ? ek?1\n?t\n\n? ederk (7.98)\n\nThe integral portion, denoted by eint, is computed by simply using\n\neintk D eintk?1 C ek ?t (7.99)\n\nThe torque control law is then given by\n\nLwk D kp ek C kd ederk C ki eintk (7.100)\n\nwhere kp , kd and ki are the proportional, derivative and integral gains, respectively,\ngiven as follows for the various modes:\n\n\n\n7.7 SAMPEX Control Design 333\n\n\u2022 All Modes: kp D !2nJ22, kd D 2 ? !nJ22, and ki D .kp kd /=.10 J22/.\n\u2022 Vertical and ORR Modes: ? D p2=2 and !n D 0:02.\n\u2022 Special Pointing Mode: ? D p2=2 and !n D 0:01.\nAn integral limit is also imposed for all modes, which is set to 3 ? 10?3=ki . Note\nthat unlike the magnetic control system no filter is used to filter noisy measurements\nin the wheel control law. This is because the measurement errors do not significantly\naffect the overall wheel control performance to meet the desired specifications. This\nis an important point to make about the design phase of any spacecraft control\nsystem. Start with the simplest design for analysis purposes and then add one\ncomponent, such as a Kalman filter, at a time to see how the performance improves.\nOnce the desired specifications are met within some desired confidence and safety\nfactor then it is usually best to not add any more components. A system that is\nover-designed may lead to unknown errors that may subsequently cause catastrophic\nfailures. The SAMPEX design shows how simplicity often can lead to a successful\ncontrol design that far exceeds initial lifetime performance specifications.\n\n7.7.5 Simulations\n\nThis section provides simulation results for all three modes. The epoch is September\n16, 2011 at midnight. The simulation runtime is 5 h with a sampling interval of 5 s\nfor all sensors and actuators. The position and velocity vectors from the onboard\nephemeris are given by\n\nr.t0/ D\n2\n4\n3335:973299\n\n2571:763319\n\n?5370:931739\n\n3\n5 km; v.t0/ D\n\n2\n4\n3:530941\n\n4:977268\n\n4:566940\n\n3\n5 km/s (7.101)\n\nFor these conditions the orbital altitude varies from an apogee of 450 km to a perigee\nof 390 km, which is far lower than the initial orbit insertion because of atmospheric\ndrag that decayed the orbit over the lifetime of the mission. But this orbit is still\nsufficient to perform the required science modes. The onboard orbit propagator\nincludes the effects of drag and higher-order gravity terms. Here only the effects\nof J2 are simulated because drag has an insignificant effect on the orbit over 5 h.\nThe dynamic model is given by [36]\n\nRr D ? ?krk3 C aJ2 (7.102)\n\nwhere aJ2 is given by Eq. (10.103a) with J2 from Table 10.2, ? D 3:98601 ?\n105 km3/s2, and R? D 6378:1363 km. A plot of SAMPEX longitude and latitude\nfor this simulation is given in Fig. 7.23. The inclination of 82? is clearly seen in this\nplot. A 10th-order IGRF model is used to generate the reference magnetic field using\n\n\n\n334 7 Attitude Control\n\n0 30 60 90 120 150 180 ?150 ?120 ?90 ?60 ?30 0\n?90\n\n?80\n\n?70\n\n?60\n\n?50\n\n?40\n\n?30\n\n?20\n\n?10\n\n0\n\n10\n\n20\n\n30\n\n40\n\n50\n\n60\n\n70\n\n80\n\n90\n\nLongitude (Deg)\n\nL\nat\n\nit\nud\n\ne \n(D\n\neg\n)\n\nFig. 7.23 SAMPEX ground track\n\nthe inertial position of the satellite. The inertial Sun vector is calculated simply from\nthe epoch. All measurements are produced using the noise and resolution parameters\ndiscussed previously.\n\nThe rotation dynamic models are given by\n\nPq D 1\n2\n?.q/! (7.103a)\n\nPH D ?! ?HC Lmag (7.103b)\nPHw D Lw (7.103c)\n\nwhere ! D J?1.H ? Hw j/. For all simulations the initial quaternion is given by\nthe identity quaternion, and the system and wheel momenta are set to zero. For the\nfirst 2 h the wheel is turned off in order to reorient the spacecraft so that the y-axis\nis pointed towards the Sun using magnetic torquers only.\n\nAs previously mentioned the onboard attitude determination algorithm used\nthe TRIAD algorithm, which ignores some part of the measurement. In order to\nprovide more accurate attitude estimates Davenport\u2019s q method is applied here (see\nSect. 5.3). Using this approach allows us to increase the Kalman gain to 0.04 instead\n\n\n\n7.7 SAMPEX Control Design 335\n\n0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5\n?20\n\n0\n\n20\n\n40\n\n60\n\n80\n\n100\n\nSu\nn \n\nA\nng\n\nle\n E\n\nrr\nor\n\n (\nD\n\neg\n)\n\nTime (Hr)\n\n0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5\n?200\n\n?150\n\n?100\n\n?50\n\n0\n\n50\n\n100\n\n150\n\n200\n\nP\noi\n\nnt\nin\n\ng \nA\n\nng\nle\n\n E\nrr\n\nor\n (\n\nD\neg\n\n)\n\nTime (Hr)\n\n0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5\n?0.2\n\n0\n\n0.2\n\n0.4\n\n0.6\n\n0.8\n\n1\n\n1.2\n\nW\nhe\n\nel\n M\n\nom\nen\n\ntu\nm\n\n (\nN\n\nm\ns)\n\nTime (Hr)\n\n0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5\n?1\n\n?0.5\n0\n\n0.5\n1 x 10\n\n?3\n\nx 10?3\n\nx 10?3\n0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5\n\n?1\n?0.5\n\n0\n0.5\n\n1\n\n0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5\n?1\n\n?0.5\n0\n\n0.5\n1\n\nL\nm\n\nag\n1 \n (\n\nN\nm\n\n)\nL\n\nm\nag\n\n2 \n (\n\nN\nm\n\n)\nL\n\nm\nag\n\n3 \n (\n\nN\nm\n\n)\n\nTime (Hr)\n\nba\n\ndc\n\nFig. 7.24 SAMPEX vertical pointing mode. (a) Sun angle error. (b) Pointing angle error. (c)\nWheel momentum. (d) Magnetic control torques\n\nof 0.01, which actually gives better filtered estimates than the TRIAD method using\na lower Kalman gain. Simulation results for the vertical pointing mode are shown\nin Fig. 7.24. The Sun error angle is shown in Fig. 7.24a. After 2 h the Sun error\nangle is about 10?. Figure 7.24b shows the pointing error. Note that since the wheel\nis turned off for the first 2 h there are large fluctuations in the error angle. The wheel\nmomentum is shown in Fig. 7.24c. After 2 h the wheel is turned on and drives the\nerror angle to near zero. The magnetic control torques are shown in Fig. 7.24d. Note\nthe large control torques at the beginning of the simulation run, which are required\nto reorient the y-axis along the Sun line. After that period only minimal control\ntorques are required. Simulation results for the orbit rate rotation mode are shown in\nFig. 7.25. Results are very similar to the vertical pointing mode results. Simulation\nresults for the special pointing mode are shown in Fig. 7.26. Note that unlike the\nother two modes, the error angle is not always maintained at zero. The fluctuations\nare due to achieving the \u201cbest possible\u201d angle given the constraints of the geometry\nfrom the orbit position and spacecraft orientation requirements, particularly the Sun\n\n\n\n336 7 Attitude Control\n\n0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5\n?20\n\n0\n\n20\n\n40\n\n60\n\n80\n\n100\n\nSu\nn \n\nA\nng\n\nle\n E\n\nrr\nor\n\n (\nD\n\neg\n)\n\nTime (Hr)\n\n0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5\n?200\n\n?150\n\n?100\n\n?50\n\n0\n\n50\n\n100\n\n150\n\n200\n\nP\noi\n\nnt\nin\n\ng \nA\n\nng\nle\n\n E\nrr\n\nor\n (\n\nD\neg\n\n)\n\nTime (Hr)\n\n0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5\n?0.2\n\n0\n\n0.2\n\n0.4\n\n0.6\n\n0.8\n\n1\n\n1.2\n\nW\nhe\n\nel\n M\n\nom\nen\n\ntu\nm\n\n (\nN\n\nm\ns)\n\nTime (Hr)\n\n0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5\n?1\n\n?0.5\n0\n\n0.5\n1\n\n0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5\n?1\n\n?0.5\n0\n\n0.5\n1\n\n0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5\n?1\n\n?0.5\n0\n\n0.5\n1\n\nTime (Hr)\n\nL\nm\n\nag\n1 \n (\n\nN\nm\n\n)\nL\n\nm\nag\n\n2 \n (\n\nN\nm\n\n)\nL\n\nm\nag\n\n3 \n (\n\nN\nm\n\n)\nx 10?3\n\nx 10?3\n\nx 10?3\n\nba\n\ndc\n\nFig. 7.25 SAMPEX orbit rate rotation mode. (a) Sun angle error. (b) Pointing angle error. (c)\nWheel momentum. (d) Magnetic control torques\n\nline pointing requirement. Still, the desired pointing is achieved enough to satisfy\nthe special pointing mode requirements.\n\nIt is important to note that although the control laws and filter developed for\nSAMPEX were very simple, they were proven to be extremely effective. Extended\nKalman filters are widely used for onboard attitude estimators, even though filter\nstability cannot be guaranteed. Many, if not most, modern-day attitude controllers\nare very simple PID controllers. For example, the actual WMAP spacecraft uses a\nsimple PID controller that is not asymptotically stable from a theoretical point of\nview [3]. This leads to a \u201cbias\u201d in the control error signal, which was overcome by\nusing a simple feed-forward term. Still the attitude control design meets the desired\nmission objectives because attitude knowledge accuracy is more important than\npointing accuracy for the WMAP spacecraft. The SAMPEX and WMAP attitude\ncontrol designs epitomize the notion of \u201ckeep it simple\u201d if sufficient confidence\ncan be obtained that the controllers will meet mission objectives. Future spacecraft\ncontrol designs will most likely gravitate more towards Lyapunov-based controllers\nas confidence grows in their ability to achieve desired mission objectives. Although\n\n\n\nProblems 337\n\n0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5\n?20\n\n0\n\n20\n\n40\n\n60\n\n80\n\n100\n\nSu\nn \n\nA\nng\n\nle\n E\n\nrr\nor\n\n (\nD\n\neg\n)\n\nTime (Hr)\n\n0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5\n?200\n\n?150\n\n?100\n\n?50\n\n0\n\n50\n\n100\n\n150\n\n200\n\nP\noi\n\nnt\nin\n\ng \nA\n\nng\nle\n\n E\nrr\n\nor\n (\n\nD\neg\n\n)\n\nTime (Hr)\n\n0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5\n?0.2\n\n0\n\n0.2\n\n0.4\n\n0.6\n\n0.8\n\n1\n\n1.2\n\nW\nhe\n\nel\n M\n\nom\nen\n\ntu\nm\n\n (\nN\n\nm\ns)\n\nTime (Hr)\n\n0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5\n?1\n\n?0.5\n0\n\n0.5\n1\n\n0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5\n?1\n\n?0.5\n0\n\n0.5\n1\n\n0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5\n?1\n\n?0.5\n0\n\n0.5\n1\n\nTime (Hr)\n\nL\nm\n\nag\n1 \n (\n\nN\nm\n\n)\nL\n\nm\nag\n\n2 \n (\n\nN\nm\n\n)\nL\n\nm\nag\n\n3 \n (\n\nN\nm\n\n)\nx 10?3\n\nx 10?3\n\nx 10?3\n\nba\n\ndc\n\nFig. 7.26 SAMPEX special pointing mode. (a) Sun angle error. (b) Pointing angle error. (c)\nWheel momentum. (d) Magnetic control torques\n\nmore complicated than simple PID controllers, these more advanced control laws\nmay require fewer contingency mode analyses than simpler controllers, which may\nin fact reduce the time to design the actual spacecraft control system.\n\nProblems\n\n7.1. Consider the following modified version of the control law given in\nEq. (7.7) [49]:\n\nL D ?kp J ?q1W3 ? kd J!C \u0152!??J!\n\nThe error-quaternion given in Eq. (7.2) is represented by\n\n?q ?\n?\n?q1W3\n?q4\n\n?\nD\n?\n?e sin.?#=2/\n\ncos.?#=2/\n\n?\n\n\n\n338 7 Attitude Control\n\nwhere ?e is the axis of rotation and ?# is the angle. Substitute the control law\ninto Eq. (7.1) and derive a second-order differential equation that is a function of\n?# , kp and kd only. (Hint: the expression shown in Problem 3.3 may be helpful).\nNext, using a small angle approximation find a linear form of this equation that\nleads to the classic form given in Sect. 12.2.1.1 of ? R#2 C 2 ? !n ? P# C !2n?# D 0.\nDetermine the relationships of kp and kd to !n and ?. Assuming that !n D 0:1\nrad/s and ? D p2=2 determine the associated kp and kd values. Using these kp and\nkd values in the above modified control law perform a simulation study using the\ninertia matrix and initial conditions described in Example 7.1.\n\n7.2. Consider the following modified version of the control law given in Eq. (7.7):\n\nL D ?kp sign.?q4/J ?q1W3 ? kd J!C \u0152!??J!\n\nSubstitute the control law into Eq. (7.1) and show that the closed-loop differential\nequation for ?q4 is given by\n\n? Rq4 C\n?\n?q4 ? Pq4\n.1 ? ?q24/\n\nC kd\n?\n? Pq4 C 1\n\n2\nkp j?q4j ?q4 D 1\n\n2\nkp sign.?q4/\n\nHow does this differential equation change if the control law in Example 7.1 is used\ninstead, i.e. without sign.?q4/? Numerically integrate the differential equation for\n?q4 for a total time of 30 min using both control laws; one with sign.?q4/ and one\nwithout it. Run two different initial conditions for both control laws: (1) ?q4.t0/ D\n0:5 and ? Pq4.t0/ D 0, and (2) ?q4.t0/ D ?0:5 and ? Pq4.t0/ D 0. Use the following\ncontrol gains for both control laws: kp D 0:01 and kd D 2. Compare the trajectories\nof ?q4 over time in all cases and discuss how using sign.?q4/ produces the shortest\ndistance. Also discuss the case using the following initial conditions: ?q4.t0/ D 0:5\nand ? Pq4.t0/ D ?1.\n7.3. Redo the simulation shown in Example 7.1. Next, using the same gains from\nthis example, implement the controller shown in Eq. (7.14). Try both the plus and\nminus signs in the control law. Compute the function in Eq. (7.9) for each of the\nthree controllers and plot them over time. Also plot the rotation angle of error, ?# ,\nfor each of the three controllers. Discuss the differences seen in the responses.\n\n7.4. Prove that the control law in Eq. (7.13) produces a globally asymptotic stable\nresponse for the closed-loop system.\n\n7.5. Another attitude regulation control law involves using the attitude matrix\ndirectly [34]:\n\nL D ?kp s ?Kd !\n\nwhere kp is a positive scalar, Kd is a diagonal matrix with positive elements and\n\n\n\nProblems 339\n\ns D\n3X\niD1\n\nri \u0152.?A ei /??ei\n\nwhere e1 D \u01521 0 0?T , e2 D \u01520 1 0?T , e3 D \u01520 0 1?T , and r1, r2, and r3 are positive\nscalars. The attitude error, ?A, is given by ?A D AATc , where Ac is a constant\nattitude matrix. Prove that this control law produces an asymptotically stable closed-\nloop system by using the following candidate Lyapunov function:\n\nV D 1\n2\n!T J!C kp tr.R ?R ?A/\n\nwhere R is a diagonal matrix with elements given by r1, r2, and r3. First show that\ntr.R ?R ?A/ ? 0. Note that the equality is given only when ?A D I3.\n\nNext, consider the following gains:\n\nkp ? ?\ntrR\n\nKd ? ?\n\n2\n666664\n\n1\n\n1C j!1j 0 0\n\n0\n1\n\n1C j!2j 0\n\n0 0\n1\n\n1C j!3j\n\n3\n777775\n\nwhere ? and ? are positive scalars. Show that kL.t/k1 ? ? C ?. Begin by using\nthe following relation:\n\nkL.t/k1 D kkp sCKd !k1\n? kp ksk1 C kKd !k1\n\nPerform a simulation using the inertia matrix and initial conditions given in\nExample 7.1 with this control law. Choose the following gains: ? D 50, ? D 500,\nand R D I3.\n7.6. Prove the relation given in Eq. (7.20). Next, show that the time derivative of\n?q4 is ? Pq4 D 12 .!c ?!/T ?q1W3.\n7.7. Prove that the control law in Eq. (7.36) produces a globally asymptotic stable\nresponse for the closed-loop tracking system.\n\n7.8. In this exercise you will design a controller that tracks an LVLH attitude.\nConsider the following orbital elements: a D 26; 559 km, e D 0:704482, M0 D\n12:9979?, i D 63:1706?, ? D 206:346?, and ! D 281:646?. Note that this is a\nhighly eccentric orbit. Compute the initial position and velocity using Table 10.1,\nand then propagate the orbit for an 18-h period in 10-s intervals. Next, compute the\n\n\n\n340 7 Attitude Control\n\ndesired LVLH attitude using Eq. (2.79) and angular rate using Eq. (3.175). Also find\nan analytical expression for the derivative of Eq. (3.175). Assume that the actual\ninitial attitude is given by the identity matrix and the actual initial angular rate is\ngiven by zero. The inertia matrix is given by\n\nJ D\n2\n4\n10000 0 0\n\n0 9000 0\n\n0 0 12000\n\n3\n5 kg-m2\n\nFinally, using the control law given by Eq. (7.36) pick values of kp and kd so that\nthe actual attitude and angular rate converges to the desired attitude and angular\nrate in about 10 min. Show plots of the orbit, the first three components of the error\nquaternion and the angular velocity errors using Eq. (7.31).\n\n7.9. Consider the case of tracking a desired quaternion with kinematics given by\n\nPqc D 1\n2\n?.qc/!c\n\nwhere !c is the desired angular velocity vector. The error quaternion is given by\n?q D q? q?1c . Let us assume that the closed-loop kinematic equation is desired to\nhave the following prescribed linear form [32]:\n\n? Rq1W3 C L2? Pq1W3 C L1?q1W3 D 0\n\nwhere L1 and L2 are 3 ? 3 gain matrices. Determine the control law that will yield\nthis closed-loop linear form. Next, assuming that both L1 and L2 are each given by\na scalar times identity matrix, with L1 D `1I3, L2 D `2I3, show that your derived\ncontrol law reduces down to\n\nL D \u0152!??J!C J\n\n\n?A P!c ? \u0152!?? ?A!c ? `2?! ? 2\n\n?\n4`1 ? .?!T ?!/\n\n4 ?q4\n\n?\n?q1W3\n\n?\n\nwith\n\n?A D A.q/AT .qc/\n?! D ! ? ?A!c\n\nThis control law is clearly singular when ?q4 D 0. Do the same issues arise in the\ncontrol law that uses general 3 ? 3 L1 and L2 gain matrices?\n7.10. Redo the simulation shown in Example 7.4. Pick different values for the\nPWPF parameters to see how they affect the overall performance.\n\n7.11. Redo the simulation shown in Example 7.6. Pick different values for k to see\nhow they affect the overall performance.\n\n\n\nReferences 341\n\n7.12. Redo the simulation shown in Example 7.7. Pick different values for the\nvarious parameters in the control law as well as different noise levels to see how\nthey affect the overall performance.\n\nReferences\n\n1. Agrawal, B.N., McClelland, R.S., Song, G.: Attitude control of flexible spacecraft using pulse-\nwidth pulse-frequency modulated thrusters. Space Tech. 17(1), 15\u201334 (1997)\n\n2. Anderson, B.D.O., Moore, J.B.: Optimal Control: Linear Quadratic Methods. Prentice Hall,\nEnglewood Cliffs (1990)\n\n3. Andrews, S.F., Campbell, C.E., Ericsson-Jackson, A.J., Markley, F.L., O\u2019Donnell Jr., J.R.:\nMAP attitude control system design and analysis. In: Proceedings of the Flight Mechan-\nics/Estimation Theory Symposium, pp. 445\u2013456. NASA-Goddard Space Flight Center,\nGreenbelt (1997)\n\n4. Arantes, G., Martins-Filho, L.S., Santana, A.C.: Optimal on-off attitude control for the\nBrazilian Multimission Platform satellite. Math. Probl. Eng. 2009(1) (2009)\n\n5. \u00c5str\u00f6m, K.J.: Introduction to Stochastic Control Theory. Academic Press, New York (1970)\n6. Avanzini, G., Giulietti, F.: Magnetic detumbling of a rigid spacecraft. J. Guid. Contr. Dynam.\n\n35(4), 1326\u20131334 (2012)\n7. Bhat, S.P., Dham, A.S.: Controllability of spacecraft attitude under magnetic actuation. In:\n\nProceedings of the 42nd IEEE Conference on Decision and Control, pp. 2383\u20132388. Maui\n(2003)\n\n8. Camillo, P.J., Markley, F.L.: Orbit-averaged behavior of magnetic control laws for momentum\nunloading. J. Guid. Contr. 3(6), 563\u2013568 (1980)\n\n9. Challa, M.S., Natanson, G.A., Baker, D.E., Deutschmann, J.K.: Advantages of estimating rate\ncorrections during dynamic propagation of spacecraft rates-applications to real-time attitude\ndetermination of SAMPEX. In: Proceedings of the Flight Mechanics/Estimation Theory\nSymposium, pp. 481\u2013495. NASA-Goddard Space Flight Center, Greenbelt (1994)\n\n10. Chen, L.C., Lerner, G.M.: Three-axis attitude determination. In: Wertz, J.R. (ed.) Sun Sensor\nModels, chap. 7. Kluwer Academic, Dordrecht (1978)\n\n11. Chu, D., Harvie, E.: Accuracy of the ERBS definitive attitude determination system in the\npresence of propagation noise. In: Proceedings of the Flight Mechanics/Estimation Theory\nSymposium, pp. 97\u2013114. NASA-Goddard Space Flight Center, Greenbelt (1990)\n\n12. Crassidis, J.L., Junkins, J.L.: Optimal Estimation of Dynamic Systems, 2nd edn. CRC Press,\nBoca Raton (2012)\n\n13. Crassidis, J.L., Markley, F.L.: Sliding mode control using modified Rodrigues parameters.\nJ. Guid. Contr. Dynam. 19(6), 1381\u20131383 (1996)\n\n14. Crassidis, J.L., Markley, F.L.: Predictive filtering for attitude estimation without rate sensors.\nJ. Guid. Contr. Dynam. 20(3), 522\u2013527 (1997)\n\n15. Crassidis, J.L., Vadali, S.R., Markley, F.L.: Optimal variable-structure control tracking of\nspacecraft maneuvers. J. Guid. Contr. Dynam. 23(3), 564\u2013566 (2000)\n\n16. Davis, M.: Linear Estimation and Stochastic Control. Chapman and Hall, London (1977)\n17. Dorf, R.C., Bishop, R.H.: Modern Control Systems. Addison Wesley Longman, Menlo Park\n\n(1998)\n18. Dwyer, T.A.W., Sira-Ramirez, H.: Variable structure control of spacecraft reorientation\n\nmaneuvers. J. Guid. Contr. Dynam. 11(3), 262\u2013270 (1988)\n19. Flatley, T.W., Forden, J.K., Henretty, D.A., Lightsey, E.G., Markley, F.L.: On-board atti-\n\ntude determination and control algorithms for SAMPEX. In: Proceedings of the Flight\nMechanics/Estimation Theory Symposium, pp. 379\u2013398. NASA-Goddard Space Flight Center,\nGreenbelt (1990)\n\n\n\n342 7 Attitude Control\n\n20. Frakes, J.P., Henretty, D.A., Flatley, T.W., Markley, F.L., Forden, J.K., Lightsey, E.G.:\nSAMPEX science pointing modes with velocity avoidance. In: Proceedings of the 2nd\nAAS/AIAA Spaceflight Mechanics Meeting, pp. 949\u2013966. Colorado Springs (1992)\n\n21. Junkins, J.L., Turner, J.D.: Optimal Spacecraft Rotational Maneuvers. Elsevier, New York\n(1986)\n\n22. Kang, W.: Nonlinear H1 control and its application to rigid spacecraft. IEEE Trans. Automat.\nContr. 40(7), 1281\u20131285 (1995)\n\n23. Koon, W.S., Lo, M.W., Marsden, J.E., Ross, S.D.: Dynamical Systems, The Three-Body\nProblem and Space Mission Design. Marsden Books, Pasadena (2011)\n\n24. Kr\u00f8vel, T.D.: Optimal tuning of PWPF modulator for attitude control. Master\u2019s thesis,\nNorwegian University of Science and Technology, Department of Engineering Cybernetics,\nTrondheim (2005)\n\n25. Lizarralde, F., Wen, J.T.Y.: Attitude control without angular velocity measurement: A passivity\napproach. IEEE Trans. Automat. Contr. 41(3), 468\u2013472 (1996)\n\n26. Lovera, M.: Optimal magnetic momentum control for inertially pointing spacecraft. Eur. J.\nContr. 7(1), 30\u201339 (2001)\n\n27. Markley, F.L., Andrews, S.F., O\u2019Donnell Jr., J.R., Ward, D.K.: Attitude control system of the\nWilkinson Microwave Anisotropy Probe. J. Guid. Contr. Dynam. 28(3), 385\u2013397 (2005)\n\n28. Markley, F.L., Flatley, T.W., Leoutsakos, T.: SAMPEX special pointing mode. In: Proceedings\nof the Flight Mechanics/Estimation Theory Symposium, pp. 201\u2013215. NASA-Goddard Space\nFlight Center, Greenbelt (1995)\n\n29. Mayhew, C.G., Sanfelice, R.G., Teel, A.R.: Robust global asymptotic attitude stabilization of a\nrigid body by quaternion-based hybrid feedback. In: Joint 48th IEEE Conference on Decision\nand Control and 28th Chinese Control Conference, pp. 2522\u20132527. Shanghai (2009)\n\n30. Mayhew, C.G., Sanfelice, R.G., Teel, A.R.: Quaternion-based hybrid control for robust global\nattitude tracking. IEEE Trans. Automat. Contr. AC-56(11), 2555\u20132565 (2011)\n\n31. McCullough, J.D., Flatley, T.W., Henretty, D.A., Markley, F.L., San, J.K.: Testing of the on-\nboard attitude determination and control algorithms for SAMPEX. In: Proceedings of the\nFlight Mechanics/Estimation Theory Symposium, pp. 55\u201368. NASA-Goddard Space Flight\nCenter, Greenbelt (1992)\n\n32. Paielli, R.A., Bach, R.E.: Attitude control with realization of linear error dynamics. J. Guid.\nContr. Dynam. 16(1), 182\u2013189 (1993)\n\n33. Sanfelice, R.G., Messina, M.J., Tuna, S.E., Teel, A.R.: Robust hybrid controllers for\ncontinuous-time systems with applications to obstacle avoidance and regulation to discon-\nnected set of points. In: American Control Conference, pp. 3352\u20133357. Minneapolis (2006)\n\n34. Sanyal, A., Fosbury, A., Chaturvedi, N., Bernstein, D.S.: Inertia-free spacecraft attitude\ntracking with disturbance rejection and almost global stabilization. J. Guid. Contr. Dynam.\n32(4), 1167\u20131178 (2009)\n\n35. Schaub, H., Akella, M.R., Junkins, J.L.: Adaptive control of nonlinear attitude motions\nrealizing linear closed loop dynamics. J. Guid. Contr. Dynam. 24(1), 95\u2013100 (2001)\n\n36. Schaub, H., Junkins, J.L.: Analytical Mechanics of Aerospace Systems, 2nd edn. American\nInstitute of Aeronautics and Astronautics, New York (2009)\n\n37. Scrivener, S.L., Thompson, R.C.: Survey of time-optimal attitude maneuvers. J. Guid. Contr.\nDynam. 17(2), 225\u2013233 (1994)\n\n38. Shuster, M.D., Dellinger, W.F.: Spacecraft attitude determination and control. In: V.L. Pisacane\n(ed.) Fundamentals of Space Systems, 2nd edn., chap. 5. Oxford University Press, New York\n(2005)\n\n39. Sidi, M.J.: Spacecraft Dynamics and Control: A Practical Engineering Approach. Cambridge\nUniversity Press, New York (2006)\n\n40. Silani, E., Lovera, M.: Magnetic spacecraft attitude control: A survey and some new results.\nContr. Eng. Pract. 13(3), 357\u2013371 (2005)\n\n41. Slotine, J.J.E., Li, W.: Applied Nonlinear Control. Prentice Hall, Englewood Cliffs (1991)\n42. Stengel, R.F.: Optimal Control and Estimation. Dover Publications, New York (1994)\n\n\n\nReferences 343\n\n43. Stickler, A.C., Alfriend, K.T.: Elementary magnetic attitude control system. J. Spacecraft\nRockets 13(5), 282\u2013287 (1976)\n\n44. Tsai, D.C., Markley, F.L., Watson, T.P.: SAMPEX spin stabilized mode. In: SpaceOps\nConference. Heidelberg, Germany (2008). AIAA 2008\u20133435\n\n45. Tsiotras, P.: Stabilization and optimality results for the attitude control problem. J. Guid. Contr.\nDynam. 19(4), 772\u2013779 (1996)\n\n46. Vadali, S.R.: Variable structure control of spacecraft large angle maneuvers. J. Guid. Contr.\nDynam. 9(2), 235\u2013239 (1986)\n\n47. Vadali, S.R., Junkins, J.L.: Optimal open-loop and stable feedback control of rigid spacecraft\nmaneuvers. J. Astronaut. Sci. 32(2), 105\u2013122 (1984)\n\n48. White, J.S., Shigemoto, F.H., Bourquin, K.: Satellite attitude control utilizing the Earth\u2019s\nmagnetic field. Tech. Rep. NASA-TN-D-1068, A-474, NASA Ames Research Center, Moffett\nField (1961)\n\n49. Wie, B.: Space Vehicle Dynamics and Control, 2nd edn. American Institute of Aeronautics\nand Astronautics, Reston (2008)\n\n50. Wie, B., Barba, P.M.: Quaternion feedback for spacecraft large angle maneuvers. J. Guid.\nContr. Dynam. 8(3), 360\u2013365 (1985)\n\n\n\nChapter 8\nQuaternion Identities\n\nThe purpose of this chapter is to present a collection of vector and quaternion\nidentities that are useful for control and estimation computations. Many of them\nused throughout this text. Several appear in Chap. 2 but are repeated here for\nconvenience.\n\n8.1 Cross Product Identities\n\nThe 3 ? 3 skew-symmetric cross-product matrix is defined as\n\n\u0152u?? ?\n2\n4\n0 ?u3 u2\nu3 0 ?u1\n?u2 u1 0\n\n3\n5 (8.1)\n\ngiving \u0152u??v D u ? v. Since \u0152u??u D 0, \u0152u?? must be singular. The eigenvalues\nof \u0152u?? are given by \t1 D 0 and \t2; 3 D ?ikuk. Some useful identities for the\ncross-product matrix include [6]:\n\n\u0152u??T D ?\u0152u?? (8.2a)\nadj .\u0152u??/ D u uT (8.2b)\n\n\u0152u??v D ?\u0152v??u (8.2c)\n\u0152u??\u0152v?? D ? ?uT v\t I3 C v uT (8.2d)\n\n\u0152u??\u0152v??w D u ? .v ? w/ D ?uTw\t v ? ?uT v\tw (8.2e)\n\u0152u??3 D ?kuk2\u0152u?? (8.2f)\n\n\u0152u??\u0152v?? ? \u0152v??\u0152u?? D v uT ? u vT D \u0152.u ? v/?? (8.2g)\n\nF.L. Markley and J.L. Crassidis, Fundamentals of Spacecraft Attitude Determination\nand Control, Space Technology Library 33, DOI 10.1007/978-1-4939-0802-8__8,\n\u00a9 Springer Science+Business Media New York 2014\n\n345\n\n\n\n346 8 Quaternion Identities\n\n.I3 ? \u0152u??/.I3 C \u0152u??/?1 D 1\n1C kuk2\n\n?\n.1 ? kuk2/I3 C 2u uT ? 2\u0152u??\n\n?\n(8.2h)\n\nku ? vk2I3 D kuk2v vTCkvk2u uT ?\n?\nuT v\n\n\t?\nu vT C v uT \tC .u ? v/.u ? v/T\n\n(8.2i)\n\nwhere In is an n ? n identity matrix. Some useful identities involving the cross-\nproduct matrix and an arbitrary 3 ? 3 matrix M are:\n\ntr.M/\u0152u?? DM\u0152u??C \u0152u??MT C \u0152.MT u/?? (8.3a)\nM\u0152u??MT D \u0152fadj.MT /ug?? (8.3b)\n\n\u0152f.Mu/ ? .Mv/g?? DM\u0152.u ? v/??MT (8.3c)\n.Mu/ ? .Mv/ D adj.MT / .u ? v/ (8.3d)\n\n\u0152u??\u0152tr.M/I3 ?M?\u0152u??TD .uTMu/I3? u uTMT?MT u uTC kuk2MT (8.3e)\n\nwhere tr denotes the trace operator and adj denotes the adjoint matrix. If we write\nM in terms of its columns\n\nM D ?u1 u2 u3\n?\n\n(8.4)\n\nthen\n\ndet.M/ D uT1 .u2 ? u3/ (8.5)\n\nwhere det denotes the determinant. Also, if A is an orthogonal matrix with\ndeterminant 1, then from we have Eq. (8.3b)\n\nA\u0152u??AT D \u0152.Au/?? (8.6)\n\nThese cross product relations are useful in proving many of the quaternion identities\nshown in this chapter.\n\n8.2 Basic Quaternion Identities\n\nThe quaternion has a vector part, q1W3, and a scalar part, q4:\n\nq ?\n\n2\n664\n\nq1\nq2\nq3\nq4\n\n3\n775 ?\n\n?\nq1W3\nq4\n\n?\n(8.7)\n\n\n\n8.2 Basic Quaternion Identities 347\n\nWe define two 4 ? 4 matrices analogous to the 3 ? 3 cross-product matrix:\n\n\u0152q?? ?\n?\nq4 I3 ? \u0152q1W3?? q1W3\n?qT1W3 q4\n\n?\nD ??.q/ q? (8.8a)\n\n\u0152q?? ?\n?\nq4 I3 C \u0152q1W3?? q1W3\n?qT1W3 q4\n\n?\nD ??.q/ q? (8.8b)\n\nwith ?.q/ and ?.q/ being the 4 ? 3 matrices\n\n?.q/ ?\n?\nq4 I3 ? \u0152q1W3??\n?qT1W3\n\n?\n(8.9a)\n\n?.q/ ?\n?\nq4 I3 C \u0152q1W3??\n?qT1W3\n\n?\n(8.9b)\n\nThese matrices provide two alternative products of two quaternions q and Nq:\n\nq? Nq D \u0152q?? Nq (8.10a)\nq? Nq D \u0152q?? Nq (8.10b)\n\nThe first of these, denoted by ?, has proved to be more useful in attitude analysis.\nIt follows from these definitions that\n\nq? Nq D Nq? q (8.11)\nQuaternion multiplication is associative, q?. Nq? NNq/ D .q? Nq/? NNq and distributive,\nq ? . Nq C NNq/ D q ? Nq C q ? NNq. Quaternion multiplication is not commutative in\ngeneral, q? Nq \u00a4 Nq? q, paralleling the situation for matrix multiplication. In those\ncases for which q ? Nq D Nq ? q, the quaternions q and Nq are said to commute.\nAnalogous equations hold for the product q? Nq.\n\nThe identity quaternion\n\nIq ?\n?\n\n03\n1\n\n?\n(8.12)\n\nobeys Iq ? q D q? Iq D Iq ? q D q? Iq D q, as required of the identity.\nThe conjugate quaternion q? is obtained, in analogy with the complex conjugate,\n\nby changing the sign of the three-vector part:\n\nq? ?\n??q1W3\nq4\n\n?\nD T q (8.13)\n\nwhere\n\nT ?\n??I3 03?1\n01?3 1\n\n?\n(8.14)\n\n\n\n348 8 Quaternion Identities\n\nNote that T 2 D 1, so T ?1 D T . The conjugate of the product of two quaternions Nq\nand q is the product of the conjugates in the opposite order:\n\n. Nq? q/? D q? ? Nq? (8.15)\n\nThe product of a quaternion with its conjugate is equal to the square of its norm\ntimes the identity quaternion\n\nq? q? D q? ? q D q? q? D q? ? q D kqk2 Iq (8.16)\n\nThese relations and the associativity of quaternion multiplication can be used to\nshow that\n\nkNq? qk D kNq? qk D kNqkkqk (8.17)\n\nThe inverse of any quaternion having nonzero norm is defined by\n\nq?1 ? q?=kqk2 (8.18)\n\nso that q ? q?1 D q?1 ? q D q ? q?1 D q?1 ? q D Iq , as required by the\ndefinition of an inverse. The inverse of the product of two quaternions is the product\nof the inverses in the opposite order . Nq? q/?1 D q?1 ? Nq?1.\n\nSome useful identities are given by\n\n\u0152q??? D \u0152q??T D T \u0152q?? T (8.19a)\n\u0152q??? D \u0152q??T D T \u0152q?? T (8.19b)\n\n\u0152q??\u0152 Nq?? D \u0152 Nq??\u0152q?? (8.19c)\n\u0152q??\u0152q??? D \u0152q??\u0152q??T D kqk2I4 (8.19d)\n\u0152q??\u0152q??? D \u0152q??\u0152q??T D kqk2I4 (8.19e)\n\n\u0152q???1 D kqk?2\u0152q??? D \u0152q?1?? (8.19f)\n\u0152q???1 D kqk?2\u0152q??? D \u0152q?1?? (8.19g)\n\u0152Iq?? D \u0152Iq?? D I4 (8.19h)\n\u0152q??Iq D \u0152q??Iq D q (8.19i)\n\n\u0152.q? Nq/?? D \u0152q??\u0152 Nq?? D kqk?2\u0152q??\u0152. Nq? q/??\u0152q??T\n\nD kNqk?2\u0152 Nq??T \u0152. Nq? q/??\u0152 Nq?? (8.19j)\n\u0152.q? Nq/?? D \u0152 Nq??\u0152q?? D kqk?2\u0152q??T \u0152. Nq? q/??\u0152q??\n\nD kNqk?2\u0152 Nq??\u0152. Nq? q/??\u0152 Nq??T (8.19k)\n\n\n\n8.3 The Matrices ?.q/, ?.q/, ?.!/, and ? .!/ 349\n\n8.3 The Matrices ?.q/, ?.q/,?.!/, and \n .!/\n\nThe matrices ?.q/ and ?.q/ satisfy the identities\n\n?T .q/?.q/ D ?T .q/?.q/ D kqk2I3 (8.20a)\n?.q/?T .q/ D ?.q/?T .q/ D kqk2I4 ? qqT (8.20b)\n\n?T .q/q D ?T .q/q D 03 (8.20c)\n?T .q/ Nq D ??T . Nq/q (8.20d)\n?T .q/ Nq D ??T . Nq/q (8.20e)\n\n?T .q/?. Nq/ D ?T . Nq/?.q/ (8.20f)\n?T .q/?. Nq/ D ?T . Nq/?.q/ (8.20g)\n\n?.q/?T . Nq/C q NqT D \u0152q??\u0152 Nq??? D \u0152.q? Nq?/?? (8.20h)\n?.q/?T . Nq/C q NqT D \u0152q??\u0152 Nq??? D \u0152. Nq? ? q/?? (8.20i)\n\nWe will overload the quaternion product notation to allow us to multiply a three-\ncomponent vector ! and a quaternion, using the definitions\n\n!? q ?\n?\n!\n\n0\n\n?\n? q D \u0152!??q D q?! D \u0152q??! D ?.q/! (8.21a)\n\n!? q ?\n?\n!\n\n0\n\n?\n? q D \u0152!??q D q?! D \u0152q??! D ?.q/! (8.21b)\n\nWe also use the alternate notation\n\n?.!/ ? \u0152!?? D\n??\u0152!?? !\n?!T 0\n\n?\n(8.22a)\n\n? .!/ ? \u0152!?? D\n?\n\u0152!?? !\n?!T 0\n\n?\n(8.22b)\n\nNote that the matrices ?.!/ and ? .!/ are both skew-symmetric with eigenvalues\n\t1; 3 D ik!k and \t2; 4 D ?ik!k.\n\nSome useful identities valid for any 3 ? 1 vectors b, r, and ! are given by [6]\n\n?.b/? .r/ D ? .r/?.b/ (8.23a)\n?.!/q D ?.q/! (8.23b)\n? .!/q D ?.q/! (8.23c)\n\n\n\n350 8 Quaternion Identities\n\n\u0152q?? ? .!/ D ? .!/ \u0152q?? (8.23d)\n\u0152q???.!/ D ?.!/ \u0152q?? (8.23e)\n?.!/?.q/ D ??.q/\u0152!?? ? q!T (8.23f)\n? .!/?.q/ D ?.q/\u0152!?? ? q!T (8.23g)\n\n?2.!/ D ? 2.!/ D ?k!k2I4 (8.23h)\ndet\u0152?.!/? D det\u0152? .!/? D k!k4 (8.23i)\n\n?T .q/?.!/?.q/ D ?kqk2\u0152!?? (8.23j)\n?T .q/? .!/?.q/ D kqk2\u0152!?? (8.23k)\n\n?.b ? r/ D 1\n2\n\u0152?.r/?.b/ ??.b/?.r/? (8.23l)\n\n? .b ? r/ D 1\n2\n\u0152? .b/? .r/ ? ? .r/? .b/? (8.23m)\n\n8.4 Identities Involving the Attitude Matrix\n\nThe four-component quaternion representation of attitude is related to the Euler\naxis/angle representation by\n\nq\nkqk D\n\n1q\nq24 C kq1W3k2\n\n?\nq1W3\nq4\n\n?\nD\n?\n\ne sin.#=2/\ncos.#=2/\n\n?\n(8.24)\n\nwhere e is a unit vector corresponding to the axis of rotation and # is the angle of\nrotation. Then the attitude matrix is given by\n\nA.q/ ? kqk?2 ?T .q/?.q/ D kqk?2\nn\n.q4I3 ? \u0152q1W3??/2 C q1W3 qT1W3\n\no\n\nD kqk?2 ??q24 ? kq1W3k2\n\t\nI3 C 2q1W3 qT1W3 ? 2q4\u0152q1W3??\n\n? (8.25)\n\nwhich agrees with the Euler axis/angle representation of Eq. (2.108).\nThe rotation group has only three degrees of freedom, so a quaternion has more\n\ncomponents than it needs. In fact, it is clear from Eq. (8.25) that the attitude matrix\ndoes not depend on the quaternion norm in any way.1 For this reason, the attitude\nquaternion is usually defined with unit norm, kqk D 1. This is analogous to\n\n1Some authors define the attitude matrix without the factor of kqk?2 even if the quaternion is not\nnormalized, with the result that the attitude matrix is not guaranteed to be orthogonal.\n\n\n\n8.4 Identities Involving the Attitude Matrix 351\n\nrequiring that e be a unit vector in the Euler axis/angle parameterization, and is\nthe convention adopted in Chap. 2 in this book. For greater generality, however,\nthe identities in this chapter will not assume that the quaternion obeys the norm\nconstraint. If the attitude quaternions are normalized, all the quaternion norms in\nthe following identities have the value unity and can be safely ignored.\n\nNow Eqs. (8.20a)?(8.20c) can be used to show that\nA?1.q/ D AT .q/ D A.q?/ (8.26)\n\nand that serial rotations are easily accomplished by multiplying quaternions,\n\nA. Nq/A.q/ D A. Nq? q/ D A.q? Nq/ (8.27)\nregardless of whether or not the quaternions are normalized. The order of multi-\nplication of the quaternions using the ? product is the same as that of the attitude\nmatrix, which is a major advantage of this multiplication convention.\n\nQuaternion multiplication can be used in place of matrix multiplication to\ntransform a three-component vector [6]:\n\nq?!? q?1 D kqk?2 q?\n?\n!\n\n0\n\n?\n? q? D\n\n?\nA.q/!\n0\n\n?\n(8.28a)\n\nq?1 ?!? q D kqk?2 q? ?\n?\n!\n\n0\n\n?\n? q D\n\n?\nAT .q/!\n\n0\n\n?\n(8.28b)\n\nSome useful identities are [6]\n\n\u0152q??\u0152q?1?? D \u0152q?1??\u0152q?? D\n?\nA.q/ 03?1\n01?3 1\n\n?\n(8.29a)\n\n\u0152q???.!/\u0152q?1?? D ? .A.q/!/ (8.29b)\n\u0152q?1???.!/\u0152q?? D ? ?AT .q/!\t (8.29c)\n\u0152q?1??? .!/\u0152q?? D ? .A.q/!/ (8.29d)\n\u0152q??? .!/\u0152q?1?? D ? ?AT .q/!\t (8.29e)\n\n\u0152q?1???.q/ D\n?\nAT .q/\n01?3\n\n?\n(8.29f)\n\n\u0152q?1???.q/ D\n?\nA.q/\n01?3\n\n?\n(8.29g)\n\nIdentities involving \u0152.q? Nq?/?? are given by\n\u0152.q? Nq?/?? D ?.q/A.q? Nq?/?T . Nq/C q NqT (8.30a)\n\n\u0152.q? Nq?/???. Nq/ D kNqk2?.q/A.q? Nq?/ (8.30b)\n\n\n\n352 8 Quaternion Identities\n\n?T .q/\u0152.q? Nq?/?? D kqk2A.q? Nq?/?T . Nq/ (8.30c)\n?T .q/\u0152.q? Nq?/???. Nq/ D kqk2kNqk2A.q? Nq?/ (8.30d)\n\nIdentities involving \u0152. Nq? ? q/?? are given by\n\n\u0152. Nq? ? q/?? D ?.q/A.q? ? Nq/?T . Nq/C q NqT (8.31a)\n\u0152. Nq? ? q/???. Nq/ D kNqk2?.q/A.q? ? Nq/ (8.31b)\n?T .q/\u0152. Nq? ? q/?? D kqk2A.q? ? Nq/?T . Nq/ (8.31c)\n\n?T .q/\u0152. Nq? ? q/???. Nq/ D kqk2kNqk2A.q? ? Nq/ (8.31d)\n\nEquations (8.19j) or (8.19k) can be used to exchange Nq? ? q and q? Nq? if needed.\nWe now derive some useful identities for attitude determination. If b and r are\n\nany two three-component vectors, then\n\nkqk2bT A.q/r D bT ?T .q/?.q/r D \u0152?.b/q?T ? .r/q D ?qT?.b/? .r/q (8.32)\n\nwhere\n\n??.b/? .r/ D\n?\nB C BT ? tr.B/I3 .b ? r/\n\n.b ? r/T tr.B/\n?\n? K (8.33)\n\nwith\n\nB ? b rT (8.34)\n\nThis was shown in Sect. 5.3 to lead to Davenport\u2019s q method [7]. Equations (8.23a)\nand (8.23h) can be used to show that\n\nK D ??.b/? .r/ D 1\n2\n\n??kbk2 C krk2\t I4 ? CTC\n?\n\n(8.35)\n\nwhere\n\nC ? ? .r/ ??.b/ D\n?\n\u0152.bC r/?? ?.b ? r/\n.b ? r/T 0\n\n?\n(8.36)\n\nThis has been used to develop a square-root attitude determination algorithm [5].\nEquations (8.23b) and (8.23c) lead to an identity closely related to Eq. (8.35) that is\nused in a measurement model that is linear in the quaternion [1]:\n\n?.q/r ??.q/b D Cq (8.37)\n\n\n\n8.4 Identities Involving the Attitude Matrix 353\n\nAlso, if b D A.q/r, then\n\n2?.q/\u0152b???T .q/ D 2?.q/\u0152r???T .q/ D kqk2C (8.38)\n\nOther identities are given by\n\n?.q/A.q/ D ?.q/ (8.39a)\n? .A.q/!/q D ? .!/q (8.39b)\n\n?T .q/? .!/?.q/ D kqk2\u0152A.q/!?? (8.39c)\n?T .q/?.!/?.q/ D ?kqk2\u0152AT .q/!?? (8.39d)\n\n? .? .!/q/ D ? .!/?.q/ D ??.q/\u0152!?? ? q!T ?AT .q/ (8.39e)\n? .?.!/q/ D ?.!/?.q/ D ? ??.q/\u0152!??C q!T ?A.q/ (8.39f)\n? .?.!/q/ D ? ?AT .q/!\t?.q/ D ?.q/\u0152!?? ? q!T (8.39g)\n? .? .!/q/ D ? .A.q/!/ ?.q/ D ??.q/\u0152!?? ? q!T (8.39h)\n\n??\n?T .q/K q\n\n\t?? D kqk2 ?A.q/BT ? B AT .q/? (8.39i)\n?T .q/K q D kqk2\u0152b??A.q/r (8.39j)\n?T .q/K q D ?kqk2\u0152r??AT .q/b (8.39k)\n\nwith K and B given by Eqs. (8.33) and (8.34), respectively. All the identities in this\nsection except Eq. (8.38) are valid for any 3 ? 1 vectors b, r, and !.\n\nWe now use Eqs. (8.25) and (8.23c) to derive the measurement sensitivity matrix\nused in the additive extended Kalman filter [3]. Our goal is to find an expression for\n\nH ? @\n@q\n\u0152A.q/r? D @\n\n@q\n\n?kqk?2 ?T .q/? .r/q? (8.40)\n\nIt is important to include the factor of kqk?2 when evaluating the partial derivatives\nbecause the components of q are varied independently during this process, violating\nthe norm constraint. Evaluating the partials in Eq. (8.40) gives\n\nH D kqk?2\n?\n@\n\n@q\n?T .q/\n\n?\n? .r/qC kqk?2?T .q/? .r/ ? 2 kqk?4?T .q/? .r/q qT\n\n(8.41)\n\nNote in the first term that ? .r/q ? Nq is an unnormalized quaternion that is assumed\nconstant during the differentiation, so we can use Eq. (8.20d) to get\n\n?\n@\n\n@q\n?T .q/\n\n?\n? .r/q D @\n\n@q\n\n?\n?T .q/ Nq? D ? @\n\n@q\n\n?\n?T . Nq/q? D ??T . Nq/ D ?T .q/? .r/\n\n(8.42)\n\n\n\n354 8 Quaternion Identities\n\nwhere the last equality results from Eq. (8.39e). Collecting terms and using\nEq. (8.20b) yields\n\nH D 2kqk?4?T .q/? .r/ ?kqk2I4 ? q qT\n\t D 2kqk?4?T .q/? .r/?.q/?T .q/\n\n(8.43)\n\nThen applying Eq. (8.39c) gives the final result\n\nH D 2kqk?2\u0152A.q/r?? ?T .q/ (8.44)\n\nNote that kqk D 1 in most applications and that the sensitivity matrix in the\nmultiplicative filter is \u0152A.q/r?? [3].\n\n8.5 Error Quaternions\n\nA common quantity used in estimation and control is the error quaternion between\ntwo quaternions, denoted by\n\n?q ?\n?\n?q1W3\n?q4\n\n?\nD q? Nq?1 D kNqk?2q? Nq? (8.45)\n\nwhere Nq is the estimated quaternion in estimation theory or the desired quaternion in\ncontrol theory. The rules of quaternion multiplication show that k?qk D kqk=kNqk,\nand that ?q1W3 and ?q4 are given by\n\n?q1W3 D kNqk?2 ?T . Nq/q D ?kNqk?2 ?T .q/ Nq (8.46a)\n?q4 D kNqk?2 NqT q (8.46b)\n\nIf ?q is normalized and is close to the identity quaternion, then ?q1W3 ? ?=2 and\n?q4 ? 1, where ? is a vector of small angle rotations. As q approaches Nq, then ?q1W3\nand ? both approach zero.\n\nA \u201cspace-referenced error quaternion,\u201d ?qI , is defined by\n\n?qI ?\n?\n?q1W3I\n?q4\n\n?\nD Nq?1 ? q D Nq?1 ? ?q? Nq (8.47a)\n\n?q D Nq? ?qI ? Nq?1 (8.47b)\n\nQuaternion multiplication shows that ?q4I D ?q4 and that ?q1W3I is given by\n\n?q1W3I D kNqk?2?T . Nq/q D ?kNqk?2?T .q/ Nq (8.48)\n\n\n\n8.6 Quaternion Kinematics 355\n\nThe meaning of the space-referenced error quaternion is clearly shown by2\n\n?q1W3 D A.q/?q1W3I D A. Nq/?q1W3I (8.49a)\n?q1W3I D AT .q/?q1W3 D AT . Nq/?q1W3 (8.49b)\n\nIdentities involving the error quaternion are given by [2]\n\n?T . Nq/?.q/ D kNqk2 f?q4I3 C \u0152?q1W3??g (8.50a)\n?\n?T . Nq/?.q/??1 D kNqk?2 I3 C A.?q/\n\n2?q4\n(8.50b)\n\n?\n?T . Nq/?.q/??1 ?q1W3 D kNqk?2 ?q1W3\n\n?q4\n(8.50c)\n\n?T . Nq/?.q/ D kNqk2 f?q4I3 ? \u0152?q1W3I??g (8.50d)\n?\n?T . Nq/?.q/??1 D kNqk?2 I3 C A\n\nT .?qI /\n2?q4\n\n(8.50e)\n\n?\n?T . Nq/?.q/??1 ?q1W3I D kNqk?2\n\n?q1W3I\n?q4\n\n(8.50f)\n\nA.?q/ D A.q/AT . Nq/ D ??T . Nq/?.q/??1 ?T .q/?. Nq/ (8.50g)\nAT .?qI / D AT .q/A. Nq/ D\n\n?\n?T . Nq/?.q/??1 ?T .q/?. Nq/ (8.50h)\n\nNote that the inverses of ?T . Nq/?.q/ and ?T . Nq/?.q/ are singular for 180? errors.\nEquation (8.50) can used to develop a control law that produces linear error\ndynamics [2, 4]. Also note that both Eqs. (8.50c) and (8.50f) are related to the\nRodrigues parameters or Gibbs vector.\n\n8.6 Quaternion Kinematics\n\nThe quaternion kinematic equation is given by\n\nPq D 1\n2\n!? q D 1\n\n2\n?.!/q D 1\n\n2\n?.q/! (8.51)\n\nNote that qT Pq D 0, so this equation preserves the quaternion norm. A major\nadvantage of using normalized quaternions is that the kinematic equation is linear in\nthe quaternion and is also free of singularities. Differentiating Eq. (8.51) and using\nEq. (8.23h) gives\n\n2These equations are true even though A.q/ \u00a4 A.Nq/ because A.?q/?q1W3 D ?q1W3.\n\n\n\n356 8 Quaternion Identities\n\nRq D 1\n2\n?.q/ P!C 1\n\n2\n?.!/ Pq D 1\n\n2\n?.q/ P! ? 1\n\n4\nk!k2q (8.52)\n\nSubstituting a dynamics equation for P! relates the quaternion to a torque input.\nThe inverse kinematic equation is given by multiplying Eq. (8.51) by ?T .q/ and\n\napplying Eq. (8.20a), yielding\n\n! D 2kqk?2 ?T .q/ Pq (8.53)\n\nIf we define the \u201cspace-referenced angular velocity,\u201d !I , by\n\n?\n!I\n\n0\n\n?\nD q?1 ?!? q D\n\n?\nAT .q/!\n\n0\n\n?\n(8.54)\n\nthen the following relationships can be derived:\n\nq? ?! D !I ? q? (8.55a)\n? .!/q? D ?.q?/! D ?.!I /q? D ?.q?/!I (8.55b)\n\n!? q D q?!I (8.55c)\n?.!/q D ?.q/! D ? .!I /q D ?.q/!I (8.55d)\n\nThe definition of the attitude matrix in Eq. (8.25) can be used to show that the\nquaternion kinematic equation in Eq. (8.51) can also be written as\n\nPq D 1\n2\n?.q/!I D 1\n\n2\n? .!I /q (8.56a)\n\n!I D 2kqk?2 ?T .q/ Pq (8.56b)\n\nThe derivative of the matrix ?.q/ is given by [6]\n\nd\n\ndt\n?.q/ D 1\n\n2\n? .!I /?.q/ D 1\n\n2\n?.q/\u0152!?? ? 1\n\n2\nq!T\n\nD 1\n2\n?.!/?.q/C?.q/\u0152!?? (8.57)\n\nThe derivative of the matrix ?.q/ is given by\n\nd\n\ndt\n?.q/ D 1\n\n2\n?.!/?.q/ D ?1\n\n2\n?.q/\u0152!I?? ? 1\n\n2\nq!TI\n\nD 1\n2\n? .!I /?.q/ ? ?.q/\u0152!I?? (8.58)\n\n\n\n8.6 Quaternion Kinematics 357\n\nThe identity of the various forms of the right sides of Eqs. (8.57) and (8.58) is proven\nby Eqs. (8.54), (8.39g), (8.23f), (8.39h), and (8.23g).\n\nDerivatives of the matrices \u0152q?? and \u0152q?? are given by [6]\nd\n\ndt\n\u0152q?? D 1\n\n2\n?.!/\u0152q?? D 1\n\n2\n\u0152q???.!I / (8.59a)\n\nd\n\ndt\n\u0152q?? D 1\n\n2\n\u0152q??? .!/ D 1\n\n2\n? .!I /\u0152q?? (8.59b)\n\nwhere the identities in Eqs. (8.29c) and (8.29e) have been used in Eq. (8.59).\nTaking the time derivative of Eq. (8.45) gives the kinematical relationship for the\n\nerror quaternion ?q:\n\nd\n\ndt\n?q D Pq? Nq?1 C q? d Nq\n\n?1\n\ndt\nD 1\n2\n!? q? Nq?1 C q? d Nq\n\n?1\n\ndt\n\nD 1\n2\n!? ?qC q? d Nq\n\n?1\n\ndt\n(8.60)\n\nWe now need to determine an expression for the derivative of Nq?1. The esti-\nmated/desired quaternion kinematic model follows\n\nPNq D 1\n2\nN!? Nq (8.61)\n\nTaking the time derivative of Iq D Nq? Nq?1 gives\n\n0 D PNq? Nq?1CNq? d Nq\n?1\n\ndt\nD 1\n2\nN!? Nq? Nq?1CNq? d Nq\n\n?1\n\ndt\nD 1\n2\nN!CNq? d Nq\n\n?1\n\ndt\n\n(8.62)\n\nyielding\n\nd Nq?1\ndt\nD ?1\n\n2\nNq?1 ? N! (8.63)\n\nand thus\n\nd\n\ndt\n?q D 1\n\n2\n\n?\n!? ?q ? q? Nq?1 ? N!\t D 1\n\n2\n.!? ?q ? ?q? N!/ (8.64)\n\nWe now define the following error angular velocity: ?! ? ! ? N!. Substituting\n! D N!C ?! into Eq. (8.64) leads to\n\nd\n\ndt\n?q D 1\n\n2\n. N!? ?q ? ?q? N!/C 1\n\n2\n?!? ?q (8.65)\n\n\n\n358 8 Quaternion Identities\n\nEvaluating the quaternion products gives\n\nd\n\ndt\n?q1W3 D ? N! ? ?q1W3 C 1\n\n2\n.?q4 ?! ? ?! ? ?q1W3/ (8.66a)\n\nd\n\ndt\n?q4 D ?1\n\n2\n?!T ?q1W3 (8.66b)\n\nEquation (8.66a) can also be derived by differentiating Eq. (8.46a), leading to\n\nd\n\ndt\n?q1W3 D 1\n\n2kNqk2\n?\n?T . Nq/?.q/! ??T .q/?. Nq/ N!? (8.67)\n\nEquation (8.50a) can used to prove that Eq. (8.66a) is equivalent to Eq. (8.67).\nWe define the \u201cspace-referenced error angular velocity,\u201d ?!I , by\n\n?!I ? !I ? N!I D AT .q/! ? AT . Nq/ N! (8.68)\n\nNote that ?!I \u00a4 AT ?! for either A.q/ or A. Nq/,3 but that Eq. (8.49b) gives\n\n?qT1W3I?!I D\n?\nAT .q/?q1W3\n\n?T\nAT .q/! ? ?AT . Nq/?q1W3\n\n?T\nAT . Nq/ N! D ?qT1W3?!\n\n(8.69)\n\nFollowing the derivation of Eq. (8.65), we can evaluate the derivative of ?qI as\n\nd\n\ndt\n?qI D 1\n\n2\n.?qI ?!I ? N!I ? ?qI /\n\nD 1\n2\n.?qI ? N!I ? N!I ? ?qI /C 1\n\n2\n?qI ? ?!I (8.70)\n\nwhich has the vector and scalar parts\n\nd\n\ndt\n?q1W3I D N!I ? ?q1W3I C\n\n1\n\n2\n.?q4?!I C ?!I ? ?q1W3I / (8.71a)\n\nd\n\ndt\n?q4 D ?1\n\n2\n?!TI ?q1W3I (8.71b)\n\nEquation (8.71a) can also be derived by differentiating Eq. (8.48), leading to\n\nd\n\ndt\n?q1W3I D\n\n1\n\n2kNqk2\n?\n?T . Nq/?.q/!I ? ?T .q/?. Nq/ N!I\n\n?\n(8.72)\n\nEquation (8.50d) can used to prove that Eq. (8.71a) is equivalent to Eq. (8.72).\n\n3An orthogonal transformation would preserve the norm, giving k?!Ik D k?!k, and it is not\ndifficult to show that k?!Ik2 D k?!k2 C 2!T \u0152I3 ? A.?!/? N!.\n\n\n\nReferences 359\n\nSome kinematic identities involving\n?\n?T . Nq/?.q/??1 are given by\n\n2\n?\n?T . Nq/?.q/??1 ?T .q/ PNq D A.?q/ N! (8.73a)\n\n2\n?\n?T . Nq/?.q/??1 ?T .q/ RNq D A.?q/ PN!C k N!k\n\n2\n\n2?q4\n?q1W3 (8.73b)\n\n2\n?\n?T . Nq/?.q/??1 ?T . PNq/?.!/q D\n\n?\n\u0152!??C ?q1W3!\n\nT\n\n?q4\n\n?\nA.?q/ N! (8.73c)\n\nReferences\n\n1. Choukroun, D., Bar-Itzhack, I.Y., Oshman, Y.: Novel quaternion Kalman filter. IEEE Trans.\nAerospace Electron. Syst. 42(1), 174\u2013190 (2006)\n\n2. Crassidis, J.L., Junkins, J.L.: Optimal Estimation of Dynamic Systems, 2nd edn. CRC Press,\nBoca Raton (2012)\n\n3. Lefferts, E.J., Markley, F.L., Shuster, M.D.: Kalman filtering for spacecraft attitude estimation.\nJ. Guid. Contr. Dynam. 5(5), 417\u2013429 (1982)\n\n4. Paielli, R.A., Bach, R.E.: Attitude control with realization of linear error dynamics. J. Guid.\nContr. Dynam. 16(1), 182\u2013189 (1993)\n\n5. Pittelkau, M.E.: Square root quaternion estimation. In: AIAA/AAS Astrodynamics Specialist\nConference and Exhibit. Monterey, CA (2002). AIAA 2002-4914\n\n6. Shuster, M.D.: A survey of attitude representations. J. Astronaut. Sci. 41(4), 439\u2013517 (1993)\n7. Shuster, M.D., Oh, S.D.: Attitude determination from vector observations. J. Guid. Contr. 4(1),\n\n70\u201377 (1981)\n\n\n\nChapter 9\nEuler Angles\n\nThis chapter presents explicit expressions for the attitude matrices and kinematic\nmatrices for all the 12 Euler and Tait-Bryan angle attitude representations. We first\npresent the attitude matrices for the symmetric and asymmetric sets. Then the\nkinematic matrices B.?;  /, defined by Eq. (3.39), and their inverses are shown for\nall the symmetric and asymmetric sets. These matrices are used in the kinematic\nrelations:\n\n2\n4\nP?\nP?\nP \n\n3\n5 D B.?;  /! (9.1)\n\nwhere ! ? \u0152!1 !2 !3?T is the angular velocity vector, and\n\n! D B?1.?;  /\n2\n4\nP?\nP?\nP \n\n3\n5 (9.2)\n\nThe abbreviated notation c ? cos and s ? sin is employed in Tables 9.1, 9.2,\n9.3, 9.4.\n\nTable 9.5 gives equations for converting the symmetric and asymmetric Euler\nangle sets directly to quaternions, without the need to compute the attitude matrix\nas an intermediate step.\n\nF.L. Markley and J.L. Crassidis, Fundamentals of Spacecraft Attitude Determination\nand Control, Space Technology Library 33, DOI 10.1007/978-1-4939-0802-8__9,\n\u00a9 Springer Science+Business Media New York 2014\n\n361\n\n\n\n362 9 Euler Angles\n\nTable 9.1 Attitude matrix: six symmetric sets\n\nAxes Attitude matrix\n\n1?2?1\n2\n4\n\nc? s? s? ?c? s?\ns? s c? c ? s? c? s s? c C c? c? s \ns? c ?c? s ? s? c? c ?s? s C c? c? c \n\n3\n5\n\n1?3?1\n2\n4\n\nc? c? s? s? s?\n?s? c ?s? s C c? c? c c? s C s? c? c \ns? s ?s? c ? c? c? s c? c ? s? c? s \n\n3\n5\n\n2?1?2\n2\n4\n\nc? c ? s? c? s s? s ?s? c ? c? c? s \ns? s? c? c? s?\n\nc? s C s? c?c ?s? c ?s? s C c? c? c \n\n3\n5\n\n2?3?2\n2\n4\n\n?s? s C c? c? c s? c ?c? s ? s? c? c \n?c? s? c? s? s?\n\ns? c C c? c? s s? s c? c ? s? c? s \n\n3\n5\n\n3?1?3\n2\n4\n\nc? c ? s? c? s s? c C c? c? s s? s \n?c? s ? s? c? c ?s? s C c? c? c s? c \n\ns? s? ?c? s? c?\n\n3\n5\n\n3?2?3\n2\n4\n\n?s? s C c? c? c c? s C s? c? c ?s? c \n?s? c ? c? c? s c? c ? s? c? s s? s \n\nc? s? s? s? c?\n\n3\n5\n\nTable 9.2 Attitude matrix: six asymmetric sets\n\nAxes Attitude matrix\n\n1?2?3\n2\n4\n\nc? c c? s C s? s? c s? s ? c? s? c \n?c? s c? c ? s? s? s s? c C c? s? s \n\ns? ?s? c? c? c?\n\n3\n5\n\n1?3?2\n2\n4\n\nc? c s? s C c? s? c ?c? s C s? s? c \n?s? c? c? s? c?\n\nc? s ?s? c C c? s? s c? c C s? s? s \n\n3\n5\n\n2?1?3\n2\n4\n\nc? c C s? s? s c? s ?s? c C c? s? s \n?c? s C s? s? c c? c s? s C c? s? c \n\ns? c? ?s? c? c?\n\n3\n5\n\n2?3?1\n2\n4\n\nc? c? s? ?s? c?\ns? s ? c? s? c c? c c? s C s? s? c \ns? c C c? s? s ?c? s c? c ? s? s? s \n\n3\n5\n\n3?1?2\n2\n4\n\nc? c ? s? s? s s? c C c? s? s ?c? s \n?s? c? c? c? s?\n\nc? s C s? s? c s? s ? c? s? c c? c \n\n3\n5\n\n3?2?1\n2\n4\n\nc? c? s? c? ?s?\n?s? c C c? s? s c? c C s? s? s c? s \ns? s C c? s? c ?c? s C s? s? c c? c \n\n3\n5\n\n\n\n9 Euler Angles 363\n\nTable 9.3 The matrix B.?;  /\n\nAxes Symmetric sets Axes Asymmetric sets\n\n1?2?1 1\ns?\n\n2\n4\n0 s c \n0 s? c ?s? s \ns? ?c? s ?c? c \n\n3\n5 1?2?3 1\n\nc?\n\n2\n4\n\nc ?s 0\nc? s c? c 0\n\n?s? c s? s c?\n\n3\n5\n\n1?3?1 1\ns?\n\n2\n4\n0 ?c s \n0 s? s s? c \ns? c? c ?c? s \n\n3\n5 1?3?2 1\n\nc?\n\n2\n4\n\nc 0 s \n?c? s 0 c? c \ns? c c? s? s \n\n3\n5\n\n2?1?2 1\ns?\n\n2\n4\n\ns 0 ?c \ns? c 0 s? s \n\n?c? s s? c? c \n\n3\n5 2?1?3 1\n\nc?\n\n2\n4\n\ns c 0\nc? c ?c? s 0\ns? s s? c c?\n\n3\n5\n\n2?3?2 1\ns?\n\n2\n4\n\nc 0 s \n?s? s 0 s? c \n?c? c s? ?c? s \n\n3\n5 2?3?1 1\n\nc?\n\n2\n4\n0 c ?s \n0 c? s c? c \n\nc? ?s? c s? s \n\n3\n5\n\n3?1?3 1\ns?\n\n2\n4\n\ns c 0\ns? c ?s? s 0\n\n?c? s ?c? c s?\n\n3\n5 3?1?2 1\n\nc?\n\n2\n4\n\n?s 0 c \nc? c 0 c? s \ns? s c? ?s? c \n\n3\n5\n\n3?2?3 1\ns?\n\n2\n4\n\n?c s 0\ns? s s? c 0\nc? c ?c? s s?\n\n3\n5 3?2?1 1\n\nc?\n\n2\n4\n0 s c \n0 c? c ?c? s \n\nc? s? s s? c \n\n3\n5\n\nTable 9.4 The matrix B?1.?;  /\n\nAxes Symmetric sets Axes Asymmetric sets\n\n1?2?1\n2\n4\n\nc? 0 1\ns? s c 0\ns? c ?s 0\n\n3\n5 1?2?3\n\n2\n4\n\nc? c s 0\n?c? s c 0\n\ns? 0 1\n\n3\n5\n\n1?3?1\n2\n4\n\nc? 0 1\n?s? c s 0\ns? s c 0\n\n3\n5 1?3?2\n\n2\n4\n\nc? c ?s 0\n?s? 0 1\n\nc? s c 0\n\n3\n5\n\n2?1?2\n2\n4\n\ns? s c 0\nc? 0 1\n\n?s? c s 0\n\n3\n5 2?1?3\n\n2\n4\n\nc? s c 0\nc? c ?s 0\n?s? 0 1\n\n3\n5\n\n2?3?2\n2\n4\n\ns? c ?s 0\nc? 0 1\n\ns? s c 0\n\n3\n5 2?3?1\n\n2\n4\n\ns? 0 1\nc? c s 0\n\n?c? s c 0\n\n3\n5\n\n3?1?3\n2\n4\n\ns? s c 0\ns? c ?s 0\n\nc? 0 1\n\n3\n5 3?1?2\n\n2\n4\n\n?c? s c 0\ns? 0 1\n\nc? c s 0\n\n3\n5\n\n3?2?3\n2\n4\n\n?s? c s 0\ns? s c 0\n\nc? 0 1\n\n3\n5 3?2?1\n\n2\n4\n\n?s? 0 1\nc? s c 0\nc? c ?s 0\n\n3\n5\n\n\n\n364 9 Euler Angles\n\nTable 9.5 Euler angle to quaternion conversions\n\nAxes Quaternion Axes Quaternion\n\n1?2?1\n\n2\n664\n\nNc? Ns.? C  /\nNs? Nc.? ?  /\nNs? Ns.? ?  /\nNc? Nc.? C  /\n\n3\n775 1?2?3\n\n2\n664\n\nNs? Nc? Nc C Nc? Ns? Ns \nNc? Ns? Nc ? Ns? Nc? Ns \nNc? Nc? Ns C Ns? Ns? Nc \nNc? Nc? Nc ? Ns? Ns? Ns \n\n3\n775\n\n1?3?1\n\n2\n664\n\nNc? Ns.? C  /\nNs? Ns. ? ?/\nNs? Nc. ? ?/\nNc? Nc.? C  /\n\n3\n775 1?3?2\n\n2\n664\n\nNs? Nc? Nc ? Nc? Ns? Ns \nNc? Nc? Ns ? Ns? Ns? Nc \nNc? Ns? Nc C Ns? Nc? Ns \nNc? Nc? Nc C Ns? Ns? Ns \n\n3\n775\n\n2?1?2\n\n2\n664\n\nNs? Nc. ? ?/\nNc? Ns.? C  /\nNs? Ns. ? ?/\nNc? Nc.? C  /\n\n3\n775 2?1?3\n\n2\n664\n\nNc? Ns? Nc C Ns? Nc? Ns \nNs? Nc? Nc ? Nc? Ns? Ns \nNc? Nc? Ns ? Ns? Ns? Nc \nNc? Nc? Nc C Ns? Ns? Ns \n\n3\n775\n\n2?3?2\n\n2\n664\n\nNs? Ns.? ?  /\nNc? Ns.? C  /\nNs? Nc.? ?  /\nNc? Nc.? C  /\n\n3\n775 2?3?1\n\n2\n664\n\nNc? Nc? Ns C Ns? Ns? Nc \nNs? Nc? Nc C Nc? Ns? Ns \nNc? Ns? Nc ? Ns? Nc? Ns \nNc? Nc? Nc ? Ns? Ns? Ns \n\n3\n775\n\n3?1?3\n\n2\n664\n\nNs? Nc.? ?  /\nNs? Ns.? ?  /\nNc? Ns.? C  /\nNc? Nc.? C  /\n\n3\n775 3?1?2\n\n2\n664\n\nNc? Ns? Nc ? Ns? Nc? Ns \nNc? Nc? Ns C Ns? Ns? Nc \nNc? Ns? Ns C Ns? Nc? Nc \nNc? Nc? Nc ? Ns? Ns? Ns \n\n3\n775\n\n3?2?3\n\n2\n664\n\nNs? Ns. ? ?/\nNs? Nc. ? ?/\nNc? Ns.? C  /\nNc? Nc.? C  /\n\n3\n775 3?2?1\n\n2\n664\n\nNc? Nc? Ns ? Ns? Ns? Nc \nNc? Ns? Nc C Ns? Nc? Ns \nNs? Nc? Nc ? Nc? Ns? Ns \nNc? Nc? Nc C Ns? Ns? Ns \n\n3\n775\n\nwhere Nc.?/ ? cos.?=2/ and Ns.?/ ? sin.?=2/\n\n\n\nChapter 10\nOrbital Dynamics\n\nThe study of bodies in orbit has attracted the world\u2019s greatest mathematicians in\nthe past, and remains a flourishing subject area in the present. In fact many useful\nmathematical concepts, such as Bessel functions and nonlinear least squares, can\nbe directly traced back to the study of orbital motion. Here the basic equations\nand concepts of orbital dynamics are introduced. More details can be found in the\nreferences herein.\n\nIn the seventeenth century, Johannes Kepler propounded his three laws of\nplanetary motion defining the shape of planetary orbits, the velocity at which planets\ntravel around the Sun, and the time required for a planet to complete an orbit. They\nstate that\n\n1. The orbit of each planet is an ellipse, with the Sun at a focus.\n2. The line joining the planet to the Sun sweeps out equal areas in equal times.\n3. The square of the period of a planet is proportional to the cube of its mean\n\ndistance from the Sun.\n\nSince ellipses are a basic element in the study of orbital motion, we begin this\nchapter with a review of the geometry of ellipses.\n\nIn this chapter all position, r, and velocity, v, vectors are expressed in inertial\ncoordinates, unless a different frame is explicitly indicated. Thus, the subscript I is\nremoved from these vectors for brevity.\n\n10.1 Geometry of Ellipses\n\nThis section provides a review of elliptical geometry, which will later be used to\ndescribe the motion of a spacecraft in orbit. Figure 10.1 shows a basic ellipse using a\ntwo-center bipolar coordinate system, centered at .x0; y0/. The variable a is known\nas the semimajor axis and the variable b is the semiminor axis. By definition the\ntwo-center bipolar coordinate equation is given by\n\nF.L. Markley and J.L. Crassidis, Fundamentals of Spacecraft Attitude Determination\nand Control, Space Technology Library 33, DOI 10.1007/978-1-4939-0802-8__10,\n\u00a9 Springer Science+Business Media New York 2014\n\n365\n\n\n\n366 10 Orbital Dynamics\n\nFig. 10.1 Two-center bipolar\nellipse coordinate system\n\nr1 C r2 D 2a (10.1)\n\nAssuming that x0 D y0 D 0, the first focus F1 is at .?c; 0/ and the second focus F2\nis at .c; 0/. We wish to describe a point given by both r1 and r2 using the coordinates\nx and y. It is easy to show that r1 D\n\np\n.x C c/2 C y2 and r2 D\n\np\n.x ? c/2 C y2.\n\nSubstituting these quantities into Eq. (10.1) gives\n\np\nx2 C y2 C c2 C 2cx C\n\np\nx2 C y2 C c2 ? 2cx D 2a (10.2)\n\nSquaring both sides of Eq. (10.2) gives\n\n2.x2 C y2 C c2/C 2\np\n.x2 C y2 C c2/2 ? 4c2x2 D 4a2 (10.3)\n\nRearranging terms and squaring again leads to\n\n.x2 C y2 C c2/2 ? 4c2x2 D \u01522a2 ? .x2 C y2 C c2/?2\n\nD 4a4 ? 4a2.x2 C y2 C c2/C .x2 C y2 C c2/2\n(10.4)\n\nGrouping terms and dividing by 4a2.a2 ? c2/ then leads to\n\nx2\n\na2\nC y\n\n2\n\na2 ? c2 D 1 (10.5)\n\nThe points on the ellipse at x D 0 have y D ?b, so r1 D r2 D\np\nc2 C b2 D a at\n\nthese points. Substituting a2 ? c2 D b2 into Eq. (10.5) gives the basic equation for\nan ellipse:\n\nx2\n\na2\nC y\n\n2\n\nb2\nD 1 (10.6)\n\n\n\n10.1 Geometry of Ellipses 367\n\nFig. 10.2 Focal definition of ellipse\n\nFig. 10.3 Relationships in focal definition of ellipse\n\nAnother way to describe an ellipse is to use the focal definition, which states\nthat an ellipse is the locus of points the ratio of whose distances from a fixed\nline, the directrix, to a fixed point, the focus, is a constant e, called the eccentricity.\nThis definition is depicted in Fig. 10.2, where the vertical line through D1 is\nthe directrix associated with F1 and the vertical line through D2 is the directrix\nassociated with F2. The eccentricity is e D r1=g1 D r2=g2, where g1 and g2 are\nthe distances from the comparative directrices to the desired point on the ellipse.\nAdding r1 D e g1 and r2 D e g2 gives\n\nr1 C r2 D e.g1 C g2/ (10.7)\n\nComparing Eqs. (10.1) and (10.7) gives a D e g, where g is the distance shown in\nFig. 10.3.\n\nReferring to Fig. 10.3 the following relationships can be seen:\n\nrp D a ? c D e gp (10.8a)\ng D aC gp (10.8b)\n\n\n\n368 10 Orbital Dynamics\n\nwhere rp is the radial distance to the periapsis, the orbital point closest to the focus,\nand gp is the distance from the directrix to the periapsis. Also, ra D a C c is the\nradial distance to the apoapsis, the orbital point farthest from the focus. For Earth-\norbiting space objects the closest and farthest points are called perigee and apogee,\nrespectively. Substituting Eq. (10.8b) into a D e g and using Eq. (10.8a) gives\n\na D ae C e gp D ae C a ? c (10.9)\nSolving Eq. (10.9) for e gives the well-known result:\n\ne D c\na\n\n(10.10)\n\nSubstituting c D pa2 ? b2 into this yields\n\ne D\nr\n1 ? b\n\n2\n\na2\n(10.11)\n\nwhich clearly shows that the eccentricity of a circle, for which a D b, is zero as\nexpected. Substituting Eq. (10.10) into g D a=e yields\n\ng D a\n2\n\nc\n(10.12)\n\nAnother form for the eccentricity is given by\n\ne D a ? c\ng ? a D\n\np\nb2 C c2\ng\n\n(10.13)\n\nSubstituting c D e a into rp D a ? c and ra D aC c gives\nrp D a.1 ? e/ (10.14a)\nra D a.1C e/ (10.14b)\n\nEquations (10.6) and (10.10) give y D bp1 ? e2 when x D c. This distance is\nknown as the semilatus rectum, a combination of the Latin words \u201csemi,\u201d meaning\nhalf, \u201clatus,\u201d meaning side, and \u201crectum,\u201d meaning straight. It is shown as p in\nFig. 10.4, so we have\n\np D a.1 ? e2/ (10.15)\nIt is often more convenient to represent an ellipse in polar coordinate form rather\n\nthan the Cartesian form of Eq. (10.6). Referring to Fig. 10.5 the x and y components\nare related to the polar coordinates r and ? by\n\nx D c C r cos ? (10.16a)\ny D r sin ? (10.16b)\n\n\n\n10.1 Geometry of Ellipses 369\n\nFig. 10.4 Semilatus rectum\ndefinition\n\nFig. 10.5 Polar coordinate\ndefinition of an ellipse\n\nwhere ? is known as the true anomaly, which is defined as a positive rotation from\nthe periapsis direction. Substituting Eq. (10.16) into Eq. (10.6) and multiplying both\nsides by b2 gives\n\n.b2=a2/.c2 C 2 c r cos ? C r2 cos2 ?/C r2 sin2 ? D b2 (10.17)\nSubstituting sin2 ? D 1?cos2 ?, using b2 D a2.1?e2/ from Eq. (10.11) and c D e a\nfrom Eq. (10.10), and collecting terms leads to\n\n0 D r2 ? e2r2 cos2 ? C 2a.1 ? e2/ e r cos ? ? a2.1 ? e2/2\n\nD r2 ? \u0152a.1 ? e2/ ? e r cos ??2 (10.18)\nso r is given by\n\nr D ?\u0152a.1 ? e2/ ? e r cos ?? (10.19)\nThe plus sign must be used because r is positive. This leads to\n\nr D a.1 ? e\n2/\n\n1C e cos ? (10.20)\n\nUsing Eq. (10.15) expresses this in terms of the semilatus rectum\n\nr D p\n1C e cos ? (10.21)\n\nNote that when e D 0 then r D p, which represents a circle.\n\n\n\n370 10 Orbital Dynamics\n\n10.2 Keplerian Motion\n\nKepler\u2019s three laws of motion, stated at the beginning of this chapter, can be proven\nmathematically from Newton\u2019s universal law of gravitation. Newton stated that any\ntwo bodies with mass M and m attract each other by force that acts along the line\nr joining them with magnitude directly proportional to the product of their masses\nand inversely proportional to the square of the distance r D krk between them.\nMathematically, this statement is given by\n\nFg D ?GMm r\nr3\n\n(10.22)\n\nwhere G is the universal gravitation constant [3, 4].\nConsider the two bodies in Fig. 10.6, where Rc denotes the vector to the center\n\nof mass. Applying Newton\u2019s law for each body we obtain\n\nM RRM D ? GMmkRM ? Rmk3 .RM ? Rm/ (10.23a)\n\nm RRm D ? GMmkRM ? Rmk3 .Rm ? RM/ (10.23b)\n\nAdding Eqs. (10.23a) and (10.23b) gives\n\nM RRM Cm RRm D 0 (10.24)\nThe center of mass is given by\n\nRc D MRM CmRm\nM Cm (10.25)\n\nso Eq. (10.24) gives RRc D 0 at all time. This states that the center of mass moves in\na straight line at constant velocity. We are also interested in determining the relative\nposition, r D Rm ? RM , of the smaller mass (e.g. a satellite) with respect to the\nlarge mass (e.g. the Earth). Subtracting Eq. (10.23a) from Eq. (10.23b) leads to\n\nRr D ? ?\nr3\n\nr (10.26)\n\nFig. 10.6 Relative motion of\ntwo bodies\n\n\n\n10.2 Keplerian Motion 371\n\nwhere? D G.MCm/ is the gravitational parameter. The approximation? ? GM\nis obviously a good one for most orbiting bodies since M \n m. Perturbations\ndue to conservative forces, such as the gravity differential force due to the Earth\u2019s\noblateness, and non-conservative forces, such as drag and solar radiation pressure,\nare often added to the right hand side of Eq. (10.26). These perturbations will be\ndiscussed in Sect. 10.3.\n\nEquation (10.26) can be used to show that the energy and angular momentum of\norbital motion are conserved. The specific kinetic energy, i.e. the kinetic energy per\nunit mass, is given by\n\nT ? 1\n2\nv2 (10.27)\n\nThe time derivatives of T , using Eq. (10.26), is\n\nPT D d\ndt\n\n? Pr ? Pr\n2\n\n?\nD Pr ? Rr D ??Pr ? r\n\nr3\n(10.28)\n\nThe specific potential energy is defined by\n\nV ? ??\nr\n\n(10.29)\n\nThe time derivative of V is\n\nPV D ?? d\ndt\n.r ? r/?1=2 D ?Pr ? r\n\nr3\n(10.30)\n\nAdding Eqs. (10.28) and (10.30) proves that the specific energy\n\nE D T C V (10.31)\n\nhas time derivative zero, i.e. that it is conserved.\nThe specific angular momentum is given by\n\nh ? r ? v D r ? Pr (10.32)\nIts time derivative is\n\nPh D Pr ? PrC r ? Rr D ? ?\nr3\n\nr ? r D 0 (10.33)\n\nshowing that the angular momentum is conserved. Since r and v are both perpen-\ndicular to the constant vector h, the position and velocity vectors must remain in a\nfixed plane, called the orbital plane, perpendicular to h.\n\nWe now use Eq. (10.26) to prove Kepler\u2019s three laws. Figure 10.7 depicts the area\nswept out by a line joining the primary mass and its satellite. This area is half the\narea of a parallelogram formed by r and dr:\n\n\n\n372 10 Orbital Dynamics\n\nFig. 10.7 Area sweep of\nprimary mass and satellite\n\ndA D 1\n2\nkr ? drk D 1\n\n2\nkr ? dr\n\ndt\ndtk\n\nD 1\n2\nkr ? Prkdt D 1\n\n2\nh dt\n\n(10.34)\n\nSince h is constant then Eq. (10.34) indicates that the line sweeps out equal areas in\nequal times, which proves Kepler\u2019s second law.\n\nSince h is constant, then\n\nd\n\ndt\n.Pr?h/ D Rr?h D ? ?\n\nr3\nr?h D ? ?\n\nr3\nr? .r? Pr/ D ? ?\n\nr3\n\n?\n.r ? Pr/r ? r2 Pr? (10.35)\n\nwhere Eq. (8.2e), the \u201cbac?cab\u201d rule, has been used. Combining this with\nEq. (10.30) gives\n\nd\n\ndt\n\n\nPr ? h ? ?\n\nr\nr\n?\nD 0 (10.36)\n\nIntegrating this equation gives\n\nPr ? h ? ?\nr\n\nr D ? e (10.37)\n\nwhere the integration constant ? e is commonly referred to as the Laplace vector.\nClearly Pr ? h is in the orbit plane, so e must also be in this plane. Forming the dot\nproduct of (10.37) with r gives\n\n? r ? e D r ? .Pr ? h/ ? ?r D .r ? Pr/ ? h ? ?r D h2 ? ?r (10.38)\n\nwhere we have used Eq. (2.56a). Let  be the angle between r and e, so that\nEq. (10.38) becomes h2 D ? r C ? r e cos , or\n\nr D h\n2=?\n\n1C e cos (10.39)\n\nThis is just Eq. (10.21) for an ellipse in polar coordinates, where h2=? is the\nsemilatus rectum,  ? ? is the true anomaly shown in Fig. 10.5, and e is the\neccentricity, proving Kepler\u2019s first law. It also requires the vector e, which is known\nas the eccentricity vector, to point along the periapsis direction because ? is the\nangle between r and e. The magnitude of the eccentricity vector is the eccentricity\n\n\n\n10.2 Keplerian Motion 373\n\nof the elliptical orbit, so e is not a unit vector as its symbol might mislead one into\nthinking. The equation p ? h2=? gives the following useful expression for h:\n\nh D p?p (10.40)\nNote that Eq. (10.39) is actually more general than just for ellipses. It is a polar\n\nequation of a conic section, where the value of e dictates the type of orbit. If e D 0\nthen the orbit is circular with a D r ; if e < 1 then the orbit is elliptical with a > 0;\nif e D 1 then the orbit is parabolic with infinite semimajor axis; and if e > 1 then\nthe orbit is hyperbolic with a < 0. Elliptic orbits are the most common type because\nthey are used for planets and planetary satellites. Parabolic orbits are rarely found,\nbut orbits of some comets approximate a parabola. These orbits are a borderline case\nbetween an open and closed orbit. The orbit of an interplanetary probe sent from the\nEarth must be a hyperbolic orbit if the probe is to escape the Earth\u2019s gravitational\nfield with finite speed. Parabolic and hyperbolic orbits are one-way trips to infinity\nthat will never retrace the same path again.\n\nEquation (10.34) can be written as dt D .2=h/ dA. Integrating this equation\nover an entire orbit and noting that the area of an ellipse is given by \n a b yields\n\n? D 2\nab\nh\n\n(10.41)\n\nwhere ? is the orbital period. Substituting Eq. (10.40) and b D pap, which follows\nfrom Eqs. (10.11) and (10.15), yields\n\n? D 2\np\n?\na3=2 D 2\n\nn\n(10.42)\n\nwhere n is the mean motion, defined by\n\nn ?\nr\n?\n\na3\n(10.43)\n\nThis proves Kepler\u2019s third law. For a circular 300 km low-Earth orbit, Eq. (10.42)\ngives a period of about 90 min. A geosynchronous orbit with a period of one sidereal\nday (approximately 23 h 56 min and 4 s), matching the Earth\u2019s sidereal rotation\nperiod, requires an altitude of 35,786 km. Communications satellites are often\nplaced in geostationary orbits, equatorial circular geosynchronous orbits, because\nthey appear to be stationary with respect to the ground.\n\nHaving proven Kepler\u2019s three laws from Newton\u2019s gravitational law, we now\ninvestigate energy further. Since energy is conserved, it can be computed at any\nconvenient point in the orbit. Here, we choose the periapsis point with vp D h=rp .\nUsing Eqs. (10.14a), (10.40), and (10.15) gives\n\nE D h\n2\n\n2r2p\n? ?\nrp\nD ?a.1 ? e\n\n2/\n\n2a2.1 ? e/2 ?\n?\n\na.1 ? e/ D\n?a.1C e/ ? 2a?\n\n2a2.1 ? e/ D ?\n?\n\n2a\n\n(10.44)\n\n\n\n374 10 Orbital Dynamics\n\nSubstituting this expression into Eq. (10.31), substituting the definitions of T and\nV , and rearranging gives\n\nv2 D ?\n?\n2\n\nr\n? 1\na\n\n?\n(10.45)\n\nEquation (10.45) is known as the vis viva equation from the Latin for living force.\nThe escape velocity at a distance r from a center of force is the minimum velocity\nneeded to escape its gravitational pull. This is the velocity needed to achieve a\nparabolic orbit, and is obtained by setting a D1 in Eq. (10.45):\n\nvesc D\nr\n2?\n\nr\n(10.46)\n\nThe escape velocity for a body on the Earth\u2019s surface, with r being the radius of the\nEarth, is 11.06 km/s. The escape velocity for a body on the Moon\u2019s surface, with\nr and ? being the radius and gravitational parameter of the Moon, respectively, is\n1.68 km/s, which is almost 10 times less than for the Earth.\n\n10.2.1 Classical Orbital Elements\n\nEquation (10.26) requires the initial position, r.t0/, and velocity, Pr.t0/, with respect\nto some inertial coordinate system. Unfortunately r.t0/ and Pr.t0/ do not provide the\nmost convenient characterization of the orbit. The six classical Keplerian orbital\nelements give a more satisfying physical characterization of the orbit than the\nCartesian position and velocity vectors. The dimensional elements are given by\n\n\u2022 a D semimajor axis (size of the orbit)\n\u2022 e D eccentricity (shape of the orbit)\n\u2022 M0 D initial mean anomaly (related to the spacecraft\u2019s initial position in the\n\norbit)\n\nThe orientation elements are given by\n\n\u2022 i D inclination (angle between orbit plane and reference plane)\n\u2022 ? D right ascension of the ascending node (angle between vernal equinox\n\ndirection and the line of nodes)\n\u2022 ! D argument of periapsis or perigee (angle between the ascending node\n\ndirection and periapsis or perigee direction)\n\nFigure 10.8 shows the orientation elements and the unit vectors that define the\nperifocal coordinate system. The vector ie points along the periapsis direction, the\nvector ip points along the semilatus rectum direction, and the vector ih points along\nthe momentum direction, which is the orbit normal. Note that the perifocal system\nis specific to a particular orbit, and that ie and ip are in the orbital plane. The line\nof nodes vector is given by the intersection of the reference plane (e.g. the Earth\u2019s\nequatorial plane) and the orbital plane.\n\n\n\n10.2 Keplerian Motion 375\n\nReference\nPlane\n\nOrbital\nPlane\n\nPeriapsis\n\nLine of Nodes\n\nFig. 10.8 Coordinate system geometry and orbital elements\n\nThe transformation from GCI to perifocal coordinates is given by\n\nie D A11i1 C A12i2 C A13i3 (10.47a)\nip D A21i1 C A22i2 C A23i3; (10.47b)\nih D A31i1 C A32i2 C A33i3 (10.47c)\n\nwhere Aij are elements of a rotation matrix. The transformation is accomplished\nusing a 3?1?3 Euler rotation, with rotation matrix elements given by\n\nA11 D cos? cos! ? sin? sin! cos i (10.48a)\nA12 D sin? cos! C cos? sin! cos i (10.48b)\nA13 D sin! sin i (10.48c)\nA21 D ? cos? sin! ? sin? cos! cos i (10.48d)\nA22 D ? sin? sin! C cos? cos! cos i (10.48e)\nA23 D cos! sin i (10.48f)\nA31 D sin? sin i (10.48g)\nA32 D ? cos? sin i (10.48h)\nA33 D cos i (10.48i)\n\nThe inverse relationships are given in Sect. 10.2.3.\n\n\n\n376 10 Orbital Dynamics\n\n10.2.2 Kepler\u2019s Equation\n\nWe wish to determine the location of an object in orbit at any instant of time, which\nmeans finding the true anomaly as a function of time. Kepler\u2019s second law states\nthat equal times give equal areas, so the true anomaly will be a linear function of\ntime only in a circular orbit. Referring back to Fig. 10.5, the position and velocity\nvectors are given by\n\nr D r cos ? ie C r sin ? ip (10.49a)\nPr D . Pr cos ? ? r P? sin ?/ie C . Pr sin ? C r P? cos ?/ip (10.49b)\n\nPerforming the cross product h D r ? Pr and noting that ie ? ip D ih yields\nh D \u0152r cos ?. Pr sin ? C r P? cos ?/ ? r sin ?. Pr cos ? ? r P? sin ?/? ih D r2 P? ih\n\n(10.50)\nThus h D r2 P?, which shows that r2 P? must be a constant. This equation can be\nwritten as\n\nhdt D r2 d? (10.51)\nSubstituting Eqs. (10.39) and (10.40) into Eq. (10.51) gives\n\nr\n?\n\np3\ndt D d?\n\n.1C e cos ?/2 (10.52)\n\nThis equation needs to be integrated to determine the true anomaly difference to go\nfrom some initial time t0 to another time t1:\n\nr\n?\n\np3\n.t1 ? t0/ D\n\nZ ?1\n?0\n\nd?\n\n.1C e cos ?/2 (10.53)\n\nThe right hand side of Eq. (10.53) involves finding a solution to a nonstandard\nelliptic integral. Unfortunately, no closed-form solution exists. Kepler essentially\nperformed a change of variables to convert the integral equation to an algebraic\nequation.\n\nKepler projected the object\u2019s position vertically onto a circle circumscribed\naround the ellipse, as shown in Fig. 10.9. Note that the origin in this figure is at\nthe focus, rather than at the center of the ellipse, as had been assumed in Sect. 10.1.\nThe remainder of this chapter will assume that the origin is at the focus. The angle\nE is known as the eccentric anomaly. It is clear from the figure that\n\nx D a cosE ? c D a.cosE ? e/ (10.54)\nThen\n\na cosE D c C x D ae C a.1 ? e\n2/\n\n1C e cos ? cos ? D\na.e C cos ?/\n1C e cos ? (10.55)\n\n\n\n10.2 Keplerian Motion 377\n\nFig. 10.9 Kepler\u2019s geometry\n\nSolving this equation for cos ? gives\n\ncos ? D cosE ? e\n1 ? e cosE (10.56)\n\nand then substituting this into r D x= cos ? gives\n\nr D a.1 ? e cosE/ (10.57)\n\nIt follows from Eq. (10.56) that\n\nsin2 ? D 1 ? cos2 ? D .1 ? e cosE/\n2 ? .cosE ? e/2\n\n.1 ? e cosE/2 D\n.1 ? e2/ sin2 E\n.1 ? e cosE/2 (10.58)\n\nFigure 10.9 also shows that sin ? has the same sign as sinE, so\n\nsin ? D\np\n1 ? e2 sinE\n1 ? e cosE (10.59)\n\nCombining Eqs. (10.57) and (10.59) gives\n\ny D r sin ? D a\np\n1 ? e2 sinE (10.60)\n\nWe now use Eqs. (10.54), (10.57), and (10.60) to find a relationship between\nthe eccentric anomaly and true anomaly. Trigonometric half-angle identities for any\nangle ? give\n\ntan\n?\n\n2\nD sin.?=2/\n\ncos.?=2/\nD 2 sin.?=2/ cos.?=2/\n\n2 cos2.?=2/\nD sin ?\n1C cos ? (10.61)\n\n\n\n378 10 Orbital Dynamics\n\nThus, we find from Eqs. (10.56) and (10.59) that\n\ntan\n?\n\n2\nD\n\np\n1 ? e2 sinE\n\n.1 ? e cosE/C .cosE ? e/ D\nr\n1C e\n1 ? e\n\nsinE\n\n1C cosE (10.62)\n\nand using Eq. (10.61) on the right side gives the desired result\n\ntan\n?\n\n2\nD\nr\n1C e\n1 ? e tan\n\nE\n\n2\n(10.63)\n\nEquation (10.63) allows us to compute ? given e and E, but we still need to find the\ntime dependence of E.\n\nA computation similar to Eq. (10.50) gives\n\nh D r ? Pr D .x ie C y ip/ ? . Px ie C Py ip/ D .x Py ? y Px/ih (10.64)\n\nThus h D x Py ? y Px. Substituting Eqs. (10.54) and (10.60), along with their time\nderivatives, into h leads to\n\nh D a2.cosE ? e/\np\n1 ? e2 cosE dE\n\ndt\nC a2\np\n1 ? e2 sin2 E dE\n\ndt\n\nD a2\np\n1 ? e2.1 ? e cosE/dE\n\ndt\n\n(10.65)\n\nSubstituting h D p?p Dp?a.1 ? e2/ into this gives\nr\n?\n\na3\nD n D .1 ? e cosE/dE\n\ndt\nD d\ndt\n.E ? e sinE/ (10.66)\n\nwhere n is the mean motion, defined by Eq. (10.43). Integrating both sides of\nEq. (10.66) easily leads to\n\nn.t1 ? t0/ D .E ? e sinE/jE1E0 (10.67)\n\nNote that if we set E0 D 0 and E1 D 2\n , then we get Kepler\u2019s third law! The mean\nanomaly at a general time t is given by\n\nM.t/ DM0 C n.t ? t0/ (10.68)\n\nwhere M0 D E0 ? e sinE0 is mean anomaly at time t0. Then Eq. (10.67) can\nwritten as\n\nM.t/ D E.t/ ? e sinE.t/ (10.69)\n\n\n\n10.2 Keplerian Motion 379\n\nwhich is known as Kepler\u2019s equation. Given M0 and some time past t0, our goal is\nto determine E.t/ using Eqs. (10.68) and (10.69). Unfortunately, Kepler\u2019s equation\nhas no closed-form solution. Kepler\u2019s equations has intrigued mathematicians for\ncenturies and spawned a multitude of mathematical techniques [7]. Kepler\u2019s equa-\ntion is well suited for Newton-Raphson\u2019s iteration. Define the following function:\n\nf .E/ ?M ? .E ? e sinE/ (10.70)\nwhich is zero if the correct E is found. A series expansion of Eq. (10.69) gives\nthe following approximation for E, which is accurate up to third-order in the\neccentricity [4]:\n\nE DM C e sinM\n1 ? e cosM ?\n\n1\n\n2\n\n?\ne sinM\n\n1 ? e cosM\n?3\nC ? ? ? (10.71)\n\nBegin Newton\u2019s iteration by starting with some initial guess of E, denoted by OE,\nwhich can be given by M for small e or by Eq. (10.71). Then compute the Newton\ncorrection\n\n?E D ? f .\nOE/\n\nf 0. OE/ D\nM ? . OE ? e sin OE/\n\n1 ? e cos OE (10.72)\n\nNext update the current estimate using\n\nOE  OE C?E (10.73)\nwhere denotes replacement. Continue iterating until ?E is below some prede-\nfined threshold.\n\n10.2.3 Orbit Propagation\n\nThe classical solution is the following: given the classical orbital elements at an\nepoch time t0, compute the position and velocity vectors at any time t . The classical\nsolution involvingE is summarized in Table 10.1. Note that the position in perifocal\ncoordinates is given by \u0152x; y; 0?. Therefore, only the elements A11, A21, A12, A22,\nA13, and A23 from Eq. (10.48) are needed to convert from perifocal coordinates to\nGCI coordinates, since\n\nr D\n2\n4\nA11 A12 A13\nA21 A22 A23\nA31 A32 A33\n\n3\n5\nT 2\n4\nx\n\ny\n\n0\n\n3\n5 (10.74a)\n\nPr D\n2\n4\nA11 A12 A13\nA21 A22 A23\nA31 A32 A33\n\n3\n5\nT 2\n4\nPx\nPy\n0\n\n3\n5 (10.74b)\n\n\n\n380 10 Orbital Dynamics\n\nTable 10.1 Classical orbital solution\n\nfa; e; i; ?; !; M0; .t ? t0/g ) fr.t/; Pr.t/g\nMean Anomaly n D p?=a3\n\nM D M0 C n.t ? t0/\nKepler\u2019s Equation M D E ? e sinE\n\nSolve for E\n\nCompute r r D a.1? e cosE/\nCompute x; y x D a.cosE ? e/\n\ny D ap1? e2 sinE\nCompute Px; Py Px D ?.na2=r/ sinE\n\nPy D .na2=r/p1? e2 cosE\n\nPosition r D\n2\n4\nA11 A21\nA12 A22\nA13 A23\n\n3\n5\n?\nx\n\ny\n\n?\n\nVelocity Pr D\n2\n4\nA11 A21\nA12 A22\nA13 A23\n\n3\n5\n\" Px\n\nPy\n\n#\n\nNote that these rotation matrix elements are time-invariant, which means that they\nonly need to be computed once and then stored. First, the mean motion, n, and\nmean anomaly,M , are computed. Then, Kepler\u2019s equation is solved forE. Next, the\nvariables x, y, Px, Py, and r are computed. Finally, the position and velocity vectors\nat time t are determined.\n\nAnother form of the classical solution is possible by substituting x D r cos ? and\ny D r sin ? into Eq. (10.74a), which gives\n\nr D r\n2\n4\n\ncos? cos ? ? sin? sin ? cos i\nsin? cos ? C cos? sin ? cos i\n\nsin ? sin i\n\n3\n5 (10.75)\n\nwhere ? D ! C ?. The time derivative of Eq. (10.75) can be shown to be\n\nPr D ?\nr\n?\n\np\n\n2\n4\n.sin ? C e sin!/ cos? C .cos ? C e cos!/ sin? cos i\n.sin ? C e sin!/ sin? ? .cos ? C e cos!/ cos? cos i\n\n?.cos ? C e cos!/ sin i\n\n3\n5 (10.76)\n\nFor this solution once E has been determined using Kepler\u2019s equation, then ? is\ndetermined using Eq. (10.63). The parameters r can be given by either Eq. (10.21)\nor Eq. (10.57). Also, the constant p is computed using Eq. (10.15).\n\n\n\n10.2 Keplerian Motion 381\n\nThe inverse problem involves determining the orbital elements from the space-\ncraft position r.t/ and velocity v.t/ vectors at some time t . First, the following\nquantities are computed:\n\nr D kr.t/k; v D kv.t/k (10.77a)\nh D r.t/ ? v.t/; h D khk (10.77b)\n\n1\n\na\nD 2\nr\n? v\n\n2\n\n?\n(10.77c)\n\ne D v.t/ ? h\n?\n\n? r.t/\nr\n; e D kek (10.77d)\n\nEquation (10.77c), derived directly from the vis viva equation, is used to deter-\nmine a. The perifocal coordinates vectors can now be computed, so that\n\nih D h=h D A31i1 C A32i2 C A33i3 (10.78a)\nie D e=e D A11i1 C A12i2 C A13i3 (10.78b)\nip D ih ? ie D A21i1 C A22i2 C A23i3 (10.78c)\n\nwhich can be used to extract any desired Aij . The inclination, i , right ascension of\nthe ascending node, ?, argument of periapsis, !, are computed by\n\ni D cos?1 A33; 0 ? i < \n (10.79a)\n? D atan2.A31;?A32/; 0 ? ? < 2\n (10.79b)\n! D atan2.A13; A23/; 0 ? ! < 2\n (10.79c)\n\nReferring to Table 10.1 and Eq. (10.57), we see that\n\nr.t/ ? v.t/ D x Px C y Py D .na3=r/\u0152?.cosE ? e/ sinE C .1 ? e2/ sinE cosE?\nD .na3=r/e.1 ? e cosE/ sinE D na2e sinE.t/ (10.80)\n\nwhere many time arguments of E.t/ have been omitted to save space. Solving\nEq. (10.57) for e cosE.t/ gives\n\ne cosE.t/ D 1 ? r\na\n\n(10.81)\n\nEquations (10.80) and (10.81) then give the eccentric anomaly at time t as\n\nE.t/ D atan2\n?\n\nr.t/ ? v.t/\nna2\n\n; 1 ? r\na\n\n?\n; 0 ? E.t/ < 2\n (10.82)\n\n\n\n382 10 Orbital Dynamics\n\nThe mean anomaly at time t is determined by Kepler\u2019s equation\n\nM.t/ D E.t/ ? e sinE.t/ (10.83)\nand the mean anomaly at the epoch time t0 is given by\n\nM0 DM.t/ ? n.t ? t0/ (10.84)\nNote that the Kepler elements a, e, i ,?, !, andM0 are independent of the time t at\nwhich r.t/ and v.t/ are determined. Note also that quadrants are important, which\nis why the atan2 function is used in Eqs. (10.78) and (10.82).\n\n10.3 Disturbing Forces1\n\nA spacecraft is affected by many disturbing accelerations, or perturbations. Four\nimportant disturbance sources are gravity due to a non-spherical Earth,2 denoted\nby agrav; forces due to bodies other than the central body, denoted by athird;\naerodynamic drag, denoted by aaero; and solar radiation pressure (SRP), denoted\nby aSRP. The modification of Eq. (10.26) include these disturbances is\n\nRr D ? ?\nr3\n\nrC aperturb D ? ?\nr3\n\nrC agrav C athird C aaero C aSRP (10.85)\n\nNote that gravity and third-body disturbances are conservative, meaning that they\ncan be computed as gradients of potential functions, while drag and SRP are not.\n\nThe most straightforward way to compute perturbed orbital motion is to integrate\nEq. (10.85) numerically. This is known as the method of special perturbations, and\ncan be the most accurate method, but also the most computationally expensive.\nThe method of general perturbations, which is actually less general, was developed\nto speed the computation [10]. We provide a brief discussion of general perturbation\ntheory in Sect. 10.4.1.\n\n10.3.1 Non-Spherical Gravity\n\nThe Earth is not a perfect sphere, and mass is distributed nonuniformly throughout\nthe Earth. Since gravity depends directly on mass, the gravity field will reflect this\nnonuniformity. The most common approach to model non-spherical gravity uses a\n\n1The authors would like to thank Christopher K. Nebelecky for the contributions in this section.\n2The generalization to any other central body is straightforward; we choose the Earth for\nspecificity.\n\n\n\n10.3 Disturbing Forces 383\n\nspherical harmonic expansion, which we will now develop. We consider a body such\nas the Earth to be built up of a large number, N , of points with mass mi located at\npoints ri These give rise to a gravitational potential at a point r of\n\nU.r/ D\nNX\niD1\n\nGmi\n\nkr ? rik (10.86)\n\nwhere G is Newton\u2019s universal gravitational constant. In the Earth-Centered/Earth-\nFixed (ECEF) frame\n\nr D r\n2\n4\n\ncos\t0 cos?\ncos\t0 sin?\n\nsin\t0\n\n3\n5 and ri D ri\n\n2\n4\n\ncos\t0i cos?i\ncos\t0i sin?i\n\nsin\t0i\n\n3\n5 (10.87)\n\nwhere \t0 is the geocentric latitude3 and ? is the longitude, so\n\nkr ? rik?1 D .r2 C r2i ? 2r ? ri /?1=2\n\nD 1\nr\n\n\n\n1C\n\n\nri\nr\n\n?2 ? 2ri\nr\n\n?\ncos\t0 cos\t0i cos.? ? ?i /C sin\t0 sin\t0i\n\n???1=2\n\n(10.88)\n\nWe separate the dependence on r from that on ri by means of the identity [2]\n\n\n\n1C\n\n\nri\nr\n\n?2 ? 2ri\nr\n\n?\ncos\t0 cos\t0i cos.? ? ?i /C sin\t0 sin\t0i\n\n???1=2\n\nD\n1X\nnD0\n\n\nri\nr\n\n?n nX\nmD0\n\n.2 ? ?0m/ .n ?m/\u0160\n.nCm/\u0160P\n\nm\nn .sin\t\n\n0/Pmn .sin\t0i / cos .m.? ? ?i //\n(10.89)\n\nwhere ?0m is the Kronecker delta and Pmn , the associated Legendre function of\ndegree n and order m, is defined in terms of the Legendre polynomials4\n\nPn.x/ D 1\n2nn\u0160\n\ndn\n\ndxn\n.x2 ? 1/n (10.90)\n\nby5\n\nPmn .x/ D .1 ? x2/m=2\ndm\n\ndxm\nPn.x/ (10.91)\n\n3We use \t0 for latitude to avoid confusion with the geodetic latitude of Sect. 2.6.3.\n4Equation (10.90) is the well-known Rodrigues equation for the Legendre polynomials.\n5We follow Vallado\u2019s notation [21]. Montenbruck and Gill [14] and Abramowitz and Stegun [1]\ndenote these functions by Pnm and define Pmn D .?1/mPnm.\n\n\n\n384 10 Orbital Dynamics\n\nThe associated Legendre functions for degrees 0 to 4 are [21]\n\nP 00 .sin\t\n0/ D 1 P 23 .sin\t0/ D 15 cos2 \t0 sin\t0\n\nP 01 .sin\t\n0/ D sin\t0 P 33 .sin\t0/ D 15 cos3 \t0\n\nP 11 .sin\t\n0/ D cos\t0 P 04 .sin\t0/ D\n\n1\n\n8\n.35 sin4 \t0 ? 30 sin2 \t0 C 3/\n\nP 02 .sin\t\n0/ D 1\n\n2\n.3 sin2 \t0 ? 1/ P 14 .sin\t0/ D\n\n5\n\n2\ncos\t0.7 sin3 \t0 ? 3 sin\t0/\n\nP 12 .sin\t\n0/ D 3 sin\t0 cos\t0 P 24 .sin\t0/ D\n\n15\n\n2\ncos2 \t0.7 sin2 \t0 ? 1/\n\nP 22 .sin\t\n0/ D 3 cos2 \t0 P 34 .sin\t0/ D 105 cos3 \t0 sin\t0\n\nP 03 .sin\t\n0/ D 1\n\n2\n.5 sin3 \t0 ? 3 sin\t0/ P 44 .sin\t0/ D 105 cos4 \t0\n\nP 13 .sin\t\n0/ D 3\n\n2\ncos\t0.5 sin2 \t0 ? 1/ (10.92)\n\nEquations (10.90) and (10.91) are not useful for computation. The customary\nprocedure is to compute P 00 , P\n\n0\n1 , and P\n\n1\n1 from their explicit expressions and then to\n\nfind the associated Legendre functions of higher degree recursively by\n\nP 0n .sin\t\n0/ D 1\n\nn\n\n?\n.2n ? 1/ sin\t0P 0n?1.sin\t0/ ? .n ? 1/P 0n?2.sin\t0/\n\n?\n(10.93a)\n\nPmn .sin\t\n0/ D sin\t0Pmn?1.sin\t0/C .nCm ? 1/ cos\t0 Pm?1n?1 .sin\t0/;\n\nfor 0 < m < n (10.93b)\n\nPnn .sin\t\n0/ D .2n ? 1/ cos\t0 Pn?1n?1 .sin\t0/ (10.93c)\n\nor some equivalent recursion relations.\nPutting Eqs. (10.86), (10.88), and (10.89) together, and noting that P 00 .x/ D 1,\n\ngives the spherical harmonics expansion for the gravity potential\n\nU.r/ D ?\nr\n\n(\n1C\n\n1X\nnD1\n\n?\nR\n\nr\n\n?n nX\nmD0\n\nPmn .sin\t\n0/\u0152Cmn cos.m?/C Smn sin.m?/?\n\n)\n\n(10.94)\n\nwhere ? ? GM , with M DPNiD1 mi being the total mass of all the particles in the\ncentral body and, for n ? 1 and 0 ? m ? n,\n\nCmn D\n2 ? ?0m\nM\n\n.n ?m/\u0160\n\n.nCm/\u0160\nNX\niD1\n\nmi\n\n\n ri\nR\n\n?n\nPmn .sin\t\n\n0\ni / cos.m?i / (10.95a)\n\nSmn D\n2 ? ?0m\nM\n\n.n ?m/\u0160\n\n.nCm/\u0160\nNX\niD1\n\nmi\n\n\n ri\nR\n\n?n\nPmn .sin\t\n\n0\ni / sin.m?i / (10.95b)\n\n\n\n10.3 Disturbing Forces 385\n\nFig. 10.10 Types of spherical harmonics. (a) Zonal. (b) Tesseral. (c) Sectoral\n\nThe parameter R characterizes the size of the mass distribution; for Earth gravity\nmodeling, M D M? and R D R?. Note that Eq. (10.95) is not used to compute\nCmn and S\n\nm\nn ; they are found by fitting gravity measurement data, including tracking\n\nof satellite orbits.\nThe spherical harmonics fall into three classes: zonal harmonics for m D 0,\n\ntesseral harmonics for 0 < m < n, and sectoral harmonics for m D n. These are\nillustrated in Fig. 10.10.\n\nNote that Eq. (10.95) implies that S0n D 0, so there are only 2n C 1 nonzero\nterms in the spherical harmonics expansion for any degree n. We can eliminate some\nother coefficients by choosing our coordinate system wisely. Equations (10.95) and\n(10.87) say that\n\n2\n4\nC11\nS11\nC 01\n\n3\n5 D 1\n\nMR\n\nNX\niD1\n\nmiri (10.96)\n\nThus C01 , C\n1\n1 , and S\n\n1\n1 will all vanish by Eq. (3.55) if we place the origin of our\n\ncoordinate system at the central body\u2019s center of mass, as is done for ECEF coor-\ndinates. Furthermore, Eqs. (10.95), (10.87), and (3.69) say that C12 D ?J13=MR2\nand S12 D ?J23=MR2, where J is the central body\u2019s moment of inertia tensor. Thus\nthese coefficients also vanish if we choose the z axis of our coordinate frame to be a\nprincipal axis of inertia of the central body.\n\nThe acceleration due to gravity is determined by taking the gradient of the\npotential function in Eq. (10.94). The leading term ?=r in the potential function\ngives the first term on the right side of Eq. (10.85), so we denote the potential with\nthis term omitted by U 0. We also set the origin of the coordinate frame at the Earth\u2019s\ncenter of mass so that the n D 1 terms in Eq. (10.94) vanish by Eq. (10.96). The\ngeopotential U 0 is expressed in terms of radial distance, geocentric latitude, and\nlongitude, so we apply the chain rule to obtain acceleration due to the non-spherical\nEarth as\n\nagrav D rU 0.r/ D @U\n0\n\n@r\nrr C @U\n\n0\n\n@\t0\nr\t0 C @U\n\n0\n\n@?\nr? (10.97)\n\n\n\n386 10 Orbital Dynamics\n\nThe partials of the geopotential are given by\n\n@U 0\n\n@r\nD ? ?\n\nr2\n\n1X\nnD2\n\n?\nR?\nr\n\n?n\n.nC 1/\n\nnX\nmD0\n\nPmn .sin\t\n0/.Smn sinm? C Cmn cosm?/\n\n(10.98a)\n\n@U 0\n\n@\t0\nD ?\nr\n\n1X\nnD2\n\n?\nR?\nr\n\n?n nX\nmD0\n\n\u0152P mC1n .sin\t0/ ? .m tan\t0/Pmn .sin\t0/?\n\n? .Smn sinm? C Cmn cosm?/\n(10.98b)\n\n@U 0\n\n@?\nD ?\nr\n\n1X\nnD2\n\n?\nR?\nr\n\n?n nX\nmD0\n\nmPmn .sin\t\n0/.Smn cosm? ? Cmn sinm?/ (10.98c)\n\nThe gradients of the radius, latitude, and longitude are given by\n\nrr D r\nr\n\n(10.99a)\n\nr\t0 D 1p\nx2 C y2\n\n\n?z r\nr2\nC rz\n\n?\n(10.99b)\n\nr? D 1\nx2 C y2 .x ry ? y rx/ (10.99c)\n\nwhere\n\nrx D\n2\n4\n1\n\n0\n\n0\n\n3\n5 ; ry D\n\n2\n4\n0\n\n1\n\n0\n\n3\n5 ; rz D\n\n2\n4\n0\n\n0\n\n1\n\n3\n5 (10.100)\n\nThe Cartesian coordinates of the acceleration are then given by\n\nagravx D\n \n1\n\nr\n\n@U 0\n\n@r\n? z\nr2\np\nx2 C y2\n\n@U 0\n\n@\t0\n\n!\nx ?\n\n?\n1\n\nx2 C y2\n@U 0\n\n@?\n\n?\ny (10.101a)\n\nagravy D\n \n1\n\nr\n\n@U 0\n\n@r\n? z\nr2\np\nx2 C y2\n\n@U 0\n\n@\t0\n\n!\ny C\n\n?\n1\n\nx2 C y2\n@U 0\n\n@?\n\n?\nx (10.101b)\n\nagravz D\n?\n1\n\nr\n\n@U 0\n\n@r\n\n?\nzC\n\np\nx2 C y2\nr2\n\n@U 0\n\n@\t0\n(10.101c)\n\nAs an example we consider a 6th-order spherical harmonic geopotential model\nincluding only the zonal harmonics. Zonal harmonics are especially simple because\nthey are symmetrical about the polar axis, i.e. there is no dependence on the\nlongitude or on the Greenwich hour angle. A specific notation, Jn ? ?C0n , is used\n\n\n\n10.3 Disturbing Forces 387\n\nTable 10.2 Zonal\ncoefficients\n\ni Ji ?10\n2 1:08262668355 ?3\n3 ?2:53265648533 ?6\n4 ?1:61962159137 ?6\n5 ?2:27296082869 ?7\n6 5:40681239107 ?7\n\nfor these coefficients. Values for the zonal coefficients of the Earth can be found\nin Table 10.2 [21]. By far the strongest perturbation due to the Earth\u2019s shape arises\nfrom J2, with J3 being more than 400 times smaller.\n\nThe perturbing acceleration is given by\n\nagrav D\n6X\niD2\n\naJi (10.102)\n\nwhere the individual terms are [17]\n\naJ2 D ?\n3\n\n2\nJ2\n\n\n ?\nr2\n\n??R?\nr\n\n?2\n2\n6664\n\n\n1 ? 5 ? z\n\nr\n\n\t2? x\nr\n\n1 ? 5 ? z\nr\n\n\t2? y\nr\n\n3 ? 5 ? z\nr\n\n\t2? z\nr\n\n3\n7775 (10.103a)\n\naJ3 D ?\n1\n\n2\nJ3\n\n\n ?\nr2\n\n??R?\nr\n\n?3\n2\n6664\n\n5\n\n7\n?\n\nz\nr\n\n\t3 ? 3 ? z\nr\n\n\t?\nx\nr\n\n5\n\n7\n?\n\nz\nr\n\n\t3 ? 3 ? z\nr\n\n\t?\ny\n\nr\n\n3\n\n10\n?\n\nz\nr\n\n\t2 ? 35\n3\n\n?\nz\nr\n\n\t4 ? 1\n?\n\n3\n7775 (10.103b)\n\naJ4 D ?\n5\n\n8\nJ4\n\n\n ?\nr2\n\n??R?\nr\n\n?4\n2\n6664\n\n\n3 ? 42 ? z\n\nr\n\n\t2 C 63 ? z\nr\n\n\t4? x\nr\n\n3 ? 42 ? z\nr\n\n\t2 C 63 ? z\nr\n\n\t4? y\nr\n\n?\n\n15 ? 70 ? z\n\nr\n\n\t2 C 63 ? z\nr\n\n\t4? z\nr\n\n3\n7775 (10.103c)\n\naJ5 D ?\n1\n\n8\nJ5\n\n\n ?\nr2\n\n??R?\nr\n\n?5\n2\n6664\n\n3\n\n35\n?\n\nz\nr\n\n\t ? 210 ? z\nr\n\n\t3 C 231 ? z\nr\n\n\t5? x\nr\n\n3\n\n35\n?\n\nz\nr\n\n\t ? 210 ? z\nr\n\n\t3 C 231 ? z\nr\n\n\t5? y\nr\n\n15 ? 315 ? z\nr\n\n\t2 C 945 ? z\nr\n\n\t4 ? 693 ? z\nr\n\n\t6?\n\n3\n7775\n\n(10.103d)\n\naJ6 D\n1\n\n16\nJ6\n\n\n ?\nr2\n\n??R?\nr\n\n?6\n2\n6664\n\n\n35 ? 945 ? z\n\nr\n\n\t2 C 3465 ? z\nr\n\n\t4 ? 3003 ? z\nr\n\n\t6? x\nr\n\n35 ? 945 ? z\nr\n\n\t2 C 3465 ? z\nr\n\n\t4 ? 3003 ? z\nr\n\n\t6? y\nr\n\n2205\n?\n\nz\nr\n\n\t2 ? 4851 ? z\nr\n\n\t4 C 3003 ? z\nr\n\n\t6 ? 315\n?\n\nz\nr\n\n3\n7775\n\n(10.103e)\n\n\n\n388 10 Orbital Dynamics\n\nThe gravitational parameter ? and mean equatorial Earth radius, R? are given by\n\n? D 3:986004418 ? 1014 m\n3\n\ns2\n(10.104a)\n\nR? D 6:378 137 ? 106 m (10.104b)\n\n10.3.2 Third-Body Forces\n\nThe term third-body is usually applied to any body other than the two bodies\nproducing two-body Keplerian motion. Consider the motion of a body with mass\nm2 at position r2 about a body with mass m1 at position r1, under the influence of\nn ? 2 other bodies with masses mi at positions ri\n\nRr1 D ? Gm2kr1 ? r2k3 .r1 ? r2/ ?\nNX\niD3\n\nGmi\n\nkr1 ? rik3 .r1 ? ri / (10.105a)\n\nRr2 D ? Gm1kr1 ? r2k3 .r2 ? r1/ ?\nNX\niD3\n\nGmi\n\nkr2 ? rik3 .r2 ? ri / (10.105b)\n\nAs in the two-body case, subtracting Eq. (10.105a) from Eq. (10.105b) gives, with\nr ? r2 ? r1, r ? krk, ? ? G.m1 Cm2/, and ?i ? Gmi for i ? 3,\n\nRr D ? ?\nr3\n\nr ?\nNX\niD3\n\n?i\n\n?\nr1 ? ri C r\nkr1 ? ri C rk3 ?\n\nr1 ? ri\nkr1 ? rik3\n\n?\n(10.106)\n\nThe terms in the sum can be treated as small perturbations if all the other bodies\nare much farther away from m1 than is m2, i.e. if kr1 ? rik ? r for all i ? 3.\nThat is why the gravitational force of the Sun can be treated as a perturbation when\nanalyzing the motion of a spacecraft about the Earth.\n\nLet us now expand the first term in the parentheses of Eq. (10.106) in powers of\nr=kr1 ? rik and retain only the first-order term. With\n\nkr1 ? ri C rk?3 D\n?kr1 ? rik2 C 2r ? .r1 ? ri /C r2\n\n??3=2\n\n? kr1 ? rik?3\n?\n1 ? 3r ? .r1 ? ri /=kr1 ? rik2\n\n?\n(10.107)\n\nthis gives\n\nRr D ? ?\nr3\n\nr ?\nNX\niD3\n\n?i\nr ? 3.ui ? r/ui\nkr1 ? rik3 (10.108)\n\n\n\n10.3 Disturbing Forces 389\n\nwhere ui ? .r1 ? ri /=kr1 ? rik. However, it is often better to use Eq. (10.106)\nthan this approximation. For instance, higher order terms in the expansion for the\nperturbation of the Moon on a spacecraft in geosynchronous orbit are not negligible,\nbecause r=kr1 ? rik ? 1=9 in that case.\n\n10.3.3 Atmospheric Drag\n\nFor objects in low-Earth orbit, atmospheric drag represents a significant perturbing\nforce. The drag force that a spacecraft experiences is given by\n\nFaero D ?1\n2\n? CDSkvrelkvrel (10.109)\n\nwhere ? is the local atmospheric density, which is discussed in Sect. 11.2, CD is a\ndimensionless drag coefficient, S is the spacecraft area projected along the direction\nof motion, and vrel is the relative velocity of the spacecraft with respect to the\natmosphere. As discussed in Sect. 3.3.6.3, the relative velocity, vrel, is different from\nthe GCI velocity of the spacecraft because the atmosphere is not stationary in the\nGCI frame. The equations accounting for atmospheric motion can be found in that\nsection.\n\nThe drag coefficient, CD , is a dimensionless parameter that quantifies how a\nspacecraft interacts with the surrounding medium to retard its motion. The drag\ncoefficient is a function of the shape of the spacecraft, its orientation with respect\nto vrel, its surface properties, and the composition of the atmosphere. Often,\ndrag coefficients are determined via experimental and/or finite element analysis.\nExperiments are in their own right situation-dependent as they consider only a\nsingle composition for the surrounding medium. Vallado [23] points out that the\ndrag coefficient for several common shapes can increase significantly simply by\nchanging the orbital altitude. This is because the composition of the atmosphere\nchanges with altitude and the surface materials of the spacecraft will, in general,\ninteract with the different compositions differently.\n\nThe projected area of a spherical spacecraft is unchanging, but S depends on\nthe spacecraft attitude for all other shapes. It is typical to model the geometry of\nnon-spherical spacecraft as a collection of N flat plates of area Si and outward\nnormal unit vector niB expressed in the spacecraft body-fixed coordinate system.\nThe inclination of the i th plate to the relative velocity is given by\n\ncos ?iaero D\n?\nAT niB\n\n\tT ? vrel\nkvrelk\n\n?\n(10.110)\n\nwhereA is the attitude matrix that rotates the GCI frame to the spacecraft body-fixed\nframe. The drag force in this model is\n\nFaero D ?1\n2\n? CDkvrelkvrel\n\nNX0\niD1\n\nSi cos ?\ni\naero (10.111)\n\n\n\n390 10 Orbital Dynamics\n\nwhere the prime on the sum indicates that only plates with cos ?iaero > 0 are included\nin the summation. Note that this algorithm does not account for potential self-\nshielding that would exist on concave spacecraft.\n\nIt is typical to group the drag coefficient, projected frontal area, and mass into a\nsingle term called the ballistic coefficient, B:\n\nB D m\nCDS\n\n(10.112)\n\nThe ballistic coefficient describes the relative magnitude of the effect of drag to\ninertial forces and gravity. A spacecraft with a low ballistic coefficient will be\nmore susceptible to effects caused by drag than a spacecraft with a high ballistic\ncoefficient. Most orbit determination algorithms can also refine an initial estimate\nof the ballistic coefficient. Note that some texts define the ballistic coefficient as the\ninverse of that in Eq. (10.112).\n\n10.3.4 Solar Radiation Pressure\n\nSolar radiation pressure (SRP) is another non-conservative force acting on space-\ncraft. It is dominated by drag for spacecraft in low-Earth orbit, but SRP will\ngenerally outweigh drag in higher altitude orbits (? 800 km). Like drag, SRP can be\ncharacterized using either a simple or high fidelity model depending upon the level\nof accuracy needed as well as a priori knowledge of the spacecraft. The mechanism\nby which SRP affects the orbit of a spacecraft is through momentum exchange\nbetween the spacecraft and photons incident on the spacecraft. Because of this,\nSRP is a fundamentally different perturbation from that of drag. Whereas drag acts\nthroughout the entire orbit, SRP only contributes as times when the spacecraft is not\nin the shadow of the Earth or another body.\n\nThe simplest of SRP models assumes that the force on the spacecraft due to solar\nradiation can be characterized as [21]\n\nFSRP D ?P? cSRP S esat? (10.113)\n\nwhere P? is the pressure of solar radiation, S is the Sun-facing area of the\nspacecraft, and esat? is a unit vector directed from the spacecraft to the center\nof the Sun, expressed in inertial coordinates. Section 11.3 presents methods for\ncomputing the Sun position, solar pressure, and conditions for shadowing. The\nconstant cSRP defines how the incident radiation interacts with the spacecraft.\nA value of cSRP D 0:0 implies that the spacecraft is transparent, so not affected\nby any incoming radiation. When cSRP D 2:0, the spacecraft acts like a mirror with\nall incident radiation perfectly reflected directly back to the Sun. While cSRP can\nvary for a single spacecraft depending on its attitude, for most practical problems a\nvalue of cSRP between 1.0 and 2.0 is sufficient for preliminary simulations.\n\n\n\n10.3 Disturbing Forces 391\n\nMore sophisticated methods can be used to obtain more accurate estimates\nof SRP if detailed knowledge of the spacecraft is available. These methods\ndecompose the SRP into contributions due to specular reflection, diffuse reflection,\nabsorption, and emission. Suppose that spacecraft\u2019s surface can be modeled as a\ncollection of N flat plates of area Si , outward normal niB in the body coordinate\nframe, specular reflection coefficient Rispec, diffuse reflection coefficient R\n\ni\ndiff, and\n\nabsorption coefficient Riabs. The coefficients sum to unity; R\ni\nspecCRidiffCRiabs D 1.\n\nDiffuse reflection is assumed to be Lambertian, which means that the intensity of\nthe reflected light in any direction is proportional to the cosine of the angle between\nthe reflection direction and the normal.\n\nThe inclination of the i th plate to the spacecraft-to-Sun vector is given by\n\ncos ?iSRP D\n?\nniI\n\tT\n\nesat? D\n?\nAT niB\n\n\tT\nesat? (10.114)\n\nwhereA is the attitude matrix that rotates the GCI frame to the spacecraft body-fixed\nframe. The force due to SRP can then be expressed as [21]\n\nFSRP D ?P?\nNX0\niD1\n\nSi cos ?\ni\nSRP\n\n?\n2\n\n?\nRidiff\n3\nCRispec cos ?iSRP\n\n?\nniI C .1 ?Rispec/esat?\n\n?\n\n(10.115)\n\nwhere the prime on the sum indicates that only plates with cos ?iSRP > 0 are included\nin the summation.\n\nEquation (10.115) provides a good approximation for the SRP acting on a\nspacecraft of basic geometry, but it has several limitations. First, it should be\nmentioned that the Sun is not the only source of radiation, although it is by far\nthe largest for Earth-orbiting spacecraft. Reflected light from the Earth or the Moon,\ncalled albedo, can be significant if very precise dynamical modeling is required; and\nmodels incorporating this effect have been developed [5].\n\nSecondly, the force due to thermal radiation emitted from the spacecraft has\nbeen ignored. A spacecraft is usually in a long-term energy balance, so all the\nabsorbed radiation is emitted as thermal radiation, although not necessarily at the\nsame time or from the same surface as its absorption. A simple way to model\nthermal radiation is to consider a portion of the absorbed radiation to be diffusely\nreflected, by increasing Ridiff and decreasing R\n\ni\nabs. However, this assumes that the\n\nenergy is re-radiated from the same surface and at the same time as its absorption.\nA more accurate computation requires knowledge of the absolute temperature Ti\nand emissivity \ni (a dimensionless constant between 0 and 1) of each surface. Then\nthe thermal radiation flux from the surface is given by the Stefan-Boltzmann law\n\nF ithermal D \ni?T 4i (10.116)\nwhere ? D 5:67?10?8 Wm?2K?4 is the Stefan-Boltzmann constant. If the thermal\nradiation from every surface is Lambertian, it gives rise to a net force\n\nFthermal D ?2\n3\n\nNX\niD1\n\nF ithermalSin\ni\nI (10.117)\n\n\n\n392 10 Orbital Dynamics\n\nThe reason that thermal radiation is usually negligible is that it is emitted with\nroughly equal flux in all directions, so that the net radiation force is generally small.\nA careful treatment of thermal radiation has been used to explain the anomalous\nacceleration of the Pioneer 10 and 11 spacecraft, though [18, 20]. This analysis had\nto account for onboard nuclear energy sources on these spacecraft, which resulted\nin more radiation energy being emitted than absorbed.\n\nFinally, Eq. (10.115) does not explicitly account for potential self-shadowing of\nconcave spacecraft. If the configuration of the spacecraft is known a priori, self-\nshadowing can be taken into account by replacing Si with the area of the flat plate\nthat is visible to the Sun after accounting for self-shadowing. Modeling the effects of\nreflected radiation or thermal radiation from one surface striking another surface is\nan additional complication. Another drawback to Eq. (10.115) is that it is only valid\nfor a collection of flat surfaces with uniquely defined outward normals. Most real\nspacecraft have some curved surfaces, and accurately approximating these surfaces\nby a collection of flat plates causes the size of the model to grow, increasing the\ncomputational burden.\n\n10.4 Perturbation Methods\n\nPerturbation methods find solutions to complex problems by relating them to\nsolutions of simpler problems. In our case, the solution of Eq. (10.85) is close to\nthe solution of the Kepler problem with all but the first term on the right side absent.\nWe will only give a very brief discussion of one of these methods; much fuller\ntreatments can be found in many books [4, 8, 16, 22].\n\n10.4.1 Variation of Parameters\n\nIn the variation of parameters (VOP) method, constant parameters that characterize\nthe unperturbed motion of a system are treated as slowly-varying parameters in\na representation of the perturbed motion. The six Kepler orbit elements are well\nsuited for the application of the VOP method to perturbed orbital motion. Consider\nthat we have a solution of Eq. (10.85) that gives a spacecraft\u2019s position and velocity\nas functions of time. Then at any particular time t , we can compute a set of six\nKepler elements using Eqs. (10.77)\u2013(10.84). These are called osculating elements,\nand the Keplerian orbit with these elements is the osculating orbit, after the Latin\nword \u201cosculum,\u201d meaning kiss, because the osculating orbit is tangent to, or kisses,\nthe perturbed orbit at time t .\n\nThe osculating Keplerian elements a.t/, e.t/, i.t/, ?.t/, !.t/, and M0.t/ that\nrepresent the perturbed orbit are functions of time, and obey a set of nonlin-\near coupled differential equations. These equations for the case of conservative\nperturbations, i.e. those derivable from a potential function, were developed by\n\n\n\n10.4 Perturbation Methods 393\n\nLagrange; and Gauss found the equivalent equations in terms of the perturbing\nacceleration aperturb. Exact integration of these equations has no real advantage over\ndirect integration of Eq. (10.85), but they are very useful as a starting point for\napproximations. Their widespread application to the dynamics of Earth-orbiting\nspacecraft began with the work of Brouwer [6] and Kozai [12], who analyzed\nthe effect of the zonal gravity harmonics on the osculating elements. Hoots has\nsummarized the history of these developments [10].\n\nThe variations of the osculating elements can be separated into periodic terms\nand secular terms. The orbit elements obtained after removing the periodic terms\n(in some analytic model and to some degree of approximation) are called mean\nelements. The mean elements are smoother functions of time than the osculating\nelements, and they obey simpler differential equations. The basic idea of the\nVOP method is to propagate the mean elements and then add the periodic terms\nanalytically. Care must be taken, because different analytic methods result in\nsomewhat different mean elements.\n\n10.4.2 Two Line Elements\n\nThe U.S. Space Surveillance System has been tracking and maintaining a catalog\nof man-made Earth-orbiting satellites since the dawn of the space age; by 2004\nthe catalog contained more than 10,000 objects [10]. The catalog is in the form\nof North American Air Defense Command (NORAD) two line element (TLE)\nsets, which provide the basic parameters to predict the position and velocity of\na spacecraft. Tables 10.3 and 10.4 describe the information in the TLE set.6 The\norbital elements in Line 2 are mean values obtained by removing periodic variations\nin a particular way. Accurate orbit predictions are obtained only if the prediction\nmodel computes these periodic variations in exactly the same way that they were\nremoved in computing the elements. Using any other prediction model, even one\nthat is theoretically more accurate, will produce inferior predictions. The model\ncurrently used for this purpose is the simplified general perturbations model SGP4,\nwhich includes low-order zonal gravity terms and an approximate aerodynamic drag\nmodel [10, 22].\n\nAn example for a TLE from the Tropical Rainfall Measuring Mission (TRMM)\nspacecraft is given by\n\nTRMM\n1 25063U 97074A 11130.2059828 .00013273 00000-0 18660-3 0 6592\n2 25063 034.9640 081.2155 0001042 240.3761 119.6798 15.55777853 76795 4\n\nThe title line contains the spacecraft name. The other two lines are described in\nTables 10.3 and 10.4. Note that there is an assumed decimal point in the B? value,\nso the value in the example is by 1:8660 ? 10?4. The term B? is given by [21]\n\n6The format is also described in http://en.wikipedia.org/wiki/Two-line_element_set.\n\nhttp://en.wikipedia.org/wiki/Two-line_element_set\n\n\n394 10 Orbital Dynamics\n\nTable 10.3 Line 1 TLE information\n\nField Columns Content Example\n\n1 01?01 Line number 1\n2 03?07 Satellite number 25063\n3 08?08 Classification (U=Unclassified) U\n4 10?11 International Designator (Last two digits of launch year) 97\n5 12?14 International Designator (Launch number of the year) 074\n6 15?17 International Designator (Piece of the launch) A\n7 19?20 Epoch Year (Last two digits of year) 11\n8 21?32 Epoch (Day of the year and fractional portion of the day) 130.20598286\n9 34?43 First Time Derivative of the Mean Motion divided by two .00013273\n10 45?52 Second Time Derivative of Mean Motion divided by six 00000?0\n11 54?61 B? drag term (decimal point assumed) 18660?3\n12 63?63 The number 0 (Originally \u201cEphemeris type\u201d) 0\n13 65?68 Element number 659\n14 69?69 Checksum (Modulo 10) 2\n\nTable 10.4 Line 2 TLE information\n\nField Columns Content Example\n\n1 01?01 Line number 2\n2 03?07 Satellite number 25063\n3 09?16 Inclination (Deg) 34.9640\n4 18?25 Right Ascension (Deg) 81.2155\n5 27?33 Eccentricity (decimal point assumed) 0001042\n6 35?42 Argument of Perigee (Deg) 240.3761\n7 44?51 Mean Anomaly (Deg) 119.6798\n8 53?63 Mean Motion (Revs per Day) 15.55777853\n9 64?68 Revolution number at epoch (Revs) 76795\n10 69?69 Checksum (Modulo 10) 4\n\nB? D 1\n2\n\nCDS\n\nm\n?0R? (10.118)\n\nwhere CD is the drag coefficient, S is the cross-sectional area, m is the mass, ?0 is\nthe atmospheric density at perigee (assumed to be 2:461?10?5 kg/m2/ER), andR?\nis the Earth radius (ER), typically given by 6378.135 km. The ballistic coefficient,\nB , defined by Eq. (10.112), is related to B? by\n\nB D R??0\n2B?\n\n(10.119)\n\nUsing R? D 6378:135 km the constant conversion is given by\n\nB D 1\n12:741621B?\n\nkg\n\nm2\n(10.120)\n\n\n\n10.4 Perturbation Methods 395\n\n10.4.3 A Useful Approximation, Secular J2 Effects Only\n\nWe noted in Sect. 10.3.1 that the J2 zonal term gave by far the largest perturbation\ndue to non-spherical gravitational field of the Earth. In many cases, a simple\nKeplerian propagation including only secular J2 perturbations is adequate for the\norbital accuracy required. This is the case, for example, when the output is used\nfor graphical visualization. In such instances, we can tolerate errors of order J2, but\nwant to avoid errors of order J2.t ? t0/.\n\nAnalysis shows that the mean elements Na, Ne, and Ni are constant, and the other\nmean elements have the following secular variation to first order in J2 [16]:\n\nN!.t/ D N!.t0/C 3\n2\nJ2\n\n?\nR?\nNa\n?2\n.1 ? Ne2/?2\n\n?\n2 ? 5\n\n2\nsin2 Ni\n\n?\nNn.t ? t0/ (10.121a)\n\nN? .t/ D N? .t0/ ? 3\n2\nJ2\n\n?\nR?\nNa\n?2\n.1 ? Ne2/?2 ?cos Ni\t Nn.t ? t0/ (10.121b)\n\nNM0.t/ D NM0.t0/C 3\n2\nJ2\n\n?\nR?\nNa\n?2\n.1 ? Ne2/?3=2\n\n?\n1 ? 3\n\n2\nsin2 Ni\n\n?\nNn.t ? t0/ (10.121c)\n\nwhere the overbars indicate mean elements, and Nn D p?= Na3. We can combine the\nlast of these equations with Eq. (10.68) to get\n\nNM.t/ D NM0.t0/C On.t ? t0/ (10.122)\n\nwhere\n\nOn D Nn\n\"\n1C 3\n\n2\nJ2\n\n?\nR?\nNa\n?2\n.1 ? Ne2/?3=2\n\n?\n1 ? 3\n\n2\nsin2 Ni\n\n?#\nD\nr\n?\n\nOa3 (10.123)\n\nwith\n\nOa D Na\n\"\n1 ? J2\n\n?\nR?\nNa\n?2\n.1 ? Ne2/?3=2\n\n?\n1 ? 3\n\n2\nsin2 Ni\n\n?#\n(10.124)\n\nIf we can tolerate errors of order J2, we only need to add the first-order corrections\nof Eqs. (10.121) and (10.122), and can otherwise propagate the orbit as if it were an\nunperturbed orbit. It is unnecessary to compute the periodic corrections for many\norbit and attitude analyses, so we can treat the propagated mean elements as if they\nwere osculating elements. The initial values of the mean elements can be obtained\nfrom a TLE set, or they can simply be postulated for a mission design study.\n\nWe often want to initialize an orbit propagation with position and velocity\nvectors at some epoch time. In order to use the simple Keplerian propagator\nincorporating secular J2 effects, we first convert the position and velocity to\n\n\n\n396 10 Orbital Dynamics\n\nosculating orbital elements. In principle, we should then remove the periodic\nvariations to obtain mean elements. Since we are willing to tolerate errors of order\nJ2, however, this osculating-to-mean conversion is unnecessary for five of the six\nKeplerian orbit elements. We must compute the mean value of the semimajor axis,\nhowever, because Eq. (10.122) shows that an error of order J2 in the semimajor axis\nwill lead to an error of the same order of magnitude in the mean motion and thus to\npropagation errors growing like J2 On.t?t0/, which we are not willing to tolerate [13].\nThe mean-to-osculating transformation of the semimajor axis is given by [16]\n\na.t/ D NaC J2R\n2?\nNa\n\n(? Na\nr\n\n?3?\n1?3 sin2 Ni sin2. N!C?/??.1?Ne2/?3=2\n\n?\n1?3\n2\n\nsin2 Ni\n?)\n\n(10.125)\n\nAfter propagating the orbit to times of interest, we apply the inverse, mean-to-\nosculating, transformation of the semimajor axis. This is not strictly necessary,\nbecause ignoring it leads to tolerable errors of order J2, but it ensures that the\noutput position and velocity agree with the input position and velocity at the epoch\ntime. Since we convert back to the osculating semimajor axis, we are free to use\nthe quantity Oa of Eq. (10.124) as our mean semimajor axis on the right side of\nEqs. (10.121a) and (10.121b), because that introduces differences only of order J 22 .\nCombining Eqs. (10.124) and (10.125) and using Eq. (10.20) to express r.t/ in terms\nof the mean elements and the true anomaly ?.t/ gives\n\na.t/ D OaC\n \nJ2R\n\n2?\nOa\n\n!\ng.t/ (10.126)\n\nwhere\n\ng.t/ ?\n?\n1C Ne cos ?.t/\n\n1 ? Ne2\n?3 ?\n\n1 ? 3 sin2 Ni sin2. N!.t/C ?.t//? (10.127)\n\nWe use the exact inverse of this equation\n\nOa D 1\n2\n\n?\na.t0/C\n\nq\na2.t0/ ? 4J2R2?g.t0/\n\n?\n(10.128)\n\nto initialize Oa at the epoch time, so that the output position and velocity agree with\nthe input to computer precision. Thus the steps in this orbit propagator are\n\n\u2022 Convert r.t0/ and v.t0/ to osculating Keplerian orbit elements\n\u2022 Use Eq. (10.128) to compute Oa\n\u2022 Treat Oa and the other five osculating elements as mean elements\n\u2022 Compute the mean motion On Dp?= Oa3\n\u2022 Use Eqs. (10.121a), (10.121b), and (10.122) to propagate to time t\n\n\n\n10.4 Perturbation Methods 397\n\n\u2022 Use Eq. (10.126) to compute a.t/\n\u2022 Convert the Keplerian orbit elements to r.t/ and v.t/\n\nThis orbit propagator was used in Goddard Space Flight Center\u2019s Mission Planning\nGraphics Tool (MPGT), and also to drive a wall display at the Smithsonian Air and\nSpace Museum.\n\n10.4.4 Sun-Synchronous Orbits\n\nThe right ascension of the ascending node in a Sun-synchronous orbit increases at\na rate of 1 revolution per year, or 1:991 ? 10?7 rad/s, so that the orbit plane has a\nnearly fixed orientation relative to the Sun. Substituting PN? D 1:991?10?7 rad/s and\nthe numerical values for J2, ?, andR? into Eq. (10.121b) shows that the inclination\nof a Sun-synchronous orbit must obey the relationship\n\ncos Ni D ?0:09892 .1 ? Ne2/2\n? Na\nR?\n\n?7=2\nD ?.1 ? Ne2/2\n\n\n ?\n3:975 h\n\n?7=3\n(10.129)\n\nwhere ? is the orbit period. Because the cosine is negative, the inclination will be\ngreater than 95:68?, which means that these are retrograde orbits.\n\nSun-synchronous orbits are labeled by the mean local time of the ascending\nnode, i.e. the mean local time at the sub-satellite point when the spacecraft crosses\nthe equator from South to North. These orbits have many useful applications,\nparticularly for observing the Earth\u2019s surface, because the lighting conditions at any\nlatitude change only seasonally, so very slowly from orbit to orbit. The inclination\nof circular Sun-synchronous orbits varies from 95:68? for a D R? to 99:48? for\na D R? C 1;000 km, and these high-inclination orbits are well-suited to observing\nhigh-latitude regions of the Earth.\n\nThe A Train, or Afternoon Train, of Earth-observation satellites provides a\ngood example of the use of such orbits. The spacecraft in this constellation are\nin 1:30 p.m. Sun-synchronous orbits with i D 98:14? and a D 7;078 km.7 They\nare spaced a few minutes apart from each other so their collective observations may\nbe used to build high-definition three-dimensional images of the Earth\u2019s atmosphere\nand surface. There are currently five active satellites in the A Train: the Global\nChange Observing Mission (GCOM-W1, also known as SHIZUKU), the lead\nspacecraft in the constellation, launched by JAXA on May 18, 2012: Aqua, 4 min\nbehind GCOM-W1, launched by NASA on May 4, 2002; CloudSat, a cooperative\neffort between NASA and the Canadian Space Agency, 2 min and 30 s behind Aqua;\nthe Cloud-Aerosol Lidar and Infrared Pathfinder Satellite Observations (CALIPSO)\nspacecraft, a joint effort of CNES and NASA, launched with Cloudsat on April 28,\n\n7The lack of precise agreement with Eq. (10.129) is due to higher-order zonal perturbations.\n\n\n\n398 10 Orbital Dynamics\n\n2006 and following it by no more than 15 s; and Aura, a multi-national satellite,\n15 min behind Aqua but crossing the equator 8 min behind it due to a different\nascending node, launched by NASA on July 15, 2004.\n\nSeveral solar observing scientific spacecraft have employed dawn/dusk Sun-\nsynchronous orbits, with ascending nodes at 6 a.m. or 6 p.m., to afford a nearly\ncontinuous view of the Sun. The near-absence of eclipses in dawn/dusk orbits is\nalso useful for providing photoelectric power and for minimizing thermal transients\non sensitive scientific instruments that occur at eclipse entry and exit. The eclipse\nanalysis of Sect. 11.3 of Chap. 11 shows that eclipses cannot be completely avoided\nunless aj sin.\"C i/j > R?, where \" D 23:44? is the obliquity of the ecliptic. This\ncondition is satisfied only if a is between 1:218R? and 1:522R?. A spacecraft in\na lower or higher 6 a.m. orbit will suffer eclipses around the northernmost point of\nits orbit for several weeks near the winter solstice, and a spacecraft in a 6 p.m.\norbit outside this altitude range will be eclipsed near the southernmost point of\nits orbit around the time of the summer solstice. The Canadian RADARSAT-2\nspacecraft, launched on December 14, 2007, is an example of a 6 p.m. Sun-\nsynchronous orbit. Its altitude is 798 km, so it has an 11-week eclipse period around\nthe summer solstice, with the longest eclipse duration being 18 min [15].\n\n10.5 Lagrange Points\n\nAfter Newton solved the equations of motion of two bodies under their gravitational\nattraction, the famous two-body problem, attention turned to the three-body prob-\nlem. This led to a great deal of deep mathematics that is beyond the scope of this\nbook [4, 8, 16]. We will only consider the circular restricted three-body problem\n(CR3BP). Restricted means that the mass of the third body (generally a spacecraft\nor an asteroid) is so small compared to the masses of the other two bodies (usually\nthe Sun and the Earth,8 the Earth and the Moon, or the Sun and Jupiter) that ignoring\nits influence on their motion is an excellent approximation. Circular means that the\ntwo other bodies, called the primaries, move in circular orbits around each other.\nWe will assume that the first primary, with mass m1, is at least as heavy as the\nsecond, with mass m2. The motion of the third body is most naturally described\nin a co-rotating coordinate system, in which the primaries appear to be at rest.\nThe origin of this frame is at the center of mass of the two primaries, its x axis is\nin the direction from m1 to m2, its z axis is along the direction of the orbital angular\nvelocity of the two primaries, and its y axis completes the right-handed orthogonal\ntriad. Figure 10.11 illustrates the frame and axis definitions.\n\nOur analysis will follow that of Danby [8], and will employ kinematic equations\nin a rotating frame developed in Sect. 3.1.3. We use Eq. (3.15) for the position vector\n\n8In discussing the Sun/Earth Lagrange points, \u201cEarth\u201d means the system of the Earth and the Moon,\nthe Sun is the first body, and the mass and location of the second body are the summed Earth/Moon\nmass and the location of the Earth/Moon center of mass.\n\n\n\n10.5 Lagrange Points 399\n\ny\n\nx\nL2L1L3\n\nL5\n\nL4\n\nOx1 x2\n\nm1 m2\n\na2\n\na1\n\nac\n\nFig. 10.11 The five Lagrange points\n\nof the spacecraft with respect to the center of mass of the two primaries, letting F\ndenote the inertial frame and G denote the co-rotating frame, which differ only\nby a rotation about the z axis. Because ! is in the positive z direction, it has the\nsame representation in both frames, so we can omit its frame-specifying subscript.\nThe angular velocity is also constant, so the P! term vanishes, giving\n\nRrG D AGF RrF ?! ? .! ? rG/ ? 2! ? PrG (10.130)\n\nThe acceleration in the inertial frame is due to the gravitational attraction of the two\nprimaries,\n\nRrF D ??1 .r ? r1/Fkr ? r1k3 ? ?2\n.r ? r2/F\nkr ? r2k3 (10.131)\n\nwhere ?i D GMi , so the spacecraft dynamics is governed by the equation\n\nRrG D ??1 .r ? r1/Gkr ? r1k3 ? ?2\n.r ? r2/G\nkr ? r2k3 ?! ? .! ? rG/ ? 2! ? PrG (10.132)\n\nAll vectors have now been expressed in the co-rotating frame, so we will omit the\nsubscript G for the remainder of the discussion.\n\nWe want to prove the existence of five Lagrange points, or libration points, which\nare points of static equilibrium where Rr and Pr are zero. Thus we are looking for\nsolutions of\n\n0 D ? ?1kr ? r1k3\n\n2\n4\nx ? x1\ny\n\nz\n\n3\n5 ? ?2kr ? r2k3\n\n2\n4\nx ? x2\ny\n\nz\n\n3\n5C ?1 C ?2\n\na3\n\n2\n4\nx\n\ny\n\n0\n\n3\n5 (10.133)\n\n\n\n400 10 Orbital Dynamics\n\nWe have used the relation !2 D .?1C?2/=a3, which follows from Eq. (10.43) with\na being the radius of the orbit of the two primaries. The z component of Eq. (10.133)\nrequires z D 0, so any equilibrium point must lie in the x?y plane. The y component\nrequires either y D 0 or\n\n0 D ? ?1kr ? r1k3 ?\n?2\n\nkr ? r2k3 C\n?1 C ?2\na3\n\n(10.134)\n\nIf y \u00a4 0, substituting this into the x component of Eq. (10.133) leads to the\nrequirement\n\n0 D ?1x1kr ? r1k3 C\n?2x2\n\nkr ? r2k3 (10.135)\n\nThe definition of the center of mass means that ?1x1 D ??2x2, so it follows from\nEq. (10.135) that kr? r1k D kr? r2k. Substituting this into Eq. (10.134) then gives\nkr ? r1k D kr ? r2k D a. This defines the two Lagrange points L4 and L5 at\nthe vertices of two equilateral triangles in the orbital plane of the two primaries,\nwhose other vertices are the locations of the primaries. These are illustrated for\nthe case that m1 D 3m2 in Fig. 10.11. The figure shows that the resultant of the\nacceleration vectors a1 due to the attraction of m1 and a2 due to the attraction of m2\nprovides the centripetal acceleration ac D !? .!?r/ needed for equilibrium at L4.\n\nThere is no simple expression for the location of the collinear Lagrange points,\nthe points with y D z D 0. Assume that m2 ? m1 and let\n\n? ? m2\nm1 Cm2 ; so that x1 D ??a and x2 D .1 ? ?/a (10.136)\n\nWe also let x D ?a, so that Eq. (10.132) for a body at rest on the x axis gives\nR?\n!2\nD ?.1 ? ?/ ? C ?j? C ?j3 ? ?\n\n? C ? ? 1\nj? C ? ? 1j3 C ? (10.137)\n\nThe right side of this equation is plotted in Fig. 10.12 for j?j ? 1:5 for the case that\nm1 D 3m2. The function will have this general shape for any mass ratios. We notice\ntwo things. First, it is easy to see that there are three collinear Lagrange points: L1\nbetween m1 and m2, L2 on the side of m2 away from m1, and L3 on the side of\nm1 away from m2.9 The second point is that the acceleration in the vicinity of a\ncollinear Lagrange point is always away from the Lagrange point, meaning that the\ncollinear Lagrange points are unstable. If m2 ? m1, the usual case, it is not too\ndifficult to show that L2 and L1 are at x ? x2 ? .?=3/1=3a, respectively, and that\nL3 is at x ? ?.1C 5?=12/a. The Sun/Earth L1 and L2 points are about 0.01 AU,\nor about 1:5 ? 106 km, from the Earth, because ? ? 3 ? 10?6 for that system.\n\n9This labeling convention is not universally followed.\n\n\n\nReferences 401\n\nL3\nm1 O m2 x\n\ny\n\nL1 L2\n\nFig. 10.12 x-axis force, and collinear Lagrange points\n\nA complete analysis of the stability of the Lagrange points requires consideration\nof the Coriolis acceleration, the last term in Eq. (10.132). We will only state the\nresult obtained by linearizing this equation in the vicinity of L4 and L5, Danby\nshows that these points are stable if m1=m2 > .25 C 3\n\np\n69/=2 D 24:96. Stable\n\npoints at L4 or L5 are called Trojan points, after the Trojan asteroids at the Sun-\nJupiter L4 and L5 points. The Earth/Moon Trojan points are stable, but solar gravity\nleads to large motions about these points [11, 19].\n\nAlthough the collinear Lagrange points are unstable, relatively small control\nforces can keep spacecraft in orbits around these points, and a variety of uses have\nbeen found for spacecraft in such orbits [9]. The International Sun-Earth Explorer\n3 (ISEE-3), the Solar and Heliospheric Observatory (SOHO), the Advanced Com-\nposition Explorer (ACE), and WIND spacecraft have all been stationed near the\nSun/Earth L1 point to observe the Sun and the solar wind. Radio emissions\nfrom the Sun would complicate communication with a spacecraft exactly at L1.\nThe Sun/Earth L2 point is useful for stationing an instrument that needs to be\nshielded from thermal energy emitted by both the Sun and the Earth, which are both\non the same side of the spacecraft. Spacecraft are almost never placed exactly at L2,\nhowever, since they would not be able to use Solar power at that point. The WMAP,\nHerschel, and Planck spacecraft have all been placed in orbits around L2, and the\nJames Webb Space Telescope (JWST) is planned to be placed there. An orbit about\nthe Earth/Moon L2 point has been proposed as the location for a data relay satellite\nto communicate with human or robotic explorers on the back side of the Moon.\n\n\n\n402 10 Orbital Dynamics\n\nReferences\n\n1. Abramowitz, M., Stegun, I.A.: Handbook of Mathematical Functions with Formulas, Graphs\nand Mathematical Tables. Applied Mathematics Series - 55. National Bureau of Standards,\nWashington, DC (1964)\n\n2. Arfken, G.B., Weber, H.J., Harris, F.E.: Mathematical Methods for Physicists: A Comprehen-\nsive Guide, 7th edn. Academic Press, Waltham (2013)\n\n3. Bate, R.R., Mueller, D.D., White, J.E.: Fundamentals of Astrodynamics. Dover Publications,\nNew York (1971)\n\n4. Battin, R.H.: An Introduction to the Mathematics and Methods of Astrodynamics. American\nInstitute of Aeronautics and Astronautics, New York (1987)\n\n5. Borderies, N., Longaretti, P.: A new treatment of the albedo radiation pressure in the case of a\nuniform albedo and of a spherical satellite. Celestial Mech. Dyn. Astron. 49(1), 69\u201398 (1990)\n\n6. Brouwer, D.: Solution of the problem of artificial satellite theory without drag. Astron.\nJ. 64(1274), 378\u2013397 (1959)\n\n7. Colwell, P.: Solving Kepler\u2019s Equation over Three Centuries. Willmann-Bell, Richmond (1993)\n8. Danby, J.M.A.: Fundamentals of Celestial Mechanics, 2nd edn., 3rd Printing. Willman-Bell,\n\nRichmond (1992)\n9. Farquhar, R.W.: Fifty Years on the Space Frontier: Halo Orbits, Comets, Asteroids, and More.\n\nOutskirts Press, Parker (2011)\n10. Hoots, F.R., Schumacher Jr., P.W., Glover, R.A.: History of analytical orbit modeling in the\n\nU.S. space surveillance system. J. Guid. Contr. Dynam. 27(2), 174\u2013185 (2004)\n11. Kolenkiewicz, R., Carpenter, L.: Stable periodic orbits about the Sun perturbed Earth-Moon\n\ntriangular points. AIAA J. 6(7), 1301\u20131304 (1968)\n12. Kozai, Y.: The motion of a close Earth satellite. Astron. J. 64(1274), 367\u2013377 (1959)\n13. Markley, F.L., Jeletic, J.F.: Fast orbit propagator for graphical display. J. Guid. Contr. Dynam.\n\n14(2), 473\u2013475 (1991)\n14. Montenbruck, O., Gill, E.: Satellite Orbits: Models, Methods, and Applications. Springer,\n\nBerlin/Heidelberg/New York (2000)\n15. Morena, L.C., James, K.V., Beck, J.: An introduction to the RADARSAT-2 mission. Can.\n\nJ. Rem. Sens. 30(3), 221\u2013234 (2004)\n16. Roy, A.E.: Orbital Motion, 4th edn. IOP Publishing, Bristol (2005)\n17. Schaub, H., Junkins, J.L.: Analytical Mechanics of Aerospace Systems, 2nd edn. American\n\nInstitute of Aeronautics and Astronautics, New York (2009)\n18. Scheffer, L.K.: Conventional forces can explain the anomalous acceleration of Pioneer 10.\n\nPhys. Rev. D67(8), 8402-1\u20138402-11 (2003)\n19. Tapley, B.D., Lewallen, J.M.: Solar influence on satellite motion near the stable Earth-Moon\n\nlibration points. AIAA J. 2(4), 728\u2013732 (1964)\n20. Turyshev, S.G., Toth, V.T., Kinsella, G., Lee, S.-C., Lok, S.M., Ellis, J.: Support for the thermal\n\norigin of the Pioneer anomaly. Phys. Rev. Lett. 108(24), 241101 (2012)\n21. Vallado, D.A.: Fundamentals of Astrodynamics and Applications, 3rd edn. Microcosm Press,\n\nHawthorne and Springer, New York (2007)\n22. Vallado, D.A., Crawford, P., Hujsak, R., Kelso, T.S.: Revisiting Spacetrack Report #3: Rev 2.\n\nIn: AIAA/AAS Astrodynamics Specialist Conference. Keystone (2006)\n23. Vallado, D.A., Finkleman, D.: A critical assessment of satellite drag and atmospheric density\n\nmodelling. In: AIAA/AAS Astrodynamics Specialist Conference. Honolulu (2008)\n\n\n\nChapter 11\nEnvironment Models\n\nThe analysis of spacecraft attitude and trajectory motion depends on several\nenvironmental models, as does the analysis of sensor measurements. This chapter\npresents models of the Earth\u2019s magnetic field and atmosphere and of the motion of\nthe Sun and its planets as seen from the Earth.\n\n11.1 Magnetic Field Models\n\nIn a region with no appreciable electric currents, a magnetic field can be computed\nas the negative gradient of a magnetic scalar potential arising from a collection\nof magnetic poles, each providing a 1=r contribution. This is similar to the\ngravitational potential contributed by a collection of point masses, so magnetic field\nmodels use the same mathematical apparatus as gravity field models. Following\nthe same path as in Sect. 10.3.1 leads to a spherical harmonics expansion for the\nmagnetic potential. There is one significant difference between the magnetic and\ngravitational potentials. Gravitational forces are always attractive, while magnetic\nforces can be attractive or repulsive, represented by North and South magnetic\npoles with pole strengths of opposite signs. In fact, isolated poles are never found in\nnature: poles always appear in pairs, North and South poles of equal and opposite\nmagnitude, comprising a magnetic dipole.1 As a result, the first term on the right\nside of the magnetic analog of Eq. (10.94) is absent, leading to\n\nV.r/ D a\n1X\nnD1\n\n\na\nr\n\n?nC1 nX\nmD0\nNPmn .sin\t0/\u0152gmn .t/ cos.m?/Chmn .t/ sin.m?/? (11.1)\n\n1Some physical theories predict the occurrence of isolated magnetic monopoles, but none has of\nyet been detected.\n\nF.L. Markley and J.L. Crassidis, Fundamentals of Spacecraft Attitude Determination\nand Control, Space Technology Library 33, DOI 10.1007/978-1-4939-0802-8__11,\n\u00a9 Springer Science+Business Media New York 2014\n\n403\n\n\n\n404 11 Environment Models\n\nThis equation is presented in the form used for the International Geomagnetic\nReference Field (IGRF) [4]. The parameter a D 6371:2 km is the magnetic spherical\nreference radius, and the coefficients gmn .t/ and h\n\nm\nn .t/ are conventionally given in\n\nunits of nanotesla (nT). The bars over the associated Legendre functions indicate\nthat they are the Schmidt semi- (or quasi-) normalized functions, defined as [20]\n\nNPmn D\ns\n.2 ? ?0m/ .n ?m/\u0160\n\n.nCm/\u0160 P\nm\nn (11.2)\n\nThe IGRF is produced and maintained under the auspices of the International\nAssociation of Geomagnetism and Aeronomy (IAGA). It represents the internal\npart of the Earth\u2019s magnetic field, which is almost entirely generated in the Earth\u2019s\ncore and is slowly varying on time scales of years to decades [12]. In addition to\nthe internal field, magnetic fields with time scales ranging mostly from seconds to\nhours are generated by electric currents in the ionosphere and magnetosphere. These\nfields, which are not included in the IGRF, are as small as 20 nT during magnetically\nquiet periods, but can be as large as 1,000 nT or greater during a magnetic storm.\n\nBecause of the time variation of the Earth\u2019s field, the IGRF provides coefficients\ngmn .Ti / and h\n\nm\nn .Ti / at 5-year intervals. The eleventh generation IGRF has coeffi-\n\ncients of degrees n ? 10 for 1900 ? Ti < 2000 and n ? 13 for 2000 ? Ti ? 2010.\nThe coefficients for times between Ti and TiC1 are found by linear interpolation.\nThis IGRF also includes a predictive model for linear extrapolation to years after\n2010, comprising secular variations Pgmn .2010/ and Phmn .2010/ (in nT/year) only\nfor degrees n ? 8. When one of the 5-year constituent models is considered\ndefinitive, it is called a Definitive Geomagnetic Reference Field (DGRF), and its\ncoefficients are frozen. The eleventh generation IGRF is considered definitive for\nthe years 1945\u20132005. The RMS errors in the more recent models are estimated to\nbe about 10 nT.\n\n11.1.1 Dipole Model\n\nKeeping only the n D 1 terms in Eq. (11.1) gives the dipole approximation\n\nV.r/ D a\n3\n\nr2\n\n? NP 01 .sin\t0/g01 C NP 11 .sin\t0/.g11 cos? C h11 sin?/\n?\n\nD a\n3\n\nr2\n\n?\ng01 sin\t\n\n0 C g11 cos\t0 cos? C h11 cos\t0 sin?\n\t D m ? r\n\nr3\n(11.3)\n\nwhere\n\nm D a3\n2\n4\ng11\nh11\ng01\n\n3\n5 D m\n\n2\n4\n\nsin ?m cos?m\nsin ?m sin?m\n\ncos ?m\n\n3\n5 (11.4)\n\n\n\n11.1 Magnetic Field Models 405\n\nis the magnetic dipole in the ECEF frame. The coefficients from the 2005 DGRF:\ng01 D ?29554:63 nT, g11 D ?1669:05 nT, and h11 D 5077:99 nT give the dipole\nmagnitude2 m D a3 ? 30;034 nT D 7:77 ? 1022 Am2 as well as the orientation\n?m D 169:7? and ?m D 108:2?. Note that the Earth\u2019s North magnetic pole is\nnear the South geographic pole, where it must be because opposite poles attract.\nThe magnetic field is given by\n\nB.r/ D ?rV.r/ D 3.m ? r/r ? r\n2m\n\nr5\n(11.5)\n\nThe magnetic field strength falls off with distance as 1=r3, and it is twice as great at\nthe magnetic poles, r km, as at the magnetic equator, r ? m.\n\nThe Earth\u2019s magnetic field is often used as a reference for attitude determination\nor control, so it is of interest to know how the direction of the ambient magnetic field\nvaries as a spacecraft moves around its orbit. The time derivative of the magnetic\nfield at the location of the spacecraft can be separated into components parallel and\nperpendicular to the field by\n\nPB D kBk?2\nh\n.B ? PB/BC .B ? PB/ ? B\n\ni\nD kBk?2.B ? PB/BC? ? B (11.6)\n\nwhere? ? kBk?2.B? PB/ is the rotation rate of the magnetic field. The first term on\nthe right side of Eq. (11.6) gives the rate of change of the magnitude of the magnetic\nfield, which is of less interest for attitude estimation and control. For a spacecraft\nin a circular orbit, r is constant and the spacecraft velocity in the GCI frame is\nPr D !o ? r, where !o is the orbital angular velocity, so\n\nPB D 3.m ? r/.!o ? r/C 3\u0152m ? .!o ? r/?r\nr5\n\n(11.7)\n\nThe derivation of Eq. (11.7) assumes that the magnetic dipole is constant in GCI,\nwhich is not exactly true due to the rotation of the Earth. The orbital angular velocity\nof a near-Earth spacecraft is about 15 times greater than the rotation rate of the\nEarth, though, so ignoring the motion of the dipole in the GCI frame is a reasonable\napproximation. Then, after a significant amount of vector algebra, we find that\n\n? D 3 \u0152.m ? r/\n2 Cm2r2?!o C .m ?!o/\u01522.m ? r/r ? r2m?\n\n3.m ? r/2 Cm2r2 (11.8)\n\nThe derivation of Eq. (11.8) makes use of the fact that r ? !o D 0, because !o is\nalong the orbit normal. This result has two interesting limits. If the orbit plane is\n\n2An extra factor of 4\n=?0 D 107 is needed to convert to Am2.\n\n\n\n406 11 Environment Models\n\nthe magnetic equatorial plane, then m!o D ?!om and m ? r D 0, so ? D 0 as\nexpected. In the more interesting case that the orbit plane contains the magnetic pole\ndirections, m ?!o D 0, and\n\n? D 3\n?\n.m ? r/2 Cm2r2\n3.m ? r/2 Cm2r2\n\n?\n!o; for m in the orbit plane (11.9)\n\nThis has the maximum and minimum magnitudes? D 3!o at the magnetic equator\nand? D 3!o=2 at the magnetic poles.\n\n11.2 Atmospheric Density\n\nModeling the local atmospheric density, ?, is quite difficult, and many decades of\nwork have resulted in many different models. Vallado [18] provides an excellent\ndescription of the development of atmospheric models, including many of the\ncommon assumptions built into them. This section is devoted to the development of\natmospheric modeling including the numerous existing models with their benefits\nand shortcomings.\n\n11.2.1 Exponentially Decaying Model Atmosphere\n\nThe simplest of all the models is a fully static, exponentially decaying model. This\nmodel [19] assumes the atmospheric density decays exponentially with increasing\nheight. This model is fully static in the sense that the densities are independent of\ntime. Also, the exponential model assumes an axially symmetric atmosphere about\nthe polar axis. The exponential model is given by\n\n? D ?0 exp\n?\n?h ? h0\n\nH\n\n?\n(11.10)\n\nwhere ?0 and h0 are reference density and height, respectively, h is the height above\nthe ellipsoid, and H is the scale height, which is the fractional change in density\nwith height. Table 11.1 gives values of h0, ?0, and H for various ranges of h [19].\nThe exponential atmosphere is a good choice for preliminary simulations because\nit yields decent results and is computationally efficient. However, this model is not\nusually sufficient for high fidelity simulations.\n\n\n\n11.2 Atmospheric Density 407\n\nTable 11.1 Exponential\natmospheric model\n\nh (km) h0 (km) ?0 (kg/m3) H (km)\n\n0\u201325 0 1.225 8.44\n25\u201330 25 3.899?10?2 6.49\n30\u201335 30 1.774?10?2 6.75\n35\u201340 35 8.279?10?3 7.07\n40\u201345 40 3.972?10?3 7.47\n45\u201350 45 1.995?10?3 7.83\n50\u201355 50 1.057?10?3 7.95\n55\u201360 55 5.821?10?4 7.73\n60\u201365 60 3.206?10?4 7.29\n65\u201370 65 1.718?10?4 6.81\n70\u201375 70 8.770?10?5 6.33\n75\u201380 75 4.178?10?5 6.00\n80\u201385 80 1.905?10?5 5.70\n85\u201390 85 8.337?10?6 5.41\n90\u201395 90 3.396?10?6 5.38\n95\u2013100 95 1.343?10?6 5.74\n100\u2013110 100 5.297?10?7 6.15\n110\u2013120 110 9.661?10?8 8.06\n120\u2013130 120 2.438?10?8 11.6\n130\u2013140 130 8.484?10?9 16.1\n140\u2013150 140 3.845?10?9 20.6\n150\u2013160 150 2.070?10?9 24.6\n160\u2013180 160 1.224?10?9 26.3\n180\u2013200 180 5.464?10?10 33.2\n200\u2013250 200 2.789?10?10 38.5\n250\u2013300 250 7.248?10?11 46.9\n300\u2013350 300 2.418?10?11 52.5\n350\u2013400 350 9.158?10?12 56.4\n400\u2013450 400 3.725?10?12 59.4\n450\u2013500 450 1.585?10?12 62.2\n500\u2013600 500 6.967?10?13 65.8\n600\u2013700 600 1.454?10?13 79.0\n700\u2013800 700 3.614?10?14 109.0\n800\u2013900 800 1.170?10?14 164.0\n900\u20131,000 900 5.245?10?15 225.0\n>1,000 1,000 3.019?10?15 268.0\n\n11.2.2 Harris-Priester Model Atmosphere\n\nThe Harris-Priester atmosphere [6] was one of the first attempts to model density\nin terms of atmospheric temperature. Harris and Priester noted that the atmosphere\nis mainly governed by the laws of thermodynamics and equilibrium in diffusion,\nconduction and the absorption of thermal energy from the Sun. Density for the\nHarris-Priester atmosphere is determined by simultaneous integration of the heat\nconduction and diffusion equations for each of the molecular constituents in the\n\n\n\n408 11 Environment Models\n\natmosphere, yielding the number density for each constituent. Using the ideal gas\nlaw, the density can then be calculated. The Harris-Priester model has resulted\nin several lookup tables where one can determine the density as a function of\nthe local time and altitude for a prescribed solar-flux value. These tables are\nconvenient for determining the density variation within single day and may be useful\nin short term simulations. While the Harris-Priester model accounts for many of\nthe phenomena affecting the atmosphere, it lacks the ability to model seasonal,\nlatitudinal, and geomagnetic variations with the accuracy needed for high fidelity\nlong term simulations.\n\n11.2.3 Jacchia and GOST Model Atmospheres\n\nThroughout the late 1960s and 1970s, Jacchia produced a series of models [7\u20139]\nand updates that explicitly handle each of the observed atmospheric phenomena.\nThe basis for each of the Jacchia models is essentially the same as the Harris-Priester\nmodel with one major exception. Whereas the Harris-Priester model determines the\ntemperature by integrating the heat conduction equation, Jacchia uses an empirically\nderived temperature profile to integrate the diffusion equation for each constituent.\nAnother difference between the Harris-Priester and Jacchia models is that the\nHarris-Priester model accounts for all of the solar phenomena within the integration\nof the conduction equation whereas Jacchia takes a different approach and adds\ntemperature and/or density corrections to account for each of the phenomena.\nA particular advantage to Jacchia\u2019s models is that he and his colleagues used real\nspacecraft data to curve fit certain phenomena. This allows Jacchia\u2019s models to\naccurately represent actual atmospheric conditions even though all the phenomena\nare not precisely modeled. One shortcoming of Jacchia\u2019s models are that there is\nno standard set of lookup tables, meaning that the entire temperature/density profile\nmust be determined via numeric integration for each instant, limiting the models\u2019\nuse in real-time applications.\n\nJacchia\u2019s models must be numerically integrated because of the empirical\ntemperature formula that he used. By proposing an alternative temperature function,\nRoberts [15] was able to analytically integrate the barometric and diffusion equa-\ntions [17]. The resulting density profile proved to be a very good approximation\nto Jacchia\u2019s densities for all altitudes. The Jacchia-Roberts atmosphere produces\nvery good results and has been implemented in NASA\u2019s Goddard Trajectory\nDetermination System (GTDS) [13].\n\nOne last model atmosphere of interest is the Russian GOST atmosphere [21].\nThe GOST model is a purely empirical model constructed using data from the\nCosmos spacecraft [17]. The main advantage to the GOST model is that it is\nextremely computationally efficient. In contrast the other models described, except\nthe static model, the GOST model determines the density directly rather than com-\nputing first the temperature profile of the atmosphere. Five multiplicative correction\nfactors then account for variations in the solar flux, diurnal effect, semiannual\n\n\n\n11.2 Atmospheric Density 409\n\nchanges, and geomagnetic activity. Because the GOST model is empirically derived,\nit requires numerous extensive lookup tables to determine the proper coefficients\ncorresponding to the current atmospheric conditions. The GOST model has been\nshown to provide good agreement with other semi-analytic models such as Jacchia\n1977 [1] and NRLMSIS-00 [22].\n\n11.2.4 Jacchia-Bowman 2008 (JB2008) Model Atmosphere\n\nBecause Jacchia\u2019s models treat each of the known phenomena individually, they\nprovide a good base that can be refined given new experimental data and advances\nin research. Such is the case with the Jacchia-Bowman model atmospheres [2, 3].\nBowman uses new spacecraft drag data and new solar indices in order to develop\ncorrections to Jacchia\u2019s 1970 model [7]. Bowman has incorporated new solar\nindices apart from the standard F10:7 index in order to determine the exospheric\ntemperature [2], fitted new semiannual and seasonal-latitudinal corrections, added\nhigh altitude corrections, and provided a new means to account for geomagnetic\nactivity. The Jacchia-Bowman model atmosphere uses Jacchia\u2019s original tempera-\nture function, which means that numeric integration is required in order to determine\nthe density distribution. While the model is slow, Bowman\u2019s corrections result in a\nsubstantial reduction in density error over other atmospheric models [2].\n\nBecause of the high quality of results produced by the Jacchia-Bowman model,\nit is the standard model used by the Joint Space Operations Center (JSpOC) when\ntracking objects. The most current version of the Jacchia-Bowman model, JB2008,\ncan be found at the website http://sol.spacenvironment.net/~JB2008/. Along with\nFortran source code, the website also offers many relevant publications relating to\nthe JB2008 model and its previous versions, histories of solar flux data and magnetic\nstorm indices. In this section the JB2008 model is described in detail.\n\n11.2.4.1 Temperature Profile\n\nJacchia\u2019s models, from which the JB2008 model is constructed, begin by deter-\nmining the temperature profile of the atmosphere at a specific time and location.\nThis temperature profile is subsequently used to integrate the diffusion equations\nin order to determine the local density. Defining the temperature profiles begins by\ndetermining the exospheric temperature. The exospheric temperature is influenced\nby many factors including solar activity, local time and geomagnetic activity.\nThe effect of solar activity on the exospheric temperature can be represented by\nthe uncorrected exospheric temperature, Tc [2]\n\nTc D 392:4C 3:227 NFS C 0:298 ?F10C 2:259 ?S10C 0:312 ?M10C 0:178 ?Y10\n(11.11)\n\nhttp://sol.spacenvironment.net/~JB2008/\n\n\n410 11 Environment Models\n\nwith\n\nNFS D WT NF10 C .1 ?WT / NS10 (11.12a)\n\nWT D min\n0\n@\n NF10\n240\n\n!1=4\n; 1\n\n1\nA (11.12b)\n\nand Tc expressed in degrees Kelvin. The? values are given by?X D X? NX where\nX is the current value of the solar index and NX is the 81-day centered average value\nof the index, centered at the desired time. F10, S10, M10, and Y10 are indices which\nare used to describe solar activity, as described in detail in [2]. These indices are\ntypically tabulated as daily values. However, care must be taken when reading values\nfrom a lookup table. Each index has its own associated time lag for implementation.\nValues for F10 and S10 have a time lag of 1 day,M10 has a 2 day time lag and Y10 has\na 5 day time lag. To clarify this point, suppose we want to determine the exospheric\ntemperature on 11-February-2011. The values F10, S10, and their centered averages\nwould correspond to those tabulated for 10-February-2011. TheM10 and NM10 values\nwould come from the tabulated values for 9-February-2011, and the values for Y10\nwould be read from 6-February-2011.\n\nOnce the uncorrected exospheric temperature is determined, correction factors\ncorresponding to diurnal and geomagnetic effects are added in. The diurnal vari-\nation accounts for the day-to-night variation in density of the atmosphere. Using\nspacecraft drag data to derive the atmospheric density has shown that the maximum\ndensity occurs around 14h00 local solar time while a minimum in density occurs\naround 04h00 local solar time [10]. Accounting for the diurnal variation, the local\natmospheric temperature is given by\n\nT` D Tc f1CR \u0152sinm.?/C .cosm ? ? sinm ?/j cosn .?=2/ j?g (11.13)\n\nwith\n\n? D 1\n2\nj\tC ??j (11.14a)\n\n? D 1\n2\nj\t ? ??j (11.14b)\n\n? D H C ? C p sin.H C ?/ (11.14c)\nH D ? ? ?? (11.14d)\n\nwhere \t is the geodetic latitude, ? is the longitude, ?? is the declination of the Sun,\nand ?? is the right ascension (longitude) of the Sun. The constants R, m, n ?, p,\nand ? are derived so that the model given by Eq. (11.13) best fit spacecraft drag data;\n\n\n\n11.2 Atmospheric Density 411\n\nR D 0:31 ? D C37?\nm D 2:5 p D C6?\nn D 3:0 ? D C43?\n\nIn addition to modeling of the diurnal bulge, Bowman has introduced an additional\ndiurnal correction [3]. The temperature correction can be determined by first\ndefining\n\nF D 0:1.F10 ? 100/ (11.15a)\n\nT D LST\n24\n\n(11.15b)\n\ny D cos\t (11.15c)\n\nwhere LST is the local spacecraft time give by LST D .H C \n/180?\n\n\n24\n360\n\nwhich\nis then modulated so that 0 < LST ? 24. The temperature corrections were\ndetermined by curve-fitting data over certain altitude intervals. With h being the\naltitude in the ECEF frame given by Eq. (2.77), the results of these fits are given by\n\n120 ? h ? 200 km\n\nH D .h ? 120/=80\nA D C17 C C18yT C C19yT 2 C C20yT 3 C C21yF C C22yF T C C23yF T 2\n\nB D C1 C C2F C C3F T C C4F T 2 C C5F T 3 C C6F T 4 C C7F T 5\n\nC C8yT C C9yT 2 C C10yT 3 C C11yT 4 C C12yT 5 C C13y C C14Fy\nC C15FyT C C16FyT 2\n\n?Tc D .3A ? B/H2 C .B ? 2A/H3 (11.16)\n\n200 < h ? 240 km\nH D 4=5\n\n?Tc D C1H C C2FH C C3FHT C C4FHT 2 C C5FHT 3 C C6FHT 4 C C7FHT 5\n\nC C8yHT C C9yHT 2 C C10yHT 3 C C11yHT 4 C C12yHT 5 C C13yH\nC C14FyH C C15FyHT C C16FyHT 2 C C17 C C18yT C C19yT 2 C C20yT 3\n\nC C21Fy C C22FyT C C23FyT 2 (11.17)\n\n\n\n412 11 Environment Models\n\n240 < h ? 300 km\nH D .h? 200/=50; Nh D 3; hp D .h? 240/=6\nA D C1H C C2FH C C3FHT C C4FHT 2 C C5FHT 3 C C6FHT 4\n\nC C7FHT 5 C C8yHT C C9yHT 2 C C10yHT 3 C C11yHT 4 C C12yHT 5\n\nC C13yH C C14FyH C C15FyHT C C16FyHT 2 C C17 C C18yT\nC C19yT 2 C C20yT 3 C C21Fy C C22FyT C C23FyT 2\n\nB D C1 C C2F C C3F T C C4F T 2 C C5F T 3 C C6F T 4 C C7F T 5 C C8yT C C9yT 2\n\nC C10yT 3 C C11yT 4 C C12yT 5 C C13y C C14Fy C C15FyT C C16FyT 2\n\nX D B1 C B2F C B3F T C B4F T 2 C B5F T 3 C B6F T 4 C B7F T 5 C B8yT\nC B9yT 2 C B10yT 3 C B11yT 4 C B12yT 5 C B13y NhC B14y NhT C B15y NhT 2\n\nC B16y NhT 3 C B17y NhT 4 C B18y NhT 5 C B19y\nY D B13y C B14yT C B15yT 2 C B16yT 3 C B17yT 4 C B18yT 5\nC D 3X ? Y ? 3A? 2B\nD D X ? .AC B C C/\n\n?Tc D AC Bhp C Ch2p CDh4p (11.18)\n300 < h ? 600 km\n\nH D h=100\n?Tc D B1 C B2F C B3F T C B4F T 2 C B5F T 3 C B6F T 4 C B7F T 5\n\nC B8yT C B9yT 2 C B10yT 3B11yT 4 C B12yT 5 C B13yH\nC B14yHT C B15yHT 2 C B16yHT 3 C B17yHT 4\n\nC B18yHT 5 C B19y (11.19)\n600 < h ? 800 km\n\nH D 6; hp D .h ? 600/=100\nA D B1 C B2F C B3F T C B4F T 2 C B5F T 3 C B6F T 4 C B7F T 5\n\nC B8yT C B9yT 2 C B10yT 3 C B11yT 4 C B12yT 5 C B13yH\nC B14yHT C B15yHT 2 C B16yHT 3 C B17yHT 4 C B18yHT 5 C B19y\n\nB D B13y C B14yT C B15yT 2 C B16yT 4 C B17yT 4 C B18yT 5\n\nC D ?.3C 4B/=4\nD D .AC B/=4\n\n?Tc D AC Bhp C Ch2p CDh3p (11.20)\n\n\n\n11.2 Atmospheric Density 413\n\nTable 11.2 Diurnal\ntemperature correction factors\n\ni Bi Ci\n\n1 ?0:457512297 ? 101 ?0:155986211 ? 102\n2 ?0:512114909 ? 101 ?0:512114909 ? 101\n3 ?0:693003609 ? 102 ?0:693003609 ? 102\n4 0:203716701 ? 103 0:203716701 ? 103\n5 0:703316291 ? 103 0:703316291 ? 103\n6 ?0:194349234 ? 104 ?0:194349234 ? 104\n7 0:110651308 ? 104 0:110651308 ? 104\n8 ?0:174378996 ? 103 ?0:220835117 ? 103\n9 0:188594601 ? 104 0:143256989 ? 104\n10 ?0:709371517 ? 104 ?0:318481844 ? 104\n11 0:922454523 ? 104 0:328981513 ? 104\n12 ?0:384508073 ? 104 ?0:135332119 ? 104\n13 ?0:645841789 ? 101 0:199956489 ? 102\n14 0:409703319 ? 102 ?0:127093998 ? 102\n15 ?0:482006560 ? 103 0:212825156 ? 102\n16 0:181870931 ? 104 ?0:275555432 ? 101\n17 ?0:237389204 ? 104 0:110234982 ? 102\n18 0:996703815 ? 103 0:148881951 ? 103\n19 0:361416936 ? 102 ?0:751640284 ? 103\n20 0:637876542 ? 103\n21 0:127093998 ? 102\n22 ?0:212825156 ? 102\n23 0:275555432 ? 101\n\nh < 120 km or 800 km < h\n\n?Tc D 0 (11.21)\nThe coefficients Bi and Ci can be found in Table 11.2.\n\nDuring calculation of the diurnal temperature variation, Eq. (11.13), it was\nspecifically assumed that this temperature occurs during times of no geomagnetic\nactivity [8]. There are several means to account for the effect of geomagnetic activity\non the density. The first method, proposed by Jacchia et al. [10] uses an empirically\nderived temperature correction based on the 3-h geomagnetic planetary index Kp .\nThe empirical formulation was later updated to incorporate a latitudinal dependence.\nThis method was found to work well for altitudes greater than 200 km, but fails to\naccurately match data below this height. To overcome this shortcoming a hybrid\nformula that includes both a temperature and density correction can be applied\nfor altitudes lower than 200 km. A new method proposed by Bowman uses the\nDST (Disturbance Storm Time) index in order to calculate a temperature correction,\n?TDST [2].\n\n\n\n414 11 Environment Models\n\nGiven T`, the diurnal correction factor?Tc and the geomagnetic correction factor\n?TDST , the local exospheric temperature, T1 is calculated as\n\nT1 D T` C?Tc C?TDST (11.22)\n\nThe atmospheric temperature profile is assumed to have a constant temperature\nT0 D 183 K at an altitude of h0 D 90 km. The temperature gradient at h0 is also\nassumed equal to zero. From there the temperature rises rapidly to an inflection\ntemperature, Tx at a height of hx D 125 km. Above 125 km the temperature\ncontinues to increase in an asymptotic form towards the exospheric temperature T1.\nThe inflection temperature has been empirically defined as\n\nTx D aC bT1 C c exp \u0152dT1? (11.23)\n\nwith the constant coefficients\n\na D 371:6678; b D 0:02385\nc D ?392:8292; d D ?0:0021357\n\nBelow hx the temperature profile is given by a 4th-order polynomial\n\nT .h/ D Tx C\n4X\n\nnD1\ncn.h ? hx/n; 90 < h < hx km (11.24)\n\nwhere the coefficients, cn are determined using the following boundary conditions\n\nT .h0/ D 183 (11.25a)\ndT\n\ndh\n\n??\n??\nh0\n\nD 0 (11.25b)\n\nGx ? dT\ndh\n\n??\n??\nhx\n\nD 1:90Tx ? T0\nhx ? h0 (11.25c)\n\nd2T\n\ndh2\n\n??\n??\nhx\n\nD 0 (11.25d)\n\nFor h > hx the temperature profile is asymptotic and the temperature is given by\n\nT .h/ D Tx C 2.T1 ? Tx/\n\n\ntan?1\n?\nGx\n.h ? hx/\n2.T1 ? Tx/\n\n?\n1C 4:5 ? 10?6.h ? hx/2:5\n\n??\n\nhx < h\n(11.26)\n\nwhere Gx is as given in Eq. (11.25c).\n\n\n\n11.2 Atmospheric Density 415\n\n11.2.4.2 Barometric Equation\n\nFor altitudes between 90 and 105 km, the atmospheric density is computed\nby integrating the barometric equation. The differential form of the barometric\nequation is\n\nd ln.?/ D d ln\n NM\nT\n\n!\n?\nNMg\nR?T\n\ndh (11.27)\n\nwhere R? D 8:31432 J/(K-mol) is the ideal gas constant, g is the local acceleration\ndue to gravity given by\n\ng D 9:80665\n?\n1C h\n\nRe\n\n??2\n(11.28)\n\nwhere Re D 6356:766 km and NM is the mean molecular mass of the atmosphere.\nFor 90 < h ? 105 km, NM is approximated by means of a 6th-order polynomial\n\nNM.h/ D\n6X\n\nnD0\ncn.h ? 90/n; 90 < h < 105 km (11.29)\n\nwhere the coefficients are given by\n\nc0 D 28:15204; c1 D ?8:5586 ? 10?2; c2 D 1:2840 ? 10?4\nc3 D ?1:0056 ? 10?5; c4 D ?1:0210 ? 10?5; c5 D 1:5044 ? 10?6\nc6 D 9:9826 ? 10?8\n\nAfter integrating the barometric equation, the resulting density is given by\n\n?uncorr.h/ D ?0\n NM.h/\nNM0\n\n!?\nT0\n\nT .h/\n\n?\nexp\n\n?\n?F.h/\nR?\n\n?\n(11.30)\n\nwhere\n\nF.h/ ?\nZ h\nh0\n\nNM.?/g.?/\nT .?/\n\nd? (11.31)\n\nThe density at h0 is ?0 D 3:46 ? 10?6 kg/m3. Note that T0 D 183 K andNM0 ? NM.h0/. The subscript \u201cuncorr\u201d has been added to the density in Eq. (11.30)\nbecause this density does not include correction factors for the observed semiannual,\nEq. (11.39), and seasonal-latitudinal, Eq. (11.42), variations derived from drag data.\n\n\n\n416 11 Environment Models\n\nThese correction factors must be applied to determine the density. The integral given\nin Eq. (11.31) must be computed numerically. A constant step, 6-point quadrature\nrule was applied\n\nZ b\na\nf .x/dx ? b ? a\n\n288\n\u015219f .x0/C 75f .x1/C 50f .x2/C 50f .x3/C 75f .x/4 C 19f .x5/?\n\n(11.32)\n\nwhere the range from h0 to h was broken into intervals with b ? a D 10 m. The\nJB2008 Fortran code employed a 5-point quadrature rule, also with b ? a D 10 m,\nfor the 90 < h ? 105 km regime.\n\n11.2.4.3 Diffusion Equation\n\nFor altitudes between 90 and 105 km, integration of the barometric equation is\nsufficient to determine the atmospheric density (save for some additional correction\nfactors which will be discussed later). However, altitudes within this range are\nnot typical of spacecraft except during launch and end of life because the drag at\nthis height is high enough such that a spacecraft without thrusting will spiral back\nto Earth. Above 105 km the atmosphere is assumed to be in diffuse equilibrium.\nHere the density is computed by determining the number density of each of the\nindividual atmospheric constituents. The atmosphere is assumed to be composed\nof six components: nitrogen, argon, helium, hydrogen, and atomic and molecular\noxygen (O and O2). The number density for each component is determined by\nintegrating the diffusion equation\n\ndni\n\nni\nD ?Mig\n\nR?T\ndh ? dT\n\nT\n.1 ? ?i / (11.33)\n\nwhere ni , Mi , and ?i are the number density (number of atoms per unit volume),\nmolecular weight, and thermal diffusion coefficient of component i . Before inte-\ngrating the diffusion equation, we need to know the number density at the boundary,\n105 km. Given the density, ?.105/, the number densities for five of the components,\nexcluding hydrogen, are determined as\n\nni D qiNA?.105/NMSL\n; i D N2; Ar; He (11.34a)\n\nnO D 2NA?.105/\n?\n\n1\n\nNM.105/ ?\n1\n\nNMSL\n\n?\n(11.34b)\n\nnO2 D NA?.105/\n?\n1C qO2\nNMSL\n\n? 1NM.105/\n?\n\n(11.34c)\n\nwhere qi is the volumetric fraction of each component in the mixture, NA is\nAvogadro\u2019s constant, given by 6:02214129 ? 1023 mol?1, and NMSL D 28:960\nis the mean molecular mass of the atmosphere at sea level. The number density\n\n\n\n11.2 Atmospheric Density 417\n\nTable 11.3 Atmospheric\ncomposition at h D 90 km Species (i ) qi Mi ?i\n\nNitrogen (N2) 0.78110 28.0134 0\nOxygen (O2) 0.20955 31.9988 0\nOxygen (O) ? 15.9994 0\nArgon (Ar) 0.0093432 39.948 0\nHelium (He) 0.0000061471 4.0026 ?0.38\nHydrogen (H) ? 1.00797 0\n\nof hydrogen is not calculated in Eq. (11.34) because hydrogen does not have any\nimpact on the density at altitudes below 500 km. Because of this, altitudes above\n105 km must be broken into two distinct regimes, one with 105 < h < 500 km\nand one with 500 km ? h. Also note that the density in Eq. (11.34) is the corrected\ndensity at 105 km which includes the semiannual and seasonal-latitudinal correction\nfactors alluded to before.\n\n105 < h < 500 km\n\nThe volumetric fraction, molecular weight, and thermal diffusion coefficient of each\ncomponent can be found in Table 11.3.\n\nIntegrating Eq. (11.33) results in\n\nln.ni .h// D ln.ni .105// ? .1C ?i / ln\n?\nT .h/\n\nT .105/\n\n?\n? MiG.h/\n\nR?\n(11.35)\n\nwhere\n\nG.h/ ?\nZ h\n105\n\ng.?/\n\nT .?/\nd? (11.36)\n\nis again computed numerically by the 6-point quadrature and b ? a D 10 m. Once\nthe number densities are calculated, the uncorrected density is determined as\n\n?uncorr.h/ D 1\nNA\n\nX\ni\n\nMini .h/ (11.37)\n\nA discussion of the correction factors which need to be applied to determine the\nfinal density will be discussed later.\n\n500 km < h\n\nAbove 500 km hydrogen begins to have an impact on the density calculation.\nTo determine the density at any point above 500 km we begin by integrating\nthe barometric equation for all components, except hydrogen, up to an altitude\nof 500 km. Next we determine the number density of hydrogen at this altitude\naccording to [8]\n\nlog10.nH.500// D 79:13 ? 39:40 log10.T500/C 5:5 log10.T500/2 (11.38)\n\n\n\n418 11 Environment Models\n\nwhere T500 is the temperature at h D 500 km. Now the diffusion equations can be\nintegrated for each component, including hydrogen, up to the desired altitude. The\nuncorrected density is then determined by Eq. (11.37).\n\n11.2.4.4 Density Correction Factors\n\nThe density calculated to this point only includes correction factors accounting\nfor diurnal variations and geomagnetic activity. These are not the only phenom-\nena affecting the density that must be accounted for. The JB2008 atmospheric\nmodel includes corrections that account for the observed semiannual variation and\nseasonal-latitudinal variation of the lower atmosphere. Bowman has also proposed\na correction for high altitudes, h ? 1;000 k [3].\n\n11.2.4.5 Semiannual Variation\n\nThe semiannual variation describes how the density fluctuates throughout the year.\nAnalysis has shown that the period of this variation is about 6 months with density\nmaxima occurring in April and October and density minima occurring in January\nand July. The semiannual density correction factor has the form\n\n? log10 ?SA D f .h/g.t/ (11.39)\n\nwhere f .h/ and g.t/ are calculated via\n\nNFSMJ D NF10 ? 0:7 NS10 ? 0:04 NM10 (11.40a)\nNh D h=1;000 (11.40b)\n\nf .h/ D B1 C B2 NFSMJ C B3 NFSMJ NhC B4 NFSMJ Nh2 C B5 NF 2SMJ Nh (11.40c)\n\nand\n\nNFSM D NF10 ? 0:75 NS10 ? 0:37 NM10 (11.41a)\n\n! D 2\nDOY ? 1\n365\n\n(11.41b)\n\ng.t/ D C1 C C2 sin.!/C C3 cos.!/C C4 sin.2!/C C5 cos.2!/\nC NFSM \u0152C6 C C7 sin.!/C C8 cos.!/C C9 sin.2!/C C10 cos.2!/?\n\n(11.41c)\n\nwhereDOY is the current day of the yearDOY 2 \u01520; 367/. The coefficients Bi and\nCi can be found in Table 11.4.\n\n\n\n11.2 Atmospheric Density 419\n\nTable 11.4 Semiannual\nvariation correction factors\n\ni Bi Ci\n\n1 2:689? 10?1 ?3:633? 10?1\n2 ?1:176? 10?2 8:506? 10?2\n3 2:782? 10?2 2:401? 10?1\n4 ?2:782? 10?2 ?1:897? 10?1\n5 3:470? 10?4 ?2:554? 10?1\n6 ?1:790? 10?2\n7 5:650? 10?4\n8 ?6:407? 10?4\n9 ?3:418? 10?3\n10 ?1:252? 10?3\n\n11.2.4.6 Seasonal-Latitudinal Variation\n\nIn calculation of the temperature profile, we have assumed the temperature to\nbe a constant 183 K at h D 90 km over the entire globe. In reality however,\nthe temperature at this height varies seasonally and over different latitudes. The\nseasonal-latitudinal correction factor attempts to account for the variation in density\narising from our assumption. The correction factor is given by\n\nS D 0:2.h ? 90/ exp \u0152?0:045.h ? 90/? (11.42a)\n\n? D JD ? 2400000:5 ? 36204\n365:2422\n\n(11.42b)\n\nP D sin .2\n? C 1:72/ (11.42c)\n? log10 ?SL D sign.\t/SP sin2.\t/ (11.42d)\n\nwhere JD is the current Julian Date. The seasonal-latitudinal correction is only\napplicable to altitudes lower than 200 km. The semiannual variation and seasonal\nlatitudinal variation are multiplicative correction factors to density. Thus the\ncorrected density is given by\n\nlog10 ?corr D log10 ?uncorr C? log10 ?SA C? log10 ?SL (11.43)\n\n11.2.4.7 High Altitude Density Correction\n\nThe last correction factor accounts for variations observed at high altitudes. The high\naltitude correction factor was developed by Bowman after analysis of 25 spacecraft\nwith orbital altitudes between 1,500 and 4,000 km. The high altitude correction\nfactor follows as\n\nh < 1;000 km\n\nFHA D 1 (11.44)\n\n\n\n420 11 Environment Models\n\n1;000 ? h < 1;500 km\n\nH D .h ? 1;000/=500\nF1;500 D D1 CD2 NF10 C 1;500D3 C 1;500D4 NF10\n@F1;500\n\n@h\nD D3 CD4 NF10\n\nFHA D 1C\n?\n3F1;500 ? 500@F1;500\n\n@h\n? 3\n\n?\nH2C\n\n?\n500\n\n@F1;500\n\n@h\n? 2F1;500 C 2\n\n?\nH3\n\n(11.45)\n\n1;500 ? h km\n\nFHA D D1 CD2 NF10 CD3hCD4h NF10 (11.46)\n\nwhere the coefficients are given by\n\nD1 D 2:2 ? 10?1, D2 D ?2:0 ? 10?3\nD3 D 1:15 ? 10?3, D4 D ?2:11 ? 10?6\n\nOnce the high altitude correction factor, and corrected density have been\ndetermined, the final atmospheric density is given by\n\n? D FHA?corr (11.47)\n\n11.3 Sun Position, Radiation Pressure, and Eclipse\nConditions\n\nIn order determine solar radiation pressure forces or torques acting on a spacecraft\nor to process Sun sensor data, we must first determine where the Sun is relative to\nthe spacecraft and whether the spacecraft is shadowed by the Earth or the Moon.\nThe position of the Sun with respect to the Earth can be determined as follows [17].\nFirst, the mean longitude, ??, and mean anomaly of the Sun, M?, are determined\nin degrees as\n\n?? D 280:460? C 36;000:771 TUT1 (11.48a)\nM? D 357:5277233? C 35999:05034 TUT1 (11.48b)\n\nwhere\n\nTUT1 D JD.Y;M;D; h;m; s/ ? 2;451;545\n36;525\n\n(11.49)\n\n\n\n11.3 Sun Position, Radiation Pressure, and Eclipse Conditions 421\n\nwith JD computed as in Sect. 2.6.3. Both ?? and M? are reduced to the range 0?\nto 360? and the longitude of the ecliptic is determined in degrees as\n\n?ecliptic D ?? C 1:914666471? sin.M?/C 0:019994643 sin.2M?/ (11.50)\nThe obliquity of the ecliptic is given by\n\n\" D 23:439291? ? 0:0130042 TUT1 (11.51)\nThe unit vector in the direction from the Earth to the Sun is then\n\ne?? D\n2\n4\n\ncos.?ecliptic/\ncos.\"/ sin.?ecliptic/\nsin.\"/ sin.?ecliptic/\n\n3\n5 (11.52)\n\nWe omit subscripts to indicate the coordinate frame because all vectors in this\nsection are expressed in the GCI frame.\n\nThe distance, in AU, between the Earth and the Sun can be found by\n\nr?? D 1:000140612? 0:016708617 cos.M?/? 0:000139589 cos.2M?/ (11.53)\n\nand the position vector from the Earth to the Sun is r?? D r??e??. After\nconverting the spacecraft position vector r to AU, the position vector from the\nspacecraft to the Sun, expressed in the GCI frame is given\n\nrsat? D r?? ? r (11.54)\nThe distance rsat?, between the spacecraft and Sun (in AU) and the unit vector esat?\nare then given by\n\nrsat? D krsat?k (11.55a)\nesat? D rsat?\n\nrsat?\n(11.55b)\n\nThe pressure of solar radiation at the position of the spacecraft is then\n\nP? D F?\nc r2sat?\n\n(11.56)\n\nwhere F?, known as the solar constant, is the flux density of solar radiation at a\ndistance of 1 AU from the Sun, and c D 299;792;458 m/s is the speed of light.\nThe solar constant varies over the 11-year solar cycle from 1,361 W/m2 at solar\nminimum to 1,363 W/m2 at solar maximum and is subject to rapid fluctuations as\nlarge as 5 W/m2 at times of high or low solar activity.3 These fluctuations are very\ndifficult to predict, although daily data does exist [5].\n\n3These recent measurements [11] are about 5 W/m2 lower than previous measurements [5].\n\n\n\n422 11 Environment Models\n\nGiven the position vector of the spacecraft and the position vector of the Sun,\nit can now be determined whether or not the spacecraft is in the shadow of the\nEarth. There are two main approaches to shadowing. The first assumes that the\nshadow created by the Earth is a cylindrical projection of the Earth\u2019s diameter along\nthe direction of the Sun to the Earth. In the cylindrical approximation, which is\ngenerally adequate for spacecraft in lower altitude orbits, the spacecraft is in the\nEarth\u2019s shadow if and only if\n\nr ? e?? < ?\nq\nr2 ?R2? (11.57)\n\nwhere r is the spacecraft position vector andR? is the equatorial radius of the Earth,\nwhich is approximated as a sphere. For a spacecraft in a geosynchronous orbit with\nradius 42,164 km, Eq. (11.57) gives an eclipse time of 69.6 min for the longest\neclipse, which occurs at the equinoxes when the Sun is in the orbital plane of the\nspacecraft.\n\nThe second shadowing approach accounts for the finite diameters of both the Sun\nand the Earth. This more accurate approach has a conical shadow model with partial\nshadowing in a region called the penumbra. The more complex eclipse conditions\nfor the conical shadow model, including illumination levels in the penumbra, can be\nfound in Wertz [19]. His equations show that a spacecraft in a geostationary orbit\nspends 67.5 min in total shadow and 4.3 min in the penumbra during its longest\neclipse.\n\n11.4 Orbital Ephemerides of the Sun, Moon, and Planets\n\nThe best source for accurate orbital ephemerides of the Sun, Moon, and planets is\nDE405/LE405 computed by the Jet Propulsion Laboratory (JPL) of the California\nInstitute of Technology [16]. These ephemerides are obtained by precise numerical\nintegration of the equations of motion of the bodies. This computation has four main\ningredients: formulating the equations of motion, determining the initial conditions,\nperforming the integrations, and making the results available in a useful form. It is\nbelieved that the difficulty of accurately determining the initial conditions is the\nlimiting factor in the accuracy of the solutions.\n\nThe equations of motion are described in detail in [16]. They include \u201c(a) point-\nmass interactions among the Moon, planets, and Sun; (b) general relativity\n(isotropic, parameterized post-Newtonian); (c) Newtonian perturbations of selected\nasteroids; (d) action upon the figure of the Earth from the Moon and Sun; (e) action\nupon the figure of the Moon from the Earth and Sun; (f) physical libration of the\nMoon, modeled as a solid body with tidal and rotational distortion, including both\nelastic and dissipational effects; (g) the effect upon the Moon\u2019s motion caused by\nthe tides raised upon the Earth by the Moon and Sun; and (h) the perturbations of\n300 asteroids upon the motions of Mars, the Earth, and the Moon.\u201d The reference\n\n\n\nReferences 423\n\nframe for the ephemerides is the International Celestial Reference Frame [14].\nThe initial conditions are determined by fitting data from optical observations,\nmeridian transits, photographic and CCD astrometry, occultation timings, astrolabe\nobservations, radiometric emission measurements, ranging data, VLBI data, and\nlunar laser range data.\n\nThe planetary ephemerides are saved as files of Chebyshev polynomials for the\nCartesian positions and velocities of the Sun, Moon, and planets, typically at 32-day\nintervals. They can be obtained from JPL\u2019s interactive \u201cHorizons\u201d website at http://\nssd.jpl.nasa.gov/?horizons. The positional accuracy of the inner planet ephemerides\nis believed to be a few thousandths of an arcsecond, and a few hundredths of an\narcsecond for the outer planets. Reference [16] also provides Keplerian elements\nfor applications that do not require the full accuracy of an integrated ephemeris.\n\nReferences\n\n1. Amelina, T., Batyr, G., Dicky, V., Tumolskaya, N., Yurasov, V.S.: Comparison of atmospheric\ndensity models. In: 2nd U. S. - Russian Space Surveillance Workshop. Poznan, Poland (1996)\n\n2. Bowman, B.R., Tobiska, W., Marcos, F.A., Huang, C.Y., Lin, C.S., Burke, W.J.: A new\nempirical thermospheric density model JB2008 using new solar and geomagnetic indices. In:\nAIAA/AAS Astrodynamics Specialist Conference. Honolulu (2008)\n\n3. Bowman, B.R., Tobiska, W., Marcos, F.A., Valladares, C.: The JB2006 empirical thermo-\nspheric density model. J. Atmos. Sol. Terr. Phys. 70(5), 774\u2013793 (2008)\n\n4. Finlay, C.C., Maus, S., Beggan, C.D., Bondar, T.N., Chambodut, A., Chernova, T.A., Chulliat,\nA., Golovkov, V.P., Hamilton, B., Hamoudi, M., Holme, R., Hulot, G., Kuang, W., Langlais, B.,\nLesur, V., Lowes, F.J., L\u00fchr, H., Macmillan, S., Mandea, M., McLean, S., Manoj, C., Menvielle,\nM., Michaelis, I., Olsen, N., Rauberg, J., Rother, M., Sabaka, T.J., Tangborn, A., T\u00f8ffner-\nClausen, L., Th\u00e9bault, E., Thomson, A.W.P., Wardinski, I., Wei, Z., Zvereva, T.I.: International\nGeomagnetic Reference Field: the eleventh generation. Geophys. J. Int. 183, 1216\u20131230 (2010)\n\n5. Fr\u00f6hlich, C., Lean, J.: Total solar irradiance (TSI) composite database (1978-present). http://\nwww.ngdc.noaa.gov/stp/solar/solarirrad.html#composite (Accessed Sept. 20, 2013)\n\n6. Harris, I., Priester, W.: Time-dependent structure of the upper atmosphere. J. Atmos. Sci. 19,\n286\u2013301 (1962)\n\n7. Jacchia, L.G.: New static models of the thermosphere and exosphere with empirical tempera-\nture profiles. Tech. Rep. SAO Special Report No. 313, Smithsonian Astrophysical Observatory,\nCambridge. Smithsonian Institution Astrophysical Observatory (1970)\n\n8. Jacchia, L.G.: Revised static models of the thermosphere and exosphere with empirical\ntemperature profiles. SAO special report no. 332, Smithsonian Astrophysical Observatory,\nCambridge. Smithsonian Institution Astrophysical Observatory (1971)\n\n9. Jacchia, L.G.: Thermospheric temperature, density, and composition: New models. SAO\nspecial report no. 375, Smithsonian Astrophysical Observatory, Cambridge. Smithsonian\nInstitution Astrophysical Observatory (1977)\n\n10. Jacchia, L.G., Slowey, J., Verniani, F.: Geomagnetic pertubations and upper-atmosphere\nheating\u201d. J. Geophys. Res. 72(5), 1423\u20131434 (1966)\n\n11. Kopp, G., Lean, J.L.: A new, lower value of total solar irradiance: Evidence and climate\nsignificance. Geophys. Res. Lett. 38(1), L01,706 (2011)\n\n12. Langel, R.A.: The main field. In: Jacobs, J.A. (ed.) Geomagnetism, pp. 249\u2013512. Academic\nPress, Orlando (1987)\n\nhttp://ssd.jpl.nasa.gov/?horizons\nhttp://ssd.jpl.nasa.gov/?horizons\nhttp://www.ngdc.noaa.gov/stp/solar/solarirrad.html#composite\nhttp://www.ngdc.noaa.gov/stp/solar/solarirrad.html#composite\n\n\n424 11 Environment Models\n\n13. Long, A.C., Cappellari Jr., J.O., Velez, C.E., Fuchs, A.J.: Goddard Trajectory Determination\nSystem (GTDS) mathematical theory (revision 1). FDD/522-89/001 and CSC/TR-89/6001,\nNational Aeronautics and Space Administration/Goddard Space Flight Center, Greenbelt\n(1989)\n\n14. Ma, C., Arias, E.F., Eubanks, T.M., Frey, A.L., Gontier, A.M., Jacobs, C.S., Sovers, O.J.,\nArchinal, B.A., Charlot, P.: The International Celestial Reference Frame as realized by very\nlong baseline interferometry. Astron. J. 116, 516\u2013546 (1998)\n\n15. Roberts Jr., C.E.: An analytical model for upper atmosphere densities based upon Jacchia\u2019s\n1970 models. Celestial Mech. 314(4), 368\u2013377 (1971)\n\n16. Standish, E.M., Williams, J.G.: Orbital ephemerides of the Sun, Moon, and planets. In: Urban,\nS.E., Seidelmann, P.K. (eds.) Explanatory Supplement to the Astronomical Almanac, 3rd edn.,\nchap. 8. University Science Books, Sausalito (2013)\n\n17. Vallado, D.A.: Fundamentals of Astrodynamics and Applications, 3rd edn. Microcosm Press,\nHawthorne and Springer, New York (2007)\n\n18. Vallado, D.A., Finkleman, D.: A critical assessment of satellite drag and atmospheric density\nmodelling. In: AIAA/AAS Astrodynamics Specialist Conference. Honolulu (2008)\n\n19. Wertz, J.R. (ed.): Spacecraft Attitude Determination and Control. Kluwer Academic, The\nNetherlands (1978)\n\n20. Winch, D.E., Ivers, D.J., Turner, J.P.R., Stening, R.J.: Geomagnetism and Schmidt quasi-\nnormalization. Geophys. J. Int. 160, 487\u2013504 (2005)\n\n21. Yurasov, V.S., Cefola, P.J.: Earth\u2019s upper atmosphere density model for ballistic suport of the\nflight of artificial Earth satellites. Tech. rep., National Standard of the Russian Federation\n(Gosstandart of Russia), Moscow, Russia (2004)\n\n22. Yurasov, V.S., Nazarenko, A.I., Cefola, P.J., Alfriend, K.T.: Density corrections for the\nNRLMSIS-00 atmospheric model. Adv. Astronaut. Sci. 120(2), 1079\u20131107 (2005)\n\n\n\nChapter 12\nReview of Control and Estimation Theory\n\nThe purpose of this chapter is to provide a review of control and estimation theory.\nIt is expected that the reader has some basic knowledge of dynamical systems and\nprobability theory. Several of the concepts shown in this chapter are used throughout\nthe text. First a basic review of system modeling using differential equations is\nshown. This is followed by linear and nonlinear control theory. Then estimation\nconcepts, such as maximum likelihood and the Kalman filter, are reviewed. The\nreader is encouraged to read the several cited texts in this chapter for further\ninformation.\n\n12.1 System Modeling\n\nIn this section system modeling is reviewed. This subject is introduced by first\nderiving the equations of motion for the classic inverted pendulum problem. Then,\nstate and observation models for both nonlinear and linear systems are introduced.\nFinally, discrete-time systems are reviewed.\n\n12.1.1 Inverted Pendulum Modeling\n\nThe classic inverted pendulum mounted to a motorized cart is shown in Fig. 12.1a,\nwhere x is the cart position,M is the mass of the cart,m is the mass of the pendulum,\n` is the length to pendulum center of mass, J D m`2=3 is the mass moment of\ninertia of the pendulum, modeling it as a uniform thin rod, ? is the pendulum angle\nfrom vertical, and u is the force applied to the cart. The associated free body diagram\nis shown in Fig. 12.1b, where N and P are reaction forces along the horizontal\n\nF.L. Markley and J.L. Crassidis, Fundamentals of Spacecraft Attitude Determination\nand Control, Space Technology Library 33, DOI 10.1007/978-1-4939-0802-8__12,\n\u00a9 Springer Science+Business Media New York 2014\n\n425\n\n\n\n426 12 Review of Control and Estimation Theory\n\n,m  J\n\nM\n\nx\n\nu\nu Ff\n\nmgP\n\nP\n\nN\nN\n\nx\n\ni1\n\ni2\n\na b\n\nFig. 12.1 Inverted pendulum (a) and associated free body diagram (b)\n\nand vertical directions, respectively, and Ff is the friction force which is given by\nFf D c Px, where c is a constant. The axes i1 and i2 are inertially fixed, which\nrepresent the horizontal and vertical directions, respectively.\n\nThe locations of the centroid of the pendulum, along the i1 and i2 axes, denoted\nby xc and yc , respectively, are given by\n\nxc D x C ` sin ? (12.1a)\nyc D ` cos ? (12.1b)\n\nTaking two time derivatives of Eq. (12.1a) gives\n\nRxc D Rx C ` R? cos ? ? ` P?2 sin ? (12.2)\n\nTherefore, summing the forces of the pendulum in the horizontal direction, i1, gives\n\nN D m Rx Cm` R? cos ? ?m` P?2 sin ? (12.3)\n\nSumming the forces of the cart in the horizontal direction gives\n\nM Rx C c Px CN D u (12.4)\n\nSubstituting Eq. (12.3) into Eq. (12.4) gives\n\n.M Cm/ Rx C c Px Cm` R? cos ? ?m` P?2 sin ? D u (12.5)\n\nTaking two time derivatives of Eq. (12.1b) gives\n\nRyc D ?.` R? sin ? C ` P?2 cos ?/ (12.6)\n\n\n\n12.1 System Modeling 427\n\nSumming the forces of the pendulum in the vertical direction, i2, gives\n\nP D mg ?m` R? sin ? ?m` P?2 cos ? (12.7)\n\nFor the pendulum, summing the moments around its center of gravity gives the\nfollowing rotational dynamic equations:\n\nJ R? D .m`2=3/ R? D P` sin ? ?N` cos ? (12.8)\n\nSubstituting Eqs. (12.3) and (12.7) into Eq. (12.8), and simplifying yields\n\n.4`=3/ R? D g sin ? ? Rx cos ? (12.9)\n\nEquations (12.5) and (12.9) provide the governing equations of motion.\nWe now linearize the governing equations about the vertical point, where ? D 0.\n\nThe first-order approximations are given by cos ? ? 1, sin ? ? ? , and P?2 ? 0. Then\nthe linearized governing equations become\n\n.4`=3/ R? D g? ? Rx (12.10a)\n.M Cm/ Rx C c Px Cm` R? D u (12.10b)\n\nSolving Eq. (12.10a) for R? and substituting the resultant into Eq. (12.10b) leads to\n\nRx D ? c\nM 0\nPx ? 3mg\n\n4M 0\n? C 1\n\nM 0\nu (12.11)\n\nwhere\n\nM 0 ?M Cm=4 (12.12)\n\nSubstituting Eq. (12.11) into Eq. (12.10a) then leads to\n\nR? D 3.M Cm/g\n4M 0`\n\n? C 3c\n4M 0`\n\nPx ? 3\n4M 0`\n\nu (12.13)\n\nWe now define the following state vector:\n\nx D ?x ? Px P??T (12.14)\n\n\n\n428 12 Review of Control and Estimation Theory\n\nTaking the time derivative of Eq. (12.14), and using Eqs. (12.11) and (12.13) gives\n\nPx D\n\n2\n666664\n\n0 0 1 0\n\n0 0 0 1\n\n0 ?3mg\n4M 0\n\n? c\nM 0\n\n0\n\n0\n3.M Cm/g\n4M 0`\n\n3c\n\n4M 0`\n0\n\n3\n777775\n\nxC\n\n2\n666664\n\n0\n\n0\n1\n\nM 0\n? 3\n4M 0`\n\n3\n777775\n\nu (12.15a)\n\ny D\n?\n1 0 0 0\n\n0 1 0 0\n\n?\nxC\n\n?\n0\n\n0\n\n?\nu (12.15b)\n\nwhere the outputs, given in the vector y, are assumed to be x and ? .\n\n12.1.2 State and Observation Models\n\nModeling is an important aspect for the analysis of system behavior and for the\ndesign of control and estimation algorithms. A model may either be static or\ndynamic. A static model\u2019s output at any given time only depends on the input at\nthat time [19]. A dynamic model\u2019s present output depends on past inputs. Dynamic\nmodels frequently use differential or difference equations to describe physical\nsystems. Both static and dynamic models can either be derived using a theoretical\nanalysis or be identified using experimental data. Theoretical models help to provide\na user with insight to any aspect which is modeled, but may not accurately represent\nthe actual physical process. The major advantage of theoretical models is that the\nactual system need not be implemented to develop a model. Identified models\nusually describe actual physical processes more accurately, but may not provide\nall the information to describe all the desired aspects of the system. Choosing\nbetween a theoretical model or an identified model depends on a number of factors;\nincluding, the availability of obtaining experimental data, the desired accuracy of\nthe model, the complexity of the physical system, etc.\n\n12.1.2.1 State Models\n\nAn important quantity for modern modeling design and analysis is the state vector,\nsuch as the one given by Eq. (12.14). The components of a state vector are known\nas state variables. These variables describe a system\u2019s condition, and are directly\nrelated to the dissipation and storage of energy. The number of state variables\nis known as the order of the system, which describes how many energy storing\nelements are present in the system. The consequence of the order leads directly\nto the number of first-order differential or difference equations in the model.\n\n\n\n12.1 System Modeling 429\n\nAn nth-order system can be written using n first-order equations (known as state\nequations), which are mathematically described in differential form by\n\nPx.t/ D f.x.t/;u.t/; t/; x.t0/ D x0 (12.16)\n\nwhere f is an n?1 vector that is sufficiently differentiable, x is an n?1 state vector,\nand u is a q?1 vector that denotes an exogenous input representing any input to the\nsystem that does not depend on the state elements. An autonomous system is one\nthat does not depend on time explicitly, so that Px.t/ D f.t/.x.t/;u.t//.\n\nEquation (12.16) describes the general structure of a dynamic model. A subset of\nthis general structure is a class of systems known as linear systems. A linear system\nfollows the superposition principle [3], which states that a linear combination of\ninputs produces an output that is a linear combination of the outputs that would be\nproduced if each input was applied separately [19]. Mathematically, this principle is\ndescribed by\n\ny D f .z/ D f .?1z1 C ?2z2/ D ?1f .z1/C ?2f .z2/ (12.17)\n\nwhere ?1 and ?2 are arbitrary constants, and z1 and z2 are arbitrary inputs. It is easy\nto show that the following system is linear:\n\nPx.t/ D F.t/x.t/C B.t/u.t/; x.t0/ D x0 (12.18)\n\nwhere the n? n matrix F and the n? q matrix B are known as the state matrix and\ninput matrix, respectively. Equation (12.15a) shows the F and B matrices for the\ninverted pendulum system. The solution to Eq. (12.18) is given by\n\nx.t/ D ?.t; t0/x0 C\nZ t\nt0\n\n?.t; ?/B.?/u.?/ d? (12.19)\n\nwhere ?.t; t0/ is known as the state transition matrix, which has the following\nproperties:\n\n?.t0; t0/ D I (12.20a)\n?.t0; t/ D ??1.t; t0/ (12.20b)\n?.t2; t0/ D ?.t2; t1/?.t1; t0/ (12.20c)\nP? .t; t0/ D F.t/?.t; t0/ (12.20d)\n\nNote that Eq. (12.20a) gives x.t0/ D x0, which satisfies the initial condition given\nin Eq. (12.18). Differentiating Eq. (12.19) and using the properties in Eq. (12.20)\nshows that it is indeed the solution for Eq. (12.18):\n\n\n\n430 12 Review of Control and Estimation Theory\n\nPx.t/ D P? .t; t0/x0 C ?.t; t/B.t/u.t/C F.t/\nZ t\nt0\n\n?.t; ?/B.?/u.?/ d?\n\nD F.t/\n?\n?.t; t0/x0 C\n\nZ t\nt0\n\n?.t; ?/B.?/u.?/ d?\n?\nC B.t/u.t/\n\nD F.t/x.t/C B.t/u.t/ (12.21)\n\nNote that since x.t/ is the linear sum of a part due to the initial condition and a part\ndue to the forcing input, it must follow the superposition principle.\n\nConsider a simple single-input-single-output (SISO) nth-order linear and\nautonomous ordinary differential equation (ODE), given by\n\ndny\n\ndtn\nC an?1 d\n\nn?1y\ndtn?1\n\nC ? ? ? C a1 dy\ndt\nC a0 y D u (12.22)\n\nwhere y is the output variable and u is the input variable. In order to convert the\nODE into first-order form, consider the following variable change:\n\nx1 D y\n\nx2 D dy\ndt\n\n:::\n\nxn D d\nn?1y\ndtn?1\n\n(12.23)\n\nThis leads to the following equivalent system of n first-order equations:\n\nPx1 D x2\nPx2 D x3\n:::\n\nPxn D ?a0x1 ? a1x2 ? ? ? ? ? an?1xn C u\n\n(12.24)\n\nwhich can be represented in matrix form by\n\nPx D F xC Bu (12.25)\n\nwhere the vector x contains the state variables\n\nx D ?x1 x2 ? ? ? xn\n?T\n\n(12.26)\n\n\n\n12.1 System Modeling 431\n\nand the matrices F and B are given by\n\nF D\n\n2\n666664\n\n0 1 0 ? ? ? 0\n0 0 1 ? ? ? 0\n:::\n\n:::\n:::\n: : :\n\n:::\n\n0 0 0 ? ? ? 1\n?a0 ?a1 ?a2 ? ? ? ?an?1\n\n3\n777775\n\n(12.27a)\n\nB D ?0 0 ? ? ? 1?T (12.27b)\n\nIf the linear system is autonomous, then the solution given by Eq. (12.19) simpli-\nfies to\n\nx D eF.t?t0/x0 C\nZ t\nt0\n\neF.t??/Bu.?/ d? (12.28)\n\nwhere eF.t?t0/ is the matrix exponential.\nA linear model can also be used to describe an autonomous nonlinear model. This\n\nis accomplished by performing a linearization about an equilibrium state vector and\ninput, so that\n\n0 D f.xe;ue/ (12.29)\nwhere xe and ue denote the known equilibrium quantities. Next, a multivariable\nTaylor series expansion about and xe and ue is performed, keeping only the first-\norder terms, so that\n\nPx ? f.xe;ue/C @f\n@x\n\n??\n??\nxe\n\n.x ? xe/C @f\n@u\n\n??\n??\nue\n\n.u ? ue/ (12.30)\n\nNow, the following linearized state and input vectors are defined as\n\n?x D x ? xe (12.31a)\n?u D u ? ue (12.31b)\n\nTherefore, a linearized model of an autonomous nonlinear system is given by\n\n?Px D F?xC B?u (12.32)\nwhere\n\nF ? @f\n@x\n\n??\n??\nxe\n\n(12.33a)\n\nB ? @f\n@u\n\n??\n??\nue\n\n(12.33b)\n\n\n\n432 12 Review of Control and Estimation Theory\n\nThis model can now be used to describe and analyze the characteristics of the\nnonlinear system using linear tools, such as superposition, linear stability, etc.\n\nChoosing state variables usually depends on the complexity of the system.\nA complex system such as a spacecraft potentially has an extremely large number\nof state variables, such as orbital elements, kinematic elements, rotational dynamic\nelements, flexible dynamic elements, thermal effects, disturbance model elements,\netc. Often, state variables do not themselves represent physical quantities, but\nare needed to form a relationship to physical quantities. Implementing all state\nvariables into a full model can be a formidable task. Ideally, one chooses the\nleast number of state variables to represent the characteristics of sought physical\nquantities. For example, for attitude estimation using rate-integrating gyros the\nstate vector may only contain the attitude elements and gyro biases. Other effects,\nsuch as flexible dynamic effects, may often be neglected in the attitude estimation,\nor may not be required for on-orbit implementation. It is important to note that\nalthough this simple example describes the least number of state variables for\nattitude estimation, other state variables in other models may have already been\nused before or concurrently with the attitude estimator. For example, orbital element\nstates may be required in the attitude estimator whenever the sensor supplying the\ndata produces an observation which depends on spacecraft position in the orbit.\nAn example of this scenario is a magnetometer-based attitude estimator, which\nrequires knowledge of the orbital position state vector in order to develop the\nreference magnetic field vector. Therefore, other state variables can indirectly affect\nthe state quantities used in the primary model.\n\n12.1.2.2 Observation Models\n\nState vectors are used to model the dynamic motion of a particular system.\nObservation vectors are used to show how a sensor relates to various state\nquantities. Observations are developed from sensor output quantities. The number\nof elements in an observation vector is usually determined by both the number of\navailable sensors and the number of individual sensor quantities (e.g. a three-axis\nmagnetometer provides observations of three quantities). The general form of an\nobservation vector is given by\n\ny.t/ D h.x.t/;u.t/; t/ (12.34)\nwhere h is a p ? 1 observation vector. This vector shows how each sensor is related\nto input and state quantities. The dimension of the observation vector (p) may be\nsmaller or larger than the dimension of the state vector (n). As seen from Eq. (12.34),\nthe observation vector may also be a function of the input u (it must always be a\nfunction of the state vector).\n\nLinear observation models follow the same structure as linear state models. The\nstandard form for the linear observation model is given by\n\ny.t/ D H.t/x.t/CD.t/u.t/ (12.35)\n\n\n\n12.1 System Modeling 433\n\nwhereH is the p ? n observation matrix (also referred to as the output or sensitivity\nmatrix) and D is the p ? q direct transmission matrix. Equation (12.15b) shows the\nH and D matrices for the inverted pendulum system.\n\nThe general SISO nth-order linear and autonomous ODE is given by\n\ndny\n\ndtn\nC an?1 d\n\nn?1y\ndtn?1\n\nC ? ? ? C a1 dy\ndt\nC a0 y\n\nD bn d\nnu\n\ndtn\nC bn?1 d\n\nn?1u\ndtn?1\n\nC ? ? ? C b1 du\ndt\nC b0 u (12.36)\n\nIn order to convert the ODE into first-order form we first rewrite Eq. (12.36) into an\nequivalent form involving two ODEs, given by\n\ny D bn d\nnx\n\ndtn\nC bn?1 d\n\nn?1x\ndtn?1\n\nC ? ? ? C b1 dx\ndt\nC b0 x (12.37a)\n\nu D d\nnx\n\ndtn\nC an?1 d\n\nn?1x\ndtn?1\n\nC ? ? ? C a1 dx\ndt\nC a0 x (12.37b)\n\nwhere x is an intermediate variable. Now, consider the following variable change:\n\nx1 D x\n\nx2 D dx\ndt\n\n:::\n\nxn D d\nn?1x\ndtn?1\n\n(12.38)\n\nThis leads to the following equivalent system of n first-order equations, given in\nmatrix form by\n\nPx D F xC Bu (12.39a)\ny D HxCDu (12.39b)\n\nwhere the matrices F and B are given by Eq. (12.27), and H and D are given by\n\nH D ?.b0 ? bn a0/ .b1 ? bn a1/ ? ? ? .bn?1 ? bn an?1/\n?\n\n(12.40a)\n\nD D bn (12.40b)\n\nClearly, if b0 D 1 and the remaining coefficients bi D 0; i D 1; 2; : : : ; n, then the\nintermediate variable x D y, which reduces the general case in Eq. (12.36) to the\nsimple case in Eq. (12.22).\n\n\n\n434 12 Review of Control and Estimation Theory\n\nThe transfer function for autonomous linear systems can be found by by taking\nthe Laplace transform [12] of both sides of Eqs. (12.18) and (12.35) with zero initial\nconditions:\n\nsX.s/ D F X.s/C B U.s/ (12.41a)\nY.s/ D H X.s/CDU.s/ (12.41b)\n\nwhere s is the Laplace variable. Solving for X.s/ in Eq. (12.41a) and substituting\nthe resulting expression into Eq. (12.41b) yields\n\nY.s/ D\nh\nH .sI ? F /?1 B CD\n\ni\nU.s/ (12.42)\n\nSince the inverse of .sI ? F / is given by its adjoint divided by its determinant,\nthen the determinant of .sI ? F / gives the poles of the transfer function. Also,\nthe eigenvalues of F are equivalent to the roots of the denominator of the transfer\nfunction. All of the eigenvalues must lie left of the imaginary axis, i.e. in the left-\nhand plane, for a stable response. Even if one eigenvalue lies to the right of the\nimaginary axis then the system is unstable.\n\nLinearized observation models can also be developed, similar in fashion to the\nlinearized state equations. This is accomplished by\n\nH ? @h\n@x\n\n??\n??\nxe\n\n(12.43a)\n\nD ? @h\n@u\n\n??\n??\nue\n\n(12.43b)\n\nwhich are again evaluated at the equilibrium conditions.\n\n12.1.3 Discrete-Time Systems\n\nAll of the concepts shown previously extend to discrete-time systems. Discrete-\ntime systems have now become standard in most dynamic applications with the\nadvent of digital computers, which are used to process sampled-data systems for\nestimation and control purposes. The mechanism that acts on the sensor output and\nsupplies numbers to the digital computer is the analog-to-digital (A/D) converter.\nThen, the numbers are processed through numerical subroutines and sent to the\ndynamic system input through the digital-to-analog (D/A) converter. This allows\nthe use of software driven systems to accommodate the estimation/control aspect of\na dynamic system, which can be modified simply by uploading new subroutines to\nthe computer.\n\n\n\n12.1 System Modeling 435\n\n0 21 3 5 64\n\ny\n\ncontinuous\n\nsampled\n\nTime\n\nt\n\nFig. 12.2 Continuous signal\nand sampled zero-order hold\n\nWe shall only consider the most common sampled-type system given by a \u201czero-\norder hold\u201d which holds the sampled point to a constant value throughout the\ninterval. Figure 12.2 shows a sampled signal using a zero-order hold. Obviously,\nas the sample interval decreases the sampled signal more closely approximates\nthe continuous signal. Consider the case where time is set to the first sample\ninterval, denoted by?t , and F andB are constants in Eq. (12.18). Then, Eq. (12.28)\nreduces to\n\nx.?t/ D eF?tx.0/C\n?Z ?t\n\n0\n\neF.?t??/ d?\n?\nB u.0/ (12.44)\n\nThe integral can be simplified by defining ? D ?t ? ? , which leads to\nZ ?t\n0\n\neF.?t??/ d? D ?\nZ 0\n?t\n\neF ? d? D\nZ ?t\n0\n\neF ? d? (12.45)\n\nTherefore, Eq. (12.44) becomes\n\nx.?t/ D ? x.0/C ? u.0/ (12.46)\n\nwhere\n\n? ? eF?t (12.47a)\n\n? ?\n?Z ?t\n\n0\n\neF t dt\n\n?\nB (12.47b)\n\nExpanding Eq. (12.46) for k C 1 samples gives\n\nx\u0152.k C 1/?t? D ?x.k ?t/C ? u.k ?t/ (12.48)\n\n\n\n436 12 Review of Control and Estimation Theory\n\nIt is common convention to change the notation of Eq. (12.48) so that the entire\ndiscrete state-space representation is given by\n\nxkC1 D ?xk C ? uk (12.49a)\nyk D Hxk CDuk (12.49b)\n\nNotice that the output system matrices H and D are unaffected by the conversion\nto a discrete-time system. The system can be shown to be stable if all eigenvalues\nof ? lie within the unit circle [7].\n\nExample 12.1. In this example we will perform a conversion from the continuous-\ntime domain to the discrete-time domain for a second-order system, given by\n\nF D\n??1 0\n1 0\n\n?\n; B D\n\n?\n1\n\n0\n\n?\n\nTo compute ? we will enlist the help of Laplace transforms, with\n\n? D eF?t D ?L ?1\u0152sI ? F ??1???\n?t\nD\n\n8?\n\u02c6?<\n\u02c6??:\n\nL ?1\n\n2\n6664\n\n1\n\ns C 1 0\n\n1\n\ns.s C 1/\n1\n\ns\n\n3\n7775\n\n9>>>=\n>>>;\n\n??\n??\n??\n??\n?\n?t\n\nD\n?\ne??t 0\n\n1 ? e??t 1\n?\n\nwhere L ?1 denotes the inverse Laplace transform. The matrix ? is computed using\nEq. (12.47b):\n\n? D\nZ ?t\n0\n\n?\ne?t\n\n1 ? e?t\n?\ndt D\n\n?\n1 ? e??t\n\n?t C e??t ? 1\n?\n\nIf the sampling interval is chosen to be ?t D 0:1 s, then ? and ? become\n\n? D\n?\n0:9048 0\n\n0:0952 1\n\n?\n; ? D\n\n?\n0:0952\n\n0:0048\n\n?\n\nDetermining analytical expressions for ? and ? can be tedious and difficult for\nlarge-order systems. Fortunately, several numerical approaches exist for computing\nthese matrices [18]. A computationally efficient and accurate approach involves a\nseries expansion:\n\n? D I C F?t C 1\n2\u0160\nF 2?t2 C 1\n\n3\u0160\nF 3?t3 C ? ? ? (12.50)\n\n\n\n12.2 Control Theory 437\n\nand the matrix ? is obtained from integration of Eq. (12.50):\n\n? D\n?\nI?t C 1\n\n2\u0160\nF?t2 C 1\n\n3\u0160\nF 2?t3 C ? ? ?\n\n?\nB (12.51)\n\nAdequate results can be obtained in most cases using only a few of the terms in the\nseries expansion. For the matrices in Example 12.1, using three terms in the series\nexpansion yields\n\n? D\n?\n0:9048 0\n\n0:0952 1\n\n?\n; ? D\n\n?\n0:0952\n\n0:0048\n\n?\n(12.52)\n\nThe series results for ? and ? are accurate to within four significant digits. Results\nvary with sampling interval. As a general rule of thumb, if the sampling interval is\nbelow Nyquist\u2019s upper limit, then three to four terms in the series expansion gives\naccurate results [20].\n\n12.2 Control Theory\n\nIn this section control theory is reviewed. First, the fundamentals of basic linear\ncontrol are introduced. A single axis attitude control system design is shown next to\nhighlight the various aspects of linear control. Then, stability of nonlinear systems is\ndiscussed. Finally, a popular nonlinear controller law, called sliding-mode control,\nis reviewed.\n\n12.2.1 Basic Linear Control Design\n\nA fundamental block diagram of a SISO negative feedback control system is shown\nin Fig. 12.3, where R.s/ is the reference, Y.s/ is the output signal, D.s/ is the\ndisturbance, U.s/ is the control input, Gp.s/ is the plant to be controlled, Gc.s/\nis the controller, and H.s/ is the sensor dynamics. The disturbance is added to\nthe control input because for spacecraft the disturbance is an external torque that\n\u201cturns\u201d it just as a control input does. This is similar to a current-controlled motor\nsystem [5]. Assuming the disturbance is zero, the transfer function between the\noutput and reference is given by\n\nY.s/\n\nR.s/\nD Gc.s/Gp.s/\n1CGc.s/Gp.s/H.s/ (12.53)\n\nThe denominator of Eq. (12.53) is known as the characteristic equation whose roots\ndefine the type of response. All roots of the associated polynomial must be to the\n\n\n\n438 12 Review of Control and Estimation Theory\n\nFig. 12.3 Control block diagram\n\nleft of the imaginary axis to insure that the closed-loop system is asymptotically\nstable. Clearly, the poles of the open-loop system, Gc.s/Gp.s/H.s/, can now\nbe manipulated by the controller, Gc.s/, to either stabilize an unstable plant or\nobtain some desired characteristics in the closed-loop system. The sensor dynamics\ncan also affect the closed-loop response, although for most cases this is not a\ndestabilizing issue. Assuming the reference is zero, the transfer function between\nthe output and disturbance is given by\n\nY.s/\n\nD.s/\nD Gp.s/\n1CGc.s/Gp.s/H.s/ (12.54)\n\nNote that the denominators of Eqs. (12.53) and (12.54) are equivalent, which means\nthat the stability dynamics are the same for the reference and disturbance closed-\nloop responses. The numerators are different which means that the actual output\nresponses to a reference input and a disturbance input are different. The total\nresponse is given by the sum of the two transfer functions.\n\n12.2.1.1 Single Axis Attitude Control\n\nIn this section a simple single axis attitude control system is designed. For this case\nEuler\u2019s rotational equations of motion reduce down to simply\n\nJ R? D u (12.55)\n\nwhere J is the inertia, ? is the angle, and u is the applied torque. The open-loop\ntransfer function is given by\n\n?.s/\n\nU.s/\nD 1\nJ s2\n\n(12.56)\n\n\n\n12.2 Control Theory 439\n\nClearly this system is unstable since it has a double pole at the origin. Several\ndifferent types of controllers can be designed to stabilize this system. Here we\nfocus on a \u201cproportional-integral-derivative\u201d (PID) controller. We first will attempt a\nsimple proportional controller, where the error signal, E.s/, is multiplied simply by\na scalar gain, kp . Assuming that H.s/ D 1 the closed-loop dynamics in Eq. (12.53)\nare given by\n\nY.s/\n\nU.s/\nD kp\nJ s2 C kp (12.57)\n\nClearly, using only proportional control results in a closed-loop system that yields a\nsinusoidal response and thus the response is not asymptotically stable.\n\nWe now will attempt a PD controller, with Gc.s/ D kp C kd s, where kd is the\nscalar gain associated with the derivative portion of the controller. The closed-loop\nsystem now becomes\n\nY.s/\n\nU.s/\nD kp C kd s\nJ s2 C kd s C kp (12.58)\n\nNow the closed-loop dynamics can be made stable. The characteristic equation can\nbe written in the familiar form of s2 C 2 ? !n s C !2n, where ? is the damping ratio\nand !n is the natural frequency, which is the frequency of the sinusoidal response\nfor the undamped response. From Eq. (12.58) we have !n D\n\np\nkp=J and ? D\n\nkd=.2\np\nJ kp/. Four types of responses can be given for various values of ?:\n\n\u2022 ? < 0. This results in an unstable system.\n\u2022 ? D 0. This is the undamped response which yields a pure sinusoidal closed-\n\nloop response with frequency given by !n. The undamped response is given by\ny.t/ D A sin.!nt/CB cos.!nt/, where A and B are constants determined from\nthe initial conditions.\n\n\u2022 0 < ? < 1. This results in exponentially decaying sinusoidal, known as the\nunder-damped response, with frequency !d D !n\n\np\n1 ? ?2, called the damped\n\nnatural frequency. The response is given by y.t/ D e??!nt \u0152A sin.!d t/ C\nB cos.!d t/?, where A and B are constants determined from the initial condi-\ntions. Figure 12.4 gives plots for various values of ?. Clearly, the oscillations\ndamp out faster as ? increases.\n\n\u2022 ? D 1. This gives a critically damped response that converges as fast as possible\nwithout oscillating. The roots of the characteristic equation are repeated for this\ncase with s1; 2 D ?!n. The response is given by y.t/ D .AC B t/e??!nt , where\nA and B are constants determined from the initial conditions. Note that the term\nt grows with time, but the overall system is still stable because the exponential\n\u201cdecays\u201d the response faster than the t \u201cgrows\u201d the response.\n\n\u2022 ? > 1. This gives an over-damped response since all the roots, denoted by s1 and\ns2, are real and negative. The response is given by y.t/ D Aes1t CB es2t , where\nA and B are constants determined from the initial conditions.\n\n\n\n440 12 Review of Control and Estimation Theory\n\n0 1 2 3 4 5 6 7 8 9 10\n?0.8\n\n?0.6\n\n?0.4\n\n?0.2\n\n0\n\n0.2\n\n0.4\n\n0.6\n\n0.8\n\n1\n? = 0.1\n? = 0.7\n? = 0.9\n\nTime (Sec)\n\ny(\nt)\n\nFig. 12.4 Response for various damping ratio values\n\nThe single-axis PD control design explains a fundamental concept for basic\nspacecraft design. That is, spacecraft attitude control must incorporate derivative\nfeedback in order to achieve an asymptotically stable response. This derivative\ninformation is achieved either through gyros or by taking a finite difference of\nthe attitude. For the latter case, Eq. (3.174) can be used to determine the angular\nvelocity. However, it is important to note that employing a finite difference amplifies\nnoise since higher frequencies are amplified. This is clearly seen by the fact\nthat a magnitude plot of s shows a 20 decibel per decade increase. Typically, a\nlow-pass filter is employed to filter the noise. This approach works well when\nloose attitude and jitter requirements are given. Some researchers imply that\nspacecraft can be controlled without angular velocity measurements [14]. However,\na derivative is always given in these works, which must be derived from a finite\ndifference approach in practice. For tight pointing and/or jitter requirements the\nfinite difference approach will typically not meet the requirements and high quality\ngyros must be employed.\n\nFrom Eq. (12.58) it can be seen that a unit step input will result in a unit response\nas t !1. Thus zero steady-state error is achieved which results in perfect tracking.\nThe closed-loop disturbance response is given by\n\nY.s/\n\nD.s/\nD 1\nJ s2 C kd s C kp (12.59)\n\nFrom the final value theorem [5] the steady-state response for a unit disturbance\ninput is given by 1=kp . Ideally we want the steady-state disturbance response to\n\n\n\n12.2 Control Theory 441\n\n?1.4 ?1.2 ?1 ?0.8 ?0.6 ?0.4 ?0.2 0 0.2\n?1.5\n\n?1\n\n?0.5\n\n0\n\n0.5\n\n1\n\n1.5\n\nIm\nag\n\nin\nar\n\ny\n\nReal\n\nFig. 12.5 Pole locations for increase ki\n\nbe zero. We employ a full PID controller with Gc.s/ D kp C kd s C ki=s, where\nki is the integral gain, to make this happen. The closed-loop disturbance response is\nnow given by\n\nY.s/\n\nD.s/\nD s\nJ s3 C kd s2 C kp s C ki (12.60)\n\nFrom the final value theorem the disturbance response at steady-state is now zero.\nHowever, one needs to be careful. From Eq. (12.59) a stable response is given when\nthe PD gains are positive. However, the addition of integral control can actually\ndestabilize the system. We show this by example. We set J D kp D kd D 1\nand vary ki from 0 to 2. A plot of the root locations, also known as a root locus\nplot, for varying ki is shown in Fig. 12.5. When ki D 0 the roots are given by\n0 and ?1=2 ? p3=2 j . As ki increases the two complex poles move towards the\nimaginary axis and cross it when ki > 1. While the 0 pole moves further down the\nleft-hand plane\u2019s real axis, any integral gain that is greater than 1 causes the closed-\nloop system to become unstable. This is a typical characteristic of integral control\nand the reason why care must be taken when it is employed in a control design.\n\n\n\n442 12 Review of Control and Estimation Theory\n\n12.2.2 Stability of Nonlinear Dynamic Systems\n\nWe now consider the circumstance in which the original system of differential\nequations is nonlinear and can be brought to the standard form\n\nPx D f.x/ (12.61)\n\nSome of the nonlinear systems of differential equations encountered in applications\ncan be solved for an exact analytical solution. Unfortunately, only a minority of\nthese systems have known analytical solutions and no standardized methods exist\nfor finding exact analytical solutions.\n\nStability for nonlinear systems is much more difficult to prove. Fortunately,\nLyapunov methods can be applied to show stability for both nonlinear and linear\nsystems. Two methods for stability were introduced by Lyapunov. The first is given\nby Lyapunov\u2019s linearization method. Before proceeding with this method we must\nfirst define an equilibrium point, denoted by xe . An equilibrium is defined as a\npoint where the system states remain indefinitely, so that Px.t/ D 0 for all t .\nFor linear systems there is usually only one equilibrium point given at xe D 0,\nalthough there are exceptions. In Lyapunov\u2019s linearization method each equilibrium\npoint is considered and evaluated in a linearized model. The equilibrium point\nis said to be Lyapunov stable if we can select a bound on initial conditions that\nresults in trajectories that remain with a chosen finite limit. Furthermore, the\nequilibrium point is asymptotically stable if the linearized state also approaches\nzero as time approaches infinity. Denoting F as the Jacobian of f.x/ evaluated at\nthe equilibrium point, Lyapunov\u2019s linearization method gives the following stability\nconditions [25]:\n\n\u2022 The equilibrium point is asymptotically stable for the actual nonlinear system if\nthe linearized system is strictly stable, with all eigenvalues of F strictly in the\nleft-hand plane.\n\n\u2022 The equilibrium point is unstable for the actual nonlinear system if the linearized\nsystem is strictly unstable, with at least one eigenvalue strictly on the right-hand\nplane.\n\n\u2022 Nothing can be concluded if the linearized system is marginally stable, with at\nleast one eigenvalue of F on the imaginary axis and the remainder in the left-\nhand plane (the equilibrium point may be stable or unstable for the nonlinear\nsystem).\n\nLyapunov\u2019s linearization method provides a powerful approach to help qualify the\nstability of a system if a control (or estimation) scheme is designed to remain within\na linear region, but does not give a thorough understanding of the nonlinear system\nin many cases.\n\nLyapunov\u2019s direct method gives a global stability condition for the general\nnonlinear system. This concept is closely related to the energy of a system, which\nis a scalar function. The scalar function must in general be continuous and have\n\n\n\n12.2 Control Theory 443\n\ncontinuous derivatives with respect to all components of the state vector. Lyapunov\nshowed that if the total energy of a system is dissipated, then the state is confined to a\nvolume bounded by a surface of constant energy, so that the system must eventually\nsettle to an equilibrium point. This concept is valid for both linear and nonlinear\nsystems. Lyapunov stability is given if a chosen scalar function V.x/ satisfies the\nfollowing conditions:\n\n\u2022 V.xe/ D 0\n\u2022 V.x/ > 0 for x \u00a4 xe\n\u2022 PV .x/ ? 0\nIf these conditions are met, then V.x/ is a Lyapunov function. Furthermore, if\nPV .x/ < 0 for x \u00a4 xe , then the equilibrium point, xe , is asymptotically stable.\n\nFor the case when the condition PV .x/ ? 0 can only be shown, LaSalle\u2019s theorem\n[28] allows us to prove asymptotic stability. We first define an invariant set, as given\nin [25]: A set G is an invariant set for a dynamic system if every system trajectory\nwhich starts from a point G remains in G for all future time. Now assume that\nPV .x/ ? 0 is true over the entire state space and that V.x/ ! 1 as kxk ! 1. Let\nR be the set of all points PV .x/ D 0 andM be the largest invariant set inR. LaSalle\u2019s\ntheorem states that all solutions globally asymptomatically converge to M as time\napproaches infinity. More details on Lyapunov methods for stability can be found\nin [25].\n\nExample 12.2. Consider the following spring-mass-damper system with nonlinear\nspring and damper components:\n\nm Rx C c Pxj Pxj C k1x C k2x3 D 0\nwhere m, c, k1, and k2 have positive values. The system can be represented in first-\n\norder form by defining the following state vector x D ?x Px?T :\nPx1 D x2\nPx2 D ?.k1=m/x1 ? .k2=m/x31 ? .c=m/x2jx2j\n\nThe system has only one equilibrium point at x D ?0 0?T that is physically correct\n(the others are complex). We wish to investigate the stability of this nonlinear system\nusing Lyapunov\u2019s direct method. Intuitively, we choose a candidate Lyapunov\nfunction that is given by the total mechanical energy of the system, which is the\nsum of its kinetic and potential energies:\n\nV.x/ D 1\n2\nm Px2 C\n\nZ x\n0\n\n.k1x C k2x3/ dx\n\nEvaluating this integral yields\n\nV.x/ D 1\n2\nm Px2 C 1\n\n2\nk1x\n\n2 C 1\n4\nk2x\n\n4\n\n\n\n444 12 Review of Control and Estimation Theory\n\nNote that zero energy corresponds to the equilibrium point (x D 0), which satisfies\nthe first condition for a valid Lyapunov function. Also, the second condition, V.x/ >\n0 for x \u00a4 0, is clearly satisfied. Taking the time derivative of V.x/ gives\n\nPV .x/ D m Rx Px C .k1x C k2x3/ Px\nSolving the original system equation for m Rx, and substituting the resulting expres-\nsion into the equation for PV .x/ yields\n\nPV .x/ D ?cj Pxj3\n\nClearly, PV .x/ ? 0 for all nonzero values of Px. Therefore, V.x/ is a Lyapunov\nfunction and shows that the system is stable. But PV .x/ does not depend on x.\nTo prove asymptotic stability we consider the set R, which consists of x such\nthat x2 D 0 and x1 is anything. Suppose x.t/ is a trajectory starting in R. Then\nPx1 D x2 D 0, which implies that x1.t/ is constant. But if this constant is not\nzero, then Px2 is not necessarily zero and so x2 will become nonzero. Therefore, any\ninitial point in R must leave R. Since R is not attracting, then LaSalle\u2019s theorem\nimplies the origin is asymptotically stable. This example shows how an \u201cenergy-\nlike\u201d function can be used to find a Lyapunov function, since the energy of this\nsystem is dissipated by the damper until the mass settles down.\n\nLyapunov\u2019s global method can be shown to be valid for linear autonomous\nsystems with Px D F x. Consider the function V.x/ D xT P x, where P is a positive\ndefinite symmetric matrix. Clearly, V.x/ > 0 for all x \u00a4 0. The time derivative of\nV.x/ is given by\n\nPV .x/ D PxT P xC xT P Px D xT .F T P C PF /x (12.62)\nNext, define the following matrix Lyapunov equation:\n\nF TP C PF D ?Q (12.63)\nIf Q is strictly positive definite then the system is asymptotically stable. Lyapunov\nshowed that this condition is true if and only if all eigenvalues of F are strictly in\nthe left-hand plane. See [4] for the proof.\n\n12.2.3 Sliding-Mode Control1\n\nIn this section a popular control approach, called sliding-mode control, for nonlinear\nsystems is briefly reviewed. More details can be found in [25]. Sliding-mode\ncontrol is also referred to as variable structure control because the structure of the\n\n1The authors would like to thank Agamemnon L. Crassidis for many of the contributions in this\nsection.\n\n\n\n12.2 Control Theory 445\n\n?1.2 ?1 ?0.8 ?0.6 ?0.4 ?0.2 0 0.2\n?0.05\n\n0\n\n0.05\n\n0.1\n\n0.15\n\n0.2\n\n0.25\n\n0.3\n\n0.35\n\nSliding Phase\n\nReaching Phase\n\n? x\n\n?\nD\nx\n\nFig. 12.6 Phase portrait\n\ncontrol law varies, i.e. switches, based on the position of the state trajectory. Before\nintroducing the actual sliding control approach the basic concepts of switching\ntheory must first be introduced. A candidate Lypaunov function is first chosen so\nthat the system\u2019s state trajectories in the phase plane remain stable and point toward\nthe origin. The switching law forces the state trajectories onto a surface in the phase\nplane, which is called the sliding surface or switching surface. The control law\nswitches between two sets of control laws depending if the states are above or below\nthe surface. Once the state trajectories reach the sliding surface, referred to as the\nreaching phase, the discontinuous controller forces the states to slide towards the\norigin, referred to as the sliding phase. A phase portrait showing these two phases\nfor the system used in Example 12.3 is shown in Fig. 12.6.\n\nWe begin our introduction to sliding-mode control by considering the following\nsecond-order system:\n\nRx D f .x; Px/C u (12.64)\nwhere f .x; Px/may be a linear or nonlinear function. Let xc be the desired state and\n?x D x ? xc . The sliding surface, denoted by s, for a second-order system can be\nmathematically described by the following:\n\ns D ? Px C \t?x (12.65)\nfor some scalar \t. Consider the following candidate Lyapunov function:\n\nV.?x/ D 1\n2\ns2 (12.66)\n\n\n\n446 12 Review of Control and Estimation Theory\n\nThe time derivative is given by\n\nPV .?x/ D s Ps (12.67)\n\nA control law can now be found based on Eq. (12.67) that ensures that the state\ntrajectories will be asymptotically stable. In order for the state trajectories to remain\non the surface, motion off the surface is prevented by setting Ps D 0, which is referred\nto as a sliding mode.\n\nThis can be extended to higher-order systems by defining the following tracker\nerror vector [25]:\n\n?x D x ? xc D\n?\n?x ? Px ? ? ? ?x.n?1/?T (12.68)\n\nwhere n is the order of the system. The sliding surface is given by\n\ns D\n?\nd\n\ndt\nC \t\n\n?\n?x (12.69)\n\nFor example, when n D 3 we have s D ? Rx C 2 \t? Px C \t2? Px.\nSliding-mode control essentially reduces the order of the system to a first-order\n\nsystem by a form of feedback linearization. Direct feedback linearization is attrac-\ntive for nonlinear systems since the nonlinear system dynamics are transformed into\na system with linear dynamics. Typically, however, the dynamics of the system\nare not known exactly. This may lead to severe tracking errors when a direct\nfeedback linearization control law is implemented on an actual system. In other\nwords, robustness in the presence of parametric and un-modeled uncertainties\ncannot be ensured. Sliding-mode control solves the shortcomings and limitations\nof direct feedback linearization by forcing the state trajectories to track desired\nstate trajectories in the phase portrait. Stability is ensured by Lyapunov\u2019s direct\nmethod and forms the basis for deriving the control law. As an example consider\nthe following assumed second-order system:\n\nRx D Nf .x; Px/C u (12.70)\n\nwhere the assumed model Nf .x; Px/ will be used to develop the control law. Taking\nthe derivative of s in Eq. (12.65) and substituting Rx D Nf .x; Px/C u gives\n\nPs D Rx ? Rxc C \t? Px\nD Nf .x; Px/C u ? Rxc C \t? Px (12.71)\n\nUsing the condition Ps D 0 from Eq. (12.67) leads to the following control law:\n\nue D ? Nf .x; Px/C Rxc ? \t? Px (12.72)\n\n\n\n12.2 Control Theory 447\n\nwhere ue is interpreted as the \u201cbest\u201d estimate of the equivalent control [25]. In order\nto account for model uncertainties a discontinuous term is added across the sliding\nsurface:\n\nu D ue ? k sign.s/ (12.73)\n\nfor some scalar k. Substituting this control law into Eq. (12.71) and then substituting\nthe resultant into Eq. (12.67) yields\n\nPV .?x/ D ?f .x; Px/ ? Nf .x; Px/ ? k sign.s/? s\nD ?f .x; Px/ ? Nf .x; Px/? s ? k jsj (12.74)\n\nLet us assume that the model error on f .x; Px/ can be bounded by some known\nfunction F.x; Px/, so that\n\njf .x; Px/ ? Nf .x; Px/j ? F.x; Px/ (12.75)\n\nLet the maximum value of F.x; Px/ be denoted by Fmax. Then setting k D FmaxC ?\nfor some positive scalar ? gives PV .?x/ ? ??jsj.\n\nThe resulting sliding-mode control law provides stability in the face of modeling\nuncertainties if k is chosen to be large enough, but it is important to note that as\nk increases the control discontinuity also increases. The control switching law will\ncause the closed-loop system to \u201cchatter\u201d due to the discontinuous term, which is\nundesirable for most applications. The chattering can be eliminated by smoothing\nthe control signal in a thin boundary layer. To accomplish this task the signum\nfunction is replaced with a saturation function with a varying boundary layer\nthickness. The applied sliding-mode control is now given by\n\nu D ue ? k sat.s; \n/ (12.76)\n\nwhere \n is the boundary layer thickness and\n\nsat.s; \n/ ?\n\n8?\n<?\n\u02c6?:\n\n1 for s > \n\n\ns=\n for jsj ? \n\n?1 for s < ?\n\n\n(12.77)\n\nThe tracking performance is suboptimal using the saturation function, compared to\nusing the signum function, but this provides a good tradeoff between robustness and\npractical implementation for a smoothed control input. The extension of sliding-\nmode control to multiple inputs is given in [25]. Other properties of this control\napproach can also be found in this reference.\n\n\n\n448 12 Review of Control and Estimation Theory\n\nExample 12.3. In this example the nonlinear system shown in Example 12.2 is\ncontrolled to a desired trajectory. The system with a control input is given by\n\nm Rx C c Pxj Pxj C k1x C k2x3 D u\n\nwhere m, c, k1, and k2 have positive values. The system can be represented in first-\n\norder form by defining the following state vector x D ?x Px?T :\n\nPx1 D x2\nPx2 D ?.k1=m/x1 ? .k2=m/x31 ? .c=m/x2jx2j C u\n\nThe desired trajectories are simulated using the model parameters: m D 1, c D 2,\nk1 D 1, and k2 D 0:5with u D 0 for all time and an initial condition of x0 D \u01521 0?T .\nA time interval of 0.01 s is used for the integration process with a final time of 50 s.\n\nThe sliding-mode control law assumes the model parameters: Nm D 1, Nc D 3,\nNk1 D 1:5, and Nk2 D 0:75. The control parameters are given by \t D 3 and k D 1.\nThe boundary layer thickness when the saturation function is used in the control\nlaw is given by \n D 1. The assumed initial condition is given by zero for both\nstates. Simulation results using the signum and saturation functions are shown in\nFig. 12.7. Comparing Fig. 12.7a and c shows that using the signum function drives\nthe position error to zero faster than using the saturation function. But comparing\nFig. 12.7b and d shows that using the signum function produces the classical\nchattering phenomenon for the control input, while the saturation function produces\na much smoother control input.\n\n12.3 Estimation Theory\n\nIn this section the basic concepts of estimation theory are reviewed. We begin with a\ndiscussion on the differences between static-based and filter-based estimation. Then,\nmethods of least squares are presented. Formulations are shown for both batch\nand recursive least squares methods involving linear processes. Then, maximum\nlikelihood estimation is reviewed, including a review of the Cram\u00e9r-Rao lower\nbound. Next, nonlinear least squares is reviewed. An example is shown that involves\nestimating the attitude of a spacecraft from body and reference observations.\nThis is followed by a brief discussion of the advantages and disadvantages of\nleast squares methods. Then, a review of state estimation methods is provided,\nwhich includes the Kalman filter for linear systems, the extended Kalman filter\nfor nonlinear systems, and a batch smoothing algorithm. This is followed by a\ndiscussion on the concept of linear covariance analysis. Finally, the separation\ntheorem is reviewed.\n\n\n\n12.3 Estimation Theory 449\n\n0 5 10 15 20 25 30 35 40 45 50\n?0.2\n\n0\n\n0.2\n\n0.4\n\n0.6\n\n0.8\n\n1\n\nP\nos\n\nit\nio\n\nn\n\nTime (Sec)\n\n0 5 10 15 20 25 30 35 40 45 50\n?2.5\n\n?2\n\n?1.5\n\n?1\n\n?0.5\n\n0\n\n0.5\n\n1\n\n1.5\n\nC\non\n\ntr\nol\n\n I\nnp\n\nut\n\nTime (Sec)\n\n0 5 10 15 20 25 30 35 40 45 50\n?0.2\n\n0\n\n0.2\n\n0.4\n\n0.6\n\n0.8\n\n1\n\nP\nos\n\nit\nio\n\nn\n\nTime (Sec)\n\n0 5 10 15 20 25 30 35 40 45 50\n?0.8\n\n?0.7\n\n?0.6\n\n?0.5\n\n?0.4\n\n?0.3\n\n?0.2\n\n?0.1\n\n0\n\n0.1\nC\n\non\ntr\n\nol\n I\n\nnp\nut\n\nTime (Sec)\n\na b\n\nc d\n\nFig. 12.7 Sliding-mode simulation results. (a) Position error\u2014signum function. (b) Control\ninput\u2014signum function. (c) Position error\u2014saturation function. (d) Control input\u2014saturation\nfunction\n\n12.3.1 Static-Based and Filter-Based Estimation\n\nFiltering refers to the process of estimating the current state of a system from a\nset of measured observations using a priori information, typically given by the\nprevious time state estimate. The filtering problem involves finding the best estimate\nof the true system state using an assumed model and measurements each corrupted\nwith random noise of known statistics. The variables to be estimated are usually\ncollected into a state vector, which typically include more variables than just the\nattitude. For example, star tracker measurements can be combined with a kinematic\nmodel, which is propagated using gyroscopic measurements. However, all gyros\nhave inherent drift, which cause inaccuracies in the propagated model. A filter is\nused to estimate the attitude and gyro drift, oftentimes referred to as a bias because\nover short periods the drift occurs slowly, from the measurements. An important\naspect of filtering approaches is that they can be used to simultaneously estimate\n\n\n\n450 12 Review of Control and Estimation Theory\n\nquantities and filter noisy measurement observations. This is accomplished by\nfinding the best estimate from a combination of the dynamic model propagation\nand the measurement observation, as discussed in the star tracker/gyro example.\nThe attitude estimate can be shown to be more accurate than using static approaches\nalone. Because filtering approaches can (and often do) utilize dynamic models, they\ncan in theory estimate quantities when the number of to-be-determined quantities is\ngreater than the number of linearly independent observations at any single time. An\nexample of a specific filtering approach is the Kalman filter [11], which when used\nfor attitude estimation can in some cases determine the attitude using one vector\nsensor, e.g. a magnetometer-only solution [21].\n\nStatic and filtering approaches can be used in a complementary fashion. For\nexample, a static solution can be used as an initial estimate in the filter, and may also\nbe used to check the integrity of the filter solution. Another example involves star-\ntracker determined attitudes. Modern star trackers have the capability of providing\nan attitude-out solution using the vector observations only in the internal processor.\nTwo or more of these attitude solutions from multiple trackers can be combined\nwith rate-integrating gyro measurements in a filter to provide a better attitude\nestimate than the estimate provided be a single tracker. Therefore, static and filtering\napproaches can complement each other in the overall estimate.\n\nBoth static and filtering approaches have advantages and disadvantages. The\nmain advantage of static approaches is that a solution is always provided with at\nmost a very rough a priori estimate of the desired quantity. Also, these approaches\nare usually computationally more efficient than filtering approaches. The main\ndisadvantage of static approaches is that full observability is required at each\ntime frame, so that algebraic singularities do not exist in the solution. Also, some\nvariables cannot be included or determined from a static solution. Finally, optimally\ncombining determined quantities with the proper statistical balance may be difficult\nto do using static approaches.\n\nThe main advantage of filtering approaches is that estimates may still be found\neven when deterministic methods fail, such as in the algebraic singularity situation.\nAlso, other variables, such as biases, can be appended into the state estimation\nvariables, and can easily be combined with other variables with the proper statistical\nbalance. Another advantage is that filters often provide statistical measures, such as\nestimate error covariances, as part of their solutions, while simultaneously filtering\nnoisy observations. The main disadvantage of filtering approaches is that an a priori\nestimate is usually required for the solution. Also, filters may be prone to divergence\nproblems. Finally, the computational load, coding size, and implementation effort\nare usually greater for filtering approaches than with static approaches.\n\nThis section provides a review of both static-based and filtering-based estimation\napproaches. It is expected that the reader has basic knowledge of probability and\nstatistics, especially the theory behind expectations of a random variable, Gaussian\ndistributions and the definition of the covariance matrix. First, an introduction\nto the notation used for the estimation concepts throughout the text is shown.\n\n\n\n12.3 Estimation Theory 451\n\nThis is followed by a review of static-based methods, including linear and nonlinear\nleast squares. Then, filter-based methods, such as the Kalman filter and extended\nKalman filter are reviewed.\n\nThe foundation of all estimation algorithms involves taking sensor measurements\nto estimate unknown variables. For any variable or parameter in estimation, there\nare three quantities of interest: the true value, the measured value, and the estimated\nvalue. The true value (or \u201ctruth\u201d) is usually unknown in practice. This represents the\nactual value sought of the quantity being approximated by the estimator. In this text\nthe true value contains the word \u201ctrue\u201d as a superscript, such as xtrue. Measurements\nare never perfect, since they will always contain errors. Thus, measurements are\nusually modeled using a function of the true values plus some error. Other quantities\nused commonly in estimation are the measurement error (measurement value minus\ntrue value) and the residual error (measurement value minus estimated value). Thus,\nfor a measurable quantity x, the following two equations hold:\n\nmeasured value D true value C measurement error\nx D xtrue C v\n\nand\n\nmeasured value D estimated value C residual error\nx D Ox C \n\n\nThe actual measurement error, v, like the true value, is never known in practice.\nHowever, the errors in the mechanism that physically generate this error are usually\napproximated by some known process (often by a zero-mean Gaussian noise\nprocess with known variance). These assumed known statistical properties of the\nmeasurement errors are often employed to weight the relative importance of various\nmeasurements used in the estimation scheme. Unlike the measurement error, the\nresidual error is known explicitly and is easily computed once an estimated value\nhas been found. The residual error is often used to drive the estimator itself. It should\nbe evident that both measurement errors and residual errors play important roles in\nthe theoretical and computational aspects of estimation.\n\n12.3.2 Batch Least Squares Estimation\n\nThe principle of batch least squares, developed simultaneously by Karl Gauss\nand Adrien-Marie Legendre in the early Nineteenth Century, is used to estimate\nthe elements of a constant vector from redundant observations. Therefore, least\nsquares methods are known as \u201cstatic\u201d estimators. It is important to note that these\nmethods may still involve dynamic models; however, the elements to be estimated\nare always constant. The simplest least squares problem has a linear observation\nmodel, given by\n\ny D Hxtrue C v (12.78)\n\n\n\n452 12 Review of Control and Estimation Theory\n\nwhere y is anm?1 vector of observations, xtrue is an n?1 vectors of to-be-estimated\nvariables, H is an m ? n constant observation matrix, and v is an m ? 1 vector of\nmeasurement noise which is usually represented by a zero-mean Gaussian white-\nnoise process with covariance\n\nR ? EfvvT g (12.79)\n\nwhere Ef g denotes expectation [4]. Here it is assumed that R is a positive definite\nmatrix. The optimum estimate for xtrue, denoted by Ox, is found by minimizing a loss\nfunction involving the weighted sum square residual errors, given by\n\nJ.Ox/ D 1\n2\n.y ?H Ox/T R?1.y ?H Ox/ (12.80)\n\nMinimizing Eq. (12.80) can easily be shown to be equivalent to maximizing the\nlikelihood function [26], which will be shown later. The best least squares estimate\nis obtained by taking the derivative of Eq. (12.80) with respect to Ox and setting\nthe resultant to zero, which yields\n\nOx D .HTR?1H/?1HTR?1y (12.81)\n\nA sufficiency test for locating the minimum is found by using the second derivative\nof J.Ox/,\n\n@2J.Ox/\n@Ox2 D H\n\nTR?1H (12.82)\n\nwhich is an n ? n Hessian matrix. It is positive definite when H has rank n, thus\nproviding a sufficient condition for a minimum. For the simple case of estimating a\nscalar variable, it is easy to show that Eq. (12.81) reduces to the average of a number\nof observations. Variants to the least squares problem, such as the constrained\nproblem, can be found in [4].\n\nThe structure of Eq. (12.81) can also be used to prove that the estimator is\n\u201cunbiased.\u201d An estimator Ox.y/ is said to be an \u201cunbiased estimator\u201d of x if\nE fOx.y/g D xtrue for every possible value of xtrue [4].2 If Ox is biased, the difference\nE fOx.y/g ? xtrue is called the \u201cbias\u201d of Ox. Substituting Eq. (12.78) into Eq. (12.81)\ngives\n\nOx D xtrue C .HTR?1H/?1HTR?1v (12.83)\n\nTaking the expectation of both sides gives E fOxg D xtrue, since v has zero mean.\nTherefore, Eq. (12.81) is indeed an unbiased estimate.\n\n2This implies that the estimate is a function of the measurements.\n\n\n\n12.3 Estimation Theory 453\n\n12.3.3 Sequential Least Squares Estimation\n\nThe batch least squares problem can be run as a sequential process. This is\naccomplished by adding an observation and deriving a sequential estimate based on\nthe previous estimate [4]. The sequential estimate follows the following recursion\nequation:\n\nOxkC1 D Oxk CKkC1.ykC1 ?HkC1 Oxk/ (12.84)\n\nwhere\n\nKkC1 D PkC1HTkC1R?1kC1 (12.85)\nP?1kC1 D P?1k CHTkC1R?1kC1HkC1 (12.86)\n\nThe matrix P is known as the estimate error-covariance matrix, which will be\ndescribed shortly. Equation (12.84) modifies the previous best correction Oxk by an\nadditional correction to account for the information contained in the .k C 1/th\nmeasurement subset. Another form for Eq. (12.85) is given by using the matrix\ninversion lemma or Sherman-Morrison-Woodbury formula [9]:\n\n.AC U C V /?1 D A?1 ? A?1U .C?1 C V A?1U /?1V A?1 (12.87)\n\nThis leads to the covariance recursion form, given by\n\nOxkC1 D Oxk CKkC1.ykC1 ?HkC1 Oxk/ (12.88)\n\nwhere\n\nKkC1 D PkHTkC1\n?\nHkC1PkHTkC1 CRkC1\n\n??1\n(12.89)\n\nPkC1 D \u0152I ?KkC1HkC1? Pk (12.90)\n\nAn alternative form for the sequential covariance expression involves using the\nJoseph form [17], which has been shown to be more numerically stable. This is\ngiven by\n\nPkC1 D \u0152I ?KkHkC1?Pk\u0152I ?KkHkC1?T CKkRkC1KTk (12.91)\n\nEquation (12.91) requires more computations, but guarantees that the covariance\nmatrix will remain positive definite.\n\nIn sequential least squares, the new estimate is the old estimate plus a linear\ncorrection term involving the residual between a new observation and the value\npredicted by the old estimate. Also, if the estimate covariance is \u201clarge,\u201d then\nmore weight is given to the residual. This intuitively makes sense since a large\n\n\n\n454 12 Review of Control and Estimation Theory\n\ncovariance implies a large estimate error, so that more reliance should be placed on\nthe residual than the previous estimate. As the covariance decreases more weight is\nplaced on the previous estimate, so that the effect of residual correction is less. Thus,\nthe addition of more observations does not significantly affect the new estimate.\n\n12.3.4 Maximum Likelihood Estimation\n\nMaximum likelihood estimation (MLE) was first introduced by R. A. Fisher, a\ngeneticist and statistician in the 1920s. Maximum likelihood yields estimates for\nthe unknown quantities which maximize the probability of obtaining the observed\nset of data. The conditional probability density function (pdf) for the measurement\nmodel in Eq. (12.78) is simply given by [4]\n\np.yjxtrue/ D 1\n.2\n/m=2.detR/1=2\n\nexp\n\n?\n?1\n2\n.y ?Hxtrue/T R?1.y ?Hxtrue/\n\n?\n\n(12.92)\nWe wish to maximize the conditional pdf to determine an estimate for xtrue, denoted\nby Ox. Due to the monotonic aspect of this function, the maximization problem can\nbe solved by maximizing the natural log of Eq. (12.92), which gives\n\nln\n?\np.yjxtrue/? D ?1\n\n2\n.y ?Hxtrue/T R?1.y ?Hxtrue/ ? m\n\n2\nln.2\n/ ? 1\n\n2\nln.detR/\n\n(12.93)\n\nThe last two terms on the right hand side of Eq. (12.93) can be ignored because they\ndo not depend on xtrue. Maximizing Eq. (12.93) leads to\n\nOx D .HTR?1H/?1HTR?1y (12.94)\nwhich is the familiar least squares batch estimator given by Eq. (12.81). In order\nto guarantee that the function is maximized the matrix ?.HTR?1H/?1 must be\nnegative definite. Since R is positive definite, then this condition is true if m ? n\nand there are at least n independent rows in H .\n\nThe likelihood function, `.yjxtrue/, is also a pdf, given by\n\n`.yjxtrue/ D\nNY\niD1\n\np.yi jxtrue/ (12.95)\n\nwhere N is the total number of density functions (a product of a number of\ndensity functions is also a density function in itself). Note that the distributions\nused in Eq. (12.95) are the same, but the measurements belong to a different\nsample drawn from the conditional density. The goal of the method of maximum\nlikelihood is to choose as our estimate of the unknown parameters xtrue that\nvalue for which the probability of obtaining the observations y is maximized.\n\n\n\n12.3 Estimation Theory 455\n\nMany likelihood functions, such as the Gaussian pdf, contain exponential terms,\nwhich can complicate the mathematics involved in obtaining a solution. However,\nas seen previously, since ln \u0152`.yjxtrue/? is a monotonic function of `.yjxtrue/, then\nmaximizing ln \u0152`.yjxtrue/? is equivalent to maximizing `.yjxtrue/.3 It follows that for\na maximum we have the following:\n\nnecessary condition\n\n\n\n@\n\n@xtrue\nln\n?\n`.yjxtrue/?\n\n? ??\n??\nOx\nD 0n (12.96)\n\nsufficient condition\n\n@2\n\n@xtrue @.xtrue/T\nln\n?\n`.yjxtrue/? must be negative definite (12.97)\n\nEquation (12.96) is often called the likelihood equation.\nMaximum likelihood has many desirable properties. The first is the invari-\n\nance principle, which is stated as follows: Let Ox be the maximum likelihood\nestimate of xtrue. Then the maximum likelihood estimate of any function g.xtrue/\nof these parameters is the function g.Ox/ of the maximum likelihood estimate.\nThis is a powerful tool since we do not have to take more partial derivatives to\ndetermine the maximum likelihood estimate! Another property is that maximum\nlikelihood is an asymptotically efficient estimator. This means that if the sample\nsize is large, the maximum likelihood estimate is approximately unbiased and has\na variance that approaches the smallest that can be achieved by any estimator.\nFinally, the estimation errors in the maximum likelihood estimate can be shown to\nbe asymptotically Gaussian no matter what density function is used in the likelihood\nfunction. Proofs of these properties can be found in Sorenson [26].\n\nThe sufficient condition in Eq. (12.97) is useful to also compute the Cram\u00e9r-Rao\ninequality which gives a lower bound on the expected errors between the estimated\nquantities and the values from the known statistical properties of the measurement\nerrors. The Cram\u00e9r-Rao inequality for an unbiased estimate Ox, i.e. E fOxg D xtrue, is\ngiven by\n\nP ? E\nn?Ox ? xtrue\t ?Ox ? xtrue\tT\n\no\n? F ?1 (12.98)\n\nwhere the Fisher information matrix, F , is given by\n\nF D ?E\n\n\n\n@2\n\n@xtrue @.xtrue/T\nln\u0152p.yjxtrue/?\n\n?\n(12.99)\n\n3Also, taking the natural logarithm changes a product to a sum which often simplifies the problem\nto be solved.\n\n\n\n456 12 Review of Control and Estimation Theory\n\nThe first- and second-order partial derivatives are assumed to exist and to be\nabsolutely integrable. A formal proof of the Cram\u00e9r-Rao inequality can be found\nin [4]. The Cram\u00e9r-Rao inequality gives a lower bound on the expected errors. When\nthe equality in Eq. (12.98) is satisfied, then the estimator is said to be efficient. This\ncan be useful for the investigation of the quality of a particular estimator. It should\nbe stressed that the Cram\u00e9r-Rao inequality gives a lower bound on the expected\nerrors only for the case of unbiased estimates.\n\nAs an example of the Cram\u00e9r-Rao inequality, consider the least squares estimator\nof Eq. (12.94). The Fisher information matrix using Eq. (12.99) is found to be\ngiven by\n\nF D .HTR?1H/ (12.100)\nSubstituting Eq. (12.78) into Eq. (12.94) gives\n\nOx ? xtrue D .HTR?1H/?1HTR?1v (12.101)\nSince Efvg D 0 then clearly the least squares estimate is unbiased. Using\nEfv vT g D R leads to the following estimate covariance:\n\nP D .HTR?1H/?1 (12.102)\nTherefore, the equality in Eq. (12.98) is satisfied, so the least squares estimate leads\nto an efficient estimator. Note that estimate covariance matrix does not depend on\nthe observations, so that the performance of the estimator can be evaluated before\nany measurements are taken. This includes finding the 3? bounds on the estimate\nerror parameters, even though the truth, xtrue, is never known in practice!\n\n12.3.5 Nonlinear Least Squares\n\nLinear least squares provides a simple and efficient closed-form solution for linear\nmodels. Unfortunately, many systems in spacecraft orbit and attitude estimation\ninvolve nonlinear models. The nonlinear least squares problem is more com-\nplicated, since in general closed-form solutions are not possible. Consider the\nfollowing nonlinear observation model:\n\ny D h.xtrue/C v (12.103)\nwhere h.xtrue/ represents some nonlinear, continuously differentiable function\nof xtrue. Also, it is assumed that the measurement noise is an additive function to the\nobservation model h.xtrue/. This may not always be true, which further complicates\nthe problem. The nonlinear least squares problem still minimizes the weighted sum\nsquare residual errors, given by\n\nJ.Ox/ D 1\n2\n\u0152y ? h.Ox/?T R?1\u0152y ? h.Ox/? (12.104)\n\n\n\n12.3 Estimation Theory 457\n\nIn principle the solution follows exactly as in the linear case, where the derivative\nof Eq. (12.104) is set to zero. However, in practice the estimate cannot be found in\nclosed-form due to the nonlinear nature of the observation vector h.x/. We assume\nthat an initial estimate of x is known, denoted by xc , so that the estimate is related\nby an unknown set of corrections, ?x, as\n\nOx D xc C?x (12.105)\nIf the components of ?x are sufficiently small, it may be possible to solve for\napproximations to them and thereby update xc with an improved estimate of x from\nEq. (12.105). With this assumption, we may linearize h.Ox/ about xc using a first-\norder Taylor series expansion as\n\nh.Ox/ ? h.xc/CH?x (12.106)\nwhere\n\nH ? @h\n@x\n\n??\n??\nxc\n\n(12.107)\n\nThe measurement residual \u201cafter the correction\u201d can now be linearly approxi-\nmated as\n\n?y ? y ? h.Ox/ ? y ? h.xc/ ?H?x D ?yc ?H?x (12.108)\nwhere the residual \u201cbefore the correction\u201d is\n\n?yc ? y ? h.xc/ (12.109)\nRecall that the objective is to minimize the weighted sum squares, J , given\n\nby Eq. (12.104). The local strategy for determining the approximate corrections\n(\u201cdifferential corrections\u201d) in ?x is to select the particular corrections that lead to\nthe minimum sum of squares of the linearly predicted residuals Jp:\n\nJ D 1\n2\n?yT R?1?y ? Jp ? 1\n\n2\n.?yc ?H?x/T R?1.?yc ?H?x/ (12.110)\n\nBefore carrying out the minimization, we note that the minimization of Jp in\nEq. (12.110) is equivalent to the minimization of J in Eq. (12.104). If the process is\nconvergent, then ?x determined by minimizing Eq. (12.110) would be expected to\ndecrease on successive iterations until (on the final iteration) the linearization is an\nextremely good approximation.\n\nObserve that the minimization of Eq. (12.110) is completely analogous to the\npreviously minimized quadratic form. Thus, any algorithm for solving the least\nsquares problem directly applies to solving for ?x in Eq. (12.110). Therefore, the\ncorrections is given by\n\n?x D .HTR?1H/?1HTR?1?yc (12.111)\n\n\n\n458 12 Review of Control and Estimation Theory\n\nModel\nh(x)\n\nDetermine\n?h\n?x\n\nDyc = y ? h(xc)\nJi = Dy\n\nT\nc R\n\n?1Dyc\n\nH =\nxc\n\nDx = (HT R?1 H)?1 HT R?1Dyc\n\ndJ<\n?\n\n? Stop\n\nxc = xc + Dx\n\nMaximum\nIterations?Stop\n\ny,R?1\n\nYes\n\nYes\n\nNo\n\nNo\n\nxc\n\nStarting\nEstimate xc\n\ni = 0\n\ni = i + 1\n\n?h\n?x\n\nR?1\n\nR?1\n\nFig. 12.8 Nonlinear least squares algorithm\n\nThe complete nonlinear least squares algorithm is summarized in Fig. 12.8. An\ninitial guess xc is required to begin the algorithm. Equation (12.111) is then\ncalculated using the residual measurements .?yc/, Jacobian matrix .H/, and\nmeasurement covariance matrix (R?1), so that the current estimate can be updated.\nA stopping condition with an accuracy dependent tolerance for the minimization of\nJ is given by\n\n?J ? jJi ? Ji?1j\nJi\n\n<\n\"\n\nkR?1k (12.112)\n\nwhere \" is a prescribed small value. If Eq. (12.112) is not satisfied, then the update\nprocedure is iterated with the new estimate as the current estimate until the process\nconverges, or unsatisfactory convergence progress is evident (e.g. a maximum\nallowed number of iterations is exceeded, or J increases on successive iterations).\n\n\n\n12.3 Estimation Theory 459\n\nTherefore, a linear update is performed. Nonlinear least squares implies that an\nfairly accurate estimate of x must be known a priori, which may not always be\npossible. Also, a necessary condition for Ox to be the least squares estimate is that\nthe residual must be orthogonal to the columns of H . This is not true in general.\nHowever, in practice Ox is used to invoke an iterative procedure with xc replaced by Ox\nso that the process continues until the estimate is no longer improved. This iterative\nsearch procedure is known as the Gauss method. The estimate covariance is still\ngiven by Eq. (12.102), but is theoretically evaluated at the truth. Since this is not\nknown, the final estimate is used in practice.\n\nExample 12.4. In this example nonlinear least squares is used to compute the\nmodified Rodrigues parameters (MRPs) from two vector observations. The true\nbody vectors are given by\n\nbtrue1 D\n2\n4\n0\n\n0\n\n1\n\n3\n5 ; btrue2 D\n\n2\n4\n\n0\n\n0:1p\n1 ? 0:12\n\n3\n5\n\nNote that the angle between these vectors is 5:74?. The true MRP and associated\nattitude matrix are given by\n\nptrue D\n\n2\n664\n\n1\n\n1Cp2\n0\n\n0\n\n3\n775 ; A.ptrue/ D\n\n2\n4\n1 0 0\n\n0 0 1\n\n0 ?1 0\n\n3\n5\n\nThe reference vectors are computed using ri D AT btruei for i D 1; 2. To generate\nbody measurements the QUEST measurement model in Eq. (5.107b) is used with\n?bi D 0:001? for i D 1; 2. Note that the measurement covariance is fully populated.\nTo overcome the issue of generating synthetic noise with correlations in any general\nsemi-definite covariance matrix R, we first will diagonalize this matrix using an\neigenvalue/eigenvector decomposition:\n\nR D V %V T\n\nwhere V is a matrix of eigenvectors and % is a matrix of eigenvalues. Since R\nis positive semi-definite, then V is an orthogonal matrix and the elements of %\nare real and positive. A random sample, denoted by z, using scalar sampling can\nbe generated using the matrix %, where the elements of % are the variances of the\nelements of z. To determine the correlated measurement noise, we simply rotate\nthe vector z using V with\n\nv D V z\n\n\n\n460 12 Review of Control and Estimation Theory\n\nwhere v is the correlated noise associated with R. To see that this is correct, we\ncompute E\n\n?\nv vT\n\n? D VE ?z zT ?V T D V %V T D R. This process is done on both\nRb1 and Rb2 to generate synthetic v1 and v2 vectors. The measured body vectors are\nthen given by\n\nb1 D b\ntrue\n1 C v1\n\njjbtrue1 C v1jj\n; b2 D b\n\ntrue\n2 C v2\n\njjbtrue2 C v2jj\nTo compute the matrixH a first-order expansion of the attitude matrix in the error\n\nMRPs is used. First the true attitude is related to the estimated attitude, denoted by\nA. Op/, by using an error attitude, denoted A.?p/, through\n\nA.ptrue/ D A.?p/A. Op/\n\nThe first-order expansion of A.?p/ is given by\n\nA.?p/ D I3 ? 4\u0152?p??\n\nThe estimated i th body vector is given by Obi D A. Op/ri . Computing?bi ? btruei ? Obi\ngives\n\n?bi D ?4\u0152?p??A. Op/ri\nD 4\u0152A. Op/ri???p\n\nTaking the derivative with respect to ?p gives the following H matrix:\n\nH D\n2\n4\n4\u0152A. Op/r1??\n\n4\u0152A. Op/r2??\n\n3\n5\n\nThe vector ?y and matrix R are given by\n\n?y D\n\"\n\nb1 ? Ob1\nb2 ? Ob2\n\n#\n; R D ?2I6\n\nEquation (12.111) can now be used to perform the nonlinear least squares iterations.\nA multiplicative correction using Eq. (2.150) is used to update the MRP:\n\nOp D\n?\n1 ? kpck2\n\n\t\n?xC ?1 ? k?xk2\tpc ? 2?x ? pc\n\n1C kpck2k?pck2 ? 2?x ? pc (12.113)\n\nwhere Op is the estimated MRP and pc is the initial MRP.\nThe nonlinear least squares process is started with an initial MRP of pc D 03?1.\n\nThe stopping criterion is given when ?x < 1 ? 10?9. One thousand Monte Carlo\n\n\n\n12.3 Estimation Theory 461\n\n0 100 200 300 400 500 600 700 800 900 1000\n?50\n\n?25\n\n0\n\n25\n\n50\n\n0 100 200 300 400 500 600 700 800 900 1000\n?70\n\n?35\n\n0\n\n35\n\n70\n\n0 100 200 300 400 500 600 700 800 900 1000\n?1000\n\n?500\n\n0\n\n500\n\n1000\n\nRun Number\n\nR\nol\n\nl \n(m\n\nra\nd)\n\nP\nit\nch\n\n (\nm\nra\n\nd)\nY\n\naw\n (\n\nm\nra\n\nd)\n\nFig. 12.9 Attitude errors\n\nruns are executed. In each run the nonlinear least squares process converges in\nexactly 5 iterations. This is rather remarkable considering the large error in the initial\nestimate! The MRP errors are also computed using Eq. (2.150). The inverse MRP is\ngiven by its negative. Thus, ?p is given by\n\n?p D\n?\n1 ? kOpk2\t ptrue ? ?1 ? kptruek2\t OpC 2ptrue ? Op\n\n1C kOpk2kptruek2 C 2ptrue ? Op\nThe attitude errors are computed by multiplying ?p by 4. Note that covariance of\nthe attitude errors, 16 ?2.HTH/?1, evaluated at the true values, is equivalent to\nEq. (5.113). A plot of the attitude errors along with their respective 3? bounds is\nshown in Fig. 12.9. This indicates that the nonlinear least squares approach provides\ngood estimates. Also, note that the yaw errors are an order of magnitude larger than\nthe roll and pitch errors. This is due to the small angle between the two body vectors.\n\nNonlinear least squares may not be suitable to locate the optimum estimate\nsince convergence is not guaranteed unless the a priori estimate is close to the\noptimum value. The gradient search method [22, 26] overcomes this difficulty by\nadjusting the estimate so that the search direction is always along the negative\ngradient of J.Ox/. However, this method has been known to converge slowly as\nthe solution approaches the minimum J.Ox/. The Levenberg-Marquardt algorithm\n[16] overcomes both the difficulties of the standard differential correction approach\nwhen an accurate initial estimate is not given, and the slow convergence problems\nof the method of steepest descent when the solution is close to minimizing the\n\n\n\n462 12 Review of Control and Estimation Theory\n\nnonlinear least squares loss function in Eq. (12.104). This algorithm performs an\noptimum interpolation between the differential correction, which uses a Taylor\nseries expansion, and the gradient method.\n\nIn the Levenberg-Marquardt algorithm, Eq. (12.111) is modified so that the\niteration equation is given by\n\n?x D ?HTR?1H C ?R??1 HTR?1?yc (12.114)\n\nwhere ? is a scaling factor and R is a diagonal matrix with entries given by the\ndiagonal elements of HTR?1H . By using the algorithm in Eq. (12.114) the search\ndirection is actually intermediate between the steepest descent and the differential\ncorrection direction. As ? ! 0, Eq. (12.114) is equivalent to the differential\ncorrection method; however, as ? ! 1 Eq. (12.114) reduces to a steepest descent\nsearch along the negative gradient of J .\n\n12.3.6 Advantages and Disadvantages\n\nLinear batch estimators are simple to design and implement provided that the system\ncan be represented accurately using linear observation models. A major advantage\nof the linear batch estimator is that the error covariance can be found without using\nactual observations. A disadvantage of batch estimators is that the n ? n matrix,\nwhich must be inverted, may be ill-conditioned. This problem occurs frequently\nwhen the observability of the system is low. This problem can be alleviated by using\nmatrix square-root or factorization methods, such as a Cholesky decomposition\nwhich factors a symmetric matrix into the product of a lower triangular matrix and\nits transpose. Also, a large number of observations may be required to improve\nthe accuracy of the estimate, which may substantially increase computer storage.\nSequential estimators have certain advantages since the inverse of an n ? n matrix\ncan be reduced to a scalar inverse, and since the estimate is found sequentially\ncomputer storage can be kept to a minimum. However, convergence of sequential\nmethods cannot always be guaranteed (especially for bad initialization parameters),\nand erroneous observations cannot easily be disregarded.\n\n12.3.7 State Estimation Techniques\n\nThe least-square methods shown previously apply to \u201cstatic\u201d estimation problems.\nWhen an estimate of a varying state is required, \u201cdynamic\u201d methods must be used.\nThe most common technique for state estimation using dynamic models is the\nKalman filter [11]. The term \u201cfilter\u201d is used since it not only estimates dynamic\nstates, but filters noisy processes. The Kalman filter is a sequential process, but\n\n\n\n12.3 Estimation Theory 463\n\ncan also estimate for constant variables as least-squares methods do. However,\nthe essential feature of the Kalman filter is the utilization of state models for\ndynamic propagation. In addition, the Kalman filter compensates for dynamic model\ninaccuracy by incorporating a noise term (commonly known as process noise), that\ngives the filter a fading memory. So, each observation has a gradually diminishing\neffect on future state estimates.\n\nThe Kalman filter satisfies an optimality criterion which minimizes the trace\nof the covariance of the estimate error between the state estimates and true\nstate quantities. Statistical properties of the process noise and measurement error\nare used to design an optimal filter. This section introduces the fundamental\nequations used in a Kalman filter. The linear Kalman filter is first shown in order\nto introduce the fundamental concepts. The steady-state case is also shown for\nautonomous system models. The more useful formulation for attitude and orbit\nestimation is the nonlinear Kalman filter (also known as the extended Kalman filter),\nwhich incorporates nonlinear dynamic and/or observation models. Divergence and\npractical considerations are also discussed.\n\n12.3.7.1 Linear Kalman Filter\n\nThe linear Kalman filter development begins by assuming a truth model using the\nlinear dynamic model in Eq. (12.18) appended with a noise term, given by\n\nPxtrue D F xtrue C BuCGw (12.115)\n\nwhere w is a zero-mean p ? 1 Gaussian white-noise process vector with spectral\ndensity Q, and G is an n ? p process noise distribution matrix. If we ignore the\nmeasurement for now, then the \u201cpropagated\u201d estimated state, Ox, follows\n\nPOx D F OxC Bu (12.116)\n\nNext, a residual error is defined between the true state in Eq. (12.115) and the\nestimated state in Eq. (12.116):\n\n? ? xtrue ? Ox (12.117)\n\nTaking the time derivative of Eq. (12.117) leads to\n\nP? D F ?CGw (12.118)\n\nThe covariance of the residual error:\n\nP ? Ef??T g (12.119)\n\n\n\n464 12 Review of Control and Estimation Theory\n\nobeys the equation4\n\nPP D Ef? P?T g CEfP??T g D F P C P F T CGQGT (12.120)\n\nwhich is solved for P.t/ with initial condition P.t0/ D P0. Equations (12.116)\nand (12.120) define the propagated system for the estimated dynamic model and\nassociated error covariance.\n\nIn general the measurements are discrete, which are modeled by\n\nyk D Hkxtruek C vk (12.121)\n\nwhere vk is am?1 zero-mean Gaussian white-noise process vector with covariance\nRk . A discrete \u201cupdate\u201d equation is required to process the measurements. This is\nvery similar to the sequential least-squares problem. The linear discrete-time update\nequation is given by\n\nOxCk D Ox?k CKk\u0152yk ?Hk Ox?k ? (12.122)\n\nwhere the superscripts ? and C denote the discrete times just before and after\na discrete measurement update, respectively, i.e. Ox?k comes from the propagated\nestimate using Eq. (12.116). Also, the subscript k denotes the variable at time tk .\nThe updated covariance expression is given by computing\n\nPCk ? E\nn?\n\nxtruek ? OxCk\n\t ?\n\nxtruek ? OxCk\n\tT o\n\n(12.123)\n\nSubstituting Eqs. (12.121) and (12.122) into (12.123), and performing this expecta-\ntion leads to\n\nPCk D \u0152I ?KkHk?P?k \u0152I ?KkHk?T CKkRkKTk (12.124)\n\nwhere P?k is given from the propagated system by Eq. (12.120). Note that\nEq. (12.124) is valid for any gain Kk . Also note that it is equivalent to Eq. (12.91),\nexcept that the propagated P?k is used. The optimal gain is determined by\nminimizing the trace of the updated covariance:\n\nJk D trPCk (12.125)\n\nPerforming this minimization leads to a gain that is identical to the sequential least-\nsquares problem:\n\nKk D P?k HTk \u0152HkP?k HTk CRk??1 (12.126)\n\n4This follows formally from Ef?wT g D 1\n2\nGQ, but there are more rigorous derivations [4].\n\n\n\n12.3 Estimation Theory 465\n\nTable 12.1 Continuous-discrete linear Kalman filter\n\nModel Pxtrue D F xtrue C Bu CGw; where w \t N.0;Q/\nyk D Hxtruek C vk; where vk \t N.0; Rk/\n\nInitialize Ox.t0/ D Ox0\nP.t0/ D P0\n\nPropagation POx D F Ox C Bu\nPP D F P C P F T CGQGT\n\nGain Kk D P?k HTk \u0152HkP?k HTk CRk??1\nUpdate OxCk D Ox?k CKk\u0152yk ?Hk Ox?k ?\n\nP\nC\n\nk D \u0152I ?KkHk?P?k\n\nSubstituting Eq. (12.126) into Eq. (12.124) gives\n\nPCk D \u0152I ?KkHk?P?k (12.127)\n\nThis the preferred form for the covariance update, but the Joseph form in\nEq. (12.124) can still be used with the gain in Eq. (12.126) when numerical\ninstabilities are a concern.\n\nA summary of the continuous-discrete linear Kalman filter is shown in\nTable 12.1, where N.0;Q/ denotes a Gaussian distribution with zero mean and\nspectral density Q for continuous-time systems, and N.0; Rk/ denotes a Gaussian\ndistribution with zero mean and covariance Rk for discrete-time systems. The filter\nis first initialized using knowledge of the initial state, Ox0, and error covariance, P0.\nThen the state and error covariance are updated using the measured observation.\nFinally, the state dynamic model and associated error covariance are propagated\nusing the updated values to the next discrete measurement time.\n\nThe Kalman filter shown in Table 12.1 can be used with time-varying model\nmatrices. However, if the model is autonomous a steady-state expression for the\nerror covariance can be used. This is due to the fact that the covariance usually\nconverges rapidly for this case. Also, for a large class of problems the discrete-time\nversion of the dynamic model in Eq. (12.115) is usually quite adequate, given by\n\nxtruekC1 D ?kxtruek C ?kuk C $kwk (12.128)\n\nwhere wk is a p ? 1 zero-mean Gaussian white-noise process vector with covari-\nance Qk . The propagation estimate is simply given by\n\nOx?kC1 D ?k OxCk C ?kuk (12.129)\n\nCombining (12.129) with (12.122) gives, for the post-update state estimates,\n\nOxkC1 D ?k Oxk C ?kuk CKkC1\u0152ykC1 ?HkC1.?k Oxk C ?kuk/? (12.130)\n\n\n\n466 12 Review of Control and Estimation Theory\n\nwhere the superscript C on the state estimates is understood. The pre-update\ncovariance is needed to compute the Kalman gain. The discrete-time covariance\npropagation is given by [13]\n\nP?kC1 D ?kPCk ?Tk C $kQk$ Tk (12.131)\n\nCombining the discrete error covariance propagation (12.131) and update equa-\ntion (12.127) gives\n\nPkC1 D ?kPk?Tk ? ?kPkHTk \u0152HkPkHTk CR??1HkPk?Tk C $kQk$ Tk (12.132)\n\nwhere the superscript ? on the covariances is understood. If the system is\nautonomous, then the following steady-state equation can be used to find P :\n\nP D ?P?T ? ?PHT \u0152HPHT CR??1HP?T C $Q$ T (12.133)\n\nwhich is known as the discrete algebraic Riccati equation. The solution to\nEq. (12.133) is given by forming a 2n ? 2n Hamiltonian matrix\n\nH ?\n?\n\n??T ??THTR?1H\n$ Q$ T??T ? C $ Q$ T??THTR?1H\n\n?\n(12.134)\n\nwhich can be shown to have n stable eigenvalues (inside the unit circle) and\nn reciprocal unstable eigenvalues [4]. The eigenvectors of Eq. (12.134) are then\npartitioned into n ? n submatrices:\n\nV D\n?\nV11 V12\nV21 V22\n\n?\n(12.135)\n\nwhere V11 and V21 contain the eigenvectors corresponding to the unstable eigen-\nvalues, and V12 and V22 contain the eigenvectors corresponding to the stable\neigenvalues. The steady-state solution for P is found by using V11 and V21\n\nP D V21V ?111 (12.136)\n\nTherefore, the gain in Eq. (12.126) is now constant. Other efficient methods for the\nsolution of the Eq. (12.133) are shown in [1]. The steady-state discrete-time Kalman\nfilter is summarized in Table 12.2.\n\n12.3.7.2 Extended Kalman Filter\n\nA large class of orbit and attitude estimation problems involve nonlinear models.\nFor several reasons, state estimation for nonlinear systems is considerably more\n\n\n\n12.3 Estimation Theory 467\n\nTable 12.2 Discrete and autonomous linear Kalman filter\n\nModel xtruekC1 D ?xtruek C ? uk C $wk; where wk \t N.0;Q/\nyk D Hxtruek C vk; where vk \t N.0; R/\n\nInitialize Ox.t0/ D Ox0\nCovariance P D ?P?T ? ?PHT \u0152HPHT CR??1HP?T C $Q$ T\nGain K D PHT \u0152HPHT CR??1\nEstimate OxkC1 D ? Oxk C ? uk CK\u0152ykC1 ?H.? Oxk C ? uk/?\n\nTable 12.3\nContinuous-discrete extended\nKalman filter\n\nModel Pxtrue D f.xtrue;u;w; t /; where w \t N.0;Q/\nyk D h.xtruek /C vk; where vk \t N.0; Rk/\n\nInitialize Ox.t0/ D Ox0\nP.t0/ D P0\n\nPropagation POx D f.Ox;u; t /\nPP D F P C P F T CGQGT\nF ? @f\n\n@x\n\n??\n??\nOx\n; G ? @f\n\n@w\n\n??\n??\nOx\n\nGain Kk D P?k HTk \u0152HkP?k HTk CRk??1\nHk ? @h\n\n@x\n\n??\n??\nOx?k\n\nUpdate OxCk D Ox?k CKk\u0152yk ? h.Ox?k /?\nP\n\nC\n\nk D \u0152I ?KkHk?P?k\n\ndifficult, and admits a wider variety of solutions than the linear problem [8]. Some\nof these problems are seen by considering the general nonlinear system model\n\nPxtrue D f.xtrue;u;w; t / (12.137)\n\nClearly, the probability density function of w is altered as it is transmitted through\nthe nonlinear elements. So, if the noise term cannot be linearly separated from this\nequation, then the simple covariance expression in Eq. (12.137) cannot be used,\nsince a Gaussian input causes a non-Gaussian response. Fortunately, a Kalman filter\ncan still be derived using nonlinear models. The extended Kalman filter, though not\nprecisely \u201coptimum,\u201d has been successfully applied to many nonlinear systems over\nthe past many years. The fundamental concept of this filter involves the notion that\nthe true state is sufficiently close to the estimated state. Therefore, the error dynam-\nics can be represented fairly accurately by a linearized first-order Taylor series\nexpansion, given by Eq. (12.30). The extended Kalman filter uses the full nonlinear\ndynamic equation for model propagation, but uses the same linear correction as the\nlinear Kalman filter. Also, the nominal values are replaced by the current estimates\nin the filter propagation. This allows the extended Kalman filter to compute the gain\nmatrix online, as opposed to pre-computing a gain matrix sequence. A summary of\nthe extended Kalman filter algorithm is shown in Table 12.3.\n\n\n\n468 12 Review of Control and Estimation Theory\n\n12.3.7.3 Smoothing\n\nA batch version of both the linear and extended Kalman filters is useful for\nsignificantly smoothing noisy processes. Smoothing problems general fall into\nthree cases. The fixed-point smoother seeks an estimate at a single fixed point\nin time, while the observations continue ahead of the estimation. The fixed-lag\nsmoother seeks an estimate at a fixed length of time back in the past. The fixed-\ninterval smoother uses a fixed time interval of observations, and seeks estimates at\nsome or all of the interior points. This is the most common smoother for batch\nestimation. An example of such a smoother is the Rauch-Tung-Striebel (RTS)\noptimal smoother [23]. This smoother essentially processes the observation first\nforward in time and then backwards in time. The forward estimates are given by\nthe Kalman filter. The backwards process is initialized using the final time forward\nestimates:\n\nOxsN D OxCN (12.138a)\nPsN D PCN (12.138b)\n\nwhere the subscript s denotes the smoothed quantity. The RTS smoothed estimates\nand covariance are computed using\n\nKk ? PCk ?Tk .P?kC1/?1 (12.139a)\nOxsk D OxCk CKk.OxskC1 ? Ox?kC1/ (12.139b)\n\nPsk D PCk ?Kk.P?kC1 ? PskC1 /K Tk (12.139c)\n\nNote that storage of the forward estimates, state matrices, and covariance is required,\nbut storage of the measurements is not required. The advantages of smoothing\nalgorithms is that the resulting error covariance is always less than either the forward\nor backward process alone. However, smoothing algorithms cannot be implemented\nfor realtime application.\n\n12.3.7.4 Stability and Performance\n\nThe linear and autonomous Kalman filter is known to be extremely stable (i.e. the\nestimates will not diverge from the true values), and provides accurate estimates\nunder the properly defined conditions. However, the stability of the extended\nKalman filter must be properly addressed before on-board implementation. Many\nfactors affect filter stability for this case. One common problem is in the error\ncovariance update and propagation, which may become non-positive definite chiefly\ndue to numerical instabilities. A measure of the potential for difficulty in an\nill-conditioned matrix can be found by using the condition number [27]. This\nproblem may be overcome by using the Joseph form (shown previously) or by\n\n\n\n12.3 Estimation Theory 469\n\nusing matrix square root or factorization methods. Square root methods guarantee\npositive definiteness, but typically require 50\u2013150 % more computational time than\nthat required by the standard Kalman filter [27]. A more efficient algorithm is given\nby the U-D filter, which factors the covariance matrix using\n\nP D U DUT D ?U D1=2? ?U D1=2?T (12.140)\n\nwhere U is an upper triangular matrix and D is diagonal. The gain matrix,\ncovariance propagation and update are given in terms of these matrices [2].\n\nFor filter performance, non-Gaussian measurement and process noise errors are\na major source of concern. Typically, in most real-world applications these error\nsources are indeed non-Gaussian. For example, consider the problem of estimating a\nspacecraft\u2019s attitude using magnetometer data. Flight data results have clearly shown\nthat the magnetic field measurements contain errors which are a function of orbit\nrate and higher harmonics [24]. This can severely degrade the filter\u2019s performance,\nsince this is typically assumed to be modeled by a Gaussian process. A possible\nsolution to these type of problems involves using a colored-noise filter [13], which\npre-filters (shapes) a Gaussian noise process to more accurately model actual\nmeasurement error processes. However, even if the Gaussian noise assumption is\ntrue, the proper values for the process and measurement covariances may not be\nstraightforward to choose. This leads to a process known as filter tuning, which\ninvolves adjusting the filter parameters to achieve the best possible estimation\nperformance, most often using actual measured observations. Filter tuning can be\nperformed off-line using numerical optimization techniques [22] or online using\nadaptive methods [10]. However, in practice manual optimization is more prevalent.\nA common procedure involves choosing small values for the measurement error\ncovariance (which puts more weight or reliance on the measurements) and then\nadjusting the process noise covariance and initial covariance to achieve a reasonable\nperformance level. Then, the tuning process is refined until the desired performance\nis achieved.\n\nThere are many other concerns to consider in the design and implementation of a\nKalman filter. For an extended Kalman filter the obvious question is: how accurate is\nthe linearized model? This is an aspect which must be addressed in order to design\nan accurate filter. For example, the quaternion kinematic model loses normalization\nin a straightforward linearization. Therefore, the physical nature of the model can\nbe lost. Also, the observability may vary from one time step to the next. This must\nbe addressed in order to check that observability can be obtained throughout the\norbit. If the Kalman filter is used in conjunction with a control system, then the\nfilter\u2019s convergence rate (i.e. when transients decay) can significantly affect the\ncontrol system\u2019s performance. This is usually accounted for during the initialization\nprocedure; however, the filter may lose \u201clock\u201d during mission mode and may need\nproper initialization before the control system is again invoked. All or part of these\nfactors need to be accounted early in the design (before actual operation) in order to\nreduce risk of failures due to inadequate filter performance.\n\n\n\n470 12 Review of Control and Estimation Theory\n\n12.3.8 Linear Covariance Analysis\n\nSoon after the development of the Kalman filter, it was recognized that the\ncovariance matrix can be computed without processing actual data, and that the\nresulting covariance is very useful for assessing the expected estimation errors\nresulting from candidate dynamic models and measurement strategies [6, 10].\nThis is the basic idea of linear covariance analysis, which executes only the\ncovariance initialization, covariance propagation, gain computation, and covariance\nupdate steps of Table 12.1. It has been widely employed during the development\nof attitude estimation systems, to determine the type of sensors required, their\nlocations, accuracy, and required data frequency, as well as the refinement required\nof dynamic models.\n\nThe number of parameters describing a dynamical system can be quite large, and\nit is often impractical to solve for all of them, especially in real-time applications.\nThus it can be important to consider the effect on estimation accuracy of errors\nin parameters that are unknown but not solved for. Reference [15] considers the\ngeneralization of linear covariance analysis to include such consider parameters,\nincluding references to the earlier literature.\n\nIf the models are state-dependent, as is usually the case, a nominal state trajectory\nis specified to evaluate the partial derivative matrices F ? @f=@x, G ? @f=@w, and\nHk ? @h=@x. In most cases, the nominal trajectory is also required to account for\nsensor occultation, star availability for star cameras, spacecraft attitude maneuvers,\nand similar effects. Note that, unlike the EKF, the nominal state trajectory is\nspecified at the outset of the analysis and is not affected by the filter equations.\n\n12.3.9 Separation Theorem\n\nOftentimes a full-state controller is used in the controller. However, just as often\nall states in a system cannot be measured from sensors. Thus, an estimator is used\nin concert with a controller, which provides the full state information required in\nthe controller. For example, in the inverted pendulum derived at the beginning of\nthis chapter only measurements of position and angle may be provided, and these\nalong with their derivatives are estimated by the Kalman filter to provide full state\nknowledge to a controller. A natural question arises: how does the dynamics of\neither the controller or the estimator affect the dynamics of the overall (combined)\ncontroller/estimator system?\n\nFirst, a description of the closed-loop system is provided. Here only linear and\nautonomous systems are considered. Also, only the regulation case is considered\nwhere the goal is to drive the true states to zero. A controller with full state feedback\nis given by u D ?Lxtrue, where L is a constant gain. Substituting this expression\ninto Eq. (12.21) with the definition xtrue ? x gives\n\nPxtrue D .F ? BL/xtrue (12.141)\n\n\n\n12.3 Estimation Theory 471\n\nThe closed-loop controller dynamics are given by eigenvalues of .F ? BL/. The\ncontrol gain, L, is chosen to give some desired closed-loop response. Now consider\nthe continuous-time version of the Kalman filter estimate equation, given by\n\nPOx D F OxCK.y ?H Ox/ (12.142)\n\nAssuming no noise on y, so that y D Hxtrue, then the error dynamics of the\nestimator, defined by Eq. (12.117), are given by\n\nP? D .F ?KH/? (12.143)\n\nThe error dynamics of the estimator are given by eigenvalues of F?KH . In practice\nthe control input uses the estimated states, with\n\nu D ?LOx (12.144)\n\nSubstituting Ox D xtrue ? ? into (12.144), and then substituting the resultant into\nEq. (12.21) leads to\n\nPxtrue D .F ? BL/xtrue C BL? (12.145)\n\nHence, the closed-loop dynamics of the overall controller/estimator system are\ngiven by\n\n?Pxtrue\nP?\n?\nD\n?\nF ? BL BL\n0n?n F ?KH\n\n? ?\nxtrue\n\n?\n\n?\n(12.146)\n\nSince the matrix in Eq. (12.146) is block-triangular, its eigenvalues are given by the\neigenvalues of F?BL and F?KH . This shows that the overall controller/estimator\nsystem can be designed by separating the estimator from the controller, which is\nexactly the separation theorem. A block diagram of the overall controller/estimator\nsystem is shown in Fig. 12.10.\n\nExample 12.5. In this example a linear Kalman filter is used to estimate for the\nstates of the inverted pendulum. A full state controller is then used to bring the\npendulum to its zero (vertical) position. The following parameters are used for the\nmodel: M D 2 kg, m D 0:1 kg, ` D 0:1 m, and c D 2 Ns/m. Note that this\nsystem is unstable. The continuous-time system is converted to discrete-time using\na sampling interval of 0:01 s. The discrete-time system matrices are given by\n\n? D\n\n2\n664\n\n1 ?3:8687 ? 10?2 9:9485 ? 10?3 ?1:2597 ? 10?4\n0 1:3910 3:9241 ? 10?4 1:1273 ? 10?2\n0 ?8:1945 9:8924 ? 10?1 ?3:8687 ? 10?2\n0 82:860 8:3117 ? 10?2 1:3910\n\n3\n775\n\n\n\n472 12 Review of Control and Estimation Theory\n\nK L\n\nB\n\nF\n\nH\n\nx?\nB\n\nF\nH\n\nxtrue\n\nState\nEstimator\n\nSystem\nDynamics \n\nFig. 12.10 Overall controller/estimator system\n\n? D\n\n2\n664\n\n2:5761 ? 10?5\n?1:9620 ? 10?4\n5:3794 ? 10?3\n?4:1558 ? 10?2\n\n3\n775\n\nThe true and estimated initial states and the initial covariance are given by\n\nxtrue.t0/ D Ox.t0/ D\n?\n0 .10\n=180/ 0 0\n\n?T\n\nP0 D\n\n2\n664\n\n.1 ? 10?4/2 0 0 0\n0 .0:15\n=180/2 0 0\n\n0 0 0:12 0\n\n0 0 0 .0:1\n=180/2\n\n3\n775\n\nThe estimated initial and true states are equal, which is generally not true in practice.\nIt is assumed here that the filter has converged before the controller is enabled\nso that the estimated states will be close to their respective true states and small\nvalues in P0 are appropriate. The outputs are position and angle. Measurements are\ngenerated using a zero-mean Gaussian white-noise process with standard deviations\nof 0:001 m for position and 0:001\n=180 rad for the angle. The state matrices for\nthe estimate are the same as the truth so no process noise is required. The Kalman\nfilter provides estimates for position, velocity, angle, and angular rate for use in the\ncontroller.\n\nThe controller is given by uk D ?LOxk . The control gain, L, is chosen to stabilize\nthe system within 1 s. This is achieved by:\n\nL D ??8:2701 ?2:1249 ? 103 ?5:3521 ?18:386?\n\n\n\nReferences 473\n\n0 0.2 0.4 0.6 0.8 1 1.2 1.4 1.6 1.8 2\n?5\n\n0\n\n5\n\n10\n\nA\nng\n\nle\n (\n\nD\neg\n\n)\n\nTime (Sec)\n0 0.2 0.4 0.6 0.8 1 1.2 1.4 1.6 1.8 2\n\n?0.1\n\n0\n\n0.1\n\n0.2\n\n0.3\n\n0.4\n\n0.5\n\nP\nos\n\nit\nio\n\nn \n(m\n\n)\n\nTime (Sec)\n\na b\n\nFig. 12.11 Controlled response of the inverted pendulum. (a) Angle. (b) Position\n\nFigure 12.11a shows a plot of the controlled pendulum angle response. The angle\nstarts at 10? and then swings to the other side, finally coming to a near resting point\nof zero. Small oscillations are present at steady state, which are due to the noise\nin the state estimates. A plot of the controlled cart position response is shown in\nFig. 12.11b. The cart starts at its initial resting point of zero and then returns to that\nsame point once the pendulum is stabilized.\n\nReferences\n\n1. Arnold, W.F., Laub, A.J.: Generalized eigenproblem algorithms and software for algebraic\nRiccati equations. Proc. IEEE 72(12), 1746\u20131754 (1984)\n\n2. Bierman, G.J.: Factorization Methods for Discrete Sequential Estimation. Academic Press,\nOrlando (1977)\n\n3. Chen, C.T.: Linear System Theory and Design. Holt, Rinehart and Winston, New York (1984)\n4. Crassidis, J.L., Junkins, J.L.: Optimal Estimation of Dynamic Systems, 2nd edn. CRC Press,\n\nBoca Raton (2012)\n5. Dorf, R.C., Bishop, R.H.: Modern Control Systems. Addison Wesley Longman, Menlo Park\n\n(1998)\n6. Fagin, S.L.: Recursive linear regression theory, optimal filter theory, and error analysis of\n\noptimal systems. In: 1964 IEEE International Convention Record, pp. 216\u2013240 (1964)\n7. Franklin, G.F., Powell, J.D., Workman, M.: Digital Control of Dynamic Systems, 3rd edn.\n\nAddison Wesley Longman, Menlo Park (1998)\n8. Gelb, A. (ed.): Applied Optimal Estimation. MIT Press, Cambridge (1974)\n9. Golub, G.H., Van Loan, C.F.: Matrix Computations, 3rd edn. The Johns Hopkins University\n\nPress, Baltimore (1996)\n10. Jazwinski, A.H.: Stochastic Processes and Filtering Theory. Academic Press, New York (1970)\n11. Kalman, R.E., Bucy, R.S.: New results in linear filtering and prediction theory. J. Basic Eng.\n\n95\u2013108 (1961)\n12. LePage, W.R.: Complex Variables and the Laplace Transform for Engineers. Dover Publica-\n\ntions, New York (1980)\n\n\n\n474 12 Review of Control and Estimation Theory\n\n13. Lewis, F.L.: Optimal Estimation with an Introduction to Stochastic Control Theory. Wiley,\nNew York (1986)\n\n14. Lizarralde, F., Wen, J.T.Y.: Attitude control without angular velocity measurement: A passivity\napproach. IEEE Trans. Automat. Contr. 41(3), 468\u2013472 (1996)\n\n15. Markley, F.L., Carpenter, J.R.: Generalized linear covariance analysis. J. Astronaut. Sci.\n57(1 & 2), 233\u2013260 (2009)\n\n16. Marquardt, D.W.: An algorithm for least-squares estimation of nonlinear parameters. J. Soc.\nInd. Appl. Math. 11(2), 431\u2013441 (1963)\n\n17. Maybeck, P.S.: Stochastic Models, Estimation, and Control, vol. 1. Academic Press, New York\n(1979)\n\n18. Moler, C., van Loan, C.: Nineteen dubious ways to compute the exponential of a matrix. SIAM\nRev. 20(4), 801\u2013836 (1978)\n\n19. Palm, W.J.: Modeling, Analysis, and Control of Dynamic Systems, 2nd edn. Wiley, New York\n(1999)\n\n20. Phillips, C.L., Nagle, H.T.: Digital Control System Analysis and Design, 2nd edn. Prentice\nHall, Englewood Cliffs (1990)\n\n21. Psiaki, M.L., Martel, F., Pal, P.K.: Three-axis attitude determination via Kalman filtering of\nmagnetometer data. J. Guid. Contr. Dynam. 13(3), 506\u2013514 (1990)\n\n22. Rao, S.S.: Engineering Optimization: Theory and Practice, 3rd edn. Wiley, New York (1996)\n23. Rauch, H.E., Tung, F., Striebel, C.T.: Maximum likelihood estimates of linear dynamic\n\nsystems. AIAA J. 3(8), 1445\u20131450 (1965)\n24. Sedlack, J., Hashmall, J.: Accurate magnetometer/gyroscope attitudes using a filter with cor-\n\nrelated sensor noise. In: Proceedings of the Flight Mechanics/Estimation Theory Symposium,\npp. 293\u2013303. NASA-Goddard Space Flight Center, Greenbelt (1997)\n\n25. Slotine, J.J.E., Li, W.: Applied Nonlinear Control. Prentice Hall, Englewood Cliffs (1991)\n26. Sorenson, H.W.: Parameter Estimation, Principles and Problems. Marcel Dekker, New York\n\n(1980)\n27. Stengel, R.F.: Optimal Control and Estimation. Dover Publications, New York (1994)\n28. Z?ak, S.H.: Systems and Control. Oxford University press, New York (2003)\n\n\n\nAppendix: Computer Software\n\nAll of the examples shown in the text have been programmed and simulated using\nMATLAB R\n. A website of these programs, listed by chapter, can be found at\n\nhttp://www.buffalo.edu/~johnc/space_book.htm\n\nFor general information regarding MATLAB or related products, please consult\nMathWorks, Inc. at\n\nhttp://www.mathworks.com\n\nIt has been our experience that to thoroughly understand the intricacies of a\nsubject matter in this text, one must learn from basic fundamentals first. Although\ncomputer routines can provide some insights to the subject, we feel that they may\nhinder rigorous theoretical studies that are required to properly comprehend the\nmaterial. Therefore, we strongly encourage students to program their own computer\nroutines, using the codes provided from the website for verification purposes only.\nWe have decided not to include a disk of programs with the text so that up-to-date\nversions of the computer programs can be maintained on the website. The programs\nhave been written so that anyone with even a terse background in MATLAB should\nbe able to comprehend the relationships between the examples in the text and the\ncoded scripts. We hope that the reader will use these programs in the spirit that they\nare given; to supplement their reading and understanding of the material in printed\ntext in order to bridge the gap between theoretical studies and practical applications.\n\nLimit of Liability/Disclaimer of Warranty: The computer programs are provided\nas a service to readers. While the authors have used their best efforts in preparing\nthese programs, they make no representation or warranties with respect to the\naccuracy or completeness of the programs. The book publisher (Springer), the\nauthors, the authors\u2019 employers, or MathWorks, Inc. shall not be liable for any loss\nof profit or any other commercial or noncommercial damages, including, but not\nlimited to, special, incidental, consequential, or other damages.\n\nF.L. Markley and J.L. Crassidis, Fundamentals of Spacecraft Attitude Determination\nand Control, Space Technology Library 33, DOI 10.1007/978-1-4939-0802-8,\n\u00a9 Springer Science+Business Media New York 2014\n\n475\n\nhttp://www.buffalo.edu/~johnc/space_book.htm\nhttp://www.mathworks.com\n\n\nIndex\n\nA\nA Train, 397\nActive and Passive Transformations, 26, 42\nAdvanced Composition Explorer (ACE), 401\nAlbedo, 109, 133, 391\nAlgebraic Method, see TRIAD\nAlias and Alibi, see Active and Passive\n\nTransformations\nAlonso, Roberto, 269\nAngular Momentum, 67, 77, 140, 173, 323\n\nConservation, 111\nSpecific, see Specific Angular Momentum\n\nAngular Velocity, 68, 323, 356\nApogee, see Ellipse Geometry, Apoapsis\nApollo, 2\nAqua, 397\nAsymptotic Stability, see Control Theory,\n\nAsymptotic Stability\nAtmospheric Density, 108, 389, 394, 406\n\nExponential Model, 406\nScale Height, 406\n\nGOST Model, 408\nHarris-Priester Model, 407\nJacchia Model, 408\nJacchia-Bowman Model, 409\n\nBarometric Equation, 415\nDensity Correction Factors, 418\nDiffusion Equation, 416\nHigh Altitude Density Correction, 419\nSeasonal-Latitudinal Variation, 419\nSemiannual Variation, 418\nTemperature Profile, 409\n\nJacchia-Roberts Model, 408\nAtmospheric Drag, 107, 389\n\nBallistic Coefficient, 390, 394\nDrag Coefficient, 108, 389, 394\n\nAttitude Control, 1, 4, 6, 14, 287\n\nControl Moment Gyros, 8\nEffects of Noise, 312\nHysteresis-Based Switching, 315\nMagnetic Torque, 307, 324\n\nB-dot, 309\nDetumbling, 308\nMomentum Dumping, 6, 8, 107, 307,\n\n311\nReaction Wheels, 8, 291, 296, 332\nRegulation, 289\nSafehold, 4, 11, 13\nSAMPEX, see SAMPEX Attitude Control\nSingle Axis, 438\nThrusters, 8, 303\n\nInitial Acquisition, 303\nMomentum Dumping, 8, 303\nPulse-Width Pulse-Frequency, 303\nSafehold, 303\n\nTracking, 294\nAttitude Determination, 1, 183\n\nFisher Information Matrix, 212\nGPS, 137\nMaximum Likelihood Estimation, 208\nTRIAD, see TRIAD\nWahba\u2019s Problem, see Wahba\u2019s Problem\n\nAttitude Dynamics, 67, 77, 83\nAttitude Error Representations, 59\n\nKalman Filtering, 239\nKinematics, 76\n\nAttitude Estimation, 1, 235, 240\nAttitude Representations, 236\n\nAdditive Quaternion, 237\nMultiplicative Quaternion, 239\nThree-Component, 236\n\nDiscrete-Time Propagation, 251\nEffect of Orbit Errors, 216\nFarrenkopf\u2019s Steady-State Analysis, 263\n\nF.L. Markley and J.L. Crassidis, Fundamentals of Spacecraft Attitude Determination\nand Control, Space Technology Library 33, DOI 10.1007/978-1-4939-0802-8,\n\u00a9 Springer Science+Business Media New York 2014\n\n477\n\n\n\n478 Index\n\nAttitude Estimation (cont.)\nGyro Calibration Kalman Smoother, 246\nKalman Filter Formulation, 240\n\nMeasurement Sensitivity Matrix, 241,\n249, 353\n\nMeasurement Update, 241\nPropagation, 244\nReset, 242\n\nMission Mode Kalman Filter, 257\nMurrell\u2019s Version, 260\n\nAttitude Kinematics, 67, 68, 83\nAttitude Matrix, 40\n\nKinematics, 68\nAura, 398\nAxisymmetric, 87\n\nB\nB-dot Control, see Attitude Control, Magnetic\n\nTorque, B-dot\nbac?cab Rule, 372\nBaker, Dan, 328\nBallistic Coefficient, see Atmospheric Drag,\n\nBallistic Coefficient\nBar-Itzhack, Itzhack, 3\nBarba, Peter, 14\nBeletsky, Vladimir, 6\nBlack, Harold, 2\nBody Cone, 93\nBoltzmann Constant, 111\nBond Number, 103\nBradley, James, 130\nBrouwer, Kirk, 393\n\nC\nCauchy-Schwarz Inequality, 22\nCayley Transform, 50\nCayley-Hamilton Theorem, 60, 190\nCenter of Mass, 77\nCentripetal Acceleration, 70, 400\nCertainty Equivalence Principle, 312\nCloud-Aerosol Lidar and Infrared Pathfinder\n\nSatellite Observations (CALIPSO),\n397\n\nCloudSat, 397\nCohen, Clark, 137\nComputer Software, 475\nCondition Number, 468\nConic Section, 373\nConing, 85\nControl Moment Gyros, 100, 166\n\nSingle-Gimbal, 166\nSingular Configurations, 167\n\nVariable-Speed, 166\nControl Theory, 437\n\nFeedback Linearization, 446\nAsymptotic Stability, 290\nClosed-Loop, 288, 438\nCritical Damping, 439\nDamped Natural Frequency, 439\nDamping Ratio, 439\nEquilibrium Point, 290, 313, 442\nH1, 288\nLinear, 437\nLyapunov Equation, 444\nLyapunov Function, 288, 290, 309, 313,\n\n445\nLyapunov\u2019s Direct Method, 290, 442\nLyapunov\u2019s Linearization Method, 442\nNatural Frequency, 439\nNonlinear, 442\n\nStability, 442\nOpen-Loop, 287\nProportional-Derivative, 439\nProportional-Integral-Derivative, 332, 336,\n\n439, 441\nRobustness, 288, 296, 313\nSliding-Mode, 288, 295, 444\n\nBoundary Layer, 296, 447, 448\nChattering, 295, 447\nEquivalent Control, 295, 447\nReaching Phase, 445\nSliding Phase, 445\nSliding Surface, 295, 445\n\nCoriolis Acceleration, 70, 401\nCovariance, 184, 204\u2013209, 216, 270, 273, 274,\n\n453, 456, 458, 463\u2013466\nAnalysis, 201, 263, 470\nDiscrete-Time, 258\n\nCrassidis, Agamemnon, 444\nCritical Damping, see Control Theory, Critical\n\nDamping\nCross Product, see Vector, Cross Product\nCryogenic Infrared Spectrometers\n\nand Telescopes for the\nAtmosphere/Shuttle Pallet\nSatellite (CRISTA-SPAS), 137\n\nCubeSat, 5\n\nD\nDamped Natural Frequency, see Control\n\nTheory, Damped Natural Frequency\nDamping Ratio, see Control Theory, Damping\n\nRatio\nDanby, John, 398\n\n\n\nIndex 479\n\nDavenport\u2019s K Matrix, see Wahba\u2019s Problem,\nDavenport\u2019s K Matrix\n\nDavenport, Paul, 2, 52, 187, 199, 352\nDeadband, 303\nDeBra-Delp Region, 117\nDefense Meteorological Satellite Program\n\n(DMSP), 11, 135\nDirac Delta Function, 144\nDirection Cosine Matrix (DCM), see Matrix,\n\nDirection Cosine Matrix (DCM)\nDiscrete-Time Systems, 434\n\nState Space, 436\nZero-Order Hold, 435\n\nDodge, Franklin, 102\nDot Product, see Vector, Dot Product\nDowning, John, 155\nDuty Cycle, 304, 305\n\nE\nEarth Geoid, 34\n\nEquatorial Radius, 34, 388\nFlattening, 34\nPolar Radius, 34\nWorld Geodetic System, 34, 139\n\nEarth Sensor, see Horizon Sensor\nEarth Sensor Assembly, see Horizon Sensor\nEarth-Pointing Spacecraft, 55\n\nDynamics, 112\nEcho, 3\nEclipse Conditions, 422\nEigenvalues, see Matrix, Eigenvalues and\n\nEigenvectors\nEigenvectors, see Matrix, Eigenvalues and\n\nEigenvectors\nEllipse Geometry, 229, 365\n\nApoapsis, 368\nDirectrix, 367\nEccentricity, 367\nFocus, 366\nPeriapsis, 368\nPolar Coordinates, 368\nSemilatus Rectum, 368, 369, 372, 374\nSemimajor Axis, 365\nSemiminor Axis, 365\n\nElliptic Orbit, 373\nEnvironment Models, 403\nEphemeris, 420\n\nMoon, 422\nPlanets, 422\nSun, 420, 422\n\nEquatorial Radius, see Earth Geoid, Equatorial\nRadius\n\nEscape Velocity, 374\n\nESOQ, 194\nESOQ2, 195\nEstimation Theory, 448\n\nAdvantages and Disadvantages, 462\nBatch Least Squares, 451\nColored-Noise Filter, 469\nCovariance Recursion Form, 453\nEfficient Estimator, 207, 213, 456\nError-Covariance Matrix, 453\nExpectation, 452\nExtended Kalman Filter, 2, 14, 235, 239,\n\n466\nKalman Filter, 2, 323, 450, 463\n\nPropagation, 463, 464\nUpdate, 464\n\nLevenberg-Marquardt, 461\nMaximum Likelihood, 454\n\nAsymptotically Efficient, 455\nAsymptotically Gaussian, 455\nCram\u00e9r-Rao Inequality, 455\nInvariance Principle, 455\nLikelihood Function, 454\n\nMeasurement Error, 451\nNonlinear Least Squares, 456\nProbability Density Function, 454\nResidual Error, 451, 452, 456, 463\nRTS Smoother, 468\nSequential Least Squares, 453\nSmoothing, 468\nSquare Root Filter, 469\nStability and Performance, 468\nStatic-Based and Filter-Based, 449\nTruth, 451\nUnbiased Estimate, 237, 452\n\nEuclidean Matrix Norm, see Matrix, Frobenius\nNorm\n\nEuler Angles, 2, 52, 112, 361, 375\nKalman Filtering, 236\nKinematics, 73, 297, 361\n\nEuler Axis/Angle, 41, 197\nEuler Symmetric Parameters, see Quaternion\nEuler\u2019s Equation, 79\nEuler\u2019s Rotational Equation, 84, 289\nEuler\u2019s Theorem, 40\nEuler, Leonhard, 40\nEuler-Rodrigues Parameters, see Quaternion\nExplorer, 88\nExtended Kalman Filter, see Estimation\n\nTheory, Extended Kalman Filter\n\nF\nFar Ultraviolet Spectroscopy Explorer (FUSE),\n\n147\n\n\n\n480 Index\n\nFarrell, James, 2, 183, 196\nFarrenkopf\u2019s Model, 176, 267\nFarrenkopf, Robert, 263\nFinal Value Theorem, 440\nFinite Element Methods, 99\nFisher Information Matrix, 207, 455\nFisher, Ronald, 454\nFlat Spin, 88\nFlatley, Thomas W., 325\nFlexible Body Dynamics, 99\nFlight-Path Angle, 37\nFOAM, 198\nFree Body Diagram, 425\nFrobenius Norm, see Matrix, Frobenius Norm\nFroude Number, 103\n\nG\nGalileo, 8\nGambhir, Brij, 269\nGauss, Karl, 451\nGaussian Distribution, 189, 263, 270, 450\u2013452,\n\n455, 463\u2013465\nGeneralized Rodrigues Parameters, 63\nGeopotential, 333, 382\n\nSectoral Harmonics, 385\nTesseral Harmonics, 385\nZonal Harmonics, 385, 386\n\nGeostationary Experimental Ocean Satellite\n(GEOS), 8, 115\n\nGeostationary Operational Environmental\nSatellites (GOES), 8, 10, 11, 13,\n118, 216\n\nGeostationary Orbit, 3, 373\nGeosynchronous Orbit, 12, 373\nGibbs Vector, see Rodrigues Parameters\nGibbs, J. Willard, 48\nGimbal Lock, 56, 57, 75\nGlobal Change Observing Mission (GCOM-\n\nW1), 397\nGlobal Positioning System, 136, 223\n\nAlmanac, 138\nBroadcast Ephemeris, 139\nCarrier Frequencies, 136\nClock Bias, 136\nCoarse Acquisition Code, 136\nDoppler Shift, 138\nError Sources, 138\nInteger Ambiguity, 137, 223\nMultipath, 138\nPhase Difference Measurements, 137, 223,\n\n279\nPrecise Code, 136\nPseudo-Random Code, 136\n\nPseudolites, 138\nSatellites, 138\nSelf Survey, 137\n\nGoddard Trajectory Determination System,\n408\n\nGoldstein, Herbert, 89\nGPS Attitude Determination, 223\nGradient, 23\nGravitational Parameter, 104, 371, 388\nGravity-Gradient Boom, 105\nGreenwich Hour Angle, 386\nGroup, 27\n\nOrthogonal, 28\nSpecial Orthogonal, 28\n\nGyroscope, 140\nBias or Drift, 144, 235, 246, 257\nCoriolis Vibratory, 143\nDry Tuned-Rotor, 141\nDynamic Model Replacement, 245\nFiber Optic, 142\nFloated, 140\nHemispheric Resonating, 143\nLock-In, 142\nMeasurement Model, 143, 247, 263\nMEMS, 143\nMisalignment, 144, 235, 246\nOptical, 141\nRate-Integrating, 140, 219, 263, 288\nRing Laser, 142\nScalar Factor, 144, 235, 246\nSpinning-Mass, 140\nStrapdown, 140\n\nH\nHamilton, William, 17, 37\nHayabusa, 147\nHerpolhode, 89\nHerschel, 401\nHessian, 23\nHigh Energy Astronomy Observatories\n\n(HEAO), 2, 189\nHilbert-Schmidt Norm, see Matrix, Frobenius\n\nNorm\nHoffman, Henry, 12, 107\nHoots, Felix, 393\nHorizon Sensor, 10, 13, 135, 219\n\nScanning, 135\nStatic, 135\n\nHubble Space Telescope (HST), 3, 6, 10, 13,\n112, 141\n\nHughes, Peter, 89\nHyperbolic Orbit, 373\nHysteresis, 168, 303, 315\n\n\n\nIndex 481\n\nI\nInertia Ellipsoid, 89\nInner Product, see Vector, Dot Product\nInnovations Covariance, 256\nInternational Celestial Reference System\n\n(ICRF), see Reference Frame,\nInternational Celestial Reference\nSystem (ICRF)\n\nInternational Space Station, 111\nInternational Sun-Earth Explorer 3 (ISEE-3),\n\n401\nInternational Ultraviolet Explorer (IUE), 12\nInvariant Plane, 89\nInverted Pendulum, 425\n\nJ\nJacobian, 22, 247, 458\nJacobian Elliptic Functions, 95\nJames Webb Space Telescope (JWST), 152,\n\n155, 162, 164, 401\nJitter, 148\nJoint Space Operations Center (JSpOC), 409\nJulian Date, 33\nJunkins, John, 50\n\nK\nKalman Filter, see Estimation Theory, Kalman\n\nFilter\nKalman Gain Matrix, 256, 464\n\nJoseph Form, 453, 465, 468\nKane, Thomas, 99\nKaplan, Marshall, 89\nKasdin, Jeremy, 3\nKepler, 147\nKepler\u2019s Equation, 139, 376, 379\nKepler\u2019s Three Laws, 365\nKepler, Johannes, 365\nKeplerian Motion, 113, 370\n\nLaplace Vector, 372\nOrbital Plane, 371\n\nKinetic Energy, 79, 83, 173\nDissipation, 88, 174\nSpecific, see Specific Kinetic Energy\n\nKozai, Yoshihide, 393\nKreutz-Delgado, Kenneth, 14\nKronecker Delta, 24, 383\n\nL\nLagrange Multiplier, 188, 238\nLagrange Points, 297, 398\n\nCollinear, 400\n\nThree-Body Problem, 398\nTriangular, 400\nTrojan, 401\n\nLandsat, 10\nLaplace Transform, 434\nLaplace Vector, see Keplerian Motion, Laplace\n\nVector\nLaplacian, 23\nLaSalle\u2019s Theorem, 290, 443\nLatitude, 34\n\nGeocentric, 34, 383\nGeodetic, 34\n\nLegendre, Adrien-Marie, 451\nLewis, 11, 13\nLibration, 105, 115\nLibration Dampers, 105\nLibration Points, see Lagrange Points\nLightsey, E. Glenn, 137\nLiu, Frank, 162\nLongitude, 34, 383\nLow-Earth Orbit, 4, 8, 277, 373\nLunar Atmosphere and Dust Environment\n\nExplorer (LADEE), 5\nLyapunov Analysis, 14\nLyapunov Equation, see Control Theory,\n\nLyapunov Equation\nLyapunov Function, see Control Theory,\n\nLyapunov Function, 443\nLaSalle\u2019s Theorem, see LaSalle\u2019s Theorem\n\nLyapunov\u2019s Direct Method, see Control\nTheory, Lyapunov\u2019s Direct Method\n\nM\nMach\u2019s Principle, 32\nMagnetic Dipole, 106, 168\nMagnetic Field, 106, 135, 270, 307, 328, 403\n\nDefinitive Geomagnetic Reference Field,\n404\n\nDipole, 404\nInternational Geomagnetic Reference Field,\n\n107, 220, 275, 333, 404\nMagnetic Field Satellite (Magsat), 2\nMagnetic Torque Control, see Attitude Control,\n\nMagnetic Torque Control\nMagnetic Torquers, 6, 168, 319\n\nDipole Moment, 168, 311\nMagnetometer, 135\n\nThree-Axis, 107, 219, 269, 319, 322\nMagnetometer Calibration, 235, 269\n\nCentered Solution, 272\nBatch, 273\n\nKalman Filtering, 276\nMeasurement Model, 270\n\n\n\n482 Index\n\nMagnetometer Calibration (cont.)\nScalar Checking, 269\nSequential, 273\nTWOSTEP, 269, 274\n\nMAGSAT, 189\nMarandi, S. R., 50\nMason, Glenn, 328\nMATLAB, 172, 322, 475\nMatrix, 17\n\nAdjoint, 20, 29, 346\nBlock Diagonal, 248, 254, 277\nCharacteristic Equation, 41, 213\nCholesky Decomposition, 176, 462\nCross Product, 29, 345\n\nIdentities, 345\nDeterminant, 20, 29, 346\nDiagonal, 19, 197, 248\nDirection Cosine Matrix (DCM), 26, 27\nEigenvalues and Eigenvectors, 2, 40, 82,\n\n175, 188, 213, 349, 434, 436, 442,\n444, 459, 471\n\nExponential, see Matrix Exponential\nFrobenius Norm, 186, 224\nHessian, 452\nIdentity, 19\n\nOrthonormal Basis, 25, 208\nInverse, 20\nInversion Lemma, see Matrix Inversion\n\nLemma\nNonsingular, 20, 255\nNull Space, 153\nOrthogonal, 27, 197, 258\nProduct, 18\nProjection, 255\nProper Orthogonal, 28, 197\nPseudoinverse, 156\nReflection, 61\nSingular Value Decomposition, 196, 271\nSkew Symmetric, 19, 29, 345\nState Transition, see State Transition\n\nMatrix\nSymmetric, 19\nTrace, 19, 186, 188, 197, 346\nTranspose, 18\nTriangular, 19\nZero, 18\n\nMatrix Exponential, 45, 251, 431\nMatrix Inversion Lemma, 453\nMaximum Likelihood Estimation, see\n\nEstimation Theory, Maximum\nLikelihood\n\nMean Motion, 113, 373, 378\nMinimax, 157\nMission Mode, 4\n\nMission Planning Graphics Tool, 397\nModi, Vinod, 50\nModified Rodrigues Parameters, 50, 229, 282,\n\n459\nKalman Filtering, 236\nKinematics, 72\n\nMoment of Inertia, 80\nPrincipal Moments, 82, 85, 94, 100, 105,\n\n117\nProducts, 82\nTriangle Inequality, 82, 117\n\nMoore-Penrose Generalized Inverse, see\nMatrix, Pseudoinverse\n\nMortari, Daniele, 191\nMultimission Modular Spacecraft (MMS), 12,\n\n154, 239\nMurrell, James, 260\n\nN\nNatural Frequency, see Control Theory, Natural\n\nFrequency\nNavigation Base, 31\nNebelecky, Christopher, 382\nNewton\u2019s Universal Gravitational Constant,\n\n104, 370, 383\nNewton-Raphson Iteration, 191, 379\nNonlinear Least Squares, see Estimation\n\nTheory, Nonlinear Least Squares,\n274\n\nNorth American Air Defense Command\n(NORAD), 393\n\nNutation, 85, 87, 174\nBody Rate, 91\nInertial Rate, 92\n\nNutation Dampers, 88, 170\nViscous Ring, 171\n\nNyquist\u2019s Limit, 260, 437\n\nO\nObliquity of the Ecliptic, 421\nObservation Models, 432\n\nLinearization, 434\nMeasurement Sensitivity Matrix, 241, 433\n\nOptical Bench, 31\nOrbit Propagation, 379\nOrbital Dynamics, 365\nOrbital Elements, 138, 374\n\nArgument of Periapsis, 374\nEccentric Anomaly, 376\nEccentricity, 113, 374\nInclination, 374\nInitial Mean Anomaly, 374\n\n\n\nIndex 483\n\nRight Ascension of the Ascending Node,\n374\n\nSemimajor Axis, 374\nTrue Anomaly, 113, 369, 377\n\nOrbital Plane, see Keplerian Motion, Orbital\nPlane\n\nOrbiting Solar Observatory (OSO 1), 6, 8\n\u00d8rsted, 8\nOutgassing, 111\n\nP\nParabolic Orbit, 373\nParallel Axis Theorem, 81\nPerigee, see Ellipse Geometry, Periapsis\nPerturbation Methods, 392\n\nOsculating Orbit, 392\nSecular J2, 395\nVariation of Parameters, 392\n\nOsculating Elements, 392, 393\nPioneer, 6, 392\nPlanck, 401\nPoinsot\u2019s Construction, 89\nPointing\n\nError, 4\nModes, 3\n\nPoisson Distribution, 129\nPolar Radius, see Earth Geoid, Polar Radius\nPolhode, 89\nPotter, James, 183\nPrecession, 113\nPrincipal Axes, 82, 174\n\nMajor, 85\nMinor, 85\n\nPrincipal Moments of Inertia, see Moment of\nInertia, Principal Moments\n\nProbability Density Function, see Estimation\nTheory, Probability Density\nFunction\n\nProcrustes Problem, see Wahba\u2019s Problem\nProducts of Inertia, see Moment of Inertia,\n\nProducts\nPulse-Width Pulse-Frequency, see Attitude\n\nControl, Thrusters, Pulse-Width\nPulse-Frequency\n\nQ\nq Method, 2, 352\nq Method, 187\nQuaternion, 3, 14, 17, 37, 45, 361\n\nAttitude, 45, 350\nConjugate, 39, 347\nError, 289, 354\n\nIdentities, 345\nIdentity, 39, 347\nInverse, 39\nKinematics, 71, 244, 289, 355\nMeasurement, 242\nNormalization, 237, 238\nProduct, 37, 347\nUnit, 46\n\nQUEST, 2, 189\nSequential Rotations, 192\n\nQUEST Measurement Model, 205, 209, 225,\n249, 254\n\nR\nRadar Calibration (RADCAL), 137\nRADARSAT, 398\nRandom Walk Process, 263\nReaction Wheel Characteristics, 148\nReaction Wheels, 6, 100, 147, 319\n\nCharacteristics, 148\nDisturbances, 148\n\nCampbell Diagram, 151\nCogging, 152\nDynamic Imbalance, 149\nStatic Imbalance, 149\nTorque Ripple, 152\nWaterfall Chart, 152\nWhirl Modes, 150\n\nFriction, 148\nRedundant Configurations, 152\n\nDistribution Matrix, 153\nDodecahedron, 155\nMinimax (L1) Law, 157, 163\nNASA Standard, 154, 157, 293\nPseudoinverse (L2) Law, 155, 163\nPyramid, 154\u2013156, 160, 293\nSix-Wheel, 155, 157, 159\n\nRedundancy, 123\nAnalytic Redundancy, 124\nBlock-Redundant, 123\nCold Backup, 123\nCross-Strapped, 123\nHot Backup, 123\nWarm Backup, 123\n\nReference Frame, 10, 24, 31\nBody, 31, 80\nCelestial, 32, 423\nCo-Rotating, 398\nEarth-Centered/Earth-Fixed (ECEF), 32,\n\n139, 270, 383, 385\nFlatley Coordinate System, 325\nGeocentric Inertial (GCI), 32, 107, 109,\n\n375, 389, 391, 405, 421\n\n\n\n484 Index\n\nReference Frame (cont.)\nHill, 62, 118\nInertial, 31\nInternational Celestial Reference System\n\n(ICRF), 32, 130\nLocal-Vertical/Local-Horizontal (LVLH),\n\n36, 105, 112, 216, 219, 339\nPerifocal, 374\nTransformations, 25\n\nSuccesive, 27\nRetrograde Orbit, 397\nReynolds Number, 103, 172\nRiccati Equation, 466\nRight Hand Rule, 30\nRigid Body, 80\n\nDynamics, 84\nTorque-Free Dynamics\n\nAxial Symmetry, 90\nTriaxial Symmetry, 94\n\nRoberson, Robert, 6\nRodrigues Parameters, 48, 243\n\nKalman Filtering, 236\nKinematics, 72\n\nRodrigues, Olinde, 46, 383\nRoll/Yaw Coupling, 13, 114\nRossi X-Ray Timing Explorer (RXTE), 10\nRotation, 40\nRotation Vector, 44\n\nKalman Filtering, 236\nKinematics, 72\n\nS\nSafehold Mode, see Attitude Control, Safehold\nSagnac Effect, 141\nSAMPEX Attitude Control, 318\n\nAttitude Determination, 321\nMagnetic Torque, 324\nModes, 319, 324\n\nOrbit Rate Rotation, 327\nSpecial Pointing, 328\nVertical Pointing, 326\n\nRAM Angle, 325\nRAM Vector, 325\nReaction Wheel, 332\nSimulations, 333\nVelocity Avoidance, 325\n\nSaturation Function, 296, 447\nScalar Product, see Vector, Dot Product\nSchaub, Hanspeter, 50\nSchmidt Trigger, 303\nSchur Norm, see Matrix, Frobenius Norm\nSemi-Synchronous Orbit, 136\n\nSemilatus Rectum, see Ellipse Geometry,\nSemilatus Rectum\n\nSeparation Theorem, 1, 312, 470\nSeparatrix, 87\nSherman-Morrison-Woodbury Formula, see\n\nMatrix Inversion Lemma\nShuster, Malcolm, 1, 2, 17, 201, 254, 256, 269\nSidereal Day, 3, 33\nSingle-Point Failure, 123\nSliding-Mode Control, see Control Theory,\n\nSliding-Mode\nSlosh, 99, 102\nSmithsonian Air and Space Museum, 397\nSolar and Heliospheric Observatory (SOHO),\n\n3, 401\nSolar Day, 34\nSolar Maximum Mission (SMM), 12\nSolar Radiation and Climate Experiment\n\n(SORCE), 13\nSolar Radiation Pressure, 382, 390, 421\n\nAbsorption, 109, 391\nDiffuse Reflection, 109, 391\nSpecular Reflection, 109, 391\n\nSolar, Anomalous and Magnetospheric Particle\nExplorer (SAMPEX), 4, 289, 318\n\nSpace Cone, 93\nSpace Precision Attitude Reference System\n\n(SPARS), 2, 239\nSpace Shuttle, 12\nSpace Technology-5 (ST5), 171\nSpecific Angular Momentum, 37, 371\nSpecific Energy, 371\nSpecific Kinetic Energy, 371\nSpecific Potential Energy, 371\nSpectral Density, 247, 258, 263, 463, 465\nSpectrum Analysis, 278\nSpeed of Light, 130\nSpherical Harmonics, 383, 403\nSputnik, 1, 3\nStabilization, 3\n\nDual-Spin, 6, 7\nGravity-Gradient, 8, 107, 117\nMomentum Bias, 8, 116, 320, 324\nSpin, 6, 84, 107, 287\nThree-Axis, 6, 8, 14\n\nStar Tracker, 125, 242\nAccuracy, 128, 226\nActive Pixel Sensors (APS), 125\nCCD, 125\nCentroiding, 126\nCMOS, 125\nDark Current, 128\nDefocusing, 126\nField of View, 127\n\n\n\nIndex 485\n\nFocal Plane Coordinates, 126\nHot Pixels, 128\nInitial Attitude Acquisition, 126\nInstrument Magnitude, 129\nLost-in-Space Mode, 127\nMeasurement Model, 254\nPoint Spread Function, 126\nResolution, 127\nShot Noise, 127\nStar Catalogs, 129\nTracking Mode, 126\n\nStars\nDifferential Aberration, 132\nParallax, 130\nProper Motion, 130\nStar Catalog, 129\nStellar Aberration, 130\nVisual Magnitude, 129\n\nState Space, see System Modeling, State Space\nState Transition Matrix, 251, 258, 429\nStefan-Boltzmann Law, 109, 391\nStuelpnagel, John, 196\nSun Sensor, 11, 133, 219\n\nCoarse, 133, 319\nFine or Digital, 133, 134, 319, 321\n\nSun-Synchronous Orbit, 277, 397\nDawn/Dusk, 398\n\nSwift, 155, 162\nSystem Modeling, 428\n\nLinearization, 431\nSingle-Input-Single-Output, 430, 433, 437\nState Space, 430\n\nT\nTait-Bryan Angles, 55, 361\n\nKalman Filtering, 236\nKinematics, 361\n\nTANS Vector, 137\nTASTE Test, 189\nTelevision Infrared Observation Satellite\n\n(TIROS), 135\nTesla, Nikola, 106\nThermal Radiation, 109, 392\nThird-Body Forces, 388\nThree-Body Problem, see Lagrange Points,\n\nThree-Body Problem\nThrusters, 6, 169\n\nCold Gas, 169\nElectric, 170\n\nMonopropellant, 169\nSpecific Impulse, 169\n\nTime\nGPS, 139\nGreenwich Mean Sidereal Time (GMST),\n\n32\nUniversal Time (UT), 139\n\nTorque\nAerodynamic Torque, 107\nCouple, 170\nExternal, 103\nGravity-Gradient, 103, 114\nInternal, 99\nMagnetic, 106\nMass-Expulsion, 110, 169\nMomentum Exchange, 99\nSolar Radiation Pressure, 9, 108, 297\n\nTorque Rods, see Magnetic Torquers\nTotal Ozone Mapping Spectrometer-Earth\n\nProbe (TOMS-EP), 11\nTransfer Function, 434\n\nCharacteristic Equation, 437\nPoles, 434, 438\n\nTransformations, see Reference Frame,\nTransformations\n\nTransit Research and Attitude Control\n(TRAAC), 8\n\nTransition Region And Coronal Explorer\n(TRACE), 277\n\nTranslational Momentum, 67\nTRIAD, 2, 183, 184, 199, 208, 319\nTriangle Inequality, 22\n\nMoment of Inertia, 82\nTriaxial, 87\nTropical Rainfall Measuring Mission (TRMM),\n\n5, 10, 13, 124, 135, 218, 275, 393\nAttitude Determination, 218\n\nTsiotras, Panagiotis, 52\nTwo Line Elements, 393\nTwo-Point Boundary Value Problem, 287, 294\nTWOSTEP, see Magnetometer Calibration,\n\nTWOSTEP\n\nU\nUnbiased Estimate, see Estimation Theory,\n\nUnbiased Estimate\nUnscented Kalman Filter, 263\nUnwinding, 313\nUpper Atmosphere Research Satellite (UARS),\n\n11\n\n\n\n486 Index\n\nV\nVallado, David, 389, 406\nVander Velde, Wallace, 183\nVariable-Structure Control, see Sliding-Mode\n\nControl\nVector, 21\n\nAbstract, 25\nBasis, 24, 188\nColumn, 18\nCross Product, 28\nDot Product, 21, 28\nEuclidean Norm, 21, 156\nKinematics, 70\nNadir, 36, 135\nNormalization, 21\nOrthogonal Projection, 21\nOrthonormal, 24, 185\nOuter Product, 20\nRepresentations, 25\nRow, 19\nUnit Vector, 21\nZenith, 105, 326\nZero, 18\n\nVector Product, see Vector, Cross Product\nVernal Equinox, 32, 374\n\nvis viva Equation, 374\nvon Braun, Wernher, 88\n\nW\nWahba\u2019s Problem, 2, 183, 186, 224\n\nAttitude Profile Matrix, 186, 196, 198, 202,\n352\n\nCovariance Analysis, 204\nTwo Observations, 207\n\nDavenport\u2019s K Matrix, 187, 193, 352\nError Analysis, 201\nSVD Method, 196\nTwo Observations, 199\n\nObservability, 213\nWahba, Grace, 2, 186\nWeber Number, 103\nWen, John, 14\nWie, Bong, 14\nWiener, T. F., 50\nWilkinson Microwave Anisotropy Probe\n\n(WMAP), 4, 5, 26, 111, 125, 134,\n288, 297, 318, 336, 401\n\nWIND, 401\n\n\n\tPreface\n\tContents\n\t1 Introduction\n\tReferences\n\n\t2 Matrices, Vectors, Frames, Transforms\n\t2.1 Matrices\n\t2.2 Vectors\n\t2.3 Jacobian, Gradient, and Hessian\n\t2.4 Orthonormal Bases, Change of Basis\n\t2.5 Vectors in Three Dimensions\n\t2.6 Some Useful Reference Frames\n\t2.6.1 Spacecraft Body Frame\n\t2.6.2 Inertial Reference Frames\n\t2.6.3 Earth-Centered/Earth-Fixed Frame\n\t2.6.4 Local-Vertical/Local-Horizontal Frame\n\n\t2.7 Quaternions\n\t2.8 Rotations and Euler's Theorem\n\t2.9 Attitude Representations\n\t2.9.1 Euler Axis/Angle Representation\n\t2.9.2 Rotation Vector Representation\n\t2.9.3 Quaternion Representation\n\t2.9.4 Rodrigues Parameter Representation\n\t2.9.5 Modified Rodrigues Parameters\n\t2.9.6 Euler Angles\n\n\t2.10 Attitude Error Representations\n\tProblems\n\tReferences\n\n\t3 Attitude Kinematics and Dynamics\n\t3.1 Attitude Kinematics\n\t3.1.1 Attitude Matrix\n\t3.1.2 Vector Addition of Angular Velocity\n\t3.1.3 Vector Kinematics\n\n\t3.2 Kinematics of Attitude Parameterizations\n\t3.2.1 Quaternion Kinematics\n\t3.2.2 Rodrigues Parameter Kinematics\n\t3.2.3 Modified Rodrigues Parameter Kinematics\n\t3.2.4 Rotation Vector Kinematics\n\t3.2.5 Euler Angle Kinematics\n\t3.2.6 Attitude Error Kinematics\n\n\t3.3 Attitude Dynamics\n\t3.3.1 Angular Momentum and Kinetic Energy\n\t3.3.2 Rigid Body Dynamics\n\t3.3.3 Rigid Body Motion\n\t3.3.3.1 Spin Stabilization\n\t3.3.3.2 Energy Dissipation\n\t3.3.3.3 Poinsot's Construction\n\n\t3.3.4 Torque-Free Motion of a Rigid Body\n\t3.3.4.1 Axial Symmetry\n\t3.3.4.2 Triaxial Symmetry\n\n\t3.3.5 Internal Torques\n\t3.3.5.1 Reaction Wheels and Control Moment Gyros\n\t3.3.5.2 Slosh\n\n\t3.3.6 External Torques\n\t3.3.6.1 Gravity-Gradient Torque\n\t3.3.6.2 Magnetic Torque\n\t3.3.6.3 Aerodynamic Torque\n\t3.3.6.4 Solar Radiation Pressure Torque\n\t3.3.6.5 Mass-Expulsion Torques\n\n\t3.3.7 Angular Momentum for Health Monitoring\n\t3.3.8 Dynamics of Earth-Pointing Spacecraft\n\n\tProblems\n\tReferences\n\n\t4 Sensors and Actuators\n\t4.1 Redundancy\n\t4.2 Star Trackers\n\t4.2.1 Overview\n\t4.2.2 Modes of Operation\n\t4.2.3 Field of View, Resolution, Update Rate\n\t4.2.4 Star Catalogs\n\t4.2.5 Proper Motion, Parallax, and Aberration\n\n\t4.3 Sun Sensors\n\t4.4 Horizon Sensors\n\t4.5 Magnetometers\n\t4.6 Global Positioning System\n\t4.6.1 GPS Satellites\n\n\t4.7 Gyroscopes\n\t4.7.1 Gyro Measurement Model\n\n\t4.8 Reaction Wheels\n\t4.8.1 Reaction Wheel Characteristics\n\t4.8.2 Reaction Wheel Disturbances\n\t4.8.3 Redundant Wheel Configurations\n\t4.8.3.1 Pseudoinverse Distribution Law\n\t4.8.3.2 Minimax Distribution Law\n\t4.8.3.3 Comparison of Pseudoinverse and Minimax Distribution Laws\n\n\n\t4.9 Control Moment Gyros\n\t4.10 Magnetic Torquers\n\t4.11 Thrusters\n\t4.12 Nutation Dampers\n\tProblems\n\tReferences\n\n\t5 Static Attitude Determination Methods\n\t5.1 The TRIAD Algorithm\n\t5.2 Wahba's Problem\n\t5.3 Quaternion Solutions of Wahba's Problem\n\t5.3.1 Davenport's q Method\n\t5.3.2 Quaternion Estimator (QUEST)\n\t5.3.3 Another View of QUEST\n\t5.3.4 Method of Sequential Rotations\n\t5.3.5 Estimator of the Optimal Quaternion (ESOQ)\n\t5.3.6 Second Estimator of the Optimal Quaternion (ESOQ2)\n\n\t5.4 Matrix Solutions of Wahba's Problem\n\t5.4.1 Singular Value Decomposition (SVD) Method\n\t5.4.2 Fast Optimal Attitude Matrix (FOAM)\n\t5.4.3 Wahba's Problem with Two Observations\n\n\t5.5 Error Analysis of Wahba's Problem\n\t5.5.1 Attitude Error Vector\n\t5.5.2 Covariance Analysis of Wahba's Problem\n\t5.5.3 Covariance with Two Observations\n\n\t5.6 MLE for Attitude Determination\n\t5.6.1 Fisher Information Matrix for Attitude Determination\n\n\t5.7 Induced Attitude Errors from Orbit Errors\n\t5.8 TRMM Attitude Determination\n\t5.9 GPS Attitude Determination\n\tProblems\n\tReferences\n\n\t6 Filtering for Attitude Estimation and Calibration\n\t6.1 Attitude Representations for Kalman Filtering\n\t6.1.1 Three-Component Representations\n\t6.1.2 Additive Quaternion Representation\n\t6.1.3 Multiplicative Quaternion Representation\n\n\t6.2 Attitude Estimation\n\t6.2.1 Kalman Filter Formulation\n\t6.2.1.1 Measurement Update\n\t6.2.1.2 Reset\n\t6.2.1.3 Propagation\n\t6.2.1.4 Gyros for Dynamic Model Replacement\n\n\t6.2.2 Gyro Calibration Kalman Smoother\n\t6.2.3 Filtering and the QUEST Measurement Model\n\t6.2.4 Mission Mode Kalman Filter\n\t6.2.5 Murrell's Version\n\n\t6.3 Farrenkopf's Steady-State Analysis\n\t6.4 Magnetometer Calibration\n\t6.4.1 Measurement Model\n\t6.4.2 Centered Solution\n\t6.4.3 The TWOSTEP Algorithm\n\t6.4.4 Extended Kalman Filter Approach\n\t6.4.5 TRACE Spacecraft Results\n\n\tProblems\n\tReferences\n\n\t7 Attitude Control \n\t7.1 Introduction\n\t7.2 Attitude Control: Regulation Case\n\t7.3 Attitude Control: Tracking Case\n\t7.3.1 Alternative Formulation\n\n\t7.4 Attitude Thruster Control\n\t7.5 Magnetic Torque Attitude Control\n\t7.5.1 Detumbling\n\t7.5.2 Momentum Dumping\n\n\t7.6 Effects of Noise\n\t7.7 SAMPEX Control Design\n\t7.7.1 Attitude Determination\n\t7.7.2 Magnetic Torque Control Law\n\t7.7.3 Science Modes\n\t7.7.3.1 Vertical Pointing Mode\n\t7.7.3.2 Orbit Rate Rotation Mode\n\t7.7.3.3 Special Pointing Mode\n\n\t7.7.4 Reaction Wheel Control Law\n\t7.7.5 Simulations\n\n\tProblems\n\tReferences\n\n\t8 Quaternion Identities\n\t8.1 Cross Product Identities\n\t8.2 Basic Quaternion Identities\n\t8.3 The Matrices ?(q), ?(q), ?(?), and ?(?)\n\t8.4 Identities Involving the Attitude Matrix\n\t8.5 Error Quaternions\n\t8.6 Quaternion Kinematics\n\tReferences\n\n\t9 Euler Angles\n\t10 Orbital Dynamics\n\t10.1 Geometry of Ellipses\n\t10.2 Keplerian Motion\n\t10.2.1 Classical Orbital Elements\n\t10.2.2 Kepler's Equation\n\t10.2.3 Orbit Propagation\n\n\t10.3 Disturbing Forces\n\t10.3.1 Non-Spherical Gravity\n\t10.3.2 Third-Body Forces\n\t10.3.3 Atmospheric Drag\n\t10.3.4 Solar Radiation Pressure\n\n\t10.4 Perturbation Methods\n\t10.4.1 Variation of Parameters\n\t10.4.2 Two Line Elements\n\t10.4.3 A Useful Approximation, Secular J2 Effects Only\n\t10.4.4 Sun-Synchronous Orbits\n\n\t10.5 Lagrange Points\n\tReferences\n\n\t11 Environment Models\n\t11.1 Magnetic Field Models\n\t11.1.1 Dipole Model\n\n\t11.2 Atmospheric Density\n\t11.2.1 Exponentially Decaying Model Atmosphere\n\t11.2.2 Harris-Priester Model Atmosphere\n\t11.2.3 Jacchia and GOST Model Atmospheres\n\t11.2.4 Jacchia-Bowman 2008 (JB2008) Model Atmosphere\n\t11.2.4.1 Temperature Profile\n\t11.2.4.2 Barometric Equation\n\t11.2.4.3 Diffusion Equation\n\t11.2.4.4 Density Correction Factors\n\t11.2.4.5 Semiannual Variation\n\t11.2.4.6 Seasonal-Latitudinal Variation\n\t11.2.4.7 High Altitude Density Correction\n\n\n\t11.3 Sun Position, Radiation Pressure, and Eclipse Conditions\n\t11.4 Orbital Ephemerides of the Sun, Moon, and Planets\n\tReferences\n\n\t12 Review of Control and Estimation Theory\n\t12.1 System Modeling\n\t12.1.1 Inverted Pendulum Modeling\n\t12.1.2 State and Observation Models\n\t12.1.2.1 State Models\n\t12.1.2.2 Observation Models\n\n\t12.1.3 Discrete-Time Systems\n\n\t12.2 Control Theory\n\t12.2.1 Basic Linear Control Design\n\t12.2.1.1 Single Axis Attitude Control\n\n\t12.2.2 Stability of Nonlinear Dynamic Systems\n\t12.2.3 Sliding-Mode Control\n\n\t12.3 Estimation Theory\n\t12.3.1 Static-Based and Filter-Based Estimation\n\t12.3.2 Batch Least Squares Estimation\n\t12.3.3 Sequential Least Squares Estimation\n\t12.3.4 Maximum Likelihood Estimation\n\t12.3.5 Nonlinear Least Squares\n\t12.3.6 Advantages and Disadvantages\n\t12.3.7 State Estimation Techniques\n\t12.3.7.1 Linear Kalman Filter\n\t12.3.7.2 Extended Kalman Filter\n\t12.3.7.3 Smoothing\n\t12.3.7.4 Stability and Performance\n\n\t12.3.8 Linear Covariance Analysis\n\t12.3.9 Separation Theorem\n\n\tReferences\n\n\tAppendix: Computer Software\n\tIndex\n\n"}